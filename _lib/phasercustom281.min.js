(function(){var a=this;var e=e||{};e.DisplayObject=function(){this.position=new e.Point(0,0);this.scale=new e.Point(1,1);this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.worldAlpha=1;this.worldTransform=new e.Matrix();this.worldPosition=new e.Point(0,0);this.worldScale=new e.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new e.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};e.DisplayObject.prototype.constructor=e.DisplayObject;e.DisplayObject.prototype={destroy:function(){if(this.children){var f=this.children.length;while(f--){this.children[f].destroy()}this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=false;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite()},updateTransform:function(q){if(!q&&!this.parent&&!this.game){return this}var g=this.parent;if(q){g=q}else{if(!this.parent){g=this.game.world}}var u=g.worldTransform;var k=this.worldTransform;var o,n,m,l,j,i;if(this.rotation%Phaser.Math.PI2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}o=this._cr*this.scale.x;n=this._sr*this.scale.x;m=-this._sr*this.scale.y;l=this._cr*this.scale.y;j=this.position.x;i=this.position.y;if(this.pivot.x||this.pivot.y){j-=this.pivot.x*o+this.pivot.y*m;i-=this.pivot.x*n+this.pivot.y*l}k.a=o*u.a+n*u.c;k.b=o*u.b+n*u.d;k.c=m*u.a+l*u.c;k.d=m*u.b+l*u.d;k.tx=j*u.a+i*u.c+u.tx;k.ty=j*u.b+i*u.d+u.ty}else{o=this.scale.x;n=0;m=0;l=this.scale.y;j=this.position.x-this.pivot.x*o;i=this.position.y-this.pivot.y*l;k.a=o*u.a;k.b=o*u.b;k.c=l*u.c;k.d=l*u.d;k.tx=j*u.a+i*u.c+u.tx;k.ty=j*u.b+i*u.d+u.ty}o=k.a;n=k.b;m=k.c;l=k.d;var h=(o*l)-(n*m);if(o||n){var f=Math.sqrt((o*o)+(n*n));this.worldRotation=(n>0)?Math.acos(o/f):-Math.acos(o/f);this.worldScale.x=f;this.worldScale.y=h/f}else{if(m||l){var t=Math.sqrt((m*m)+(l*l));this.worldRotation=Phaser.Math.HALF_PI-((l>0)?Math.acos(-m/t):-Math.acos(m/t));this.worldScale.x=h/t;this.worldScale.y=t}else{this.worldScale.x=0;this.worldScale.y=0}}this.worldAlpha=this.alpha*g.worldAlpha;this.worldPosition.x=k.tx;this.worldPosition.y=k.ty;this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,k,u)}return this},preUpdate:function(){},generateTexture:function(g,h,j){var i=this.getLocalBounds();var f=new Phaser.RenderTexture(this.game,i.width|0,i.height|0,j,h,g);e.DisplayObject._tempMatrix.tx=-i.x;e.DisplayObject._tempMatrix.ty=-i.y;f.render(this,e.DisplayObject._tempMatrix);return f},updateCache:function(){this._generateCachedSprite();return this},toGlobal:function(f){this.updateTransform();return this.worldTransform.apply(f)},toLocal:function(f,g){if(g){f=g.toGlobal(f)}this.updateTransform();return this.worldTransform.applyInverse(f)},_renderCachedSprite:function(f){this._cachedSprite.worldAlpha=this.worldAlpha;if(f.gl){e.Sprite.prototype._renderWebGL.call(this._cachedSprite,f)}else{e.Sprite.prototype._renderCanvas.call(this._cachedSprite,f)}},_generateCachedSprite:function(){this._cacheAsBitmap=false;var i=this.getLocalBounds();i.width=Math.max(1,Math.ceil(i.width));i.height=Math.max(1,Math.ceil(i.height));this.updateTransform();if(!this._cachedSprite){var h=0;if(this.texture&&this.texture.baseTexture&&e._enableMultiTextureToggle){h=this.texture.baseTexture.textureIndex}var f=new Phaser.RenderTexture(this.game,i.width,i.height,undefined,undefined,undefined,undefined,h);this._cachedSprite=new e.Sprite(f);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(i.width,i.height)}var g=this._filters;this._filters=null;this._cachedSprite.filters=g;e.DisplayObject._tempMatrix.tx=-i.x;e.DisplayObject._tempMatrix.ty=-i.y;this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(i.x/i.width);this._cachedSprite.anchor.y=-(i.y/i.height);this._filters=g;this._cacheAsBitmap=true},_destroyCachedSprite:function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null}};e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform;Object.defineProperties(e.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(f){this.position.x=f}},y:{get:function(){return this.position.y},set:function(f){this.position.y=f}},worldVisible:{get:function(){if(!this.visible){return false}else{var f=this.parent;if(!f){return this.visible}else{do{if(!f.visible){return false}f=f.parent}while(f)}return true}}},mask:{get:function(){return this._mask},set:function(f){if(this._mask){this._mask.isMask=false}this._mask=f;if(f){this._mask.isMask=true}}},filters:{get:function(){return this._filters},set:function(k){if(Array.isArray(k)){var h=[];for(var g=0;g<k.length;g++){var l=k[g].passes;for(var f=0;f<l.length;f++){h.push(l[f])}}this._filterBlock={target:this,filterPasses:h}}this._filters=k;if(this.blendMode&&this.blendMode===e.blendModes.MULTIPLY){this.blendMode=e.blendModes.NORMAL}}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(f){if(this._cacheAsBitmap===f){return}if(f){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=f}}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);this.children=[];this.ignoreChildInput=false};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;e.DisplayObjectContainer.prototype.addChild=function(f){return this.addChildAt(f,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(g,f){if(f>=0&&f<=this.children.length){if(g.parent){g.parent.removeChild(g)}g.parent=this;this.children.splice(f,0,g);return g}else{throw new Error(g+"addChildAt: The index "+f+" supplied is out of bounds "+this.children.length)}};e.DisplayObjectContainer.prototype.swapChildren=function(i,f){if(i===f){return}var h=this.getChildIndex(i);var g=this.getChildIndex(f);if(h<0||g<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[h]=f;this.children[g]=i};e.DisplayObjectContainer.prototype.getChildIndex=function(g){var f=this.children.indexOf(g);if(f===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return f};e.DisplayObjectContainer.prototype.setChildIndex=function(h,g){if(g<0||g>=this.children.length){throw new Error("The supplied index is out of bounds")}var f=this.getChildIndex(h);this.children.splice(f,1);this.children.splice(g,0,h)};e.DisplayObjectContainer.prototype.getChildAt=function(f){if(f<0||f>=this.children.length){throw new Error("getChildAt: Supplied index "+f+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[f]};e.DisplayObjectContainer.prototype.removeChild=function(g){var f=this.children.indexOf(g);if(f===-1){return}return this.removeChildAt(f)};e.DisplayObjectContainer.prototype.removeChildAt=function(f){var g=this.getChildAt(f);if(g){g.parent=undefined;this.children.splice(f,1)}return g};e.DisplayObjectContainer.prototype.removeChildren=function(h,j){if(h===undefined){h=0}if(j===undefined){j=this.children.length}var f=j-h;if(f>0&&f<=j){var k=this.children.splice(h,f);for(var g=0;g<k.length;g++){var l=k[g];l.parent=undefined}return k}else{if(f===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}}};e.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var f=0;f<this.children.length;f++){this.children[f].updateTransform()}};e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform;e.DisplayObjectContainer.prototype.getBounds=function(O){var C=(O&&O instanceof e.DisplayObject);var x=true;if(!C){O=this}else{if(O instanceof e.DisplayObjectContainer){x=O.contains(this)}else{x=false}}var z;if(C){var u=O.worldTransform;O.worldTransform=e.identityMatrix;for(z=0;z<O.children.length;z++){O.children[z].updateTransform()}}var J=Infinity;var G=Infinity;var H=-Infinity;var D=-Infinity;var F;var o;var m;var t=false;for(z=0;z<this.children.length;z++){var l=this.children[z];if(!l.visible){continue}t=true;F=this.children[z].getBounds();J=(J<F.x)?J:F.x;G=(G<F.y)?G:F.y;o=F.width+F.x;m=F.height+F.y;H=(H>o)?H:o;D=(D>m)?D:m}var n=this._bounds;if(!t){n=new e.Rectangle();var s=n.x;var r=n.width+n.x;var q=n.y;var p=n.height+n.y;var v=this.worldTransform;var N=v.a;var L=v.b;var I=v.c;var E=v.d;var M=v.tx;var K=v.ty;var B=N*r+I*p+M;var j=E*p+L*r+K;var A=N*s+I*p+M;var h=E*p+L*s+K;var y=N*s+I*q+M;var g=E*q+L*s+K;var w=N*r+I*q+M;var f=E*q+L*r+K;H=B;D=j;J=B;G=j;J=A<J?A:J;J=y<J?y:J;J=w<J?w:J;G=h<G?h:G;G=g<G?g:G;G=f<G?f:G;H=A>H?A:H;H=y>H?y:H;H=w>H?w:H;D=h>D?h:D;D=g>D?g:D;D=f>D?f:D}n.x=J;n.y=G;n.width=H-J;n.height=D-G;if(C){O.worldTransform=u;for(z=0;z<O.children.length;z++){O.children[z].updateTransform()}}if(!x){var k=O.getBounds();n.x-=k.x;n.y-=k.y}return n};e.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};e.DisplayObjectContainer.prototype.contains=function(f){if(!f){return false}else{if(f===this){return true}else{return this.contains(f.parent)}}};e.DisplayObjectContainer.prototype._renderWebGL=function(g){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(g);return}var f;if(this._mask||this._filters){if(this._filters){g.spriteBatch.flush();g.filterManager.pushFilter(this._filterBlock)}if(this._mask){g.spriteBatch.stop();g.maskManager.pushMask(this.mask,g);g.spriteBatch.start()}for(f=0;f<this.children.length;f++){this.children[f]._renderWebGL(g)}g.spriteBatch.stop();if(this._mask){g.maskManager.popMask(this._mask,g)}if(this._filters){g.filterManager.popFilter()}g.spriteBatch.start()}else{for(f=0;f<this.children.length;f++){this.children[f]._renderWebGL(g)}}};e.DisplayObjectContainer.prototype._renderCanvas=function(g){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(g);return}if(this._mask){g.maskManager.pushMask(this._mask,g)}for(var f=0;f<this.children.length;f++){this.children[f]._renderCanvas(g)}if(this._mask){g.maskManager.popMask(g)}};Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(g){var f=this.getLocalBounds().width;if(f!==0){this.scale.x=g/f}else{this.scale.x=1}this._width=g}});Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(g){var f=this.getLocalBounds().height;if(f!==0){this.scale.y=g/f}else{this.scale.y=1}this._height=g}});e.Sprite=function(f){e.DisplayObjectContainer.call(this);this.anchor=new e.Point(e.Sprite.defaultAnchor.x,e.Sprite.defaultAnchor.y);this.texture=f||e.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=e.blendModes.NORMAL;this.shader=null;this.exists=true;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};e.Sprite.defaultAnchor={x:0,y:0};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(f){this.scale.x=f/this.texture.frame.width;this._width=f}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(f){this.scale.y=f/this.texture.frame.height;this._height=f}});e.Sprite.prototype.setTexture=function(g,f){if(f!==undefined){this.texture.baseTexture.destroy()}this.texture.baseTexture.skipRender=false;this.texture=g;this.texture.valid=true;this.cachedTint=-1};e.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};e.Sprite.prototype.getBounds=function(s){var p=this.texture.frame.width;var o=this.texture.frame.height;var n=p*(1-this.anchor.x);var m=p*-this.anchor.x;var l=o*(1-this.anchor.y);var k=o*-this.anchor.y;var q=s||this.worldTransform;var F=q.a;var D=q.b;var B=q.c;var z=q.d;var G=q.tx;var E=q.ty;var A=-Infinity;var w=-Infinity;var C=Infinity;var y=Infinity;if(D===0&&B===0){if(F<0){F*=-1;var x=n;n=-m;m=-x}if(z<0){z*=-1;var x=l;l=-k;k=-x}C=F*m+G;A=F*n+G;y=z*k+E;w=z*l+E}else{var v=F*m+B*k+G;var i=z*k+D*m+E;var u=F*n+B*k+G;var h=z*k+D*n+E;var t=F*n+B*l+G;var g=z*l+D*n+E;var r=F*m+B*l+G;var f=z*l+D*m+E;C=v<C?v:C;C=u<C?u:C;C=t<C?t:C;C=r<C?r:C;y=i<y?i:y;y=h<y?h:y;y=g<y?g:y;y=f<y?f:y;A=v>A?v:A;A=u>A?u:A;A=t>A?t:A;A=r>A?r:A;w=i>w?i:w;w=h>w?h:w;w=g>w?g:w;w=f>w?f:w}var j=this._bounds;j.x=C;j.width=A-C;j.y=y;j.height=w-y;this._currentBounds=j;return j};e.Sprite.prototype.getLocalBounds=function(){var f=this.worldTransform;this.worldTransform=e.identityMatrix;for(var g=0;g<this.children.length;g++){this.children[g].updateTransform()}var h=this.getBounds();this.worldTransform=f;for(g=0;g<this.children.length;g++){this.children[g].updateTransform()}return h};e.Sprite.prototype._renderWebGL=function(k,h){if(!this.visible||this.alpha<=0||!this.renderable){return}var f=this.worldTransform;if(h){f=h}if(this._mask||this._filters){var g=k.spriteBatch;if(this._filters){g.flush();k.filterManager.pushFilter(this._filterBlock)}if(this._mask){g.stop();k.maskManager.pushMask(this.mask,k);g.start()}g.render(this);for(var j=0;j<this.children.length;j++){this.children[j]._renderWebGL(k)}g.stop();if(this._mask){k.maskManager.popMask(this._mask,k)}if(this._filters){k.filterManager.popFilter()}g.start()}else{k.spriteBatch.render(this);for(var j=0;j<this.children.length;j++){this.children[j]._renderWebGL(k,f)}}};e.Sprite.prototype._renderCanvas=function(k,p){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0){return}var f=this.worldTransform;if(p){f=p}if(this.blendMode!==k.currentBlendMode){k.currentBlendMode=this.blendMode;k.context.globalCompositeOperation=e.blendModesCanvas[k.currentBlendMode]}if(this._mask){k.maskManager.pushMask(this._mask,k)}if(!this.texture.valid){for(var q=0;q<this.children.length;q++){this.children[q]._renderCanvas(k)}if(this._mask){k.maskManager.popMask(k)}return}var o=this.texture.baseTexture.resolution/k.resolution;k.context.globalAlpha=this.worldAlpha;if(k.smoothProperty&&k.scaleMode!==this.texture.baseTexture.scaleMode){k.scaleMode=this.texture.baseTexture.scaleMode;k.context[k.smoothProperty]=(k.scaleMode===e.scaleModes.LINEAR)}var m=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var l=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var x=(f.tx*k.resolution)+k.shakeX;var v=(f.ty*k.resolution)+k.shakeY;var j=this.texture.crop.width;var n=this.texture.crop.height;if(this.texture.rotated){var w=f.a;var u=f.b;var t=f.c;var s=f.d;var r=j;x=f.c*n+x;v=f.d*n+v;f.a=w*6.123233995736766e-17+-t;f.b=u*6.123233995736766e-17+-s;f.c=w+t*6.123233995736766e-17;f.d=u+s*6.123233995736766e-17;j=n;n=r}if(k.roundPixels){k.context.setTransform(f.a,f.b,f.c,f.d,x|0,v|0);m|=0;l|=0}else{k.context.setTransform(f.a,f.b,f.c,f.d,x,v)}m/=o;l/=o;if(this.tint!==16777215){if(this.texture.requiresReTint||this.cachedTint!==this.tint){this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false}k.context.drawImage(this.tintedTexture,0,0,j,n,m,l,j/o,n/o)}else{var h=this.texture.crop.x;var g=this.texture.crop.y;j=Math.floor(j);n=Math.floor(n);k.context.drawImage(this.texture.baseTexture.source,h,g,j,n,m,l,j/o,n/o)}for(var q=0;q<this.children.length;q++){this.children[q]._renderCanvas(k)}if(this._mask){k.maskManager.popMask(k)}};e.initDefaultShaders=function(){};e.CompileVertexShader=function(g,f){return e._CompileShader(g,f,g.VERTEX_SHADER)};e.CompileFragmentShader=function(g,f){return e._CompileShader(g,f,g.FRAGMENT_SHADER)};e._CompileShader=function(j,i,h){var g=i;if(Array.isArray(i)){g=i.join("\n")}var f=j.createShader(h);j.shaderSource(f,g);j.compileShader(f);if(!j.getShaderParameter(f,j.COMPILE_STATUS)){window.console.log(j.getShaderInfoLog(f));return null}return f};e.compileProgram=function(j,f,h){var g=e.CompileFragmentShader(j,h);var i=e.CompileVertexShader(j,f);var k=j.createProgram();j.attachShader(k,i);j.attachShader(k,g);j.linkProgram(k);if(!j.getProgramParameter(k,j.LINK_STATUS)){window.console.log(j.getProgramInfoLog(k));window.console.log("Could not initialise shaders")}return k};e.PixiShader=function(f){this._UID=Phaser._UID++;this.gl=f;this.program=null;this.fragmentSrc=null;this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};e.PixiShader.prototype.constructor=e.PixiShader;e.PixiShader.prototype.initMultitexShader=function(){var n=this.gl;this.MAX_TEXTURES=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);var f="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n";for(var j=1;j<this.MAX_TEXTURES;++j){f+="\tif (vTextureIndex == "+j+".0) {gl_FragColor = texture2D(uSamplerArray["+j+"], vTextureCoord) * vColor;return;}\n"}this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",f,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"];var h=e.compileProgram(n,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);n.useProgram(h);this.uSamplerArray=n.getUniformLocation(h,"uSamplerArray[0]");this.projectionVector=n.getUniformLocation(h,"projectionVector");this.offsetVector=n.getUniformLocation(h,"offsetVector");this.dimensions=n.getUniformLocation(h,"dimensions");this.aVertexPosition=n.getAttribLocation(h,"aVertexPosition");this.aTextureCoord=n.getAttribLocation(h,"aTextureCoord");this.colorAttribute=n.getAttribLocation(h,"aColor");this.aTextureIndex=n.getAttribLocation(h,"aTextureIndex");var m=[];var g=n.createTexture();n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,g);n.texImage2D(n.TEXTURE_2D,0,n.RGB,1,1,0,n.RGB,n.UNSIGNED_BYTE,null);for(var l=0;l<this.MAX_TEXTURES;++l){n.activeTexture(n.TEXTURE0+l);n.bindTexture(n.TEXTURE_2D,g);m.push(l)}n.activeTexture(n.TEXTURE0);n.uniform1iv(this.uSamplerArray,m);if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var k in this.uniforms){this.uniforms[k].uniformLocation=n.getUniformLocation(h,k)}this.initUniforms();this.program=h};e.PixiShader.prototype.initDefaultShader=function(){if(this.fragmentSrc===null){this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]}var h=this.gl;var f=e.compileProgram(h,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);h.useProgram(f);this.uSampler=h.getUniformLocation(f,"uSampler");this.projectionVector=h.getUniformLocation(f,"projectionVector");this.offsetVector=h.getUniformLocation(f,"offsetVector");this.dimensions=h.getUniformLocation(f,"dimensions");this.aVertexPosition=h.getAttribLocation(f,"aVertexPosition");this.aTextureCoord=h.getAttribLocation(f,"aTextureCoord");this.colorAttribute=h.getAttribLocation(f,"aColor");this.aTextureIndex=h.getAttribLocation(f,"aTextureIndex");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var g in this.uniforms){this.uniforms[g].uniformLocation=h.getUniformLocation(f,g)}this.initUniforms();this.program=f};e.PixiShader.prototype.init=function(f){if(e._enableMultiTextureToggle&&!f){this.initMultitexShader()}else{this.initDefaultShader()}};e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var i=this.gl;var f;for(var g in this.uniforms){f=this.uniforms[g];var h=f.type;if(h==="sampler2D"){f._init=false;if(f.value!==null){this.initSampler2D(f)}}else{if(h==="mat2"||h==="mat3"||h==="mat4"){f.glMatrix=true;f.glValueLength=1;if(h==="mat2"){f.glFunc=i.uniformMatrix2fv}else{if(h==="mat3"){f.glFunc=i.uniformMatrix3fv}else{if(h==="mat4"){f.glFunc=i.uniformMatrix4fv}}}}else{f.glFunc=i["uniform"+h];if(h==="2f"||h==="2i"){f.glValueLength=2}else{if(h==="3f"||h==="3i"){f.glValueLength=3}else{if(h==="4f"||h==="4i"){f.glValueLength=4}else{f.glValueLength=1}}}}}}};e.PixiShader.prototype.initSampler2D=function(h){if(!h.value||!h.value.baseTexture||!h.value.baseTexture.hasLoaded){return}var m=this.gl;m.activeTexture(m.TEXTURE0+this.textureCount);m.bindTexture(m.TEXTURE_2D,h.value.baseTexture._glTextures[m.id]);if(h.textureData){var k=h.textureData;var o=(k.magFilter)?k.magFilter:m.LINEAR;var g=(k.minFilter)?k.minFilter:m.LINEAR;var l=(k.wrapS)?k.wrapS:m.CLAMP_TO_EDGE;var j=(k.wrapT)?k.wrapT:m.CLAMP_TO_EDGE;var n=(k.luminance)?m.LUMINANCE:m.RGBA;if(k.repeat){l=m.REPEAT;j=m.REPEAT}m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!!k.flipY);if(k.width){var f=(k.width)?k.width:512;var p=(k.height)?k.height:2;var i=(k.border)?k.border:0;m.texImage2D(m.TEXTURE_2D,0,n,f,p,i,n,m.UNSIGNED_BYTE,null)}else{m.texImage2D(m.TEXTURE_2D,0,n,m.RGBA,m.UNSIGNED_BYTE,h.value.baseTexture.source)}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,g);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,j)}m.uniform1i(h.uniformLocation,this.textureCount);h._init=true;this.textureCount++};e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var f;var h=this.gl;for(var g in this.uniforms){f=this.uniforms[g];if(f.glValueLength===1){if(f.glMatrix===true){f.glFunc.call(h,f.uniformLocation,f.transpose,f.value)}else{f.glFunc.call(h,f.uniformLocation,f.value)}}else{if(f.glValueLength===2){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y)}else{if(f.glValueLength===3){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z)}else{if(f.glValueLength===4){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z,f.value.w)}else{if(f.type==="sampler2D"){if(f._init){h.activeTexture(h["TEXTURE"+this.textureCount]);if(f.value.baseTexture._dirty[h.id]){e.instances[h.id].updateTexture(f.value.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,f.value.baseTexture._glTextures[h.id])}h.uniform1i(f.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(f)}}}}}}}};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vTextureIndex = aTextureIndex;","}"];e.PixiFastShader=function(h){this._UID=Phaser._UID++;this.gl=h;this.program=null;if(e._enableMultiTextureToggle){var h=this.gl;this.MAX_TEXTURES=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS);var f="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n";for(var g=1;g<this.MAX_TEXTURES;++g){f+="\tif (vTextureIndex == "+g+".0) { gl_FragColor = texture2D(uSamplerArray["+g+"], vTextureCoord) * vColor;return;}\n"}this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",f,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else{this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]}this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.constructor=e.PixiFastShader;e.PixiFastShader.prototype.init=function(){var k=this.gl;var g=e.compileProgram(k,this.vertexSrc,this.fragmentSrc);k.useProgram(g);this.uSampler=e._enableMultiTextureToggle?k.getUniformLocation(g,"uSamplerArray[0]"):k.getUniformLocation(g,"uSampler");if(e._enableMultiTextureToggle){var j=[];var f=k.createTexture();k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,f);k.texImage2D(k.TEXTURE_2D,0,k.RGB,1,1,0,k.RGB,k.UNSIGNED_BYTE,null);for(var h=0;h<this.MAX_TEXTURES;++h){k.activeTexture(k.TEXTURE0+h);k.bindTexture(k.TEXTURE_2D,f);j.push(h)}k.activeTexture(k.TEXTURE0);k.uniform1iv(this.uSampler,j)}this.projectionVector=k.getUniformLocation(g,"projectionVector");this.offsetVector=k.getUniformLocation(g,"offsetVector");this.dimensions=k.getUniformLocation(g,"dimensions");this.uMatrix=k.getUniformLocation(g,"uMatrix");this.aVertexPosition=k.getAttribLocation(g,"aVertexPosition");this.aPositionCoord=k.getAttribLocation(g,"aPositionCoord");this.aScale=k.getAttribLocation(g,"aScale");this.aRotation=k.getAttribLocation(g,"aRotation");this.aTextureCoord=k.getAttribLocation(g,"aTextureCoord");this.colorAttribute=k.getAttribLocation(g,"aColor");this.aTextureIndex=k.getAttribLocation(g,"aTextureIndex");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];this.program=g};e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.StripShader=function(h){this._UID=Phaser._UID++;this.gl=h;this.program=null;if(e._enableMultiTextureToggle){var h=this.gl;this.MAX_TEXTURES=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS);var f="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n";for(var g=1;g<this.MAX_TEXTURES;++g){f+="\tif (vTextureIndex == "+g+".0) { gl_FragColor = texture2D(uSamplerArray["+g+"], vTextureCoord) ;return;}\n"}this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",f,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else{this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"]}this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","}"];this.init()};e.StripShader.prototype.constructor=e.StripShader;e.StripShader.prototype.init=function(){var k=this.gl;var g=e.compileProgram(k,this.vertexSrc,this.fragmentSrc);k.useProgram(g);this.uSampler=e._enableMultiTextureToggle?k.getUniformLocation(g,"uSamplerArray[0]"):k.getUniformLocation(g,"uSampler");if(e._enableMultiTextureToggle){var j=[];var f=k.createTexture();k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,f);k.texImage2D(k.TEXTURE_2D,0,k.RGB,1,1,0,k.RGB,k.UNSIGNED_BYTE,null);for(var h=0;h<this.MAX_TEXTURES;++h){k.activeTexture(k.TEXTURE0+h);k.bindTexture(k.TEXTURE_2D,f);j.push(h)}k.activeTexture(k.TEXTURE0);k.uniform1iv(this.uSampler,j)}this.projectionVector=k.getUniformLocation(g,"projectionVector");this.offsetVector=k.getUniformLocation(g,"offsetVector");this.colorAttribute=k.getAttribLocation(g,"aColor");this.aTextureIndex=k.getAttribLocation(g,"aTextureIndex");this.aVertexPosition=k.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=k.getAttribLocation(g,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex];this.translationMatrix=k.getUniformLocation(g,"translationMatrix");this.alpha=k.getUniformLocation(g,"alpha");this.program=g};e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.PrimitiveShader=function(f){this._UID=Phaser._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};e.PrimitiveShader.prototype.constructor=e.PrimitiveShader;e.PrimitiveShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.tintColor=g.getUniformLocation(f,"tint");this.flipY=g.getUniformLocation(f,"flipY");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.colorAttribute=g.getAttribLocation(f,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.ComplexPrimitiveShader=function(f){this._UID=Phaser._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader;e.ComplexPrimitiveShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.tintColor=g.getUniformLocation(f,"tint");this.color=g.getUniformLocation(f,"color");this.flipY=g.getUniformLocation(f,"flipY");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.glContexts=[];e.instances=[];e._enableMultiTextureToggle=false;e.WebGLRenderer=function(f){this.game=f;if(!e.defaultRenderer){e.defaultRenderer=this}this.extensions={};this.type=Phaser.WEBGL;this.resolution=f.resolution;this.transparent=f.transparent;this.autoResize=false;this.preserveDrawingBuffer=f.preserveDrawingBuffer;this.clearBeforeRender=f.clearBeforeRender;this.width=f.width;this.height=f.height;this.view=f.canvas;this._contextOptions={alpha:this.transparent,antialias:f.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:this.preserveDrawingBuffer};this.projection=new e.Point();this.offset=new e.Point();this.shaderManager=new e.WebGLShaderManager();this.spriteBatch=new e.WebGLSpriteBatch(f);this.maskManager=new e.WebGLMaskManager();this.filterManager=new e.WebGLFilterManager();this.stencilManager=new e.WebGLStencilManager();this.blendModeManager=new e.WebGLBlendModeManager();this.renderSession={};this.currentBatchedTextures=[];this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.flushCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.renderSession.maxTextureAvailableSpace=null;this.initContext();this.mapBlendModes()};e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.initContext=function(){var i=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=i;if(!i){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.maxTextures=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=this.gl.getParameter(i.MAX_TEXTURE_SIZE);this.glContextId=i.id=e.WebGLRenderer.glContextId++;e.glContexts[this.glContextId]=i;e.instances[this.glContextId]=this;i.disable(i.DEPTH_TEST);i.disable(i.CULL_FACE);i.enable(i.BLEND);this.shaderManager.setContext(i);this.spriteBatch.setContext(i);this.maskManager.setContext(i);this.filterManager.setContext(i);this.blendModeManager.setContext(i);this.stencilManager.setContext(i);this.renderSession.gl=this.gl;this.resize(this.width,this.height);this.extensions.compression={};var h=i.getExtension("WEBGL_compressed_texture_etc1")||i.getExtension("WEBKIT_WEBGL_compressed_texture_etc1");var g=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");var f=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(h){this.extensions.compression.ETC1=h}if(g){this.extensions.compression.PVRTC=g}if(f){this.extensions.compression.S3TC=f}};e.WebGLRenderer.prototype.setTexturePriority=function(h){if(!e._enableMultiTextureToggle){console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.");return}var p=function(i){--i;i|=i>>1;i|=i>>2;i|=i>>4;i|=i>>8;i|=i>>16;return ++i};var n=this.gl;var r=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);var k=n.getParameter(n.MAX_TEXTURE_SIZE);var o=this.game.cache._cache.image;var q=null;for(var m=0;m<this.currentBatchedTextures.length;m++){q=this.currentBatchedTextures[m];if(!(q in o)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',q);continue}o[q].base.textureIndex=0}var g=(k)-p(Math.max(this.width,this.height));this.currentBatchedTextures.length=0;for(var l=0;l<h.length;++l){q=h[l];if(!(q in o)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',q);continue}var f=o[q].base;g-=p(Math.max(f.width,f.height));if(g<=0){f.textureIndex=0;console.warn('setTexturePriority: Image "%s" was given textureIndex=0 because there is no available texture space (%s).',q,g)}else{f.textureIndex=(1+(l%(r-1)))}this.currentBatchedTextures.push(q)}this.renderSession.maxTextureAvailableSpace=g;return this.currentBatchedTextures};e.WebGLRenderer.prototype.render=function(f){if(this.contextLost){return}var g=this.gl;g.viewport(0,0,this.width,this.height);g.bindFramebuffer(g.FRAMEBUFFER,null);if(this.game.clearBeforeRender){g.clearColor(f._bgColor.r,f._bgColor.g,f._bgColor.b,f._bgColor.a);g.clear(g.COLOR_BUFFER_BIT)}this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(f,this.projection)};e.WebGLRenderer.prototype.renderDisplayObject=function(i,f,g,h){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flushCount=0;this.renderSession.flipY=g?-1:1;this.renderSession.projection=f;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,g);i._renderWebGL(this.renderSession,h);this.spriteBatch.end()};e.WebGLRenderer.prototype.resize=function(g,f){this.width=g*this.resolution;this.height=f*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};e.WebGLRenderer.prototype.updateCompressedTexture=function(g){if(!g.hasLoaded){return false}var h=this.gl;var f=g.source;if(!g._glTextures[h.id]){g._glTextures[h.id]=h.createTexture()}h.activeTexture(h.TEXTURE0+g.textureIndex);h.bindTexture(h.TEXTURE_2D,g._glTextures[h.id]);h.compressedTexImage2D(h.TEXTURE_2D,0,f.glExtensionFormat,f.width,f.height,0,f.textureData);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,g.scaleMode===e.scaleModes.LINEAR?h.LINEAR:h.NEAREST);if(g.mipmap&&Phaser.Math.isPowerOfTwo(g.width,g.height)){h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,g.scaleMode===e.scaleModes.LINEAR?h.LINEAR_MIPMAP_LINEAR:h.NEAREST_MIPMAP_NEAREST);h.generateMipmap(h.TEXTURE_2D)}else{h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,g.scaleMode===e.scaleModes.LINEAR?h.LINEAR:h.NEAREST)}if(!g._powerOf2){h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)}else{h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)}g._dirty[h.id]=false;return true};e.WebGLRenderer.prototype.updateTexture=function(f){if(!f.hasLoaded){return false}if(f.source.compressionAlgorithm){return this.updateCompressedTexture(f)}var g=this.gl;if(!f._glTextures[g.id]){f._glTextures[g.id]=g.createTexture()}g.activeTexture(g.TEXTURE0+f.textureIndex);g.bindTexture(g.TEXTURE_2D,f._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultipliedAlpha);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);if(f.mipmap&&Phaser.Math.isPowerOfTwo(f.width,f.height)){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR_MIPMAP_LINEAR:g.NEAREST_MIPMAP_NEAREST);g.generateMipmap(g.TEXTURE_2D)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST)}if(!f._powerOf2){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)}f._dirty[g.id]=false;return true};e.WebGLRenderer.prototype.destroy=function(){e.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;Phaser.CanvasPool.remove(this);e.instances[this.glContextId]=null;e.WebGLRenderer.glContextId--};e.WebGLRenderer.prototype.mapBlendModes=function(){var h=this.gl;if(!e.blendModesWebGL){var f=[];var g=e.blendModes;f[g.NORMAL]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.ADD]=[h.SRC_ALPHA,h.DST_ALPHA];f[g.MULTIPLY]=[h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA];f[g.SCREEN]=[h.SRC_ALPHA,h.ONE];f[g.OVERLAY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.DARKEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.LIGHTEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.COLOR_DODGE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.COLOR_BURN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.HARD_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.SOFT_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.DIFFERENCE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.EXCLUSION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.HUE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.SATURATION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.COLOR]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];f[g.LUMINOSITY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL=f}};e.WebGLRenderer.prototype.getMaxTextureUnit=function(){var f=this.gl;return f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)};e.enableMultiTexture=function(){e._enableMultiTextureToggle=true};e.WebGLRenderer.glContextId=0;e.WebGLRenderer.textureArray=[];e.WebGLBlendModeManager=function(){this.currentBlendMode=99999};e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager;e.WebGLBlendModeManager.prototype.setContext=function(f){this.gl=f};e.WebGLBlendModeManager.prototype.setBlendMode=function(f){if(this.currentBlendMode===f){return false}this.currentBlendMode=f;var g=e.blendModesWebGL[this.currentBlendMode];if(g){this.gl.blendFunc(g[0],g[1])}return true};e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};e.WebGLMaskManager=function(){};e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager;e.WebGLMaskManager.prototype.setContext=function(f){this.gl=f};e.WebGLMaskManager.prototype.pushMask=function(g,f){var h=f.gl;if(g.dirty){e.WebGLGraphics.updateGraphics(g,h)}if(g._webGL[h.id]===undefined||g._webGL[h.id].data===undefined||g._webGL[h.id].data.length===0){return}f.stencilManager.pushStencil(g,g._webGL[h.id].data[0],f)};e.WebGLMaskManager.prototype.popMask=function(g,f){var h=this.gl;if(g._webGL[h.id]===undefined||g._webGL[h.id].data===undefined||g._webGL[h.id].data.length===0){return}f.stencilManager.popStencil(g,g._webGL[h.id].data[0],f)};e.WebGLMaskManager.prototype.destroy=function(){this.gl=null};e.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};e.WebGLStencilManager.prototype.setContext=function(f){this.gl=f};e.WebGLStencilManager.prototype.pushStencil=function(f,i,g){var h=this.gl;this.bindGraphics(f,i,g);if(this.stencilStack.length===0){h.enable(h.STENCIL_TEST);h.clear(h.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(i);var j=this.count;h.colorMask(false,false,false,false);h.stencilFunc(h.ALWAYS,0,255);h.stencilOp(h.KEEP,h.KEEP,h.INVERT);if(i.mode===1){h.drawElements(h.TRIANGLE_FAN,i.indices.length-4,h.UNSIGNED_SHORT,0);if(this.reverse){h.stencilFunc(h.EQUAL,255-j,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}else{h.stencilFunc(h.EQUAL,j,255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,(i.indices.length-4)*2);if(this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255)}else{h.stencilFunc(h.EQUAL,j+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){h.stencilFunc(h.EQUAL,255-j,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}else{h.stencilFunc(h.EQUAL,j,255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}h.drawElements(h.TRIANGLE_STRIP,i.indices.length,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255)}else{h.stencilFunc(h.EQUAL,j+1,255)}}h.colorMask(true,true,true,true);h.stencilOp(h.KEEP,h.KEEP,h.KEEP);this.count++};e.WebGLStencilManager.prototype.bindGraphics=function(g,l,i){this._currentGraphics=g;var k=this.gl;var f=i.projection,j=i.offset,h;if(l.mode===1){h=i.shaderManager.complexPrimitiveShader;i.shaderManager.setShader(h);k.uniform1f(h.flipY,i.flipY);k.uniformMatrix3fv(h.translationMatrix,false,g.worldTransform.toArray(true));k.uniform2f(h.projectionVector,f.x,-f.y);k.uniform2f(h.offsetVector,-j.x,-j.y);k.uniform3fv(h.tintColor,Phaser.Color.hexToRGBArray(g.tint));k.uniform3fv(h.color,l.color);k.uniform1f(h.alpha,g.worldAlpha*l.alpha);k.bindBuffer(k.ARRAY_BUFFER,l.buffer);k.vertexAttribPointer(h.aVertexPosition,2,k.FLOAT,false,4*2,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,l.indexBuffer)}else{h=i.shaderManager.primitiveShader;i.shaderManager.setShader(h);k.uniformMatrix3fv(h.translationMatrix,false,g.worldTransform.toArray(true));k.uniform1f(h.flipY,i.flipY);k.uniform2f(h.projectionVector,f.x,-f.y);k.uniform2f(h.offsetVector,-j.x,-j.y);k.uniform3fv(h.tintColor,Phaser.Color.hexToRGBArray(g.tint));k.uniform1f(h.alpha,g.worldAlpha);k.bindBuffer(k.ARRAY_BUFFER,l.buffer);k.vertexAttribPointer(h.aVertexPosition,2,k.FLOAT,false,4*6,0);k.vertexAttribPointer(h.colorAttribute,4,k.FLOAT,false,4*6,2*4);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,l.indexBuffer)}};e.WebGLStencilManager.prototype.popStencil=function(f,i,g){var h=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){h.disable(h.STENCIL_TEST)}else{var j=this.count;this.bindGraphics(f,i,g);h.colorMask(false,false,false,false);if(i.mode===1){this.reverse=!this.reverse;if(this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}else{h.stencilFunc(h.EQUAL,j+1,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,(i.indices.length-4)*2);h.stencilFunc(h.ALWAYS,0,255);h.stencilOp(h.KEEP,h.KEEP,h.INVERT);h.drawElements(h.TRIANGLE_FAN,i.indices.length-4,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j),255)}else{h.stencilFunc(h.EQUAL,j,255)}}else{if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}else{h.stencilFunc(h.EQUAL,j+1,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}h.drawElements(h.TRIANGLE_STRIP,i.indices.length,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j),255)}else{h.stencilFunc(h.EQUAL,j,255)}}h.colorMask(true,true,true,true);h.stencilOp(h.KEEP,h.KEEP,h.KEEP)}};e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};e.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var f=0;f<this.maxAttibs;f++){this.attribState[f]=false}this.stack=[]};e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager;e.WebGLShaderManager.prototype.setContext=function(f){this.gl=f;this.primitiveShader=new e.PrimitiveShader(f);this.complexPrimitiveShader=new e.ComplexPrimitiveShader(f);this.defaultShader=new e.PixiShader(f);this.fastShader=new e.PixiFastShader(f);this.stripShader=new e.StripShader(f);this.creatureShader=e.CreatureShader?new e.CreatureShader(f):null;this.setShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(j){var g;for(g=0;g<this.tempAttribState.length;g++){this.tempAttribState[g]=false}for(g=0;g<j.length;g++){var f=j[g];this.tempAttribState[f]=true}var h=this.gl;for(g=0;g<this.attribState.length;g++){if(this.attribState[g]!==this.tempAttribState[g]){this.attribState[g]=this.tempAttribState[g];if(this.tempAttribState[g]){h.enableVertexAttribArray(g)}else{h.disableVertexAttribArray(g)}}}};e.WebGLShaderManager.prototype.setShader=function(f){if(this._currentId===f._UID){return false}this._currentId=f._UID;this.currentShader=f;this.gl.useProgram(f.program);this.setAttribs(f.attributes);return true};e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();if(this.creatureShader){this.creatureShader.destroy()}this.gl=null};e.WebGLSpriteBatch=function(g){this.game=g;this.vertSize=5;this.size=2000;this.vertexSize=(4*2)+(4*2)+(4)+(4);var f=this.vertexSize*this.size*4;var l=this.size*6;this.vertices=new ArrayBuffer(f);this.positions=new Float32Array(this.vertices);this.colors=new Uint32Array(this.vertices);this.indices=new Uint16Array(l);this.lastIndexCount=0;for(var k=0,h=0;k<l;k+=6,h+=4){this.indices[k+0]=h+0;this.indices[k+1]=h+1;this.indices[k+2]=h+2;this.indices[k+3]=h+0;this.indices[k+4]=h+2;this.indices[k+5]=h+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=null};e.WebGLSpriteBatch.prototype.setContext=function(i){this.MAX_TEXTURES=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);this.gl=i;if(e._enableMultiTextureToggle){var f="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n";for(var g=1;g<this.MAX_TEXTURES;++g){f+="\tif (vTextureIndex == "+g+".0) {gl_FragColor = texture2D(uSamplerArray["+g+"], vTextureCoord) * vColor;return;}\n"}this.defaultShader=new Phaser.Filter(this.game,undefined,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",f,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else{this.defaultShader=new Phaser.Filter(this.game,undefined,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"])}this.vertexBuffer=i.createBuffer();this.indexBuffer=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW);i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer);i.bufferData(i.ARRAY_BUFFER,this.vertices,i.DYNAMIC_DRAW);this.currentBlendMode=99999;var h=new e.PixiShader(i);h.fragmentSrc=this.defaultShader.fragmentSrc;h.uniforms={};h.init();this.defaultShader.shaders[i.id]=h};e.WebGLSpriteBatch.prototype.begin=function(f){this.renderSession=f;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=function(o,w){var m=o.texture;var g=m.baseTexture;var j=this.gl;if(e.WebGLRenderer.textureArray[g.textureIndex]!=g){this.flush();j.activeTexture(j.TEXTURE0+g.textureIndex);j.bindTexture(j.TEXTURE_2D,g._glTextures[j.id]);e.WebGLRenderer.textureArray[g.textureIndex]=g}var M=o.worldTransform;if(w){M=w}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=m.baseTexture}var C=m._uvs;if(!C){return}var p=o.anchor.x;var n=o.anchor.y;var A,y,u,t;if(m.trim){var f=m.trim;y=f.x-p*f.width;A=y+m.crop.width;t=f.y-n*f.height;u=t+m.crop.height}else{A=(m.frame.width)*(1-p);y=(m.frame.width)*-p;u=m.frame.height*(1-n);t=m.frame.height*-n}var J=this.currentBatchSize*this.vertexSize;var v=this.currentBatchSize*4;var D=m.baseTexture.resolution;var K=m.baseTexture.textureIndex;var P=M.a/D;var O=M.b/D;var N=M.c/D;var L=M.d/D;var I=M.tx;var H=M.ty;var q=m.crop.width;var x=m.crop.height;if(m.rotated){var F=M.a;var r=M.b;var h=M.c;var G=M.d;var z=y;var B=A;I=M.c*x+I;H=M.d*x+H;P=F*6.123233995736766e-17+-h;O=r*6.123233995736766e-17+-G;N=F+h*6.123233995736766e-17;L=r+G*6.123233995736766e-17;m._updateUvsInverted();A=u;y=t;u=B;t=z}var E=this.colors;var k=this.positions;var l=o.tint;var s=(l>>16)+(l&65280)+((l&255)<<16)+(o.worldAlpha*255<<24);if(this.renderSession.roundPixels){k[J++]=P*y+N*t+I|0;k[J++]=L*t+O*y+H|0;k[J++]=C.x0;k[J++]=C.y0;E[J++]=s;k[J++]=K;k[J++]=P*A+N*t+I|0;k[J++]=L*t+O*A+H|0;k[J++]=C.x1;k[J++]=C.y1;E[J++]=s;k[J++]=K;k[J++]=P*A+N*u+I|0;k[J++]=L*u+O*A+H|0;k[J++]=C.x2;k[J++]=C.y2;E[J++]=s;k[J++]=K;k[J++]=P*y+N*u+I|0;k[J++]=L*u+O*y+H|0;k[J++]=C.x3;k[J++]=C.y3;E[J++]=s;k[J++]=K}else{k[J++]=P*y+N*t+I;k[J++]=L*t+O*y+H;k[J++]=C.x0;k[J++]=C.y0;E[J++]=s;k[J++]=K;k[J++]=P*A+N*t+I;k[J++]=L*t+O*A+H;k[J++]=C.x1;k[J++]=C.y1;E[J++]=s;k[J++]=K;k[J++]=P*A+N*u+I;k[J++]=L*u+O*A+H;k[J++]=C.x2;k[J++]=C.y2;E[J++]=s;k[J++]=K;k[J++]=P*y+N*u+I;k[J++]=L*u+O*y+H;k[J++]=C.x3;k[J++]=C.y3;E[J++]=s;k[J++]=K}this.sprites[this.currentBatchSize++]=o};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(x){var u=x.tilingTexture;var s=u.baseTexture;var D=this.gl;var A=x.texture.baseTexture.textureIndex;if(e.WebGLRenderer.textureArray[A]!=s){this.flush();D.activeTexture(D.TEXTURE0+A);D.bindTexture(D.TEXTURE_2D,s._glTextures[D.id]);e.WebGLRenderer.textureArray[A]=s}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=u.baseTexture}if(!x._uvs){x._uvs=new e.TextureUvs()}var p=x._uvs;var r=u.baseTexture.width;var E=u.baseTexture.height;x.tilePosition.x%=r*x.tileScaleOffset.x;x.tilePosition.y%=E*x.tileScaleOffset.y;var G=x.tilePosition.x/(r*x.tileScaleOffset.x);var F=x.tilePosition.y/(E*x.tileScaleOffset.y);var M=(x.width/r)/(x.tileScale.x*x.tileScaleOffset.x);var J=(x.height/E)/(x.tileScale.y*x.tileScaleOffset.y);p.x0=0-G;p.y0=0-F;p.x1=(1*M)-G;p.y1=0-F;p.x2=(1*M)-G;p.y2=(1*J)-F;p.x3=0-G;p.y3=(1*J)-F;var k=x.tint;var B=(k>>16)+(k&65280)+((k&255)<<16)+(x.worldAlpha*255<<24);var m=this.positions;var o=this.colors;var y=x.width;var v=x.height;var j=x.anchor.x;var g=x.anchor.y;var t=y*(1-j);var q=y*-j;var n=v*(1-g);var l=v*-g;var C=this.currentBatchSize*this.vertexSize;var z=u.baseTexture.resolution;var f=x.worldTransform;var O=f.a/z;var L=f.b/z;var I=f.c/z;var H=f.d/z;var N=f.tx;var K=f.ty;m[C++]=O*q+I*l+N;m[C++]=H*l+L*q+K;m[C++]=p.x0;m[C++]=p.y0;o[C++]=B;m[C++]=A;m[C++]=(O*t+I*l+N);m[C++]=H*l+L*t+K;m[C++]=p.x1;m[C++]=p.y1;o[C++]=B;m[C++]=A;m[C++]=O*t+I*n+N;m[C++]=H*n+L*t+K;m[C++]=p.x2;m[C++]=p.y2;o[C++]=B;m[C++]=A;m[C++]=O*q+I*n+N;m[C++]=H*n+L*q+K;m[C++]=p.x3;m[C++]=p.y3;o[C++]=B;m[C++]=A;this.sprites[this.currentBatchSize++]=x};e.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var x=this.gl;var f;if(this.dirty){this.dirty=false;f=this.defaultShader.shaders[x.id];x.activeTexture(x.TEXTURE0);x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer);x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var q=this.vertexSize;x.vertexAttribPointer(f.aVertexPosition,2,x.FLOAT,false,q,0);x.vertexAttribPointer(f.aTextureCoord,2,x.FLOAT,false,q,8);x.vertexAttribPointer(f.colorAttribute,4,x.UNSIGNED_BYTE,true,q,16);x.vertexAttribPointer(f.aTextureIndex,1,x.FLOAT,false,q,20)}if(this.currentBatchSize>(this.size*0.5)){x.bufferSubData(x.ARRAY_BUFFER,0,this.vertices)}else{x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer);var n=this.positions.subarray(0,this.currentBatchSize*this.vertexSize);x.bufferSubData(x.ARRAY_BUFFER,0,n)}var v,A,m;var s=0;var l=0;var z=null;var o=this.renderSession.blendModeManager.currentBlendMode;var g=null;var k=false;var h=false;var p;var u=0;for(var y=0,w=this.currentBatchSize;y<w;y++){p=this.sprites[y];if(p.tilingTexture){v=p.tilingTexture.baseTexture}else{v=p.texture.baseTexture}A=p.blendMode;m=p.shader||this.defaultShader;k=o!==A;h=g!==m;var r=v.skipRender;if(r&&p.children.length>0){r=false}if(k||h){this.renderBatch(z,s,l);l=y;s=0;z=v;if(k){o=A;this.renderSession.blendModeManager.setBlendMode(o)}if(h){g=m;f=g.shaders[x.id];if(!f){f=new e.PixiShader(x);f.fragmentSrc=g.fragmentSrc;f.uniforms=g.uniforms;f.init();g.shaders[x.id]=f}this.renderSession.shaderManager.setShader(f);if(f.dirty){f.syncUniforms()}var B=this.renderSession.projection;x.uniform2f(f.projectionVector,B.x,B.y);var t=this.renderSession.offset;x.uniform2f(f.offsetVector,t.x,t.y)}}s++}this.renderBatch(z,s,l);this.currentBatchSize=0;this.renderSession.flushCount++};e.WebGLSpriteBatch.prototype.renderBatch=function(g,f,i){if(f===0){return}var h=this.gl;if(g._dirty[h.id]){if(!this.renderSession.renderer.updateTexture(g)){return}}else{h.bindTexture(h.TEXTURE_2D,g._glTextures[h.id])}h.drawElements(h.TRIANGLES,f*6,h.UNSIGNED_SHORT,i*6*2);this.renderSession.drawCount++};e.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};e.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};e.WebGLFastSpriteBatch=function(l){this.vertSize=11;this.maxSize=6000;this.size=this.maxSize;var f=this.size*4*this.vertSize;var k=this.maxSize*6;this.vertices=new Float32Array(f);this.indices=new Uint16Array(k);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var h=0,g=0;h<k;h+=6,g+=4){this.indices[h+0]=g+0;this.indices[h+1]=g+1;this.indices[h+2]=g+2;this.indices[h+3]=g+0;this.indices[h+4]=g+2;this.indices[h+5]=g+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(l)};e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch;e.WebGLFastSpriteBatch.prototype.setContext=function(f){this.gl=f;this.vertexBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indices,f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertices,f.DYNAMIC_DRAW)};e.WebGLFastSpriteBatch.prototype.begin=function(f,g){this.renderSession=g;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=f.worldTransform.toArray(true);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.render=function(f){var l=f.children;var k=l[0];if(!k.texture._uvs){return}this.currentBaseTexture=k.texture.baseTexture;if(k.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(k.blendMode)}for(var h=0,g=l.length;h<g;h++){this.renderSprite(l[h])}this.flush()};e.WebGLFastSpriteBatch.prototype.renderSprite=function(r){var o=r.texture;var f=o.baseTexture;var k=this.gl;var t=r.texture.baseTexture.textureIndex;if(e.WebGLRenderer.textureArray[t]!=f&&f._glTextures[k.id]&&!r.texture.baseTexture.skipRender){this.flush();k.activeTexture(k.TEXTURE0+t);k.bindTexture(k.TEXTURE_2D,f._glTextures[k.id]);e.WebGLRenderer.textureArray[t]=f;if(!r.texture._uvs){return}}if(!r.visible){return}var i,n=this.vertices,g,s,l,j,q,p,m;i=r.texture._uvs;g=r.texture.frame.width;s=r.texture.frame.height;if(r.texture.trim){var h=r.texture.trim;j=h.x-r.anchor.x*h.width;l=j+r.texture.crop.width;p=h.y-r.anchor.y*h.height;q=p+r.texture.crop.height}else{l=(r.texture.frame.width)*(1-r.anchor.x);j=(r.texture.frame.width)*-r.anchor.x;q=r.texture.frame.height*(1-r.anchor.y);p=r.texture.frame.height*-r.anchor.y}m=this.currentBatchSize*4*this.vertSize;n[m++]=j;n[m++]=p;n[m++]=r.position.x;n[m++]=r.position.y;n[m++]=r.scale.x;n[m++]=r.scale.y;n[m++]=r.rotation;n[m++]=i.x0;n[m++]=i.y1;n[m++]=r.alpha;n[m++]=t;n[m++]=l;n[m++]=p;n[m++]=r.position.x;n[m++]=r.position.y;n[m++]=r.scale.x;n[m++]=r.scale.y;n[m++]=r.rotation;n[m++]=i.x1;n[m++]=i.y1;n[m++]=r.alpha;n[m++]=t;n[m++]=l;n[m++]=q;n[m++]=r.position.x;n[m++]=r.position.y;n[m++]=r.scale.x;n[m++]=r.scale.y;n[m++]=r.rotation;n[m++]=i.x2;n[m++]=i.y2;n[m++]=r.alpha;n[m++]=t;n[m++]=j;n[m++]=q;n[m++]=r.position.x;n[m++]=r.position.y;n[m++]=r.scale.x;n[m++]=r.scale.y;n[m++]=r.rotation;n[m++]=i.x3;n[m++]=i.y3;n[m++]=r.alpha;n[m++]=t;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var g=this.gl;if(!this.currentBaseTexture._glTextures[g.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,g);return}if(this.currentBatchSize>(this.size*0.5)){g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices)}else{var f=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);g.bufferSubData(g.ARRAY_BUFFER,0,f)}g.drawElements(g.TRIANGLES,this.currentBatchSize*6,g.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++;this.renderSession.flushCount++};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var h=this.gl;h.activeTexture(h.TEXTURE0);h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=this.renderSession.projection;h.uniform2f(this.shader.projectionVector,f.x,f.y);h.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var g=this.vertSize*4;h.vertexAttribPointer(this.shader.aVertexPosition,2,h.FLOAT,false,g,0);h.vertexAttribPointer(this.shader.aPositionCoord,2,h.FLOAT,false,g,2*4);h.vertexAttribPointer(this.shader.aScale,2,h.FLOAT,false,g,4*4);h.vertexAttribPointer(this.shader.aRotation,1,h.FLOAT,false,g,6*4);h.vertexAttribPointer(this.shader.aTextureCoord,2,h.FLOAT,false,g,7*4);h.vertexAttribPointer(this.shader.colorAttribute,1,h.FLOAT,false,g,9*4);h.vertexAttribPointer(this.shader.aTextureIndex,1,h.FLOAT,false,g,10*4)};e.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager;e.WebGLFilterManager.prototype.setContext=function(f){this.gl=f;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(h,g){this.renderSession=h;this.defaultShader=h.shaderManager.defaultShader;var f=this.renderSession.projection;this.width=f.x*2;this.height=-f.y*2;this.buffer=g};e.WebGLFilterManager.prototype.pushFilter=function(g){var m=this.gl;var f=this.renderSession.projection;var l=this.renderSession.offset;g._filterArea=g.target.filterArea||g.target.getBounds();g._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new e.WebGLStencilManager();this.renderSession.stencilManager.setContext(m);m.disable(m.STENCIL_TEST);this.filterStack.push(g);var h=g.filterPasses[0];this.offsetX+=g._filterArea.x;this.offsetY+=g._filterArea.y;var i=this.texturePool.pop();if(!i){i=new e.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}else{i.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}m.bindTexture(m.TEXTURE_2D,i.texture);var j=g._filterArea;var k=h.padding;j.x-=k;j.y-=k;j.width+=k*2;j.height+=k*2;if(j.x<0){j.x=0}if(j.width>this.width){j.width=this.width}if(j.y<0){j.y=0}if(j.height>this.height){j.height=this.height}m.bindFramebuffer(m.FRAMEBUFFER,i.frameBuffer);m.viewport(0,0,j.width*this.renderSession.resolution,j.height*this.renderSession.resolution);f.x=j.width/2;f.y=-j.height/2;l.x=-j.x;l.y=-j.y;m.colorMask(true,true,true,true);m.clearColor(0,0,0,0);m.clear(m.COLOR_BUFFER_BIT);g._glFilterTexture=i};e.WebGLFilterManager.prototype.popFilter=function(){var s=this.gl;var p=this.filterStack.pop();var A=p._filterArea;var n=p._glFilterTexture;var B=this.renderSession.projection;var j=this.renderSession.offset;if(p.filterPasses.length>1){s.viewport(0,0,A.width*this.renderSession.resolution,A.height*this.renderSession.resolution);s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=A.height;this.vertexArray[2]=A.width;this.vertexArray[3]=A.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=A.width;this.vertexArray[7]=0;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);var u=n;var g=this.texturePool.pop();if(!g){g=new e.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}g.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.clear(s.COLOR_BUFFER_BIT);s.disable(s.BLEND);for(var t=0;t<p.filterPasses.length-1;t++){var h=p.filterPasses[t];s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,u.texture);this.applyFilterPass(h,A,A.width,A.height);var z=u;u=g;g=z}s.enable(s.BLEND);n=u;this.texturePool.push(g)}var m=p.filterPasses[p.filterPasses.length-1];this.offsetX-=A.x;this.offsetY-=A.y;var q=this.width;var o=this.height;var w=0;var v=0;var r=this.buffer;if(this.filterStack.length===0){s.colorMask(true,true,true,true)}else{var f=this.filterStack[this.filterStack.length-1];A=f._filterArea;q=A.width;o=A.height;w=A.x;v=A.y;r=f._glFilterTexture.frameBuffer}B.x=q/2;B.y=-o/2;j.x=w;j.y=v;A=p._filterArea;var l=A.x-w;var k=A.y-v;s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=l;this.vertexArray[1]=k+A.height;this.vertexArray[2]=l+A.width;this.vertexArray[3]=k+A.height;this.vertexArray[4]=l;this.vertexArray[5]=k;this.vertexArray[6]=l+A.width;this.vertexArray[7]=k;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);s.viewport(0,0,q*this.renderSession.resolution,o*this.renderSession.resolution);s.bindFramebuffer(s.FRAMEBUFFER,r);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,n.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=p._previous_stencil_mgr;p._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){s.enable(s.STENCIL_TEST)}else{s.disable(s.STENCIL_TEST)}this.applyFilterPass(m,A,q,o);this.texturePool.push(n);p._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=function(h,j,g,f){var k=this.gl;var i=h.shaders[k.id];if(!i){i=new e.PixiShader(k);i.fragmentSrc=h.fragmentSrc;i.uniforms=h.uniforms;i.init(true);h.shaders[k.id]=i}this.renderSession.shaderManager.setShader(i);k.uniform2f(i.projectionVector,g/2,-f/2);k.uniform2f(i.offsetVector,0,0);if(h.uniforms.dimensions){h.uniforms.dimensions.value[0]=this.width;h.uniforms.dimensions.value[1]=this.height;h.uniforms.dimensions.value[2]=this.vertexArray[0];h.uniforms.dimensions.value[3]=this.vertexArray[5]}i.syncUniforms();k.bindBuffer(k.ARRAY_BUFFER,this.vertexBuffer);k.vertexAttribPointer(i.aVertexPosition,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.uvBuffer);k.vertexAttribPointer(i.aTextureCoord,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.colorBuffer);k.vertexAttribPointer(i.colorAttribute,2,k.FLOAT,false,0,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.indexBuffer);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var f=this.gl;this.vertexBuffer=f.createBuffer();this.uvBuffer=f.createBuffer();this.colorBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertexArray,f.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.bufferData(f.ARRAY_BUFFER,this.uvArray,f.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.bufferData(f.ARRAY_BUFFER,this.colorArray,f.STATIC_DRAW);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),f.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var g=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var f=0;f<this.texturePool.length;f++){this.texturePool[f].destroy()}this.texturePool=null;g.deleteBuffer(this.vertexBuffer);g.deleteBuffer(this.uvBuffer);g.deleteBuffer(this.colorBuffer);g.deleteBuffer(this.indexBuffer)};function d(j,h,f,g){var i=j.createTexture();j.bindTexture(j.TEXTURE_2D,i);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,g===e.scaleModes.LINEAR?j.LINEAR:j.NEAREST);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,g===e.scaleModes.LINEAR?j.LINEAR:j.NEAREST);j.texImage2D(j.TEXTURE_2D,0,j.RGBA,h,f,0,j.RGBA,j.UNSIGNED_BYTE,null);return i}var b={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"};function c(h,f,m,l,n){var j=h.createFramebuffer();var i=h.createRenderbuffer();var k=null;var g=0;h.activeTexture(h.TEXTURE0+n);h.bindFramebuffer(h.FRAMEBUFFER,j);h.bindRenderbuffer(h.RENDERBUFFER,i);h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,this.renderBuffer);k=d(h,f,m,l);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,k,0);g=h.checkFramebufferStatus(h.FRAMEBUFFER);if(g!==h.FRAMEBUFFER_COMPLETE){console.error("Incomplete GL framebuffer. ",b[g])}j.width=f;j.height=m;j.targetTexture=k;j.renderBuffer=i;return j}e.FilterTexture=function(j,i,f,h,g){g=typeof g==="number"?g:0;this.gl=j;this.frameBuffer=c(j,i,f,h||e.scaleModes.DEFAULT,g);this.texture=this.frameBuffer.targetTexture;this.width=i;this.height=f;this.renderBuffer=this.frameBuffer.renderBuffer};e.FilterTexture.prototype.constructor=e.FilterTexture;e.FilterTexture.prototype.clear=function(){var f=this.gl;f.clearColor(0,0,0,0);f.clear(f.COLOR_BUFFER_BIT)};e.FilterTexture.prototype.resize=function(g,f){if(this.width===g&&this.height===f){return}this.width=g;this.height=f;var h=this.gl;h.bindTexture(h.TEXTURE_2D,this.texture);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,g,f,0,h.RGBA,h.UNSIGNED_BYTE,null);h.bindRenderbuffer(h.RENDERBUFFER,this.renderBuffer);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,g,f)};e.FilterTexture.prototype.destroy=function(){var f=this.gl;f.deleteFramebuffer(this.frameBuffer);f.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};e.CanvasBuffer=function(g,f){this.width=g;this.height=f;this.canvas=Phaser.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=g;this.canvas.height=f};e.CanvasBuffer.prototype.constructor=e.CanvasBuffer;e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};e.CanvasBuffer.prototype.resize=function(g,f){this.width=this.canvas.width=g;this.height=this.canvas.height=f};e.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)};e.CanvasMaskManager=function(){};e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager;e.CanvasMaskManager.prototype.pushMask=function(k,j){var i=j.context;i.save();var f=k.alpha;var h=k.worldTransform;var g=j.resolution;i.setTransform(h.a*g,h.b*g,h.c*g,h.d*g,h.tx*g,h.ty*g);e.CanvasGraphics.renderGraphicsMask(k,i);i.clip();k.worldAlpha=f};e.CanvasMaskManager.prototype.popMask=function(f){f.context.restore()};e.CanvasTinter=function(){};e.CanvasTinter.getTintedTexture=function(h,f){var g=h.tintedTexture||Phaser.CanvasPool.create(this);e.CanvasTinter.tintMethod(h.texture,f,g);return g};e.CanvasTinter.tintWithMultiply=function(m,g,i){var j=i.getContext("2d");var l=m.crop;var f=l.width;var k=l.height;if(m.rotated){f=k;k=l.width}if(i.width!==f||i.height!==k){i.width=f;i.height=k}j.clearRect(0,0,f,k);j.fillStyle="#"+("00000"+(g|0).toString(16)).substr(-6);j.fillRect(0,0,f,k);j.globalCompositeOperation="multiply";j.drawImage(m.baseTexture.source,l.x,l.y,f,k,0,0,f,k);j.globalCompositeOperation="destination-atop";j.drawImage(m.baseTexture.source,l.x,l.y,f,k,0,0,f,k)};e.CanvasTinter.tintWithPerPixel=function(u,o,l){var k=l.getContext("2d");var q=u.crop;var x=q.width;var s=q.height;if(u.rotated){x=s;s=q.width}if(l.width!==x||l.height!==s){l.width=x;l.height=s}k.globalCompositeOperation="copy";k.drawImage(u.baseTexture.source,q.x,q.y,x,s,0,0,x,s);var j=Phaser.Color.hexToRGBArray(o);var f=j[0],t=j[1],v=j[2];var y=k.getImageData(0,0,x,s);var m=y.data;for(var p=0;p<m.length;p+=4){m[p+0]*=f;m[p+1]*=t;m[p+2]*=v;if(!e.CanvasTinter.canHandleAlpha){var n=m[p+3];m[p+0]/=255/n;m[p+1]/=255/n;m[p+2]/=255/n}}k.putImageData(y,0,0)};e.CanvasRenderer=function(f){this.game=f;if(!e.defaultRenderer){e.defaultRenderer=this}this.type=Phaser.CANVAS;this.resolution=f.resolution;this.clearBeforeRender=f.clearBeforeRender;this.transparent=f.transparent;this.autoResize=false;this.width=f.width*this.resolution;this.height=f.height*this.resolution;this.view=f.canvas;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.count=0;this.maskManager=new e.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:false};this.mapBlendModes();this.resize(this.width,this.height)};e.CanvasRenderer.prototype.constructor=e.CanvasRenderer;e.CanvasRenderer.prototype.render=function(f){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{if(f._bgColor){this.context.fillStyle=f._bgColor.rgba;this.context.fillRect(0,0,this.width,this.height)}}}this.renderDisplayObject(f)};e.CanvasRenderer.prototype.setTexturePriority=function(f){};e.CanvasRenderer.prototype.destroy=function(f){if(f===undefined){f=true}if(f&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};e.CanvasRenderer.prototype.resize=function(g,f){this.width=g*this.resolution;this.height=f*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}if(this.renderSession.smoothProperty){this.context[this.renderSession.smoothProperty]=(this.renderSession.scaleMode===e.scaleModes.LINEAR)}};e.CanvasRenderer.prototype.renderDisplayObject=function(h,g,f){this.renderSession.context=g||this.context;this.renderSession.resolution=this.resolution;h._renderCanvas(this.renderSession,f)};e.CanvasRenderer.prototype.mapBlendModes=function(){if(!e.blendModesCanvas){var f=[];var g=e.blendModes;var h=this.game.device.canUseMultiply;f[g.NORMAL]="source-over";f[g.ADD]="lighter";f[g.MULTIPLY]=(h)?"multiply":"source-over";f[g.SCREEN]=(h)?"screen":"source-over";f[g.OVERLAY]=(h)?"overlay":"source-over";f[g.DARKEN]=(h)?"darken":"source-over";f[g.LIGHTEN]=(h)?"lighten":"source-over";f[g.COLOR_DODGE]=(h)?"color-dodge":"source-over";f[g.COLOR_BURN]=(h)?"color-burn":"source-over";f[g.HARD_LIGHT]=(h)?"hard-light":"source-over";f[g.SOFT_LIGHT]=(h)?"soft-light":"source-over";f[g.DIFFERENCE]=(h)?"difference":"source-over";f[g.EXCLUSION]=(h)?"exclusion":"source-over";f[g.HUE]=(h)?"hue":"source-over";f[g.SATURATION]=(h)?"saturation":"source-over";f[g.COLOR]=(h)?"color":"source-over";f[g.LUMINOSITY]=(h)?"luminosity":"source-over";e.blendModesCanvas=f}};e.BaseTexture=function(h,g,f){this.resolution=f||1;this.width=100;this.height=100;this.scaleMode=g||e.scaleModes.DEFAULT;this.hasLoaded=false;this.source=h;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this.textureIndex=0;this._dirty=[true,true,true,true];if(!h){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}this.skipRender=false;this._powerOf2=false};e.BaseTexture.prototype.constructor=e.BaseTexture;e.BaseTexture.prototype.forceLoaded=function(g,f){this.hasLoaded=true;this.width=g;this.height=f;this.dirty()};e.BaseTexture.prototype.destroy=function(){if(this.source){Phaser.CanvasPool.removeByCanvas(this.source)}this.source=null;this.unloadFromGPU()};e.BaseTexture.prototype.updateSourceImage=function(f){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")};e.BaseTexture.prototype.dirty=function(){for(var f=0;f<this._glTextures.length;f++){this._dirty[f]=true}};e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var g=this._glTextures.length-1;g>=0;g--){var f=this._glTextures[g];var h=e.glContexts[g];if(h&&f){h.deleteTexture(f)}}this._glTextures.length=0;this.dirty()};e.BaseTexture.fromCanvas=function(g,h,f){if(g.width===0){g.width=1}if(g.height===0){g.height=1}f=f||1;return new e.BaseTexture(g,h,f)};e.TextureSilentFail=false;e.Texture=function(h,i,g,f){this.noFrame=false;if(!i){this.noFrame=true;i=new e.Rectangle(0,0,1,1)}if(h instanceof e.Texture){h=h.baseTexture}this.baseTexture=h;this.frame=i;this.trim=f;this.valid=false;this.isTiling=false;this.requiresUpdate=false;this.requiresReTint=false;this._uvs=null;this.width=0;this.height=0;this.crop=g||new e.Rectangle(0,0,1,1);this.rotated=false;if(h.hasLoaded){if(this.noFrame){i=new e.Rectangle(0,0,h.width,h.height)}this.setFrame(i)}};e.Texture.prototype.constructor=e.Texture;e.Texture.prototype.onBaseTextureLoaded=function(){var f=this.baseTexture;if(this.noFrame){this.frame=new e.Rectangle(0,0,f.width,f.height)}this.setFrame(this.frame)};e.Texture.prototype.destroy=function(f){if(f){this.baseTexture.destroy()}this.valid=false};e.Texture.prototype.setFrame=function(f){this.noFrame=false;this.frame=f;this.width=f.width;this.height=f.height;this.crop.x=f.x;this.crop.y=f.y;this.crop.width=f.width;this.crop.height=f.height;if(!this.trim&&(f.x+f.width>this.baseTexture.width||f.y+f.height>this.baseTexture.height)){if(!e.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=f&&f.width&&f.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){this._updateUvs()}};e.Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new e.TextureUvs()}var h=this.crop;var f=this.baseTexture.width;var g=this.baseTexture.height;this._uvs.x0=h.x/f;this._uvs.y0=h.y/g;this._uvs.x1=(h.x+h.width)/f;this._uvs.y1=h.y/g;this._uvs.x2=(h.x+h.width)/f;this._uvs.y2=(h.y+h.height)/g;this._uvs.x3=h.x/f;this._uvs.y3=(h.y+h.height)/g};e.Texture.prototype._updateUvsInverted=function(){if(!this._uvs){this._uvs=new e.TextureUvs()}var h=this.crop;var f=this.baseTexture.width;var g=this.baseTexture.height;this._uvs.x0=h.x/f;this._uvs.y0=h.y/g;this._uvs.x1=(h.x+h.height)/f;this._uvs.y1=h.y/g;this._uvs.x2=(h.x+h.height)/f;this._uvs.y2=(h.y+h.width)/g;this._uvs.x3=h.x/f;this._uvs.y3=(h.y+h.width)/g};e.Texture.fromCanvas=function(f,g){var h=e.BaseTexture.fromCanvas(f,g);return new e.Texture(h)};e.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=e}exports.PIXI=e}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return a.PIXI=e})())}else{a.PIXI=e}}return e}).call(this);(function(){var h=this;var e=e||{VERSION:"2.8.1",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};if(!Math.trunc){Math.trunc=function b(l){return l<0?Math.ceil(l):Math.floor(l)}}if(!Function.prototype.bind){Function.prototype.bind=(function(){var l=Array.prototype.slice;return function(m){var p=this,q=l.call(arguments,1);if(typeof p!=="function"){throw new TypeError()}function n(){var r=q.concat(l.call(arguments));p.apply(this instanceof n?this:m,r)}n.prototype=(function o(r){if(r){o.prototype=r}if(!(this instanceof o)){return new o}})(p.prototype);return n}})()}if(!Array.isArray){Array.isArray=function(l){return Object.prototype.toString.call(l)==="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(n){if(this===void 0||this===null){throw new TypeError()}var p=Object(this);var l=p.length>>>0;if(typeof n!=="function"){throw new TypeError()}var m=arguments.length>=2?arguments[1]:void 0;for(var o=0;o<l;o++){if(o in p){n.call(m,p[o],o,p)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var f=function(l){var m=new Array();window[l]=function(n){if(typeof(n)==="number"){Array.call(this,n);this.length=n;for(var o=0;o<this.length;o++){this[o]=0}}else{Array.call(this,n.length);this.length=n.length;for(var o=0;o<this.length;o++){this[o]=n[o]}}};window[l].prototype=m;window[l].constructor=window[l]};f("Float32Array");f("Uint32Array");f("Uint16Array");f("Int16Array");f("ArrayBuffer")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}if(!Object.assign){Object.assign=function(p,r){if(p==null){throw new TypeError("Cannot convert undefined or null to object")}var q=Object(p);var n=Object.prototype.hasOwnProperty;for(var o=1;o<arguments.length;o++){var m=arguments[o];if(m!=null){for(var l in m){if(n.call(m,l)){q[l]=m[l]}}}}return q}}e.Utils={reverseString:function(l){return l.split("").reverse().join("")},getProperty:function(p,r){var o=r.split("."),l=o.length,n=0,q=p;while(n<l){var m=o[n];if(q!=null){q=q[m];n++}else{return undefined}}return q},setProperty:function(s,t,p){var r=t.split("."),o=r.pop(),m=r.length,n=1,q=r[0];while(n<m&&(s=s[q])){q=r[n];n++}if(s){s[o]=p}return s},chanceRoll:function(l){if(l===undefined){l=50}return l>0&&(Math.random()*100<=l)},randomChoice:function(m,l){return(Math.random()<0.5)?m:l},parseDimension:function(m,o){var n=0;var l=0;if(typeof m==="string"){if(m.substr(-1)==="%"){n=parseInt(m,10)/100;if(o===0){l=window.innerWidth*n}else{l=window.innerHeight*n}}else{l=parseInt(m,10)}}else{l=m}return l},pad:function(r,l,q,m){if(l===undefined){var l=0}if(q===undefined){var q=" "}if(m===undefined){var m=3}r=r.toString();var o=0;if(l+1>=r.length){switch(m){case 1:r=new Array(l+1-r.length).join(q)+r;break;case 3:var n=Math.ceil((o=l-r.length)/2);var p=o-n;r=new Array(p+1).join(q)+r+new Array(n+1).join(q);break;default:r=r+new Array(l+1-r.length).join(q);break}}return r},isPlainObject:function(m){if(typeof(m)!=="object"||m.nodeType||m===m.window){return false}try{if(m.constructor&&!({}).hasOwnProperty.call(m.constructor.prototype,"isPrototypeOf")){return false}}catch(l){return false}return true},extend:function(){var u,n,l,m,r,s,q=arguments[0]||{},p=1,o=arguments.length,t=false;if(typeof q==="boolean"){t=q;q=arguments[1]||{};p=2}if(o===p){q=this;--p}for(;p<o;p++){if((u=arguments[p])!=null){for(n in u){l=q[n];m=u[n];if(q===m){continue}if(t&&m&&(e.Utils.isPlainObject(m)||(r=Array.isArray(m)))){if(r){r=false;s=l&&Array.isArray(l)?l:[]}else{s=l&&e.Utils.isPlainObject(l)?l:{}}q[n]=e.Utils.extend(t,s,m)}else{if(m!==undefined){q[n]=m}}}}}return q},mixinPrototype:function(r,l,p){if(p===undefined){p=false}var o=Object.keys(l);for(var n=0;n<o.length;n++){var m=o[n];var q=l[m];if(!p&&(m in r)){continue}else{if(q&&(typeof q.get==="function"||typeof q.set==="function")){if(typeof q.clone==="function"){r[m]=q.clone()}else{Object.defineProperty(r,m,q)}}else{r[m]=q}}}},mixin:function(q,p){if(!q||typeof(q)!=="object"){return p}for(var l in q){var n=q[l];if(n.childNodes||n.cloneNode){continue}var m=typeof(q[l]);if(!q[l]||m!=="object"){p[l]=q[l]}else{if(typeof(p[l])===m){p[l]=e.Utils.mixin(q[l],p[l])}else{p[l]=e.Utils.mixin(q[l],new n.constructor())}}}return p}};e.Circle=function(l,n,m){l=l||0;n=n||0;m=m||0;this.x=l;this.y=n;this._diameter=m;this._radius=0;if(m>0){this._radius=m*0.5}this.type=e.CIRCLE};e.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(n){if(n===undefined){n=new e.Point()}var o=2*Math.PI*Math.random();var m=Math.random()+Math.random();var p=(m>1)?2-m:m;var l=p*Math.cos(o);var q=p*Math.sin(o);n.x=this.x+(l*this.radius);n.y=this.y+(q*this.radius);return n},getBounds:function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(l,n,m){this.x=l;this.y=n;this._diameter=m;this._radius=m*0.5;return this},copyFrom:function(l){return this.setTo(l.x,l.y,l.diameter)},copyTo:function(l){l.x=this.x;l.y=this.y;l.diameter=this._diameter;return l},distance:function(m,l){var n=e.Math.distance(this.x,this.y,m.x,m.y);return l?Math.round(n):n},clone:function(l){if(l===undefined||l===null){l=new e.Circle(this.x,this.y,this.diameter)}else{l.setTo(this.x,this.y,this.diameter)}return l},contains:function(l,m){return e.Circle.contains(this,l,m)},circumferencePoint:function(n,m,l){return e.Circle.circumferencePoint(this,n,m,l)},offset:function(m,l){this.x+=m;this.y+=l;return this},offsetPoint:function(l){return this.offset(l.x,l.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};e.Circle.prototype.constructor=e.Circle;Object.defineProperty(e.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(l){if(l>0){this._diameter=l;this._radius=l*0.5}}});Object.defineProperty(e.Circle.prototype,"radius",{get:function(){return this._radius},set:function(l){if(l>0){this._radius=l;this._diameter=l*2}}});Object.defineProperty(e.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(l){if(l>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-l}}});Object.defineProperty(e.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(l){if(l<this.x){this._radius=0;this._diameter=0}else{this.radius=l-this.x}}});Object.defineProperty(e.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(l){if(l>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-l}}});Object.defineProperty(e.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(l){if(l<this.y){this._radius=0;this._diameter=0}else{this.radius=l-this.y}}});Object.defineProperty(e.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(e.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(l){if(l===true){this.setTo(0,0,0)}}});e.Circle.contains=function(n,l,p){if(n.radius>0&&l>=n.left&&l<=n.right&&p>=n.top&&p<=n.bottom){var o=(n.x-l)*(n.x-l);var m=(n.y-p)*(n.y-p);return(o+m)<=(n.radius*n.radius)}else{return false}};e.Circle.equals=function(m,l){return(m.x===l.x&&m.y===l.y&&m.diameter===l.diameter)};e.Circle.intersects=function(m,l){return(e.Math.distance(m.x,m.y,l.x,l.y)<=(m.radius+l.radius))};e.Circle.circumferencePoint=function(l,o,n,m){if(n===undefined){n=false}if(m===undefined){m=new e.Point()}if(n===true){o=e.Math.degToRad(o)}m.x=l.x+l.radius*Math.cos(o);m.y=l.y+l.radius*Math.sin(o);return m};e.Circle.intersectsRectangle=function(w,m){var p=Math.abs(w.x-m.x-m.halfWidth);var v=m.halfWidth+w.radius;if(p>v){return false}var o=Math.abs(w.y-m.y-m.halfHeight);var t=m.halfHeight+w.radius;if(o>t){return false}if(p<=m.halfWidth||o<=m.halfHeight){return true}var q=p-m.halfWidth;var n=o-m.halfHeight;var u=q*q;var l=n*n;var s=w.radius*w.radius;return u+l<=s};PIXI.Circle=e.Circle;e.Ellipse=function(m,o,n,l){m=m||0;o=o||0;n=n||0;l=l||0;this.x=m;this.y=o;this.width=n;this.height=l;this.type=e.ELLIPSE};e.Ellipse.prototype={setTo:function(m,o,n,l){this.x=m;this.y=o;this.width=n;this.height=l;return this},getBounds:function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(l){return this.setTo(l.x,l.y,l.width,l.height)},copyTo:function(l){l.x=this.x;l.y=this.y;l.width=this.width;l.height=this.height;return l},clone:function(l){if(l===undefined||l===null){l=new e.Ellipse(this.x,this.y,this.width,this.height)}else{l.setTo(this.x,this.y,this.width,this.height)}return l},contains:function(l,m){return e.Ellipse.contains(this,l,m)},random:function(l){if(l===undefined){l=new e.Point()}var n=Math.random()*Math.PI*2;var m=Math.random();l.x=Math.sqrt(m)*Math.cos(n);l.y=Math.sqrt(m)*Math.sin(n);l.x=this.x+(l.x*this.width/2);l.y=this.y+(l.y*this.height/2);return l},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};e.Ellipse.prototype.constructor=e.Ellipse;Object.defineProperty(e.Ellipse.prototype,"left",{get:function(){return this.x},set:function(l){this.x=l}});Object.defineProperty(e.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(l){if(l<this.x){this.width=0}else{this.width=l-this.x}}});Object.defineProperty(e.Ellipse.prototype,"top",{get:function(){return this.y},set:function(l){this.y=l}});Object.defineProperty(e.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(l){if(l<this.y){this.height=0}else{this.height=l-this.y}}});Object.defineProperty(e.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(l){if(l===true){this.setTo(0,0,0,0)}}});e.Ellipse.contains=function(o,m,p){if(o.width<=0||o.height<=0){return false}var n=((m-o.x)/o.width)-0.5;var l=((p-o.y)/o.height)-0.5;n*=n;l*=l;return(n+l<0.25)};PIXI.Ellipse=e.Ellipse;e.Line=function(m,o,l,n){m=m||0;o=o||0;l=l||0;n=n||0;this.start=new e.Point(m,o);this.end=new e.Point(l,n);this.type=e.LINE};e.Line.prototype={setTo:function(m,o,l,n){this.start.setTo(m,o);this.end.setTo(l,n);return this},fromSprite:function(m,n,l){if(l===undefined){l=false}if(l){return this.setTo(m.centerX,m.centerY,n.centerX,n.centerY)}return this.setTo(m.x,m.y,n.x,n.y)},fromAngle:function(l,o,n,m){this.start.setTo(l,o);this.end.setTo(l+(Math.cos(n)*m),o+(Math.sin(n)*m));return this},rotate:function(n,m){var l=(this.start.x+this.end.x)/2;var o=(this.start.y+this.end.y)/2;this.start.rotate(l,o,n,m);this.end.rotate(l,o,n,m);return this},rotateAround:function(l,o,n,m){this.start.rotate(l,o,n,m);this.end.rotate(l,o,n,m);return this},intersects:function(m,n,l){return e.Line.intersectsPoints(this.start,this.end,m.start,m.end,n,l)},reflect:function(l){return e.Line.reflect(this,l)},midPoint:function(l){if(l===undefined){l=new e.Point()}l.x=(this.start.x+this.end.x)/2;l.y=(this.start.y+this.end.y)/2;return l},centerOn:function(n,q){var m=(this.start.x+this.end.x)/2;var p=(this.start.y+this.end.y)/2;var o=n-m;var l=q-p;this.start.add(o,l);this.end.add(o,l)},pointOnLine:function(l,m){return((l-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(m-this.start.y))},pointOnSegment:function(m,q){var n=Math.min(this.start.x,this.end.x);var p=Math.max(this.start.x,this.end.x);var l=Math.min(this.start.y,this.end.y);var o=Math.max(this.start.y,this.end.y);return(this.pointOnLine(m,q)&&(m>=n&&m<=p)&&(q>=l&&q<=o))},random:function(l){if(l===undefined){l=new e.Point()}var m=Math.random();l.x=this.start.x+m*(this.end.x-this.start.x);l.y=this.start.y+m*(this.end.y-this.start.y);return l},coordinatesOnLine:function(q,p){if(q===undefined){q=1}if(p===undefined){p=[]}var m=Math.round(this.start.x);var v=Math.round(this.start.y);var l=Math.round(this.end.x);var t=Math.round(this.end.y);var x=Math.abs(l-m);var w=Math.abs(t-v);var u=(m<l)?1:-1;var s=(v<t)?1:-1;var n=x-w;p.push([m,v]);var o=1;while(!((m===l)&&(v===t))){var r=n<<1;if(r>-w){n-=w;m+=u}if(r<x){n+=x;v+=s}if(o%q===0){p.push([m,v])}o++}return p},clone:function(l){if(l===undefined||l===null){l=new e.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{l.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return l}};Object.defineProperty(e.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(e.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(e.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(e.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(e.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(e.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(e.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(e.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(e.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(e.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(e.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(e.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(e.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(e.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(e.Line.prototype,"normalAngle",{get:function(){return e.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});e.Line.intersectsPoints=function(y,w,t,s,u,A){if(u===undefined){u=true}if(A===undefined){A=new e.Point()}var o=w.y-y.y;var n=s.y-t.y;var x=y.x-w.x;var v=t.x-s.x;var q=(w.x*y.y)-(y.x*w.y);var p=(s.x*t.y)-(t.x*s.y);var r=(o*v)-(n*x);if(r===0){return null}A.x=((x*p)-(v*q))/r;A.y=((n*q)-(o*p))/r;if(u){var z=((s.y-t.y)*(w.x-y.x)-(s.x-t.x)*(w.y-y.y));var m=(((s.x-t.x)*(y.y-t.y))-(s.y-t.y)*(y.x-t.x))/z;var l=(((w.x-y.x)*(y.y-t.y))-((w.y-y.y)*(y.x-t.x)))/z;if(m>=0&&m<=1&&l>=0&&l<=1){return A}else{return null}}return A};e.Line.intersects=function(n,m,o,l){return e.Line.intersectsPoints(n.start,n.end,m.start,m.end,o,l)};e.Line.intersectsRectangle=function(w,r){if(w.length===0||r.empty){return false}var o=w.start.x;var u=w.start.y;var n=w.end.x;var s=w.end.y;var q=r.x;var m=r.y;var p=r.right;var l=r.bottom;var v=0;if((o>=q&&o<=p&&u>=m&&u<=l)||(n>=q&&n<=p&&s>=m&&s<=l)){return true}if(o<q&&n>=q){v=u+(s-u)*(q-o)/(n-o);if(v>m&&v<=l){return true}}else{if(o>p&&n<=p){v=u+(s-u)*(p-o)/(n-o);if(v>=m&&v<=l){return true}}}if(u<m&&s>=m){v=o+(n-o)*(m-u)/(s-u);if(v>=q&&v<=p){return true}}else{if(u>l&&s<=l){v=o+(n-o)*(l-u)/(s-u);if(v>=q&&v<=p){return true}}}return false};e.Line.reflect=function(m,l){return 2*l.normalAngle-3.141592653589793-m.angle};e.Matrix=function(o,m,q,p,n,l){if(o===undefined||o===null){o=1}if(m===undefined||m===null){m=0}if(q===undefined||q===null){q=0}if(p===undefined||p===null){p=1}if(n===undefined||n===null){n=0}if(l===undefined||l===null){l=0}this.a=o;this.b=m;this.c=q;this.d=p;this.tx=n;this.ty=l;this.type=e.MATRIX};e.Matrix.prototype={fromArray:function(l){return this.setTo(l[0],l[1],l[3],l[4],l[2],l[5])},setTo:function(o,m,q,p,n,l){this.a=o;this.b=m;this.c=q;this.d=p;this.tx=n;this.ty=l;return this},clone:function(l){if(l===undefined||l===null){l=new e.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)}else{l.a=this.a;l.b=this.b;l.c=this.c;l.d=this.d;l.tx=this.tx;l.ty=this.ty}return l},copyTo:function(l){l.copyFrom(this);return l},copyFrom:function(l){this.a=l.a;this.b=l.b;this.c=l.c;this.d=l.d;this.tx=l.tx;this.ty=l.ty;return this},toArray:function(l,m){if(m===undefined){m=new Float32Array(9)}if(l){m[0]=this.a;m[1]=this.b;m[2]=0;m[3]=this.c;m[4]=this.d;m[5]=0;m[6]=this.tx;m[7]=this.ty;m[8]=1}else{m[0]=this.a;m[1]=this.c;m[2]=this.tx;m[3]=this.b;m[4]=this.d;m[5]=this.ty;m[6]=0;m[7]=0;m[8]=1}return m},apply:function(m,l){if(l===undefined){l=new e.Point()}l.x=this.a*m.x+this.c*m.y+this.tx;l.y=this.b*m.x+this.d*m.y+this.ty;return l},applyInverse:function(p,m){if(m===undefined){m=new e.Point()}var o=1/(this.a*this.d+this.c*-this.b);var l=p.x;var n=p.y;m.x=this.d*o*l+-this.c*o*n+(this.ty*this.c-this.tx*this.d)*o;m.y=this.a*o*n+-this.b*o*l+(-this.ty*this.a+this.tx*this.b)*o;return m},translate:function(l,m){this.tx+=l;this.ty+=m;return this},scale:function(l,m){this.a*=l;this.d*=m;this.c*=l;this.b*=m;this.tx*=l;this.ty*=m;return this},rotate:function(q){var p=Math.cos(q);var n=Math.sin(q);var m=this.a;var o=this.c;var l=this.tx;this.a=m*p-this.b*n;this.b=m*n+this.b*p;this.c=o*p-this.d*n;this.d=o*n+this.d*p;this.tx=l*p-this.ty*n;this.ty=l*n+this.ty*p;return this},append:function(m){var l=this.a;var n=this.b;var o=this.c;var p=this.d;this.a=m.a*l+m.b*o;this.b=m.a*n+m.b*p;this.c=m.c*l+m.d*o;this.d=m.c*n+m.d*p;this.tx=m.tx*l+m.ty*o+this.tx;this.ty=m.tx*n+m.ty*p+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};e.identityMatrix=new e.Matrix();PIXI.Matrix=e.Matrix;PIXI.identityMatrix=e.identityMatrix;e.Point=function(l,m){l=l||0;m=m||0;this.x=l;this.y=m;this.type=e.POINT};e.Point.prototype={copyFrom:function(l){return this.setTo(l.x,l.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(l,m){this.x=l||0;this.y=m||((m!==0)?this.x:0);return this},set:function(l,m){this.x=l||0;this.y=m||((m!==0)?this.x:0);return this},setToPolar:function(m,l,n){if(l==null){l=1}if(n){m=e.Math.degToRad(m)}return this.setTo(Math.cos(m)*l,Math.sin(m)*l)},add:function(l,m){this.x+=l;this.y+=m;return this},subtract:function(l,m){this.x-=l;this.y-=m;return this},multiply:function(l,m){this.x*=l;this.y*=m;return this},divide:function(l,m){this.x/=l;this.y/=m;return this},clampX:function(m,l){this.x=e.Math.clamp(this.x,m,l);return this},clampY:function(m,l){this.y=e.Math.clamp(this.y,m,l);return this},clamp:function(m,l){this.x=e.Math.clamp(this.x,m,l);this.y=e.Math.clamp(this.y,m,l);return this},clone:function(l){if(l===undefined||l===null){l=new e.Point(this.x,this.y)}else{l.setTo(this.x,this.y)}return l},copyTo:function(l){l.x=this.x;l.y=this.y;return l},distance:function(m,l){return e.Point.distance(this,m,l)},equals:function(l){return(l.x===this.x&&l.y===this.y)},angle:function(l,m){if(m===undefined){m=false}if(m){return e.Math.radToDeg(Math.atan2(l.y-this.y,l.x-this.x))}else{return Math.atan2(l.y-this.y,l.x-this.x)}},rotate:function(l,p,n,m,o){return e.Point.rotate(this,l,p,n,m,o)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(l){return this.normalize().multiply(l,l)},normalize:function(){if(!this.isZero()){var l=this.getMagnitude();this.x/=l;this.y/=l}return this},limit:function(l){if(this.getMagnitudeSq()>l*l){this.setMagnitude(l)}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(l){return((this.x*l.x)+(this.y*l.y))},cross:function(l){return((this.x*l.y)-(this.y*l.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};e.Point.prototype.constructor=e.Point;e.Point.add=function(m,l,n){if(n===undefined){n=new e.Point()}n.x=m.x+l.x;n.y=m.y+l.y;return n};e.Point.subtract=function(m,l,n){if(n===undefined){n=new e.Point()}n.x=m.x-l.x;n.y=m.y-l.y;return n};e.Point.multiply=function(m,l,n){if(n===undefined){n=new e.Point()}n.x=m.x*l.x;n.y=m.y*l.y;return n};e.Point.divide=function(m,l,n){if(n===undefined){n=new e.Point()}n.x=m.x/l.x;n.y=m.y/l.y;return n};e.Point.equals=function(m,l){return(m.x===l.x&&m.y===l.y)};e.Point.angle=function(m,l){return Math.atan2(m.y-l.y,m.x-l.x)};e.Point.negative=function(l,m){if(m===undefined){m=new e.Point()}return m.setTo(-l.x,-l.y)};e.Point.multiplyAdd=function(m,l,o,n){if(n===undefined){n=new e.Point()}return n.setTo(m.x+l.x*o,m.y+l.y*o)};e.Point.interpolate=function(m,l,o,n){if(n===undefined){n=new e.Point()}return n.setTo(m.x+(l.x-m.x)*o,m.y+(l.y-m.y)*o)};e.Point.perp=function(l,m){if(m===undefined){m=new e.Point()}return m.setTo(-l.y,l.x)};e.Point.rperp=function(l,m){if(m===undefined){m=new e.Point()}return m.setTo(l.y,-l.x)};e.Point.distance=function(m,l,n){var o=e.Math.distance(m.x,m.y,l.x,l.y);return n?Math.round(o):o};e.Point.project=function(m,l,n){if(n===undefined){n=new e.Point()}var o=m.dot(l)/l.getMagnitudeSq();if(o!==0){n.setTo(o*l.x,o*l.y)}return n};e.Point.projectUnit=function(m,l,n){if(n===undefined){n=new e.Point()}var o=m.dot(l);if(o!==0){n.setTo(o*l.x,o*l.y)}return n};e.Point.normalRightHand=function(l,m){if(m===undefined){m=new e.Point()}return m.setTo(l.y*-1,l.x)};e.Point.normalize=function(n,o){if(o===undefined){o=new e.Point()}var l=n.getMagnitude();if(l!==0){o.setTo(n.x/l,n.y/l)}return o};e.Point.rotate=function(u,v,r,m,o,l){if(o){m=e.Math.degToRad(m)}if(l===undefined){u.subtract(v,r);var z=Math.sin(m);var q=Math.cos(m);var p=q*u.x-z*u.y;var n=z*u.x+q*u.y;u.x=p+v;u.y=n+r}else{var w=m+Math.atan2(u.y-r,u.x-v);u.x=v+l*Math.cos(w);u.y=r+l*Math.sin(w)}return u};e.Point.centroid=function(n,l){if(l===undefined){l=new e.Point()}if(Object.prototype.toString.call(n)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var o=n.length;if(o<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(o===1){l.copyFrom(n[0]);return l}for(var m=0;m<o;m++){e.Point.add(l,n[m],l)}l.divide(o,o);return l};e.Point.parse=function(o,m,n){m=m||"x";n=n||"y";var l=new e.Point();if(o[m]){l.x=parseInt(o[m],10)}if(o[n]){l.y=parseInt(o[n],10)}return l};e.Point.isPoint=function(l){return(l!=null)&&(typeof l.x==="number")&&(typeof l.y==="number")};PIXI.Point=e.Point;e.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.flattened=false;this.type=e.POLYGON};e.Polygon.prototype={toNumberArray:function(l){if(l===undefined){l=[]}for(var m=0;m<this._points.length;m++){if(typeof this._points[m]==="number"){l.push(this._points[m]);l.push(this._points[m+1]);m++}else{l.push(this._points[m].x);l.push(this._points[m].y)}}return l},flatten:function(){this._points=this.toNumberArray();this.flattened=true;return this},clone:function(l){var m=this._points.slice();if(l===undefined||l===null){l=new e.Polygon(m)}else{l.setTo(m)}return l},contains:function(r,q){var n=false;if(this.flattened){for(var p=-2,o=this._points.length-2;(p+=2)<this._points.length;o=p){var m=this._points[p];var l=this._points[p+1];var t=this._points[o];var s=this._points[o+1];if(((l<=q&&q<s)||(s<=q&&q<l))&&(r<(t-m)*(q-l)/(s-l)+m)){n=!n}}}else{for(var p=-1,o=this._points.length-1;++p<this._points.length;o=p){var m=this._points[p].x;var l=this._points[p].y;var t=this._points[o].x;var s=this._points[o].y;if(((l<=q&&q<s)||(s<=q&&q<l))&&(r<(t-m)*(q-l)/(s-l)+m)){n=!n}}}return n},setTo:function(n){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(n)){n=Array.prototype.slice.call(arguments)}var o=Number.MAX_VALUE;for(var m=0,l=n.length;m<l;m++){if(typeof n[m]==="number"){var q=new PIXI.Point(n[m],n[m+1]);m++}else{if(Array.isArray(n[m])){var q=new PIXI.Point(n[m][0],n[m][1])}else{var q=new PIXI.Point(n[m].x,n[m].y)}}this._points.push(q);if(q.y<o){o=q.y}}this.calculateArea(o)}return this},calculateArea:function(p){var r;var q;var m;var o;for(var n=0,l=this._points.length;n<l;n++){r=this._points[n];if(n===l-1){q=this._points[0]}else{q=this._points[n+1]}m=((r.y-p)+(q.y-p))/2;o=r.x-q.x;this.area+=m*o}return this.area}};e.Polygon.prototype.constructor=e.Polygon;Object.defineProperty(e.Polygon.prototype,"points",{get:function(){return this._points},set:function(l){if(l!=null){this.setTo(l)}else{this.setTo()}}});PIXI.Polygon=e.Polygon;e.Rectangle=function(m,o,n,l){m=m||0;o=o||0;n=n||0;l=l||0;this.x=m;this.y=o;this.width=n;this.height=l;this.type=e.RECTANGLE};e.Rectangle.prototype={offset:function(m,l){this.x+=m;this.y+=l;return this},offsetPoint:function(l){return this.offset(l.x,l.y)},setTo:function(m,o,n,l){this.x=m;this.y=o;this.width=n;this.height=l;return this},scale:function(l,m){if(m===undefined){m=l}this.width*=l;this.height*=m;return this},centerOn:function(l,m){this.centerX=l;this.centerY=m;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(l){return this.setTo(l.x,l.y,l.width,l.height)},copyTo:function(l){l.x=this.x;l.y=this.y;l.width=this.width;l.height=this.height;return l},inflate:function(m,l){return e.Rectangle.inflate(this,m,l)},size:function(l){return e.Rectangle.size(this,l)},resize:function(m,l){this.width=m;this.height=l;return this},clone:function(l){return e.Rectangle.clone(this,l)},contains:function(l,m){return e.Rectangle.contains(this,l,m)},containsRect:function(l){return e.Rectangle.containsRect(l,this)},equals:function(l){return e.Rectangle.equals(this,l)},intersection:function(l,m){return e.Rectangle.intersection(this,l,m)},intersects:function(l){return e.Rectangle.intersects(this,l)},intersectsRaw:function(p,n,o,m,l){return e.Rectangle.intersectsRaw(this,p,n,o,m,l)},union:function(l,m){return e.Rectangle.union(this,l,m)},random:function(l){if(l===undefined){l=new e.Point()}l.x=this.randomX;l.y=this.randomY;return l},getPoint:function(l,m){if(m===undefined){m=new e.Point()}switch(l){default:case e.TOP_LEFT:return m.set(this.x,this.y);case e.TOP_CENTER:return m.set(this.centerX,this.y);case e.TOP_RIGHT:return m.set(this.right,this.y);case e.LEFT_CENTER:return m.set(this.x,this.centerY);case e.CENTER:return m.set(this.centerX,this.centerY);case e.RIGHT_CENTER:return m.set(this.right,this.centerY);case e.BOTTOM_LEFT:return m.set(this.x,this.bottom);case e.BOTTOM_CENTER:return m.set(this.centerX,this.bottom);case e.BOTTOM_RIGHT:return m.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(e.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(e.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(e.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(l){if(l<=this.y){this.height=0}else{this.height=l-this.y}}});Object.defineProperty(e.Rectangle.prototype,"bottomLeft",{get:function(){return new e.Point(this.x,this.bottom)},set:function(l){this.x=l.x;this.bottom=l.y}});Object.defineProperty(e.Rectangle.prototype,"bottomRight",{get:function(){return new e.Point(this.right,this.bottom)},set:function(l){this.right=l.x;this.bottom=l.y}});Object.defineProperty(e.Rectangle.prototype,"left",{get:function(){return this.x},set:function(l){if(l>=this.right){this.width=0}else{this.width=this.right-l}this.x=l}});Object.defineProperty(e.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(l){if(l<=this.x){this.width=0}else{this.width=l-this.x}}});Object.defineProperty(e.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(e.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(e.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(l){this.x=l-this.halfWidth}});Object.defineProperty(e.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(l){this.y=l-this.halfHeight}});Object.defineProperty(e.Rectangle.prototype,"randomX",{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(e.Rectangle.prototype,"randomY",{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(e.Rectangle.prototype,"top",{get:function(){return this.y},set:function(l){if(l>=this.bottom){this.height=0;this.y=l}else{this.height=(this.bottom-l)}}});Object.defineProperty(e.Rectangle.prototype,"topLeft",{get:function(){return new e.Point(this.x,this.y)},set:function(l){this.x=l.x;this.y=l.y}});Object.defineProperty(e.Rectangle.prototype,"topRight",{get:function(){return new e.Point(this.x+this.width,this.y)},set:function(l){this.right=l.x;this.y=l.y}});Object.defineProperty(e.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(l){if(l===true){this.setTo(0,0,0,0)}}});e.Rectangle.prototype.constructor=e.Rectangle;e.Rectangle.inflate=function(m,n,l){m.x-=n;m.width+=2*n;m.y-=l;m.height+=2*l;return m};e.Rectangle.inflatePoint=function(m,l){return e.Rectangle.inflate(m,l.x,l.y)};e.Rectangle.size=function(l,m){if(m===undefined||m===null){m=new e.Point(l.width,l.height)}else{m.setTo(l.width,l.height)}return m};e.Rectangle.clone=function(l,m){if(m===undefined||m===null){m=new e.Rectangle(l.x,l.y,l.width,l.height)}else{m.setTo(l.x,l.y,l.width,l.height)}return m};e.Rectangle.contains=function(m,l,n){if(m.width<=0||m.height<=0){return false}return(l>=m.x&&l<m.right&&n>=m.y&&n<m.bottom)};e.Rectangle.containsRaw=function(o,n,p,m,l,q){return(l>=o&&l<(o+p)&&q>=n&&q<(n+m))};e.Rectangle.containsPoint=function(m,l){return e.Rectangle.contains(m,l.x,l.y)};e.Rectangle.containsRect=function(m,l){if(m.volume>l.volume){return false}return(m.x>=l.x&&m.y>=l.y&&m.right<l.right&&m.bottom<l.bottom)};e.Rectangle.equals=function(m,l){return(m.x===l.x&&m.y===l.y&&m.width===l.width&&m.height===l.height)};e.Rectangle.sameDimensions=function(m,l){return(m.width===l.width&&m.height===l.height)};e.Rectangle.intersection=function(m,l,n){if(n===undefined){n=new e.Rectangle()}if(e.Rectangle.intersects(m,l)){n.x=Math.max(m.x,l.x);n.y=Math.max(m.y,l.y);n.width=Math.min(m.right,l.right)-n.x;n.height=Math.min(m.bottom,l.bottom)-n.y}return n};e.Rectangle.intersects=function(m,l){if(m.width<=0||m.height<=0||l.width<=0||l.height<=0){return false}return !(m.right<l.x||m.bottom<l.y||m.x>l.right||m.y>l.bottom)};e.Rectangle.intersectsRaw=function(l,q,o,p,n,m){if(m===undefined){m=0}return !(q>l.right+m||o<l.left-m||p>l.bottom+m||n<l.top-m)};e.Rectangle.union=function(m,l,n){if(n===undefined){n=new e.Rectangle()}return n.setTo(Math.min(m.x,l.x),Math.min(m.y,l.y),Math.max(m.right,l.right)-Math.min(m.left,l.left),Math.max(m.bottom,l.bottom)-Math.min(m.top,l.top))};e.Rectangle.aabb=function(o,n){if(n===undefined){n=new e.Rectangle()}var q=Number.NEGATIVE_INFINITY,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;o.forEach(function(r){if(r.x>q){q=r.x}if(r.x<m){m=r.x}if(r.y>p){p=r.y}if(r.y<l){l=r.y}});n.setTo(m,l,q-m,p-l);return n};PIXI.Rectangle=e.Rectangle;PIXI.EmptyRectangle=new e.Rectangle(0,0,0,0);e.RoundedRectangle=function(n,p,o,m,l){if(n===undefined){n=0}if(p===undefined){p=0}if(o===undefined){o=0}if(m===undefined){m=0}if(l===undefined){l=20}this.x=n;this.y=p;this.width=o;this.height=m;this.radius=l||20;this.type=e.ROUNDEDRECTANGLE};e.RoundedRectangle.prototype={clone:function(){return new e.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(l,o){if(this.width<=0||this.height<=0){return false}var m=this.x;if(l>=m&&l<=m+this.width){var n=this.y;if(o>=n&&o<=n+this.height){return true}}return false}};e.RoundedRectangle.prototype.constructor=e.RoundedRectangle;PIXI.RoundedRectangle=e.RoundedRectangle;e.Camera=function(n,q,m,p,o,l){this.game=n;this.world=n.world;this.id=0;this.view=new e.Rectangle(m,p,o,l);this.bounds=new e.Rectangle(m,p,o,l);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new e.Point(1,1);this.onShakeComplete=new e.Signal();this.onFlashComplete=new e.Signal();this.onFadeComplete=new e.Signal();this.fx=null;this._targetPosition=new e.Point();this._edge=0;this._position=new e.Point();this._shake={intensity:0,duration:0,horizontal:false,vertical:false,shakeBounds:true,x:0,y:0};this._fxDuration=0;this._fxType=0};e.Camera.FOLLOW_LOCKON=0;e.Camera.FOLLOW_PLATFORMER=1;e.Camera.FOLLOW_TOPDOWN=2;e.Camera.FOLLOW_TOPDOWN_TIGHT=3;e.Camera.SHAKE_BOTH=4;e.Camera.SHAKE_HORIZONTAL=5;e.Camera.SHAKE_VERTICAL=6;e.Camera.ENABLE_FX=true;e.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;if(e.Graphics&&e.Camera.ENABLE_FX){this.fx=new e.Graphics(this.game);this.game.stage.addChild(this.fx)}},preUpdate:function(){this.totalInView=0},follow:function(r,p,n,m){if(p===undefined){p=e.Camera.FOLLOW_LOCKON}if(n===undefined){n=1}if(m===undefined){m=1}this.target=r;this.lerp.set(n,m);var q;switch(p){case e.Camera.FOLLOW_PLATFORMER:var l=this.width/8;var o=this.height/3;this.deadzone=new e.Rectangle((this.width-l)/2,(this.height-o)/2-o*0.25,l,o);break;case e.Camera.FOLLOW_TOPDOWN:q=Math.max(this.width,this.height)/4;this.deadzone=new e.Rectangle((this.width-q)/2,(this.height-q)/2,q,q);break;case e.Camera.FOLLOW_TOPDOWN_TIGHT:q=Math.max(this.width,this.height)/8;this.deadzone=new e.Rectangle((this.width-q)/2,(this.height-q)/2,q,q);break;case e.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(l){this.setPosition(Math.round(l.x-this.view.halfWidth),Math.round(l.y-this.view.halfHeight))},focusOnXY:function(l,m){this.setPosition(Math.round(l-this.view.halfWidth),Math.round(m-this.view.halfHeight))},shake:function(l,p,n,o,m){if(l===undefined){l=0.05}if(p===undefined){p=500}if(n===undefined){n=true}if(o===undefined){o=e.Camera.SHAKE_BOTH}if(m===undefined){m=true}if(!n&&this._shake.duration>0){return false}this._shake.intensity=l;this._shake.duration=p;this._shake.shakeBounds=m;this._shake.x=0;this._shake.y=0;this._shake.horizontal=(o===e.Camera.SHAKE_BOTH||o===e.Camera.SHAKE_HORIZONTAL);this._shake.vertical=(o===e.Camera.SHAKE_BOTH||o===e.Camera.SHAKE_VERTICAL);return true},flash:function(l,o,m,n){if(l===undefined){l=16777215}if(o===undefined){o=500}if(m===undefined){m=false}if(n===undefined){n=1}if(!this.fx||(!m&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(l,n);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=o;this._fxType=0;return true},fade:function(l,o,m,n){if(l===undefined){l=0}if(o===undefined){o=500}if(m===undefined){m=false}if(n===undefined){n=1}if(!this.fx||(!m&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(l,n);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=0;this._fxDuration=o;this._fxType=1;return true},update:function(){if(this._fxDuration>0){this.updateFX()}if(this._shake.duration>0){this.updateShake()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor();this._shake.x=Math.floor(this._shake.x);this._shake.y=Math.floor(this._shake.y)}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){if(this._fxType===0){this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFlashComplete.dispatch()}}else{this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha>=1){this._fxDuration=0;this.fx.alpha=1;this.onFadeComplete.dispatch()}}},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;if(this._shake.duration<=0){this.onShakeComplete.dispatch();this._shake.x=0;this._shake.y=0}else{if(this._shake.horizontal){this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width}if(this._shake.vertical){this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height}}},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x)}else{if(this._edge>this.deadzone.right){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)}}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y)}else{if(this._edge>this.deadzone.bottom){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y)}}}else{this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x);this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){if(this.bounds){this.bounds.copyFrom(this.game.world.bounds)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;var m=this.view.x+this._shake.x;var n=this.view.right+this._shake.x;var l=this.view.y+this._shake.y;var o=this.view.bottom+this._shake.y;if(m<=this.bounds.x*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.x*this.scale.x;if(!this._shake.shakeBounds){this._shake.x=0}}else{if(n>=this.bounds.right*this.scale.x){this.atLimit.x=true;this.view.x=(this.bounds.right*this.scale.x)-this.width;if(!this._shake.shakeBounds){this._shake.x=0}}}if(l<=this.bounds.top*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.top*this.scale.y;if(!this._shake.shakeBounds){this._shake.y=0}}else{if(o>=this.bounds.bottom*this.scale.y){this.atLimit.y=true;this.view.y=(this.bounds.bottom*this.scale.y)-this.height;if(!this._shake.shakeBounds){this._shake.y=0}}}},setPosition:function(l,m){this.view.x=l;this.view.y=m;if(this.bounds){this.checkBounds()}},setSize:function(m,l){this.view.width=m;this.view.height=l},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this._shake.x=0;this._shake.y=0;this.resetFX()},resetFX:function(){if(this.fx){this.fx.clear();this.fx.alpha=0}this._fxDuration=0}};e.Camera.prototype.constructor=e.Camera;Object.defineProperty(e.Camera.prototype,"x",{get:function(){return this.view.x},set:function(l){this.view.x=l;if(this.bounds){this.checkBounds()}}});Object.defineProperty(e.Camera.prototype,"y",{get:function(){return this.view.y},set:function(l){this.view.y=l;if(this.bounds){this.checkBounds()}}});Object.defineProperty(e.Camera.prototype,"position",{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(l){if(typeof l.x!=="undefined"){this.view.x=l.x}if(typeof l.y!=="undefined"){this.view.y=l.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(e.Camera.prototype,"width",{get:function(){return this.view.width},set:function(l){this.view.width=l}});Object.defineProperty(e.Camera.prototype,"height",{get:function(){return this.view.height},set:function(l){this.view.height=l}});Object.defineProperty(e.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(l){this._shake.intensity=l}});e.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};e.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};e.State.prototype.constructor=e.State;e.StateManager=function(m,l){this.game=m;this.states={};this._pendingState=null;if(typeof l!=="undefined"&&l!==null){this._pendingState=l}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onStateChange=new e.Signal();this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};e.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(m,n,l){if(l===undefined){l=false}var o;if(n instanceof e.State){o=n}else{if(typeof n==="object"){o=n;o.game=this.game}else{if(typeof n==="function"){o=new n(this.game)}}}this.states[m]=o;if(l){if(this.game.isBooted){this.start(m)}else{this._pendingState=m}}return o},remove:function(l){if(this.current===l){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[l]},start:function(m,l,n){if(l===undefined){l=true}if(n===undefined){n=false}if(this.checkState(m)){this._pendingState=m;this._clearWorld=l;this._clearCache=n;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(l,m){if(l===undefined){l=true}if(m===undefined){m=false}this._pendingState=this.current;this._clearWorld=l;this._clearCache=m;if(arguments.length>2){this._args=Array.prototype.slice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var l=this.current;this.clearCurrentState();this.setCurrentState(this._pendingState);this.onStateChange.dispatch(this.current,l);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache){this.game.cache.destroy()}}}},checkState:function(l){if(this.states[l]){if(this.states[l]["preload"]||this.states[l]["create"]||this.states[l]["update"]||this.states[l]["render"]){return true}else{console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}}else{console.warn("Phaser.StateManager - No state found with the key: "+l);return false}},link:function(l){this.states[l].game=this.game;this.states[l].add=this.game.add;this.states[l].make=this.game.make;this.states[l].camera=this.game.camera;this.states[l].cache=this.game.cache;this.states[l].input=this.game.input;this.states[l].load=this.game.load;this.states[l].math=this.game.math;this.states[l].sound=this.game.sound;this.states[l].scale=this.game.scale;this.states[l].state=this;this.states[l].stage=this.game.stage;this.states[l].time=this.game.time;this.states[l].tweens=this.game.tweens;this.states[l].world=this.game.world;this.states[l].particles=this.game.particles;this.states[l].rnd=this.game.rnd;this.states[l].physics=this.game.physics;this.states[l].key=l},unlink:function(l){if(this.states[l]){this.states[l].game=null;this.states[l].add=null;this.states[l].make=null;this.states[l].camera=null;this.states[l].cache=null;this.states[l].input=null;this.states[l].load=null;this.states[l].math=null;this.states[l].sound=null;this.states[l].scale=null;this.states[l].state=null;this.states[l].stage=null;this.states[l].time=null;this.states[l].tweens=null;this.states[l].world=null;this.states[l].particles=null;this.states[l].rnd=null;this.states[l].physics=null}},setCurrentState:function(l){this.callbackContext=this.states[l];this.link(l);this.onInitCallback=this.states[l]["init"]||this.dummy;this.onPreloadCallback=this.states[l]["preload"]||null;this.onLoadRenderCallback=this.states[l]["loadRender"]||null;this.onLoadUpdateCallback=this.states[l]["loadUpdate"]||null;this.onCreateCallback=this.states[l]["create"]||null;this.onUpdateCallback=this.states[l]["update"]||null;this.onPreRenderCallback=this.states[l]["preRender"]||null;this.onRenderCallback=this.states[l]["render"]||null;this.onResizeCallback=this.states[l]["resize"]||null;this.onPausedCallback=this.states[l]["paused"]||null;this.onResumedCallback=this.states[l]["resumed"]||null;this.onPauseUpdateCallback=this.states[l]["pauseUpdate"]||null;this.onShutDownCallback=this.states[l]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=l;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(l===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created){if(this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created){if(this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(l){if(this._created&&this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,l)}},resize:function(m,l){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,m,l)}},render:function(){if(this._created){if(this.onRenderCallback){if(this.game.renderType===e.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this._clearWorld=true;this._clearCache=true;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};e.StateManager.prototype.constructor=e.StateManager;Object.defineProperty(e.StateManager.prototype,"created",{get:function(){return this._created}});e.Signal=function(){};e.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:false,validateListener:function(l,m){if(typeof l!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",m))}},_registerListener:function(q,o,p,n,l){var m=this._indexOfListener(q,p);var r;if(m!==-1){r=this._bindings[m];if(r.isOnce()!==o){throw new Error("You cannot add"+(o?"":"Once")+"() then add"+(!o?"":"Once")+"() the same listener without removing the relationship first.")}}else{r=new e.SignalBinding(this,q,o,p,n,l);this._addBinding(r)}if(this.memorize&&this._prevParams){r.execute(this._prevParams)}return r},_addBinding:function(l){if(!this._bindings){this._bindings=[]}var m=this._bindings.length;do{m--}while(this._bindings[m]&&l._priority<=this._bindings[m]._priority);this._bindings.splice(m+1,0,l)},_indexOfListener:function(m,l){if(!this._bindings){return -1}if(l===undefined){l=null}var p=this._bindings.length;var o;while(p--){o=this._bindings[p];if(o._listener===m&&o.context===l){return p}}return -1},has:function(m,l){return this._indexOfListener(m,l)!==-1},add:function(p,o,n){this.validateListener(p,"add");var l=[];if(arguments.length>3){for(var m=3;m<arguments.length;m++){l.push(arguments[m])}}return this._registerListener(p,false,o,n,l)},addOnce:function(p,o,n){this.validateListener(p,"addOnce");var l=[];if(arguments.length>3){for(var m=3;m<arguments.length;m++){l.push(arguments[m])}}return this._registerListener(p,true,o,n,l)},remove:function(n,m){this.validateListener(n,"remove");var l=this._indexOfListener(n,m);if(l!==-1){this._bindings[l]._destroy();this._bindings.splice(l,1)}return n},removeAll:function(l){if(l===undefined){l=null}if(!this._bindings){return}var m=this._bindings.length;while(m--){if(l){if(this._bindings[m].context===l){this._bindings[m]._destroy();this._bindings.splice(m,1)}}else{this._bindings[m]._destroy()}}if(!l){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var l=Array.prototype.slice.call(arguments);var o=this._bindings.length;var m;if(this.memorize){this._prevParams=l}if(!o){return}m=this._bindings.slice();this._shouldPropagate=true;do{o--}while(m[o]&&this._shouldPropagate&&m[o].execute(l)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(e.Signal.prototype,"boundDispatch",{get:function(){var l=this;return this._boundDispatch||(this._boundDispatch=function(){return l.dispatch.apply(l,arguments)})}});e.Signal.prototype.constructor=e.Signal;e.SignalBinding=function(q,p,n,o,m,l){this._listener=p;if(n){this._isOnce=true}if(o!=null){this.context=o}this._signal=q;if(m){this._priority=m}if(l&&l.length){this._args=l}};e.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(l){var n,m;if(this.active&&!!this._listener){m=this.params?this.params.concat(l):l;if(this._args){m=m.concat(this._args)}n=this._listener.apply(this.context,m);this.callCount++;if(this._isOnce){this.detach()}}return n},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};e.SignalBinding.prototype.constructor=e.SignalBinding;e.Filter=function(m,l,o){this.game=m;this.type=e.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new e.Point();var p=new Date();this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[p.getFullYear(),p.getMonth(),p.getDate(),p.getHours()*60*60+p.getMinutes()*60+p.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(l){for(var n in l){this.uniforms[n]=l[n]}}if(typeof o==="string"){o=o.split("\n")}this.fragmentSrc=o||[]};e.Filter.prototype={init:function(){},setResolution:function(m,l){this.uniforms.resolution.value.x=m;this.uniforms.resolution.value.y=l},update:function(m){if(m){var l=m.x/this.game.width;var n=1-m.y/this.game.height;if(l!==this.prevPoint.x||n!==this.prevPoint.y){this.uniforms.mouse.value.x=l.toFixed(2);this.uniforms.mouse.value.y=n.toFixed(2);this.prevPoint.set(l,n)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(n,r,o,m,l,q){if(l===undefined){l=0}if(q===undefined){q=0}if(o!==undefined&&o!==null){this.width=o}else{o=this.width}if(m!==undefined&&m!==null){this.height=m}else{m=this.height}var p=this.game.add.image(n,r,"__default");p.width=o;p.height=m;p.anchor.set(l,q);p.filters=[this];return p},syncUniforms:function(){for(var l=0;l<this.shaders.length;l++){this.shaders[l].dirty=true}},destroy:function(){this.passes.length=0;this.shaders.length=0;this.fragmentSrc.length=0;this.game=null;this.uniforms=null;this.prevPoint=null}};e.Filter.prototype.constructor=e.Filter;Object.defineProperty(e.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(l){this.uniforms.resolution.value.x=l}});Object.defineProperty(e.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(l){this.uniforms.resolution.value.y=l}});e.Plugin=function(l,m){if(m===undefined){m=null}this.game=l;this.parent=m;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};e.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};e.Plugin.prototype.constructor=e.Plugin;e.PluginManager=function(l){this.game=l;this.plugins=[];this._len=0;this._i=0};e.PluginManager.prototype={add:function(n){var m=Array.prototype.slice.call(arguments,1);var l=false;if(typeof n==="function"){n=new n(this.game,this)}else{n.game=this.game;n.parent=this}if(typeof n.preUpdate==="function"){n.hasPreUpdate=true;l=true}if(typeof n.update==="function"){n.hasUpdate=true;l=true}if(typeof n.postUpdate==="function"){n.hasPostUpdate=true;l=true}if(typeof n.render==="function"){n.hasRender=true;l=true}if(typeof n.postRender==="function"){n.hasPostRender=true;l=true}if(l){if(n.hasPreUpdate||n.hasUpdate||n.hasPostUpdate){n.active=true}if(n.hasRender||n.hasPostRender){n.visible=true}this._len=this.plugins.push(n);if(typeof n.init==="function"){n.init.apply(n,m)}return n}else{return null}},remove:function(m,l){if(l===undefined){l=true}this._i=this._len;while(this._i--){if(this.plugins[this._i]===m){if(l){m.destroy()}this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};e.PluginManager.prototype.constructor=e.PluginManager;e.Stage=function(l){this.game=l;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.worldTransform=new PIXI.Matrix();this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};if(!this.game.transparent){this._bgColor.a=1}if(l.config){this.parseConfig(l.config)}};e.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);e.Stage.prototype.constructor=e.Stage;e.Stage.prototype.parseConfig=function(l){if(l.disableVisibilityChange){this.disableVisibilityChange=l.disableVisibilityChange}if(l.backgroundColor){this.setBackgroundColor(l.backgroundColor)}};e.Stage.prototype.boot=function(){e.DOM.getOffset(this.game.canvas,this.offset);e.Canvas.setUserSelect(this.game.canvas,"none");e.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};e.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;var l=0;while(l<this.children.length){var m=this.children[l];m.preUpdate();if(this===m.parent){l++}}};e.Stage.prototype.update=function(){var l=this.children.length;while(l--){this.children[l].update()}};e.Stage.prototype.postUpdate=function(){this.game.camera.update();if(this.game.camera.target){this.game.camera.target.postUpdate();this.updateTransform();this.game.camera.updateTarget()}for(var l=0;l<this.children.length;l++){this.children[l].postUpdate()}this.updateTransform()};e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var l=0;l<this.children.length;l++){this.children[l].updateTransform()}};e.Stage.prototype.checkVisibility=function(){if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{this._hiddenVar=null}}}}var l=this;this._onChange=function(m){return l.visibilityChange(m)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){e.Stage.prototype.visibilityChange.call(l,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){e.Stage.prototype.visibilityChange.call(l,{type:"resume"})})}};e.Stage.prototype.visibilityChange=function(l){if(l.type==="pagehide"||l.type==="blur"||l.type==="pageshow"||l.type==="focus"){if(l.type==="pagehide"||l.type==="blur"){this.game.focusLoss(l)}else{if(l.type==="pageshow"||l.type==="focus"){this.game.focusGain(l)}}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||l.type==="pause"){this.game.gamePaused(l)}else{this.game.gameResumed(l)}};e.Stage.prototype.setBackgroundColor=function(l){if(this.game.transparent){return}e.Color.valueToColor(l,this._bgColor);e.Color.updateColor(this._bgColor);this._bgColor.r/=255;this._bgColor.g/=255;this._bgColor.b/=255;this._bgColor.a=1};e.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(e.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(l){this.setBackgroundColor(l)}});Object.defineProperty(e.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(l){if(l){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});e.Group=function(m,p,n,l,q,o){if(l===undefined){l=false}if(q===undefined){q=false}if(o===undefined){o=e.Physics.ARCADE}this.game=m;if(p===undefined){p=m.world}this.name=n||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(l){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(p){p.addChild(this);this.z=p.children.length}}this.type=e.GROUP;this.physicsType=e.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.pendingDestroy=false;this.classType=e.Sprite;this.cursor=null;this.inputEnableChildren=false;this.updateOnlyExistingChildren=false;this.onChildInputDown=new e.Signal();this.onChildInputUp=new e.Signal();this.onChildInputOver=new e.Signal();this.onChildInputOut=new e.Signal();this.enableBody=q;this.enableBodyDebug=false;this.physicsBodyType=o;this.physicsSortDirection=null;this.onDestroy=new e.Signal();this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new e.Point();this.hash=[];this._sortProperty="z"};e.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);e.Group.prototype.constructor=e.Group;e.Group.RETURN_NONE=0;e.Group.RETURN_TOTAL=1;e.Group.RETURN_CHILD=2;e.Group.RETURN_ALL=3;e.Group.SORT_ASCENDING=-1;e.Group.SORT_DESCENDING=1;e.Group.prototype.add=function(n,l,m){if(l===undefined){l=false}if(n.parent===this){return n}if(n.body&&n.parent&&n.parent.hash){n.parent.removeFromHash(n)}if(m===undefined){n.z=this.children.length;this.addChild(n)}else{this.addChildAt(n,m);this.updateZ()}if(this.enableBody&&n.hasOwnProperty("body")&&n.body===null){this.game.physics.enable(n,this.physicsBodyType)}else{if(n.body){this.addToHash(n)}}if(this.inputEnableChildren&&(!n.input||n.inputEnabled)){n.inputEnabled=true}if(!l&&n.events){n.events.onAddedToGroup$dispatch(n,this)}if(this.cursor===null){this.cursor=n}return n};e.Group.prototype.addAt=function(n,m,l){return this.add(n,l,m)};e.Group.prototype.addToHash=function(m){if(m.parent===this){var l=this.hash.indexOf(m);if(l===-1){this.hash.push(m);return true}}return false};e.Group.prototype.removeFromHash=function(m){if(m){var l=this.hash.indexOf(m);if(l!==-1){this.hash.splice(l,1);return true}}return false};e.Group.prototype.addMultiple=function(n,l){if(n instanceof e.Group){n.moveAll(this,l)}else{if(Array.isArray(n)){for(var m=0;m<n.length;m++){this.add(n[m],l)}}}return n};e.Group.prototype.getAt=function(l){if(l<0||l>=this.children.length){return -1}else{return this.getChildAt(l)}};e.Group.prototype.create=function(l,r,n,p,o,m){if(o===undefined){o=true}var q=new this.classType(this.game,l,r,n,p);q.exists=o;q.visible=o;q.alive=o;return this.add(q,false,m)};e.Group.prototype.createMultiple=function(o,m,p,n){if(p===undefined){p=0}if(n===undefined){n=false}if(!Array.isArray(m)){m=[m]}if(!Array.isArray(p)){p=[p]}var q=this;var l=[];m.forEach(function(r){p.forEach(function(t){for(var s=0;s<o;s++){l.push(q.create(0,0,r,t,n))}})});return l};e.Group.prototype.updateZ=function(){var l=this.children.length;while(l--){this.children[l].z=l}};e.Group.prototype.align=function(m,x,o,u,t,p){if(t===undefined){t=e.TOP_LEFT}if(p===undefined){p=0}if(this.children.length===0||p>this.children.length||(m===-1&&x===-1)){return false}var l=new e.Rectangle(0,0,o,u);var v=(m*o);var s=(x*u);for(var q=p;q<this.children.length;q++){var n=this.children[q];if(n.alignIn){n.alignIn(l,t)}else{continue}if(m===-1){l.y+=u;if(l.y===s){l.x+=o;l.y=0}}else{if(x===-1){l.x+=o;if(l.x===v){l.x=0;l.y+=u}}else{l.x+=o;if(l.x===v){l.x=0;l.y+=u;if(l.y===s){return true}}}}}return true};e.Group.prototype.resetCursor=function(l){if(l===undefined){l=0}if(l>this.children.length-1){l=0}if(this.cursor){this.cursorIndex=l;this.cursor=this.children[this.cursorIndex];return this.cursor}};e.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};e.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};e.Group.prototype.swap=function(m,l){this.swapChildren(m,l);this.updateZ()};e.Group.prototype.bringToTop=function(l){if(l.parent===this&&this.getIndex(l)<this.children.length){this.remove(l,false,true);this.add(l,true)}return l};e.Group.prototype.sendToBack=function(l){if(l.parent===this&&this.getIndex(l)>0){this.remove(l,false,true);this.addAt(l,0,true)}return l};e.Group.prototype.moveUp=function(n){if(n.parent===this&&this.getIndex(n)<this.children.length-1){var m=this.getIndex(n);var l=this.getAt(m+1);if(l){this.swap(n,l)}}return n};e.Group.prototype.moveDown=function(n){if(n.parent===this&&this.getIndex(n)>0){var m=this.getIndex(n);var l=this.getAt(m-1);if(l){this.swap(n,l)}}return n};e.Group.prototype.xy=function(m,l,n){if(m<0||m>this.children.length){return -1}else{this.getChildAt(m).x=l;this.getChildAt(m).y=n}};e.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};e.Group.prototype.getIndex=function(l){return this.children.indexOf(l)};e.Group.prototype.getByName=function(l){for(var m=0;m<this.children.length;m++){if(this.children[m].name===l){return this.children[m]}}return null};e.Group.prototype.replace=function(n,l){var m=this.getIndex(n);if(m!==-1){if(l.parent){if(l.parent instanceof e.Group){l.parent.remove(l)}else{l.parent.removeChild(l)}}this.remove(n);this.addAt(l,m);return n}};e.Group.prototype.hasProperty=function(n,m){var l=m.length;if(l===1&&m[0] in n){return true}else{if(l===2&&m[0] in n&&m[1] in n[m[0]]){return true}else{if(l===3&&m[0] in n&&m[1] in n[m[0]]&&m[2] in n[m[0]][m[1]]){return true}else{if(l===4&&m[0] in n&&m[1] in n[m[0]]&&m[2] in n[m[0]][m[1]]&&m[3] in n[m[0]][m[1]][m[2]]){return true}}}}return false};e.Group.prototype.setProperty=function(q,n,p,m,o){if(o===undefined){o=false}m=m||0;if(!this.hasProperty(q,n)&&(!o||m>0)){return false}var l=n.length;if(l===1){if(m===0){q[n[0]]=p}else{if(m===1){q[n[0]]+=p}else{if(m===2){q[n[0]]-=p}else{if(m===3){q[n[0]]*=p}else{if(m===4){q[n[0]]/=p}}}}}}else{if(l===2){if(m===0){q[n[0]][n[1]]=p}else{if(m===1){q[n[0]][n[1]]+=p}else{if(m===2){q[n[0]][n[1]]-=p}else{if(m===3){q[n[0]][n[1]]*=p}else{if(m===4){q[n[0]][n[1]]/=p}}}}}}else{if(l===3){if(m===0){q[n[0]][n[1]][n[2]]=p}else{if(m===1){q[n[0]][n[1]][n[2]]+=p}else{if(m===2){q[n[0]][n[1]][n[2]]-=p}else{if(m===3){q[n[0]][n[1]][n[2]]*=p}else{if(m===4){q[n[0]][n[1]][n[2]]/=p}}}}}}else{if(l===4){if(m===0){q[n[0]][n[1]][n[2]][n[3]]=p}else{if(m===1){q[n[0]][n[1]][n[2]][n[3]]+=p}else{if(m===2){q[n[0]][n[1]][n[2]][n[3]]-=p}else{if(m===3){q[n[0]][n[1]][n[2]][n[3]]*=p}else{if(m===4){q[n[0]][n[1]][n[2]][n[3]]/=p}}}}}}}}}return true};e.Group.prototype.checkProperty=function(p,m,o,n){if(n===undefined){n=false}if(this!==p.parent){return false}var l=e.Utils.getProperty(p,m);if(((l===undefined)&&n)||(l!==o)){return false}return true};e.Group.prototype.set=function(r,n,p,m,q,l,o){if(o===undefined){o=false}n=n.split(".");if(m===undefined){m=false}if(q===undefined){q=false}if((m===false||(m&&r.alive))&&(q===false||(q&&r.visible))){return this.setProperty(r,n,p,l,o)}};e.Group.prototype.setAll=function(o,q,m,r,l,p){if(m===undefined){m=false}if(r===undefined){r=false}if(p===undefined){p=false}o=o.split(".");l=l||0;for(var n=0;n<this.children.length;n++){if((!m||(m&&this.children[n].alive))&&(!r||(r&&this.children[n].visible))){this.setProperty(this.children[n],o,q,l,p)}}};e.Group.prototype.setAllChildren=function(o,q,m,r,l,p){if(m===undefined){m=false}if(r===undefined){r=false}if(p===undefined){p=false}l=l||0;for(var n=0;n<this.children.length;n++){if((!m||(m&&this.children[n].alive))&&(!r||(r&&this.children[n].visible))){if(this.children[n] instanceof e.Group){this.children[n].setAllChildren(o,q,m,r,l,p)}else{this.setProperty(this.children[n],o.split("."),q,l,p)}}}};e.Group.prototype.checkAll=function(n,p,l,q,o){if(l===undefined){l=false}if(q===undefined){q=false}if(o===undefined){o=false}for(var m=0;m<this.children.length;m++){var r=this.children[m];if((!l||(l&&r.alive))&&(!q||(q&&r.visible))){if(!this.checkProperty(r,n,p,o)){return false}}}return true};e.Group.prototype.checkAny=function(n,o,l,p){if(l===undefined){l=false}if(p===undefined){p=false}for(var m=0;m<this.children.length;m++){var q=this.children[m];if((!l||(l&&q.alive))&&(!p||(p&&q.visible))){if(this.checkProperty(q,n,o)){return true}}}return false};e.Group.prototype.addAll=function(n,m,l,o){this.setAll(n,m,l,o,1)};e.Group.prototype.subAll=function(n,m,l,o){this.setAll(n,m,l,o,2)};e.Group.prototype.multiplyAll=function(n,m,l,o){this.setAll(n,m,l,o,3)};e.Group.prototype.divideAll=function(n,m,l,o){this.setAll(n,m,l,o,4)};e.Group.prototype.killAll=function(){this.callAllExists("kill",true)};e.Group.prototype.reviveAll=function(){this.callAllExists("revive",false)};e.Group.prototype.resetAll=function(l,p,m,n,o){this.forEach(this.resetChild,this,o,l,p,m,n)};e.Group.prototype.callAllExists=function(o,n){var l;if(arguments.length>2){l=[];for(var m=2;m<arguments.length;m++){l.push(arguments[m])}}for(var m=0;m<this.children.length;m++){if(this.children[m].exists===n&&this.children[m][o]){this.children[m][o].apply(this.children[m],l)}}};e.Group.prototype.callbackFromArray=function(n,m,l){if(l===1){if(n[m[0]]){return n[m[0]]}}else{if(l===2){if(n[m[0]][m[1]]){return n[m[0]][m[1]]}}else{if(l===3){if(n[m[0]][m[1]][m[2]]){return n[m[0]][m[1]][m[2]]}}else{if(l===4){if(n[m[0]][m[1]][m[2]][m[3]]){return n[m[0]][m[1]][m[2]][m[3]]}}else{if(n[m]){return n[m]}}}}}return false};e.Group.prototype.callAll=function(s,o){if(s===undefined){return}s=s.split(".");var q=s.length;if(o===undefined||o===null||o===""){o=null}else{if(typeof o==="string"){o=o.split(".");var p=o.length}}var m;if(arguments.length>2){m=[];for(var n=2;n<arguments.length;n++){m.push(arguments[n])}}var r=null;var l=null;for(var n=0;n<this.children.length;n++){r=this.callbackFromArray(this.children[n],s,q);if(o&&r){l=this.callbackFromArray(this.children[n],o,p);if(r){r.apply(l,m)}}else{if(r){r.apply(this.children[n],m)}}}};e.Group.prototype.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false}if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var l=0;while(l<this.children.length){var m=this.children[l];m.preUpdate();if(this===m.parent){l++}}return true};e.Group.prototype.update=function(){var m=this.children.length;while(m--){var l=this.children.length;if(m>=l){m=l-1}var n=this.children[m];if(!this.updateOnlyExistingChildren||n.exists){n.update()}}};e.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var l=0;l<this.children.length;l++){this.children[l].postUpdate()}};e.Group.prototype.filter=function(l,q){var m=-1;var o=this.children.length;var n=[];while(++m<o){var p=this.children[m];if(!q||(q&&p.exists)){if(l(p,m,this.children)){n.push(p)}}}return new e.ArraySet(n)};e.Group.prototype.forEach=function(p,l,o){if(o===undefined){o=false}if(arguments.length<=3){for(var n=0;n<this.children.length;n++){if(!o||(o&&this.children[n].exists)){p.call(l,this.children[n])}}}else{var m=[null];for(var n=3;n<arguments.length;n++){m.push(arguments[n])}for(var n=0;n<this.children.length;n++){if(!o||(o&&this.children[n].exists)){m[0]=this.children[n];p.apply(l,m)}}}};e.Group.prototype.forEachExists=function(o,l){var m;if(arguments.length>2){m=[null];for(var n=2;n<arguments.length;n++){m.push(arguments[n])}}this.iterate("exists",true,e.Group.RETURN_TOTAL,o,l,m)};e.Group.prototype.forEachAlive=function(o,l){var m;if(arguments.length>2){m=[null];for(var n=2;n<arguments.length;n++){m.push(arguments[n])}}this.iterate("alive",true,e.Group.RETURN_TOTAL,o,l,m)};e.Group.prototype.forEachDead=function(o,l){var m;if(arguments.length>2){m=[null];for(var n=2;n<arguments.length;n++){m.push(arguments[n])}}this.iterate("alive",false,e.Group.RETURN_TOTAL,o,l,m)};e.Group.prototype.sort=function(m,l){if(this.children.length<2){return}if(m===undefined){m="z"}if(l===undefined){l=e.Group.SORT_ASCENDING}this._sortProperty=m;if(l===e.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};e.Group.prototype.customSort=function(l,m){if(this.children.length<2){return}this.children.sort(l.bind(m));this.updateZ()};e.Group.prototype.ascendingSortHandler=function(m,l){if(m[this._sortProperty]<l[this._sortProperty]){return -1}else{if(m[this._sortProperty]>l[this._sortProperty]){return 1}else{if(m.z<l.z){return -1}else{return 1}}}};e.Group.prototype.descendingSortHandler=function(m,l){if(m[this._sortProperty]<l[this._sortProperty]){return 1}else{if(m[this._sortProperty]>l[this._sortProperty]){return -1}else{return 0}}};e.Group.prototype.iterate=function(s,r,o,t,m,p){if(this.children.length===0){if(o===e.Group.RETURN_TOTAL){return 0}else{if(o===e.Group.RETURN_ALL){return[]}}}var q=0;if(o===e.Group.RETURN_ALL){var l=[]}for(var n=0;n<this.children.length;n++){if(this.children[n][s]===r){q++;if(t){if(p){p[0]=this.children[n];t.apply(m,p)}else{t.call(m,this.children[n])}}if(o===e.Group.RETURN_CHILD){return this.children[n]}else{if(o===e.Group.RETURN_ALL){l.push(this.children[n])}}}}if(o===e.Group.RETURN_TOTAL){return q}else{if(o===e.Group.RETURN_ALL){return l}else{return null}}};e.Group.prototype.getFirstExists=function(o,m,l,r,n,p){if(m===undefined){m=false}if(typeof o!=="boolean"){o=true}var q=this.iterate("exists",o,e.Group.RETURN_CHILD);return(q===null&&m)?this.create(l,r,n,p):this.resetChild(q,l,r,n,p)};e.Group.prototype.getFirstAlive=function(m,l,q,n,o){if(m===undefined){m=false}var p=this.iterate("alive",true,e.Group.RETURN_CHILD);return(p===null&&m)?this.create(l,q,n,o):this.resetChild(p,l,q,n,o)};e.Group.prototype.getFirstDead=function(m,l,q,n,o){if(m===undefined){m=false}var p=this.iterate("alive",false,e.Group.RETURN_CHILD);return(p===null&&m)?this.create(l,q,n,o):this.resetChild(p,l,q,n,o)};e.Group.prototype.resetChild=function(p,l,o,m,n){if(p===null){return null}if(l===undefined){l=null}if(o===undefined){o=null}if(l!==null&&o!==null){p.reset(l,o)}if(m!==undefined){p.loadTexture(m,n)}return p};e.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};e.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};e.Group.prototype.getClosestTo=function(o,s,n){var r=Number.MAX_VALUE;var m=0;var l=null;for(var p=0;p<this.children.length;p++){var q=this.children[p];if(q.exists){m=Math.abs(e.Point.distance(o,q));if(m<r&&(!s||s.call(n,q,m))){r=m;l=q}}}return l};e.Group.prototype.getFurthestFrom=function(o,s,n){var r=0;var m=0;var l=null;for(var p=0;p<this.children.length;p++){var q=this.children[p];if(q.exists){m=Math.abs(e.Point.distance(o,q));if(m>r&&(!s||s.call(n,q,m))){r=m;l=q}}}return l};e.Group.prototype.countLiving=function(){return this.iterate("alive",true,e.Group.RETURN_TOTAL)};e.Group.prototype.countDead=function(){return this.iterate("alive",false,e.Group.RETURN_TOTAL)};e.Group.prototype.getRandom=function(m,l){if(m===undefined){m=0}if(l===undefined){l=this.children.length}if(l===0){return null}return e.ArrayUtils.getRandomItem(this.children,m,l)};e.Group.prototype.getRandomExists=function(n,m){var l=this.getAll("exists",true,n,m);return this.game.rnd.pick(l)};e.Group.prototype.getAll=function(p,o,q,n){if(q===undefined){q=0}if(n===undefined){n=this.children.length}var l=[];for(var m=q;m<n;m++){var r=this.children[m];if(p){if(r[p]===o){l.push(r)}}else{l.push(r)}}return l};e.Group.prototype.remove=function(o,m,l){if(m===undefined){m=false}if(l===undefined){l=false}if(this.children.length===0||this.children.indexOf(o)===-1){return false}if(!l&&o.events&&!o.destroyPhase){o.events.onRemovedFromGroup$dispatch(o,this)}var n=this.removeChild(o);this.removeFromHash(o);this.updateZ();if(this.cursor===o){this.next()}if(m&&n){n.destroy(true)}return true};e.Group.prototype.moveAll=function(m,l){if(l===undefined){l=false}if(this.children.length>0&&m instanceof e.Group){do{m.add(this.children[0],l)}while(this.children.length>0);this.hash=[];this.cursor=null}return m};e.Group.prototype.removeAll=function(n,l,m){if(n===undefined){n=false}if(l===undefined){l=false}if(m===undefined){m=false}if(this.children.length===0){return}do{if(!l&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var o=this.removeChild(this.children[0]);this.removeFromHash(o);if(n&&o){o.destroy(true,m)}}while(this.children.length>0);this.hash=[];this.cursor=null};e.Group.prototype.removeBetween=function(q,o,n,l){if(o===undefined){o=this.children.length-1}if(n===undefined){n=false}if(l===undefined){l=false}if(this.children.length===0){return}if(q>o||q<0||o>this.children.length){return false}var m=o;while(m>=q){if(!l&&this.children[m].events){this.children[m].events.onRemovedFromGroup$dispatch(this.children[m],this)}var p=this.removeChild(this.children[m]);this.removeFromHash(p);if(n&&p){p.destroy(true)}if(this.cursor===this.children[m]){this.cursor=null}m--}this.updateZ()};e.Group.prototype.scatter=function(l,m){if(l==null){l=this.game.world.bounds}this.forEach(function(n){n.position.set(l.randomX,l.randomY)},null,m)};e.Group.prototype.shuffle=function(){e.ArrayUtils.shuffle(this.children);this.updateZ()};e.Group.prototype.destroy=function(m,l){if(this.game===null||this.ignoreDestroy){return}if(m===undefined){m=true}if(l===undefined){l=false}this.onDestroy.dispatch(this,m,l);this.removeAll(m);this.cursor=null;this.filters=null;this.pendingDestroy=false;if(!l){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(e.Group.prototype,"total",{get:function(){return this.iterate("exists",true,e.Group.RETURN_TOTAL)}});Object.defineProperty(e.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(e.Group.prototype,"angle",{get:function(){return e.Math.radToDeg(this.rotation)},set:function(l){this.rotation=e.Math.degToRad(l)}});Object.defineProperty(e.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(m){var l=this.getBounds(this.parent);var n=this.x-l.x;this.x=(m+n)-l.halfWidth}});Object.defineProperty(e.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(m){var l=this.getBounds(this.parent);var n=this.y-l.y;this.y=(m+n)-l.halfHeight}});Object.defineProperty(e.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(m){var l=this.getBounds(this.parent);var n=this.x-l.x;this.x=m+n}});Object.defineProperty(e.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(m){var l=this.getBounds(this.parent);var n=this.x-l.x;this.x=(m+n)-l.width}});Object.defineProperty(e.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(m){var l=this.getBounds(this.parent);var n=this.y-l.y;this.y=(m+n)}});Object.defineProperty(e.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(m){var l=this.getBounds(this.parent);var n=this.y-l.y;this.y=(m+n)-l.height}});e.World=function(l){e.Group.call(this,l,null,"__world",false);this.bounds=new e.Rectangle(0,0,l.width,l.height);this.camera=null;this._definedSize=false;this._width=l.width;this._height=l.height;this.game.state.onStateChange.add(this.stateChange,this)};e.World.prototype=Object.create(e.Group.prototype);e.World.prototype.constructor=e.World;e.World.prototype.boot=function(){this.camera=new e.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};e.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset()};e.World.prototype.setBounds=function(m,o,n,l){this._definedSize=true;this._width=n;this._height=l;this.bounds.setTo(m,o,n,l);this.x=m;this.y=o;if(this.camera.bounds){this.camera.bounds.setTo(m,o,Math.max(n,this.game.width),Math.max(l,this.game.height))}this.game.physics.setBoundsToWorld()};e.World.prototype.resize=function(m,l){if(this._definedSize){if(m<this._width){m=this._width}if(l<this._height){l=this._height}}this.bounds.width=m;this.bounds.height=l;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};e.World.prototype.shutdown=function(){this.destroy(true,true)};e.World.prototype.wrap=function(o,p,m,l,n){if(p===undefined){p=0}if(m===undefined){m=false}if(l===undefined){l=true}if(n===undefined){n=true}if(!m){if(l&&o.x+p<this.bounds.x){o.x=this.bounds.right+p}else{if(l&&o.x-p>this.bounds.right){o.x=this.bounds.left-p}}if(n&&o.y+p<this.bounds.top){o.y=this.bounds.bottom+p}else{if(n&&o.y-p>this.bounds.bottom){o.y=this.bounds.top-p}}}else{o.getBounds();if(l){if((o.x+o._currentBounds.width)<this.bounds.x){o.x=this.bounds.right}else{if(o.x>this.bounds.right){o.x=this.bounds.left}}}if(n){if((o.y+o._currentBounds.height)<this.bounds.top){o.y=this.bounds.bottom}else{if(o.y>this.bounds.bottom){o.y=this.bounds.top}}}}};Object.defineProperty(e.World.prototype,"width",{get:function(){return this.bounds.width},set:function(l){if(l<this.game.width){l=this.game.width}this.bounds.width=l;this._width=l;this._definedSize=true}});Object.defineProperty(e.World.prototype,"height",{get:function(){return this.bounds.height},set:function(l){if(l<this.game.height){l=this.game.height}this.bounds.height=l;this._height=l;this._definedSize=true}});Object.defineProperty(e.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(e.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(e.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.between(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.between(this.bounds.x,this.bounds.width)}}});Object.defineProperty(e.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.between(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.between(this.bounds.y,this.bounds.height)}}});e.Game=function(p,l,r,o,q,s,m,n){this.id=e.GAMES.push(this)-1;this.config=null;this.physicsConfig=n;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.multiTexture=false;this.preserveDrawingBuffer=false;this.clearBeforeRender=true;this.renderer=null;this.renderType=e.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=e.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.create=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new e.Signal();this.forceSingleUpdate=true;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof p!=="undefined"){this._width=p}if(typeof l!=="undefined"){this._height=l}if(typeof r!=="undefined"){this.renderType=r}if(typeof o!=="undefined"){this.parent=o}if(typeof s!=="undefined"){this.transparent=s}if(typeof m!=="undefined"){this.antialias=m}this.rnd=new e.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new e.StateManager(this,q)}this.device.whenReady(this.boot,this);return this};e.Game.prototype={parseConfig:function(m){this.config=m;if(m.enableDebug===undefined){this.config.enableDebug=true}if(m.width){this._width=m.width}if(m.height){this._height=m.height}if(m.renderer){this.renderType=m.renderer}if(m.parent){this.parent=m.parent}if(m.transparent!==undefined){this.transparent=m.transparent}if(m.antialias!==undefined){this.antialias=m.antialias}if(m.multiTexture!==undefined){this.multiTexture=m.multiTexture}if(m.resolution){this.resolution=m.resolution}if(m.preserveDrawingBuffer!==undefined){this.preserveDrawingBuffer=m.preserveDrawingBuffer}if(m.physicsConfig){this.physicsConfig=m.physicsConfig}var l=[(Date.now()*Math.random()).toString()];if(m.seed){l=m.seed}this.rnd=new e.RandomDataGenerator(l);var n=null;if(m.state){n=m.state}this.state=new e.StateManager(this,n)},boot:function(){if(this.isBooted){return}this.onPause=new e.Signal();this.onResume=new e.Signal();this.onBlur=new e.Signal();this.onFocus=new e.Signal();this.isBooted=true;PIXI.game=this;this.math=e.Math;this.scale=new e.ScaleManager(this,this._width,this._height);this.stage=new e.Stage(this);this.setUpRenderer();this.world=new e.World(this);this.add=new e.GameObjectFactory(this);this.make=new e.GameObjectCreator(this);this.cache=new e.Cache(this);this.load=new e.Loader(this);this.time=new e.Time(this);this.tweens=new e.TweenManager(this);this.input=new e.Input(this);this.sound=new e.SoundManager(this);this.physics=new e.Physics(this,this.physicsConfig);this.particles=new e.Particles(this);this.create=new e.Create(this);this.plugins=new e.PluginManager(this);this.net=new e.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new e.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){},isDisabled:true}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new e.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new e.RequestAnimationFrame(this,false)}this._kickstart=true;if(window.focus){if(!window.PhaserGlobal||(window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner){return}var m=e.VERSION;var p="Canvas";var l="HTML Audio";var q=1;if(this.renderType===e.WEBGL){p="WebGL";q++}else{if(this.renderType===e.HEADLESS){p="Headless"}}if(this.device.webAudio){l="WebAudio";q++}if(this.device.chrome){var n=["%c %c %c Phaser CE v"+m+" | Pixi.js | "+p+" | "+l+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(var o=0;o<3;o++){if(o<q){n.push("color: #ff2424; background: #fff")}else{n.push("color: #959595; background: #fff")}}console.log.apply(console,n)}else{if(window.console){console.log("Phaser v"+m+" | Pixi.js | "+p+" | "+l+" | http://phaser.io")}}},setUpRenderer:function(){if(this.config.canvas){this.canvas=this.config.canvas}else{this.canvas=e.Canvas.create(this,this.width,this.height,this.config.canvasID,true)}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.renderType===e.HEADLESS||this.renderType===e.CANVAS||(this.renderType===e.AUTO&&!this.device.webGL)){if(this.device.canvas){this.renderer=new PIXI.CanvasRenderer(this);this.context=this.renderer.context;if(this.renderType===e.AUTO){this.renderType=e.CANVAS}}else{throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.")}}else{if(this.multiTexture||this.renderType===e.WEBGL_MULTI){PIXI.enableMultiTexture();this.multiTexture=true}this.renderType=e.WEBGL;this.renderer=new PIXI.WebGLRenderer(this);this.context=null;this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),false);this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),false)}if(this.device.cocoonJS){this.canvas.screencanvas=(this.renderType===e.CANVAS)?true:false}if(this.renderType!==e.HEADLESS){this.stage.smoothed=this.antialias;e.Canvas.addToDOM(this.canvas,this.parent,false);e.Canvas.setTouchAction(this.canvas)}},contextLost:function(l){l.preventDefault();this.renderer.contextLost=true},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=false},update:function(n){this.time.update(n);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+10000;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var l=this.time.slowMotion*1000/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(l*3,this.time.elapsed),0);var m=0;this.updatesThisFrame=Math.floor(this._deltaTime/l);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=l){this._deltaTime-=l;this.currentUpdateID=m;this.updateLogic(this.time.desiredFpsMult);m++;if(this.forceSingleUpdate&&m===1){break}else{this.time.refresh()}}if(m>this._lastCount){this._spiraling++}else{if(m<this._lastCount){this._spiraling=0}}this._lastCount=m;this.updateRender(this._deltaTime/l)}},updateLogic:function(l){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(l);this.plugins.preUpdate(l);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate(l);this.debug.preUpdate()}this.stage.updateTransform()},updateRender:function(l){if(this.lockRender){return}this.state.preRender(l);if(this.renderType!==e.HEADLESS){this.renderer.render(this.stage);this.plugins.render(l);this.state.render(l)}this.plugins.postRender(l)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);e.Canvas.removeFromDOM(this.canvas);PIXI.defaultRenderer=null;e.GAMES[this.id]=null},gamePaused:function(l){if(!this._paused){this._paused=true;this.time.gamePaused();if(this.sound.muteOnPause){this.sound.setMute()}this.onPause.dispatch(l);if(this.device.cordova&&this.device.iOS){this.lockRender=true}}},gameResumed:function(l){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();if(this.sound.muteOnPause){this.sound.unsetMute()}this.onResume.dispatch(l);if(this.device.cordova&&this.device.iOS){this.lockRender=false}}},focusLoss:function(l){this.onBlur.dispatch(l);if(!this.stage.disableVisibilityChange){this.gamePaused(l)}},focusGain:function(l){this.onFocus.dispatch(l);if(!this.stage.disableVisibilityChange){this.gameResumed(l)}}};e.Game.prototype.constructor=e.Game;Object.defineProperty(e.Game.prototype,"paused",{get:function(){return this._paused},set:function(l){if(l===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});e.Input=function(l){this.game=l;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=true;this.multiInputOverride=e.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new e.ArraySet();this._localPoint=new e.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};e.Input.MOUSE_OVERRIDES_TOUCH=0;e.Input.TOUCH_OVERRIDES_MOUSE=1;e.Input.MOUSE_TOUCH_COMBINE=2;e.Input.MAX_POINTERS=10;e.Input.prototype={boot:function(){this.mousePointer=new e.Pointer(this.game,0,e.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new e.Mouse(this.game);this.touch=new e.Touch(this.game);this.mspointer=new e.MSPointer(this.game);if(e.Keyboard){this.keyboard=new e.Keyboard(this.game)}if(e.Gamepad){this.gamepad=new e.Gamepad(this.game)}this.onDown=new e.Signal();this.onUp=new e.Signal();this.onTap=new e.Signal();this.onHold=new e.Signal();this.scale=new e.Point(1,1);this.speed=new e.Point();this.position=new e.Point();this._oldPosition=new e.Point();this.circle=new e.Circle(0,0,44);this.activePointer=this.mousePointer;this.hitCanvas=e.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();if(!this.game.device.mspointer){this.touch.start()}this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var l=this;this._onClickTrampoline=function(m){l.onClickTrampoline(m)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];e.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(m,l){this.customCandidateHandler=m;this.customCandidateHandlerContext=l},addMoveCallback:function(m,l){this.moveCallbacks.push({callback:m,context:l})},deleteMoveCallback:function(n,m){var l=this.moveCallbacks.length;while(l--){if(this.moveCallbacks[l].callback===n&&this.moveCallbacks[l].context===m){this.moveCallbacks.splice(l,1);return}}},addPointer:function(){if(this.pointers.length>=e.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: Maximum limit of "+e.Input.MAX_POINTERS+" pointers reached.");return null}var m=this.pointers.length+1;var l=new e.Pointer(this.game,m,e.PointerMode.TOUCH);this.pointers.push(l);this["pointer"+m]=l;return l},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var l=0;l<this.pointers.length;l++){this.pointers[l].update()}this._pollCounter=0},reset:function(m){if(!this.game.isBooted||this.resetLocked){return}if(m===undefined){m=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(m)}if(this.gamepad){this.gamepad.reset()}for(var l=0;l<this.pointers.length;l++){this.pointers[l].reset()}if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor=""}if(m){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new e.Signal();this.onUp=new e.Signal();this.onTap=new e.Signal();this.onHold=new e.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(l,m){this._oldPosition.setTo(l,m);this.speed.setTo(0,0)},startPointer:function(m){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(m)}if(!this.pointer2.active){return this.pointer2.start(m)}for(var l=2;l<this.pointers.length;l++){var n=this.pointers[l];if(!n.active){return n.start(m)}}return null},updatePointer:function(m){if(this.pointer1.active&&this.pointer1.identifier===m.identifier){return this.pointer1.move(m)}if(this.pointer2.active&&this.pointer2.identifier===m.identifier){return this.pointer2.move(m)}for(var l=2;l<this.pointers.length;l++){var n=this.pointers[l];if(n.active&&n.identifier===m.identifier){return n.move(m)}}return null},stopPointer:function(m){if(this.pointer1.active&&this.pointer1.identifier===m.identifier){return this.pointer1.stop(m)}if(this.pointer2.active&&this.pointer2.identifier===m.identifier){return this.pointer2.stop(m)}for(var l=2;l<this.pointers.length;l++){var n=this.pointers[l];if(n.active&&n.identifier===m.identifier){return n.stop(m)}}return null},countActivePointers:function(l){if(l===undefined){l=this.pointers.length}var n=l;for(var m=0;m<this.pointers.length&&n>0;m++){var o=this.pointers[m];if(o.active){n--}}return(l-n)},getPointer:function(m){if(m===undefined){m=false}for(var l=0;l<this.pointers.length;l++){var n=this.pointers[l];if(n.active===m){return n}}return null},getPointerFromIdentifier:function(l){for(var m=0;m<this.pointers.length;m++){var n=this.pointers[m];if(n.identifier===l){return n}}return null},getPointerFromId:function(m){for(var l=0;l<this.pointers.length;l++){var n=this.pointers[l];if(n.pointerId===m){return n}}return null},getLocalPosition:function(o,n,m){if(m===undefined){m=new e.Point()}var l=o.worldTransform;var p=1/(l.a*l.d+l.c*-l.b);return m.setTo(l.d*p*n.x+-l.c*p*n.y+(l.ty*l.c-l.tx*l.d)*p,l.a*p*n.y+-l.b*p*n.x+(-l.ty*l.a+l.tx*l.b)*p)},hitTest:function(q,l,t){if(!q.worldVisible){return false}this.getLocalPosition(q,l,this._localPoint);t.copyFrom(this._localPoint);if(q.hitArea&&q.hitArea.contains){return(q.hitArea.contains(this._localPoint.x,this._localPoint.y))}else{if(e.Creature&&q instanceof e.Creature){var m=Math.abs(q.width);var s=Math.abs(q.height);var n=q.x-(m*q.anchorX);if(this.game.camera.x+l.x>=n&&this.game.camera.x+l.x<n+m){var r=q.y-(s*q.anchorY);if(this.game.camera.y+l.y>=r&&this.game.camera.y+l.y<r+s){return true}}}else{if(q instanceof e.TileSprite){var m=q.width;var s=q.height;var n=-m*q.anchor.x;if(this._localPoint.x>=n&&this._localPoint.x<n+m){var r=-s*q.anchor.y;if(this._localPoint.y>=r&&this._localPoint.y<r+s){return true}}}else{if(q instanceof PIXI.Sprite){var m=q.texture.frame.width/q.texture.baseTexture.resolution;var s=q.texture.frame.height/q.texture.baseTexture.resolution;var n=-m*q.anchor.x;if(this._localPoint.x>=n&&this._localPoint.x<n+m){var r=-s*q.anchor.y;if(this._localPoint.y>=r&&this._localPoint.y<r+s){return true}}}else{if(q instanceof e.Graphics){for(var p=0;p<q.graphicsData.length;p++){var o=q.graphicsData[p];if(!o.fill){continue}if(o.shape&&o.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}}}}}for(var p=0;p<q.children.length;p++){if(this.hitTest(q.children[p],l,t)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};e.Input.prototype.constructor=e.Input;Object.defineProperty(e.Input.prototype,"x",{get:function(){return this._x},set:function(l){this._x=Math.floor(l)}});Object.defineProperty(e.Input.prototype,"y",{get:function(){return this._y},set:function(l){this._y=Math.floor(l)}});Object.defineProperty(e.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(e.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(e.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(e.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(e.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});e.Mouse=function(l){this.game=l;this.input=l.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new e.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};e.Mouse.NO_BUTTON=-1;e.Mouse.LEFT_BUTTON=0;e.Mouse.MIDDLE_BUTTON=1;e.Mouse.RIGHT_BUTTON=2;e.Mouse.BACK_BUTTON=3;e.Mouse.FORWARD_BUTTON=4;e.Mouse.WHEEL_UP=1;e.Mouse.WHEEL_DOWN=-1;e.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var n=this;this._onMouseDown=function(o){return n.onMouseDown(o)};this._onMouseMove=function(o){return n.onMouseMove(o)};this._onMouseUp=function(o){return n.onMouseUp(o)};this._onMouseUpGlobal=function(o){return n.onMouseUpGlobal(o)};this._onMouseOutGlobal=function(o){return n.onMouseOutGlobal(o)};this._onMouseOut=function(o){return n.onMouseOut(o)};this._onMouseOver=function(o){return n.onMouseOver(o)};this._onMouseWheel=function(o){return n.onMouseWheel(o)};var m=this.game.canvas;m.addEventListener("mousedown",this._onMouseDown,true);m.addEventListener("mousemove",this._onMouseMove,true);m.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);window.addEventListener("mouseout",this._onMouseOutGlobal,true);m.addEventListener("mouseover",this._onMouseOver,true);m.addEventListener("mouseout",this._onMouseOut,true)}var l=this.game.device.wheelEvent;if(l){m.addEventListener(l,this._onMouseWheel,true);if(l==="mousewheel"){this._wheelEvent=new i(-1/40,1)}else{if(l==="DOMMouseScroll"){this._wheelEvent=new i(1,1)}}}},onMouseDown:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=0;this.input.mousePointer.start(l)},onMouseMove:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=0;this.input.mousePointer.move(l)},onMouseUp:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=0;this.input.mousePointer.stop(l)},onMouseUpGlobal:function(l){if(!this.input.mousePointer.withinGame){if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,l)}l.identifier=0;this.input.mousePointer.stop(l)}},onMouseOutGlobal:function(l){this.event=l;if(this.capture){l.preventDefault()}this.input.mousePointer.withinGame=false;if(!this.input.enabled||!this.enabled){return}this.input.mousePointer.stop(l);this.input.mousePointer.leftButton.stop(l);this.input.mousePointer.rightButton.stop(l)},onMouseOut:function(l){this.event=l;if(this.capture){l.preventDefault()}this.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}if(this.stopOnGameOut){l.identifier=0;this.input.mousePointer.stop(l)}},onMouseOver:function(l){this.event=l;if(this.capture){l.preventDefault()}this.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,l)}},onMouseWheel:function(l){if(this._wheelEvent){l=this._wheelEvent.bindEvent(l)}this.event=l;if(this.capture){l.preventDefault()}this.wheelDelta=e.Math.clamp(-l.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,l)}},requestPointerLock:function(){if(this.game.device.pointerLock){var l=this.game.canvas;l.requestPointerLock=l.requestPointerLock||l.mozRequestPointerLock||l.webkitRequestPointerLock;l.requestPointerLock();var m=this;this._pointerLockChange=function(n){return m.pointerLockChange(n)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(m){var l=this.game.canvas;if(document.pointerLockElement===l||document.mozPointerLockElement===l||document.webkitPointerLockElement===l){this.locked=true;this.pointerLock.dispatch(true,m)}else{this.locked=false;this.pointerLock.dispatch(false,m)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){var m=this.game.canvas;m.removeEventListener("mousedown",this._onMouseDown,true);m.removeEventListener("mousemove",this._onMouseMove,true);m.removeEventListener("mouseup",this._onMouseUp,true);m.removeEventListener("mouseover",this._onMouseOver,true);m.removeEventListener("mouseout",this._onMouseOut,true);var l=this.game.device.wheelEvent;if(l){m.removeEventListener(l,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);window.removeEventListener("mouseout",this._onMouseOutGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};e.Mouse.prototype.constructor=e.Mouse;function i(m,l){this._scaleFactor=m;this._deltaMode=l;this.originalEvent=null}i.prototype={};i.prototype.constructor=i;i.prototype.bindEvent=function(m){if(!i._stubsGenerated&&m){var l=function(o){return function(){var p=this.originalEvent[o];return typeof p!=="function"?p:p.bind(this.originalEvent)}};for(var n in m){if(!(n in i.prototype)){Object.defineProperty(i.prototype,n,{get:l(n)})}}i._stubsGenerated=true}this.originalEvent=m;return this};Object.defineProperties(i.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return(this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail))||0}},deltaX:{get:function(){return(this._scaleFactor*this.originalEvent.wheelDeltaX)||0}},deltaZ:{value:0}});e.MSPointer=function(l){this.game=l;this.input=l.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null};e.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var m=this;if(this.game.device.mspointer){this._onMSPointerDown=function(n){return m.onPointerDown(n)};this._onMSPointerMove=function(n){return m.onPointerMove(n)};this._onMSPointerUp=function(n){return m.onPointerUp(n)};this._onMSPointerUpGlobal=function(n){return m.onPointerUpGlobal(n)};this._onMSPointerOut=function(n){return m.onPointerOut(n)};this._onMSPointerOver=function(n){return m.onPointerOver(n)};var l=this.game.canvas;l.addEventListener("MSPointerDown",this._onMSPointerDown,false);l.addEventListener("MSPointerMove",this._onMSPointerMove,false);l.addEventListener("MSPointerUp",this._onMSPointerUp,false);l.addEventListener("pointerdown",this._onMSPointerDown,false);l.addEventListener("pointermove",this._onMSPointerMove,false);l.addEventListener("pointerup",this._onMSPointerUp,false);l.style["-ms-content-zooming"]="none";l.style["-ms-touch-action"]="none";if(!this.game.device.cocoonJS){window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);l.addEventListener("MSPointerOver",this._onMSPointerOver,true);l.addEventListener("MSPointerOut",this._onMSPointerOut,true);window.addEventListener("pointerup",this._onMSPointerUpGlobal,true);l.addEventListener("pointerover",this._onMSPointerOver,true);l.addEventListener("pointerout",this._onMSPointerOut,true)}}},onPointerDown:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=l.pointerId;if(l.pointerType==="mouse"||l.pointerType===4){this.input.mousePointer.start(l)}else{this.input.startPointer(l)}},onPointerMove:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=l.pointerId;if(l.pointerType==="mouse"||l.pointerType===4){this.input.mousePointer.move(l)}else{this.input.updatePointer(l)}},onPointerUp:function(l){this.event=l;if(this.capture){l.preventDefault()}if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}l.identifier=l.pointerId;if(l.pointerType==="mouse"||l.pointerType===4){this.input.mousePointer.stop(l)}else{this.input.stopPointer(l)}},onPointerUpGlobal:function(l){if((l.pointerType==="mouse"||l.pointerType===4)&&!this.input.mousePointer.withinGame){this.onPointerUp(l)}else{var m=this.input.getPointerFromIdentifier(l.identifier);if(m&&m.withinGame){this.onPointerUp(l)}}},onPointerOut:function(l){this.event=l;if(this.capture){l.preventDefault()}if(l.pointerType==="mouse"||l.pointerType===4){this.input.mousePointer.withinGame=false}else{var m=this.input.getPointerFromIdentifier(l.identifier);if(m){m.withinGame=false}}if(this.input.mouse.mouseOutCallback){this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,l)}if(!this.input.enabled||!this.enabled){return}if(this.input.mouse.stopOnGameOut){l.identifier=0;if(m){m.stop(l)}else{this.input.mousePointer.stop(l)}}},onPointerOver:function(l){this.event=l;if(this.capture){l.preventDefault()}if(l.pointerType==="mouse"||l.pointerType===4){this.input.mousePointer.withinGame=true}else{var m=this.input.getPointerFromIdentifier(l.identifier);if(m){m.withinGame=true}}if(this.input.mouse.mouseOverCallback){this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,l)}},stop:function(){var l=this.game.canvas;l.removeEventListener("MSPointerDown",this._onMSPointerDown,false);l.removeEventListener("MSPointerMove",this._onMSPointerMove,false);l.removeEventListener("MSPointerUp",this._onMSPointerUp,false);l.removeEventListener("pointerdown",this._onMSPointerDown,false);l.removeEventListener("pointermove",this._onMSPointerMove,false);l.removeEventListener("pointerup",this._onMSPointerUp,false);window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);l.removeEventListener("MSPointerOver",this._onMSPointerOver,true);l.removeEventListener("MSPointerOut",this._onMSPointerOut,true);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,true);l.removeEventListener("pointerover",this._onMSPointerOver,true);l.removeEventListener("pointerout",this._onMSPointerOut,true)}};e.MSPointer.prototype.constructor=e.MSPointer;e.DeviceButton=function(m,l){this.parent=m;this.game=m.game;this.event=null;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.value=0;this.buttonCode=l;this.onDown=new e.Signal();this.onUp=new e.Signal();this.onFloat=new e.Signal()};e.DeviceButton.prototype={start:function(l,m){if(this.isDown){return}this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.repeats=0;this.event=l;this.value=m;if(l){this.altKey=l.altKey;this.shiftKey=l.shiftKey;this.ctrlKey=l.ctrlKey}this.onDown.dispatch(this,m)},stop:function(l,m){if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.event=l;this.value=m;if(l){this.altKey=l.altKey;this.shiftKey=l.shiftKey;this.ctrlKey=l.ctrlKey}this.onUp.dispatch(this,m)},padFloat:function(l){this.isDown=false;this.isUp=false;this.value=l;this.onFloat.dispatch(this,l)},justPressed:function(l){l=l||250;return(this.isDown&&(this.timeDown+l)>this.game.time.time)},justReleased:function(l){l=l||250;return(this.isUp&&(this.timeUp+l)>this.game.time.time)},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null}};e.DeviceButton.prototype.constructor=e.DeviceButton;Object.defineProperty(e.DeviceButton.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});e.Pointer=function(l,n,m){this.game=l;this.id=n;this.type=e.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.pointerMode=m||(e.PointerMode.CURSOR|e.PointerMode.CONTACT);this.target=null;this.button=null;this.leftButton=new e.DeviceButton(this,e.Pointer.LEFT_BUTTON);this.middleButton=new e.DeviceButton(this,e.Pointer.MIDDLE_BUTTON);this.rightButton=new e.DeviceButton(this,e.Pointer.RIGHT_BUTTON);this.backButton=new e.DeviceButton(this,e.Pointer.BACK_BUTTON);this.forwardButton=new e.DeviceButton(this,e.Pointer.FORWARD_BUTTON);this.eraserButton=new e.DeviceButton(this,e.Pointer.ERASER_BUTTON);this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=(n===0);this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=false;this.dirty=false;this.position=new e.Point();this.positionDown=new e.Point();this.positionUp=new e.Point();this.circle=new e.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null};e.Pointer.NO_BUTTON=0;e.Pointer.LEFT_BUTTON=1;e.Pointer.RIGHT_BUTTON=2;e.Pointer.MIDDLE_BUTTON=4;e.Pointer.BACK_BUTTON=8;e.Pointer.FORWARD_BUTTON=16;e.Pointer.ERASER_BUTTON=32;e.Pointer.prototype={resetButtons:function(){this.isDown=false;this.isUp=true;if(this.isMouse){this.leftButton.reset();this.middleButton.reset();this.rightButton.reset();this.backButton.reset();this.forwardButton.reset();this.eraserButton.reset()}},processButtonsDown:function(m,l){if(e.Pointer.LEFT_BUTTON&m){this.leftButton.start(l)}if(e.Pointer.RIGHT_BUTTON&m){this.rightButton.start(l)}if(e.Pointer.MIDDLE_BUTTON&m){this.middleButton.start(l)}if(e.Pointer.BACK_BUTTON&m){this.backButton.start(l)}if(e.Pointer.FORWARD_BUTTON&m){this.forwardButton.start(l)}if(e.Pointer.ERASER_BUTTON&m){this.eraserButton.start(l)}},processButtonsUp:function(l,m){if(l===e.Mouse.LEFT_BUTTON){this.leftButton.stop(m)}if(l===e.Mouse.RIGHT_BUTTON){this.rightButton.stop(m)}if(l===e.Mouse.MIDDLE_BUTTON){this.middleButton.stop(m)}if(l===e.Mouse.BACK_BUTTON){this.backButton.stop(m)}if(l===e.Mouse.FORWARD_BUTTON){this.forwardButton.stop(m)}if(l===5){this.eraserButton.stop(m)}},updateButtons:function(l){this.button=l.button;var m=(l.type.toLowerCase().substr(-4)==="down");if(l.buttons!==undefined){if(m){this.processButtonsDown(l.buttons,l)}else{this.processButtonsUp(l.button,l)}}else{if(m){this.leftButton.start(l)}else{this.leftButton.stop(l);this.rightButton.stop(l)}}if(l.buttons===1&&l.ctrlKey&&this.leftButton.isDown){this.leftButton.stop(l);this.rightButton.start(l)}this.isUp=true;this.isDown=false;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown){this.isUp=false;this.isDown=true}},start:function(m){var l=this.game.input;if(m.pointerId){this.pointerId=m.pointerId}this.identifier=m.identifier;this.target=m.target;if(this.isMouse){this.updateButtons(m)}else{this.isDown=true;this.isUp=false}this.active=true;this.withinGame=true;this.dirty=false;this._history=[];this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(m,true);this.positionDown.setTo(this.x,this.y);if(l.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||l.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||(l.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&l.totalActivePointers===0)){l.x=this.x;l.y=this.y;l.position.setTo(this.x,this.y);l.onDown.dispatch(this,m);l.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){var l=this.game.input;if(this.active){if(this.dirty){if(l.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=l.holdRate){if(l.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||l.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||(l.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&l.totalActivePointers===0)){l.onHold.dispatch(this)}this._holdSent=true}if(l.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+l.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>l.recordLimit){this._history.shift()}}}},move:function(n,o){var l=this.game.input;if(l.pollLocked){return}if(o===undefined){o=false}if(n.button!==undefined){this.button=n.button}if(o&&this.isMouse){this.updateButtons(n)}this.clientX=n.clientX;this.clientY=n.clientY;this.pageX=n.pageX;this.pageY=n.pageY;this.screenX=n.screenX;this.screenY=n.screenY;if(this.isMouse&&l.mouse.locked&&!o){this.rawMovementX=n.movementX||n.mozMovementX||n.webkitMovementX||0;this.rawMovementY=n.movementY||n.mozMovementY||n.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*l.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*l.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(l.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||l.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||(l.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&l.totalActivePointers===0)){l.activePointer=this;l.x=this.x;l.y=this.y;l.position.setTo(l.x,l.y);l.circle.x=l.x;l.circle.y=l.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);var m=l.moveCallbacks.length;while(m--){l.moveCallbacks[m].callback.call(l.moveCallbacks[m].context,this,this.x,this.y,o)}if(this.targetObject!==null&&(!this.game.paused||this.targetObject.noPause)&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else{if(l.interactiveItems.total>0){this.processInteractiveObjects(o)}}return this},processInteractiveObjects:function(p){var n=0;var m=-1;var l=null;var o=this.game.input.interactiveItems.first;this.interactiveCandidates=[];while(o){o.checked=false;if(o.validForInput(m,n,false)&&(!this.game.paused||o.sprite.noPause)){o.checked=true;if((p&&o.checkPointerDown(this,true))||(!p&&o.checkPointerOver(this,true))){n=o.sprite.renderOrderID;m=o.priorityID;l=o;this.interactiveCandidates.push(o)}}o=this.game.input.interactiveItems.next}o=this.game.input.interactiveItems.first;while(o){if(!o.checked&&o.validForInput(m,n,true)){if((p&&o.checkPointerDown(this,false))||(!p&&o.checkPointerOver(this,false))){n=o.sprite.renderOrderID;m=o.priorityID;l=o;this.interactiveCandidates.push(o)}}o=this.game.input.interactiveItems.next}if(this.game.input.customCandidateHandler){l=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,l)}this.swapTarget(l,false);return(this.targetObject!==null)},swapTarget:function(m,l){if(l===undefined){l=false}if(m===null){if(this.targetObject){this.targetObject._pointerOutHandler(this,l);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=m;m._pointerOverHandler(this,l)}else{if(this.targetObject===m){if(m.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this,l);this.targetObject=m;this.targetObject._pointerOverHandler(this,l)}}}},leave:function(l){this.withinGame=false;this.move(l,false)},stop:function(m){var l=this.game.input;if(this._stateReset&&this.withinGame){m.preventDefault();return}this.timeUp=this.game.time.time;if(l.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||l.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||(l.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&l.totalActivePointers===0)){l.onUp.dispatch(this,m);if(this.duration>=0&&this.duration<=l.tapRate){if(this.timeUp-this.previousTapTime<l.doubleTapRate){l.onTap.dispatch(this,true)}else{l.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.isMouse){this.updateButtons(m)}else{this.isDown=false;this.isUp=true}if(this.id>0){this.active=false}this.withinGame=this.game.scale.bounds.contains(m.pageX,m.pageY);this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){l.currentPointers--}l.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(l){l=l||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+l)>this.game.time.time)},justReleased:function(l){l=l||this.game.input.justReleasedRate;return(this.isUp&&(this.timeUp+l)>this.game.time.time)},addClickTrampoline:function(m,q,l,o){if(!this.isDown){return}var p=(this._clickTrampolines=this._clickTrampolines||[]);for(var n=0;n<p.length;n++){if(p[n].name===m){p.splice(n,1);break}}p.push({name:m,targetObject:this.targetObject,callback:q,callbackContext:l,callbackArgs:o})},processClickTrampolines:function(){var n=this._clickTrampolines;if(!n){return}for(var l=0;l<n.length;l++){var m=n[l];if(m.targetObject===this._trampolineTargetObject){m.callback.apply(m.callbackContext,m.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;this.resetButtons();if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};e.Pointer.prototype.constructor=e.Pointer;Object.defineProperty(e.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});Object.defineProperty(e.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(e.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});e.PointerMode={CURSOR:1<<0,CONTACT:1<<1};e.Touch=function(l){this.game=l;this.enabled=true;this.touchLockCallbacks=[];this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};e.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var l=this;if(this.game.device.touch){this._onTouchStart=function(m){return l.onTouchStart(m)};this._onTouchMove=function(m){return l.onTouchMove(m)};this._onTouchEnd=function(m){return l.onTouchEnd(m)};this._onTouchEnter=function(m){return l.onTouchEnter(m)};this._onTouchLeave=function(m){return l.onTouchLeave(m)};this._onTouchCancel=function(m){return l.onTouchCancel(m)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(l){l.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},addTouchLockCallback:function(n,m,l){if(l===undefined){l=false}this.touchLockCallbacks.push({callback:n,context:m,onEnd:l})},removeTouchLockCallback:function(n,m){var l=this.touchLockCallbacks.length;while(l--){if(this.touchLockCallbacks[l].callback===n&&this.touchLockCallbacks[l].context===m){this.touchLockCallbacks.splice(l,1);return true}}return false},onTouchStart:function(n){var m=this.touchLockCallbacks.length;while(m--){var l=this.touchLockCallbacks[m];if(!l.onEnd&&l.callback.call(l.context,this,n)){this.touchLockCallbacks.splice(m,1)}}this.event=n;if(!this.game.input.enabled||!this.enabled){return}if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,n)}if(this.preventDefault){n.preventDefault()}for(var m=0;m<n.changedTouches.length;m++){this.game.input.startPointer(n.changedTouches[m])}},onTouchCancel:function(m){this.event=m;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,m)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){m.preventDefault()}for(var l=0;l<m.changedTouches.length;l++){this.game.input.stopPointer(m.changedTouches[l])}},onTouchEnter:function(l){this.event=l;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,l)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){l.preventDefault()}},onTouchLeave:function(l){this.event=l;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,l)}if(this.preventDefault){l.preventDefault()}},onTouchMove:function(m){this.event=m;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,m)}if(this.preventDefault){m.preventDefault()}for(var l=0;l<m.changedTouches.length;l++){this.game.input.updatePointer(m.changedTouches[l])}},onTouchEnd:function(n){var m=this.touchLockCallbacks.length;while(m--){var l=this.touchLockCallbacks[m];if(l.onEnd&&l.callback.call(l.context,this,n)){this.touchLockCallbacks.splice(m,1)}}this.event=n;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,n)}if(this.preventDefault){n.preventDefault()}for(var m=0;m<n.changedTouches.length;m++){this.game.input.stopPointer(n.changedTouches[m])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};e.Touch.prototype.constructor=e.Touch;e.InputHandler=function(l){this.sprite=l;this.game=l.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=false;this.dragOffset=new e.Point();this.dragFromCenter=false;this.dragStopBlocksInputUp=false;this.dragStartPoint=new e.Point();this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new e.Point();this.snapPoint=new e.Point();this._dragPoint=new e.Point();this._dragPhase=false;this._pendingDrag=false;this._dragTimePass=false;this._dragDistancePass=false;this._wasEnabled=false;this._tempPoint=new e.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};e.InputHandler.prototype={start:function(n,l){n=n||0;if(l===undefined){l=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=l;this.priorityID=n;for(var m=0;m<10;m++){this._pointerData[m]={id:m,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new e.Point();this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;for(var l=0;l<10;l++){this._pointerData[l]={id:l,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(n,m,l){if(l===undefined){l=true}if(!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||(this.sprite.parent&&this.sprite.parent.ignoreChildInput)){return false}if(!l&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>n||(this.priorityID===n&&this.sprite.renderOrderID>m)){return true}return false},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver)},pointerX:function(l){l=l||0;return this._pointerData[l].x},pointerY:function(l){l=l||0;return this._pointerData[l].y},pointerDown:function(l){l=l||0;return this._pointerData[l].isDown},pointerUp:function(l){l=l||0;return this._pointerData[l].isUp},pointerTimeDown:function(l){l=l||0;return this._pointerData[l].timeDown},pointerTimeUp:function(l){l=l||0;return this._pointerData[l].timeUp},pointerOver:function(m){if(!this.enabled){return false}if(m===undefined){for(var l=0;l<10;l++){if(this._pointerData[l].isOver){return true}}return false}else{return this._pointerData[m].isOver}},pointerOut:function(m){if(!this.enabled){return false}if(m===undefined){for(var l=0;l<10;l++){if(this._pointerData[l].isOut){return true}}}else{return this._pointerData[m].isOut}},pointerTimeOver:function(l){l=l||0;return this._pointerData[l].timeOver},pointerTimeOut:function(l){l=l||0;return this._pointerData[l].timeOut},pointerDragged:function(l){l=l||0;return this._pointerData[l].isDragged},checkPointerDown:function(m,l){if(!m.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,m,this._tempPoint)){if(l===undefined){l=false}if(!l&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(m,l){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,m,this._tempPoint)){if(l===undefined){l=false}if(!l&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(l,o,n){if(this.sprite.texture.baseTexture.source){if(l===null&&o===null){this.game.input.getLocalPosition(this.sprite,n,this._tempPoint);var l=this._tempPoint.x;var o=this._tempPoint.y}if(this.sprite.anchor.x!==0){l-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){o-=-this.sprite.texture.frame.height*this.sprite.anchor.y}l+=this.sprite.texture.frame.x;o+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){l-=this.sprite.texture.trim.x;o-=this.sprite.texture.trim.y;if(l<this.sprite.texture.crop.x||l>this.sprite.texture.crop.right||o<this.sprite.texture.crop.y||o>this.sprite.texture.crop.bottom){this._dx=l;this._dy=o;return false}}this._dx=l;this._dy=o;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,l,o,1,1,0,0,1,1);var m=this.game.input.hitContext.getImageData(0,0,1,1);if(m.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(l){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(l);return false}if(this._pendingDrag){if(!this._dragDistancePass){this._dragDistancePass=(e.Math.distance(l.x,l.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold)}if(this._dragDistancePass&&this._dragTimePass){this.startDrag(l)}return true}else{if(this.draggable&&this._draggedPointerID===l.id){return this.updateDrag(l,false)}else{if(this._pointerData[l.id].isOver){if(this.checkPointerOver(l)){this._pointerData[l.id].x=l.x-this.sprite.x;this._pointerData[l.id].y=l.y-this.sprite.y;return true}else{this._pointerOutHandler(l);return false}}}}},_pointerOverHandler:function(n,l){if(this.sprite===null){return}var m=this._pointerData[n.id];if(m.isOver===false||n.dirty){var o=(m.isOver===false);m.isOver=true;m.isOut=false;m.timeOver=this.game.time.time;m.x=n.x-this.sprite.x;m.y=n.y-this.sprite.y;if(this.useHandCursor&&m.isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(!l&&o&&this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,n)}if(this.sprite.parent&&this.sprite.parent.type===e.GROUP){this.sprite.parent.onChildInputOver.dispatch(this.sprite,n)}}},_pointerOutHandler:function(n,l){if(this.sprite===null){return}var m=this._pointerData[n.id];m.isOver=false;m.isOut=true;m.timeOut=this.game.time.time;if(this.useHandCursor&&m.isDragged===false){this.game.canvas.style.cursor="";this._setHandCursor=false}if(!l&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,n);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===e.GROUP){this.sprite.parent.onChildInputOut.dispatch(this.sprite,n)}}},_touchedHandler:function(m){if(this.sprite===null){return}var l=this._pointerData[m.id];if(!l.isDown&&l.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,m)){return}l.isDown=true;l.isUp=false;l.timeDown=this.game.time.time;this.downPoint.set(m.x,m.y);m.dirty=true;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,m);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===e.GROUP){this.sprite.parent.onChildInputDown.dispatch(this.sprite,m)}if(this.sprite===null){return}}if(this.draggable&&this.isDragged===false){if(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0){this.startDrag(m)}else{this._pendingDrag=true;this._dragDistancePass=(this.dragDistanceThreshold===0);if(this.dragTimeThreshold>0){this._dragTimePass=false;this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,m)}else{this._dragTimePass=true}}}if(this.bringToTop){this.sprite.bringToTop()}}},dragTimeElapsed:function(l){this._dragTimePass=true;if(this._pendingDrag&&this.sprite){if(this._dragDistancePass){this.startDrag(l)}}},_releasedHandler:function(n){if(this.sprite===null){return}var l=this._pointerData[n.id];if(l.isDown&&n.isUp){l.isDown=false;l.isUp=true;l.timeUp=this.game.time.time;l.downDuration=l.timeUp-l.timeDown;var m=this.checkPointerOver(n);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===n.id)){this.sprite.events.onInputUp$dispatch(this.sprite,n,m)}if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===e.GROUP){this.sprite.parent.onChildInputUp.dispatch(this.sprite,n,m)}if(m){m=this.checkPointerOver(n)}}l.isOver=m;if(!m&&this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}n.dirty=true;this._pendingDrag=false;if(this.draggable&&this.isDragged&&this._draggedPointerID===n.id){this.stopDrag(n)}}},updateDrag:function(q,m){if(m===undefined){m=false}if(q.isUp){this.stopDrag(q);return false}var p=this.globalToLocal(q);var o=p.x+this._dragPoint.x+this.dragOffset.x;var n=p.y+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=o}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=n}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y)}}else{var l=this.game.camera.x-this._pointerData[q.id].camX;var r=this.game.camera.y-this._pointerData[q.id].camY;if(this.allowHorizontalDrag){this.sprite.x=o+l}if(this.allowVerticalDrag){this.sprite.y=n+r}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);this.snapPoint.set(this.sprite.x,this.sprite.y)}}this.sprite.events.onDragUpdate.dispatch(this.sprite,q,o,n,this.snapPoint,m);return true},justOver:function(m,l){m=m||0;l=l||500;return(this._pointerData[m].isOver&&this.overDuration(m)<l)},justOut:function(m,l){m=m||0;l=l||500;return(this._pointerData[m].isOut&&(this.game.time.time-this._pointerData[m].timeOut<l))},justPressed:function(m,l){m=m||0;l=l||500;return(this._pointerData[m].isDown&&this.downDuration(m)<l)},justReleased:function(m,l){m=m||0;l=l||500;return(this._pointerData[m].isUp&&(this.game.time.time-this._pointerData[m].timeUp<l))},overDuration:function(l){l=l||0;if(this._pointerData[l].isOver){return this.game.time.time-this._pointerData[l].timeOver}return -1},downDuration:function(l){l=l||0;if(this._pointerData[l].isDown){return this.game.time.time-this._pointerData[l].timeDown}return -1},enableDrag:function(m,p,l,o,q,n){if(m===undefined){m=false}if(p===undefined){p=false}if(l===undefined){l=false}if(o===undefined){o=255}if(q===undefined){q=null}if(n===undefined){n=null}this._dragPoint=new e.Point();this.draggable=true;this.bringToTop=p;this.dragOffset=new e.Point();this.dragFromCenter=m;this.pixelPerfectClick=l;this.pixelPerfectAlpha=o;if(q){this.boundsRect=q}if(n){this.boundsSprite=n}},disableDrag:function(){if(this._pointerData){for(var l=0;l<10;l++){this._pointerData[l].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1;this._pendingDrag=false},startDrag:function(o){var l=this.sprite.x;var q=this.sprite.y;var n=this.globalToLocal(o);this.isDragged=true;this._draggedPointerID=o.id;this._pointerData[o.id].camX=this.game.camera.x;this._pointerData[o.id].camY=this.game.camera.y;this._pointerData[o.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var m=this.sprite.getBounds();var p=this.globalToLocal(new e.Point(m.centerX,m.centerY));this.sprite.cameraOffset.x=n.x+(this.sprite.cameraOffset.x-p.x);this.sprite.cameraOffset.y=n.y+(this.sprite.cameraOffset.y-p.y)}this._dragPoint.setTo(this.sprite.cameraOffset.x-o.x,this.sprite.cameraOffset.y-o.y)}else{if(this.dragFromCenter){var m=this.sprite.getBounds();var p=this.globalToLocal(new e.Point(m.centerX,m.centerY));this.sprite.x=n.x+(this.sprite.x-p.x);this.sprite.y=n.y+(this.sprite.y-p.y)}this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y)}this.updateDrag(o,true);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(l,q);this.sprite.events.onDragStart$dispatch(this.sprite,o,l,q);this._pendingDrag=false},globalToLocalX:function(l){if(this.scaleLayer){l-=this.game.scale.grid.boundsFluid.x;l*=this.game.scale.grid.scaleFluidInversed.x}return l},globalToLocalY:function(l){if(this.scaleLayer){l-=this.game.scale.grid.boundsFluid.y;l*=this.game.scale.grid.scaleFluidInversed.y}return l},globalToLocal:function(l){if(this.sprite.parent){return this.game.input.getLocalPosition(this.sprite.parent,{x:l.x,y:l.y})}else{return l}},stopDrag:function(l){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[l.id].isDragged=false;this._dragPhase=false;this._pendingDrag=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop$dispatch(this.sprite,l);if(this.checkPointerOver(l)===false){this._pointerOutHandler(l)}},setDragLock:function(l,m){if(l===undefined){l=true}if(m===undefined){m=true}this.allowHorizontalDrag=l;this.allowVerticalDrag=m},enableSnap:function(o,n,m,l,q,p){if(m===undefined){m=true}if(l===undefined){l=false}if(q===undefined){q=0}if(p===undefined){p=0}this.snapX=o;this.snapY=n;this.snapOffsetX=q;this.snapOffsetY=p;this.snapOnDrag=m;this.snapOnRelease=l},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else{if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else{if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}}};e.InputHandler.prototype.constructor=e.InputHandler;e.Gamepad=function(l){this.game=l;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!==-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new e.SinglePad(l,this),new e.SinglePad(l,this),new e.SinglePad(l,this),new e.SinglePad(l,this)]};e.Gamepad.prototype={addCallbacks:function(l,m){if(typeof m!=="undefined"){this.onConnectCallback=(typeof m.onConnect==="function")?m.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof m.onDisconnect==="function")?m.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof m.onDown==="function")?m.onDown:this.onDownCallback;this.onUpCallback=(typeof m.onUp==="function")?m.onUp:this.onUpCallback;this.onAxisCallback=(typeof m.onAxis==="function")?m.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof m.onFloat==="function")?m.onFloat:this.onFloatCallback;this.callbackContext=l}},start:function(){if(this._active){return}this._active=true;var l=this;this._onGamepadConnected=function(m){return l.onGamepadConnected(m)};this._onGamepadDisconnected=function(m){return l.onGamepadDisconnected(m)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(m){var l=m.gamepad;this._rawPads.push(l);this._gamepads[l.index].connect(l)},onGamepadDisconnected:function(m){var n=m.gamepad;for(var l in this._rawPads){if(this._rawPads[l].index===n.index){this._rawPads.splice(l,1)}}this._gamepads[n.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(!this._active){return}if(navigator.getGamepads){var n=navigator.getGamepads()}else{if(navigator.webkitGetGamepads){var n=navigator.webkitGetGamepads()}else{if(navigator.webkitGamepads){var n=navigator.webkitGamepads()}}}if(n){this._rawPads=[];var u=false;for(var s=0;s<n.length;s++){if(typeof n[s]!==this._prevRawGamepadTypes[s]){u=true;this._prevRawGamepadTypes[s]=typeof n[s]}if(n[s]){this._rawPads.push(n[s])}if(s===3){break}}for(var t=0;t<this._gamepads.length;t++){this._gamepads[t]._rawPad=this._rawPads[t]}if(u){var x={rawIndices:{},padIndices:{}};var w;for(var r=0;r<this._gamepads.length;r++){w=this._gamepads[r];if(w.connected){for(var q=0;q<this._rawPads.length;q++){if(this._rawPads[q].index===w.index){x.rawIndices[w.index]=true;x.padIndices[r]=true}}}}for(var p=0;p<this._gamepads.length;p++){w=this._gamepads[p];if(x.padIndices[p]){continue}if(this._rawPads.length<1){w.disconnect()}for(var o=0;o<this._rawPads.length;o++){if(x.padIndices[p]){break}var v=this._rawPads[o];if(v){if(x.rawIndices[v.index]){w.disconnect();continue}else{w.connect(v);x.rawIndices[v.index]=true;x.padIndices[p]=true}}else{w.disconnect()}}}}}},setDeadZones:function(m){for(var l=0;l<this._gamepads.length;l++){this._gamepads[l].deadZone=m}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var l=0;l<this._gamepads.length;l++){this._gamepads[l].reset()}},justPressed:function(l,n){for(var m=0;m<this._gamepads.length;m++){if(this._gamepads[m].justPressed(l,n)===true){return true}}return false},justReleased:function(l,n){for(var m=0;m<this._gamepads.length;m++){if(this._gamepads[m].justReleased(l,n)===true){return true}}return false},isDown:function(l){for(var m=0;m<this._gamepads.length;m++){if(this._gamepads[m].isDown(l)===true){return true}}return false},destroy:function(){this.stop();for(var l=0;l<this._gamepads.length;l++){this._gamepads[l].destroy()}}};e.Gamepad.prototype.constructor=e.Gamepad;Object.defineProperty(e.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(e.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(e.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(e.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(e.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(e.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(e.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});e.Gamepad.BUTTON_0=0;e.Gamepad.BUTTON_1=1;e.Gamepad.BUTTON_2=2;e.Gamepad.BUTTON_3=3;e.Gamepad.BUTTON_4=4;e.Gamepad.BUTTON_5=5;e.Gamepad.BUTTON_6=6;e.Gamepad.BUTTON_7=7;e.Gamepad.BUTTON_8=8;e.Gamepad.BUTTON_9=9;e.Gamepad.BUTTON_10=10;e.Gamepad.BUTTON_11=11;e.Gamepad.BUTTON_12=12;e.Gamepad.BUTTON_13=13;e.Gamepad.BUTTON_14=14;e.Gamepad.BUTTON_15=15;e.Gamepad.AXIS_0=0;e.Gamepad.AXIS_1=1;e.Gamepad.AXIS_2=2;e.Gamepad.AXIS_3=3;e.Gamepad.AXIS_4=4;e.Gamepad.AXIS_5=5;e.Gamepad.AXIS_6=6;e.Gamepad.AXIS_7=7;e.Gamepad.AXIS_8=8;e.Gamepad.AXIS_9=9;e.Gamepad.XBOX360_A=0;e.Gamepad.XBOX360_B=1;e.Gamepad.XBOX360_X=2;e.Gamepad.XBOX360_Y=3;e.Gamepad.XBOX360_LEFT_BUMPER=4;e.Gamepad.XBOX360_RIGHT_BUMPER=5;e.Gamepad.XBOX360_LEFT_TRIGGER=6;e.Gamepad.XBOX360_RIGHT_TRIGGER=7;e.Gamepad.XBOX360_BACK=8;e.Gamepad.XBOX360_START=9;e.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;e.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;e.Gamepad.XBOX360_DPAD_LEFT=14;e.Gamepad.XBOX360_DPAD_RIGHT=15;e.Gamepad.XBOX360_DPAD_UP=12;e.Gamepad.XBOX360_DPAD_DOWN=13;e.Gamepad.XBOX360_STICK_LEFT_X=0;e.Gamepad.XBOX360_STICK_LEFT_Y=1;e.Gamepad.XBOX360_STICK_RIGHT_X=2;e.Gamepad.XBOX360_STICK_RIGHT_Y=3;e.Gamepad.PS3XC_X=0;e.Gamepad.PS3XC_CIRCLE=1;e.Gamepad.PS3XC_SQUARE=2;e.Gamepad.PS3XC_TRIANGLE=3;e.Gamepad.PS3XC_L1=4;e.Gamepad.PS3XC_R1=5;e.Gamepad.PS3XC_L2=6;e.Gamepad.PS3XC_R2=7;e.Gamepad.PS3XC_SELECT=8;e.Gamepad.PS3XC_START=9;e.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;e.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;e.Gamepad.PS3XC_DPAD_UP=12;e.Gamepad.PS3XC_DPAD_DOWN=13;e.Gamepad.PS3XC_DPAD_LEFT=14;e.Gamepad.PS3XC_DPAD_RIGHT=15;e.Gamepad.PS3XC_STICK_LEFT_X=0;e.Gamepad.PS3XC_STICK_LEFT_Y=1;e.Gamepad.PS3XC_STICK_RIGHT_X=2;e.Gamepad.PS3XC_STICK_RIGHT_Y=3;e.SinglePad=function(l,m){this.game=l;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=m;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};e.SinglePad.prototype={addCallbacks:function(l,m){if(typeof m!=="undefined"){this.onConnectCallback=(typeof m.onConnect==="function")?m.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof m.onDisconnect==="function")?m.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof m.onDown==="function")?m.onDown:this.onDownCallback;this.onUpCallback=(typeof m.onUp==="function")?m.onUp:this.onUpCallback;this.onAxisCallback=(typeof m.onAxis==="function")?m.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof m.onFloat==="function")?m.onFloat:this.onFloatCallback;this.callbackContext=l}},getButton:function(l){if(this._buttons[l]){return this._buttons[l]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||(this._rawPad.timestamp&&(this._rawPad.timestamp===this._prevTimestamp))){return}for(var n=0;n<this._buttonsLen;n++){var l=isNaN(this._rawPad.buttons[n])?this._rawPad.buttons[n].value:this._rawPad.buttons[n];if(l!==this._buttons[n].value){if(l===1){this.processButtonDown(n,l)}else{if(l===0){this.processButtonUp(n,l)}else{this.processButtonFloat(n,l)}}}}for(var m=0;m<this._axesLen;m++){var o=this._rawPad.axes[m];if((o>0&&o>this.deadZone)||(o<0&&o<-this.deadZone)){this.processAxisChange(m,o)}else{this.processAxisChange(m,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(n){var o=!this.connected;this.connected=true;this.index=n.index;this._rawPad=n;this._buttons=[];this._buttonsLen=n.buttons.length;this._axes=[];this._axesLen=n.axes.length;for(var l=0;l<this._axesLen;l++){this._axes[l]=n.axes[l]}for(var m in n.buttons){m=parseInt(m,10);this._buttons[m]=new e.DeviceButton(this,m)}if(o&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(o&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var n=this.connected;var l=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var m=0;m<this._buttonsLen;m++){this._buttons[m].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(n&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,l)}if(n&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var l=0;l<this._buttonsLen;l++){this._buttons[l].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(l,m){if(this._axes[l]===m){return}this._axes[l]=m;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,l,m)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,l,m)}},processButtonDown:function(l,m){if(this._buttons[l]){this._buttons[l].start(null,m)}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,l,m,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,l,m)}},processButtonUp:function(l,m){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,l,m,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,l,m)}if(this._buttons[l]){this._buttons[l].stop(null,m)}},processButtonFloat:function(l,m){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,l,m,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,l,m)}if(this._buttons[l]){this._buttons[l].padFloat(m)}},axis:function(l){if(this._axes[l]){return this._axes[l]}return false},isDown:function(l){if(this._buttons[l]){return this._buttons[l].isDown}return false},isUp:function(l){if(this._buttons[l]){return this._buttons[l].isUp}return false},justReleased:function(l,m){if(this._buttons[l]){return this._buttons[l].justReleased(m)}},justPressed:function(l,m){if(this._buttons[l]){return this._buttons[l].justPressed(m)}},buttonValue:function(l){if(this._buttons[l]){return this._buttons[l].value}return null},reset:function(){for(var l=0;l<this._axes.length;l++){this._axes[l]=0}}};e.SinglePad.prototype.constructor=e.SinglePad;e.Key=function(m,l){this.game=m;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.durationUp=-2500;this.repeats=0;this.keyCode=l;this.onDown=new e.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new e.Signal();this._justDown=false;this._justUp=false};e.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}else{this.durationUp=this.game.time.time-this.timeUp}},processKeyDown:function(l){if(!this._enabled){return}this.event=l;if(this.isDown){return}this.altKey=l.altKey;this.ctrlKey=l.ctrlKey;this.shiftKey=l.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.durationUp=this.game.time.time-this.timeUp;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(l){if(!this._enabled){return}this.event=l;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this.durationUp=0;this._justUp=true;this.onUp.dispatch(this)},reset:function(l){if(l===undefined){l=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this.durationUp=-2500;this._enabled=true;this._justDown=false;this._justUp=false;if(l){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(l){if(l===undefined){l=50}return(this.isDown&&this.duration<l)},upDuration:function(l){if(l===undefined){l=50}return(!this.isDown&&((this.game.time.time-this.timeUp)<l))},justPressed:function(){return(this.isDown&&this.duration===0)},justReleased:function(){return(!this.isDown&&this.durationUp===0)}};Object.defineProperty(e.Key.prototype,"justDown",{get:function(){var l=this._justDown;this._justDown=false;return l}});Object.defineProperty(e.Key.prototype,"justUp",{get:function(){var l=this._justUp;this._justUp=false;return l}});Object.defineProperty(e.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(l){l=!!l;if(l!==this._enabled){if(!l){this.reset(false)}this._enabled=l}}});e.Key.prototype.constructor=e.Key;e.Keyboard=function(l){this.game=l;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};e.Keyboard.prototype={addCallbacks:function(l,m,o,n){this.callbackContext=l;if(m!==undefined&&m!==null){this.onDownCallback=m}if(o!==undefined&&o!==null){this.onUpCallback=o}if(n!==undefined&&n!==null){this.onPressCallback=n}},addKey:function(l){if(!this._keys[l]){this._keys[l]=new e.Key(this.game,l);this.addKeyCapture(l)}return this._keys[l]},addKeys:function(n){var l={};for(var m in n){l[m]=this.addKey(n[m])}return l},removeKey:function(l){if(this._keys[l]){this._keys[l]=null;this.removeKeyCapture(l)}},createCursorKeys:function(){return this.addKeys({up:e.KeyCode.UP,down:e.KeyCode.DOWN,left:e.KeyCode.LEFT,right:e.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var l=this;this._onKeyDown=function(m){return l.processKeyDown(m)};this._onKeyUp=function(m){return l.processKeyUp(m)};this._onKeyPress=function(m){return l.processKeyPress(m)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(l){if(typeof l==="object"){for(var m in l){this._capture[l[m]]=true}}else{this._capture[l]=true}},removeKeyCapture:function(l){delete this._capture[l]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(m){this.event=m;if(!this.game.input.enabled||!this.enabled){return}var l=m.keyCode;if(this._capture[l]){m.preventDefault()}if(!this._keys[l]){this._keys[l]=new e.Key(this.game,l)}this._keys[l].processKeyDown(m);this._k=l;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,m)}},processKeyPress:function(l){this.pressEvent=l;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(l.charCode),l)}},processKeyUp:function(m){this.event=m;if(!this.game.input.enabled||!this.enabled){return}var l=m.keyCode;if(this._capture[l]){m.preventDefault()}if(!this._keys[l]){this._keys[l]=new e.Key(this.game,l)}this._keys[l].processKeyUp(m);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,m)}},reset:function(m){if(m===undefined){m=true}this.event=null;var l=this._keys.length;while(l--){if(this._keys[l]){this._keys[l].reset(m)}}},downDuration:function(l,m){if(this._keys[l]){return this._keys[l].downDuration(m)}else{return null}},upDuration:function(l,m){if(this._keys[l]){return this._keys[l].upDuration(m)}else{return null}},justPressed:function(l){if(this._keys[l]){return this._keys[l].justPressed()}else{return null}},justReleased:function(l){if(this._keys[l]){return this._keys[l].justReleased()}else{return null}},isDown:function(l){if(this._keys[l]){return this._keys[l].isDown}else{return null}}};Object.defineProperty(e.Keyboard.prototype,"lastChar",{get:function(){if(this.event&&this.event.charCode===32){return""}else{if(this.pressEvent){return String.fromCharCode(this.pressEvent.charCode)}else{return null}}}});Object.defineProperty(e.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});e.Keyboard.prototype.constructor=e.Keyboard;e.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var k in e.KeyCode){if(e.KeyCode.hasOwnProperty(k)&&!k.match(/[a-z]/)){e.Keyboard[k]=e.KeyCode[k]}}e.Component=function(){};e.Component.Angle=function(){};e.Component.Angle.prototype={angle:{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(l){this.rotation=e.Math.degToRad(e.Math.wrapAngle(l))}}};e.Component.Animation=function(){};e.Component.Animation.prototype={play:function(o,n,m,l){if(this.animations){return this.animations.play(o,n,m,l)}}};e.Component.AutoCull=function(){};e.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};e.Component.Bounds=function(){};e.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return(this.x-this.offsetX)+(this.width*0.5)},set:function(l){this.x=(l+this.offsetX)-(this.width*0.5)}},centerY:{get:function(){return(this.y-this.offsetY)+(this.height*0.5)},set:function(l){this.y=(l+this.offsetY)-(this.height*0.5)}},left:{get:function(){return this.x-this.offsetX},set:function(l){this.x=l+this.offsetX}},right:{get:function(){return(this.x+this.width)-this.offsetX},set:function(l){this.x=l-(this.width)+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(l){this.y=l+this.offsetY}},bottom:{get:function(){return(this.y+this.height)-this.offsetY},set:function(l){this.y=l-(this.height)+this.offsetY}},alignIn:function(n,m,l,o){if(l===undefined){l=0}if(o===undefined){o=0}switch(m){default:case e.TOP_LEFT:this.left=n.left-l;this.top=n.top-o;break;case e.TOP_CENTER:this.centerX=n.centerX+l;this.top=n.top-o;break;case e.TOP_RIGHT:this.right=n.right+l;this.top=n.top-o;break;case e.LEFT_CENTER:this.left=n.left-l;this.centerY=n.centerY+o;break;case e.CENTER:this.centerX=n.centerX+l;this.centerY=n.centerY+o;break;case e.RIGHT_CENTER:this.right=n.right+l;this.centerY=n.centerY+o;break;case e.BOTTOM_LEFT:this.left=n.left-l;this.bottom=n.bottom+o;break;case e.BOTTOM_CENTER:this.centerX=n.centerX+l;this.bottom=n.bottom+o;break;case e.BOTTOM_RIGHT:this.right=n.right+l;this.bottom=n.bottom+o;break}return this},alignTo:function(n,m,l,o){if(l===undefined){l=0}if(o===undefined){o=0}switch(m){default:case e.TOP_LEFT:this.left=n.left-l;this.bottom=n.top-o;break;case e.TOP_CENTER:this.centerX=n.centerX+l;this.bottom=n.top-o;break;case e.TOP_RIGHT:this.right=n.right+l;this.bottom=n.top-o;break;case e.LEFT_TOP:this.right=n.left-l;this.top=n.top-o;break;case e.LEFT_CENTER:this.right=n.left-l;this.centerY=n.centerY+o;break;case e.LEFT_BOTTOM:this.right=n.left-l;this.bottom=n.bottom+o;break;case e.RIGHT_TOP:this.left=n.right+l;this.top=n.top-o;break;case e.RIGHT_CENTER:this.left=n.right+l;this.centerY=n.centerY+o;break;case e.RIGHT_BOTTOM:this.left=n.right+l;this.bottom=n.bottom+o;break;case e.BOTTOM_LEFT:this.left=n.left-l;this.top=n.bottom+o;break;case e.BOTTOM_CENTER:this.centerX=n.centerX+l;this.top=n.bottom+o;break;case e.BOTTOM_RIGHT:this.right=n.right+l;this.top=n.bottom+o;break}return this}};e.Group.prototype.alignIn=e.Component.Bounds.prototype.alignIn;e.Group.prototype.alignTo=e.Component.Bounds.prototype.alignTo;e.Component.BringToTop=function(){};e.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};e.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};e.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};e.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};e.Component.Core=function(){};e.Component.Core.install=function(n){e.Utils.mixinPrototype(this,e.Component.Core.prototype);this.components={};for(var m=0;m<n.length;m++){var o=n[m];var l=false;if(o==="Destroy"){l=true}e.Utils.mixinPrototype(this,e.Component[o].prototype,l);this.components[o]=true}};e.Component.Core.init=function(m,l,p,n,o){this.game=m;this.key=n;this.data={};this.position.set(l,p);this.world=new e.Point(l,p);this.previousPosition=new e.Point(l,p);this.events=new e.Events(this);this._bounds=new e.Rectangle();if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new e.AnimationManager(this)}if(this.components.LoadTexture&&n!==null){this.loadTexture(n,o)}if(this.components.FixedToCamera){this.cameraOffset=new e.Point(l,p)}};e.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}var l=0;while(l<this.children.length){var m=this.children[l];m.preUpdate();if(this===m.parent){l++}}return true};e.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,pendingDestroy:false,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(l){if(l){this._exists=true;if(this.body&&this.body.type===e.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===e.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.customRender){this.key.render()}if(this.components.PhysicsBody){e.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){e.Component.FixedToCamera.postUpdate.call(this)}for(var l=0;l<this.children.length;l++){this.children[l].postUpdate()}}};e.Component.Crop=function(){};e.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(l,m){if(m===undefined){m=false}if(l){if(m&&this.cropRect!==null){this.cropRect.setTo(l.x,l.y,l.width,l.height)}else{if(m&&this.cropRect===null){this.cropRect=new e.Rectangle(l.x,l.y,l.width,l.height)}else{this.cropRect=l}}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}var q=this.texture.crop.x;var p=this.texture.crop.y;var r=this.texture.crop.width;var m=this.texture.crop.height;this._crop=e.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var l=Math.max(this._frame.x,this._crop.x);var s=Math.max(this._frame.y,this._crop.y);var n=Math.min(this._frame.right,this._crop.right)-l;var o=Math.min(this._frame.bottom,this._crop.bottom)-s;this.texture.crop.x=l;this.texture.crop.y=s;this.texture.crop.width=n;this.texture.crop.height=o;this.texture.frame.width=Math.min(n,this.cropRect.width);this.texture.frame.height=Math.min(o,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();if(this.tint!==16777215&&(q!==l||p!==s||r!==n||m!==o)){this.texture.requiresReTint=true}}};e.Component.Delta=function(){};e.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};e.Component.Destroy=function(){};e.Component.Destroy.prototype={destroyPhase:false,destroy:function(n,l){if(this.game===null||this.destroyPhase){return}if(n===undefined){n=true}if(l===undefined){l=false}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof e.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}this.game.tweens.removeFrom(this);var m=this.children.length;if(n){while(m--){this.children[m].destroy(n)}}else{while(m--){this.removeChild(this.children[m])}}if(this._crop){this._crop=null;this.cropRect=null}if(this._frame){this._frame=null}if(e.Video&&this.key instanceof e.Video){this.key.onChangeSource.remove(this.resizeFrame,this)}if(e.BitmapText&&this._glyphs){this._glyphs=[]}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=false;if(this.transformCallback){this.transformCallback=null;this.transformCallbackContext=null}this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();if(l){this.texture.destroy(true)}this.destroyPhase=false;this.pendingDestroy=false}};e.Events=function(l){this.parent=l};e.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragUpdate){this._onDragUpdate.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};e.Events.prototype.constructor=e.Events;for(var d in e.Events.prototype){if(!e.Events.prototype.hasOwnProperty(d)||d.indexOf("on")!==0||e.Events.prototype[d]!==null){continue}(function(m,l){Object.defineProperty(e.Events.prototype,m,{get:function(){return this[l]||(this[l]=new e.Signal())}});e.Events.prototype[m+"$dispatch"]=function(){return this[l]?this[l].dispatch.apply(this[l],arguments):null}})(d,"_"+d)}e.Component.FixedToCamera=function(){};e.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};e.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(l){if(l){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new e.Point()};e.Component.Health=function(){};e.Component.Health.prototype={health:1,maxHealth:100,damage:function(l){if(this.alive){this.health-=l;if(this.health<=0){this.kill()}}return this},setHealth:function(l){this.health=l;if(this.health>this.maxHealth){this.health=this.maxHealth}return this},heal:function(l){if(this.alive){this.health+=l;if(this.health>this.maxHealth){this.health=this.maxHealth}}return this}};e.Component.InCamera=function(){};e.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};e.Component.InputEnabled=function(){};e.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return(this.input&&this.input.enabled)},set:function(l){if(l){if(this.input===null){this.input=new e.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};e.Component.InWorld=function(){};e.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false;if(this.outOfCameraBoundsKill){this.kill();return false}}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else{if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}}return true};e.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,outOfCameraBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};e.Component.LifeSpan=function(){};e.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};e.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(l){if(l===undefined){l=100}this.alive=true;this.exists=true;this.visible=true;if(typeof this.setHealth==="function"){this.setHealth(l)}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};e.Component.LoadTexture=function(){};e.Component.LoadTexture.prototype={customRender:false,_frame:null,loadTexture:function(q,s,o){if(q===e.PENDING_ATLAS){q=s;s=0}else{s=s||0}if((o||o===undefined)&&this.animations){this.animations.stop()}this.key=q;this.customRender=false;var n=this.game.cache;var l=true;var p=!this.texture.baseTexture.scaleMode;if(e.RenderTexture&&q instanceof e.RenderTexture){this.key=q.key;this.setTexture(q)}else{if(e.BitmapData&&q instanceof e.BitmapData){this.customRender=true;this.setTexture(q.texture);if(n.hasFrameData(q.key,e.Cache.BITMAPDATA)){l=!this.animations.loadFrameData(n.getFrameData(q.key,e.Cache.BITMAPDATA),s)}else{l=!this.animations.loadFrameData(q.frameData,0)}}else{if(e.Video&&q instanceof e.Video){this.customRender=true;var r=q.texture.valid;this.setTexture(q.texture);this.setFrame(q.texture.frame.clone());q.onChangeSource.add(this.resizeFrame,this);this.texture.valid=r}else{if(e.Tilemap&&q instanceof e.TilemapLayer){this.setTexture(PIXI.Texture.fromCanvas(q.canvas))}else{if(q instanceof PIXI.Texture){this.setTexture(q)}else{var m=n.getImage(q,true);this.key=m.key;this.setTexture(new PIXI.Texture(m.base));if(q==="__default"){this.texture.baseTexture.skipRender=true}else{this.texture.baseTexture.skipRender=false}l=!this.animations.loadFrameData(m.frameData,s)}}}}}if(l){this._frame=e.Rectangle.clone(this.texture.frame)}if(!p){this.texture.baseTexture.scaleMode=1}},setFrame:function(l){this._frame=l;this.texture.frame.x=l.x;this.texture.frame.y=l.y;this.texture.frame.width=l.width;this.texture.frame.height=l.height;this.texture.crop.x=l.x;this.texture.crop.y=l.y;this.texture.crop.width=l.width;this.texture.crop.height=l.height;if(l.trimmed){if(this.texture.trim){this.texture.trim.x=l.spriteSourceSizeX;this.texture.trim.y=l.spriteSourceSizeY;this.texture.trim.width=l.sourceSizeW;this.texture.trim.height=l.sourceSizeH}else{this.texture.trim={x:l.spriteSourceSizeX,y:l.spriteSourceSizeY,width:l.sourceSizeW,height:l.sourceSizeH}}this.texture.width=l.sourceSizeW;this.texture.height=l.sourceSizeH;this.texture.frame.width=l.sourceSizeW;this.texture.frame.height=l.sourceSizeH}else{if(!l.trimmed&&this.texture.trim){this.texture.trim=null}}if(l.rotated){this.texture.rotated=true}if(this.cropRect){this.updateCrop()}this.texture.requiresReTint=true;this.texture._updateUvs();if(this.tilingTexture){this.refreshTexture=true}},resizeFrame:function(n,m,l){this.texture.frame.resize(m,l);this.texture.setFrame(this.texture.frame)},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(l){this.animations.frame=l}},frameName:{get:function(){return this.animations.frameName},set:function(l){this.animations.frameName=l}}};e.Component.Overlap=function(){};e.Component.Overlap.prototype={overlap:function(l){return e.Rectangle.intersects(this.getBounds(),l.getBounds())}};e.Component.PhysicsBody=function(){};e.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};e.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};e.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(l){this.position.x=l;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(l){this.position.y=l;if(this.body&&!this.body.dirty){this.body._reset=true}}}};e.Component.Reset=function(){};e.Component.Reset.prototype.reset=function(l,n,m){if(m===undefined){m=1}this.world.set(l,n);this.position.set(l,n);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=m}if(this.components.PhysicsBody){if(this.body){this.body.reset(l,n,false,false)}}return this};e.Component.ScaleMinMax=function(){};e.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(l){if(this.scaleMin){if(l.a<this.scaleMin.x){l.a=this.scaleMin.x}if(l.d<this.scaleMin.y){l.d=this.scaleMin.y}}if(this.scaleMax){if(l.a>this.scaleMax.x){l.a=this.scaleMax.x}if(l.d>this.scaleMax.y){l.d=this.scaleMax.y}}},setScaleMinMax:function(l,o,n,m){if(o===undefined){o=n=m=l}else{if(n===undefined){n=m=o;o=l}}if(l===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(l,o)}else{this.scaleMin=new e.Point(l,o)}}if(n===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(n,m)}else{this.scaleMax=new e.Point(n,m)}}if(this.scaleMin===null){this.transformCallback=null}else{this.transformCallback=this.checkTransform;this.transformCallbackContext=this}}};e.Component.Smoothed=function(){};e.Component.Smoothed.prototype={smoothed:{get:function(){return !this.texture.baseTexture.scaleMode},set:function(l){if(l){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};e.GameObjectFactory=function(l){this.game=l;this.world=this.game.world};e.GameObjectFactory.prototype={existing:function(l){return this.world.add(l)},weapon:function(p,m,q,o,n){var l=this.game.plugins.add(e.Weapon);if(n){l.bulletClass=n}l.createBullets(p,m,q,o);return l},image:function(l,p,m,o,n){if(n===undefined){n=this.world}return n.add(new e.Image(this.game,l,p,m,o))},sprite:function(l,p,m,o,n){if(n===undefined){n=this.world}return n.create(l,p,m,o)},creature:function(l,q,m,p,o){if(o===undefined){o=this.world}var n=new e.Creature(this.game,l,q,m,p);o.add(n);return n},tween:function(l){return this.game.tweens.create(l)},group:function(o,m,l,p,n){return new e.Group(this.game,o,m,l,p,n)},physicsGroup:function(o,n,m,l){return new e.Group(this.game,n,m,l,true,o)},spriteBatch:function(n,m,l){if(n===undefined){n=null}if(m===undefined){m="group"}if(l===undefined){l=false}return new e.SpriteBatch(this.game,n,m,l)},audio:function(n,o,l,m){return this.game.sound.add(n,o,l,m)},sound:function(n,o,l,m){return this.game.sound.add(n,o,l,m)},audioSprite:function(l){return this.game.sound.addSprite(l)},tileSprite:function(m,r,o,l,n,q,p){if(p===undefined){p=this.world}return p.add(new e.TileSprite(this.game,m,r,o,l,n,q))},rope:function(l,q,m,p,n,o){if(o===undefined){o=this.world}return o.add(new e.Rope(this.game,l,q,m,p,n))},text:function(l,p,o,m,n){if(n===undefined){n=this.world}return n.add(new e.Text(this.game,l,p,o,m))},button:function(r,q,t,u,m,n,l,o,p,s){if(s===undefined){s=this.world}return s.add(new e.Button(this.game,r,q,t,u,m,n,l,o,p))},graphics:function(l,n,m){if(m===undefined){m=this.world}return m.add(new e.Graphics(this.game,l,n))},emitter:function(l,n,m){return this.game.particles.add(new e.Particles.Arcade.Emitter(this.game,l,n,m))},retroFont:function(m,l,o,r,t,s,p,q,n){return new e.RetroFont(this.game,m,l,o,r,t,s,p,q,n)},bitmapText:function(l,q,m,p,n,o){if(o===undefined){o=this.world}return o.add(new e.BitmapText(this.game,l,q,m,p,n))},tilemap:function(n,p,m,o,l){return new e.Tilemap(this.game,n,p,m,o,l)},renderTexture:function(o,m,n,l){if(n===undefined||n===""){n=this.game.rnd.uuid()}if(l===undefined){l=false}var p=new e.RenderTexture(this.game,o,m,n);if(l){this.game.cache.addRenderTexture(n,p)}return p},video:function(m,l){return new e.Video(this.game,m,l)},bitmapData:function(o,m,n,l){if(l===undefined){l=false}if(n===undefined||n===""){n=this.game.rnd.uuid()}var p=new e.BitmapData(this.game,n,o,m);if(l){this.game.cache.addBitmapData(n,p)}return p},filter:function(m){var l=Array.prototype.slice.call(arguments,1);var m=new e.Filter[m](this.game);m.init.apply(m,l);return m},plugin:function(l){return this.game.plugins.add(l)}};e.GameObjectFactory.prototype.constructor=e.GameObjectFactory;e.GameObjectCreator=function(l){this.game=l;this.world=this.game.world};e.GameObjectCreator.prototype={image:function(l,o,m,n){return new e.Image(this.game,l,o,m,n)},sprite:function(l,o,m,n){return new e.Sprite(this.game,l,o,m,n)},tween:function(l){return new e.Tween(l,this.game,this.game.tweens)},group:function(o,m,l,p,n){return new e.Group(this.game,o,m,l,p,n)},spriteBatch:function(n,m,l){if(m===undefined){m="group"}if(l===undefined){l=false}return new e.SpriteBatch(this.game,n,m,l)},audio:function(n,o,l,m){return this.game.sound.add(n,o,l,m)},audioSprite:function(l){return this.game.sound.addSprite(l)},sound:function(n,o,l,m){return this.game.sound.add(n,o,l,m)},tileSprite:function(m,q,o,l,n,p){return new e.TileSprite(this.game,m,q,o,l,n,p)},rope:function(l,p,m,o,n){return new e.Rope(this.game,l,p,m,o,n)},text:function(l,o,n,m){return new e.Text(this.game,l,o,n,m)},button:function(r,q,s,t,m,n,l,o,p){return new e.Button(this.game,r,q,s,t,m,n,l,o,p)},graphics:function(l,m){return new e.Graphics(this.game,l,m)},emitter:function(l,n,m){return new e.Particles.Arcade.Emitter(this.game,l,n,m)},retroFont:function(m,l,o,r,t,s,p,q,n){return new e.RetroFont(this.game,m,l,o,r,t,s,p,q,n)},bitmapText:function(l,q,m,o,n,p){return new e.BitmapText(this.game,l,q,m,o,n,p)},tilemap:function(n,p,m,o,l){return new e.Tilemap(this.game,n,p,m,o,l)},renderTexture:function(o,m,n,l){if(n===undefined||n===""){n=this.game.rnd.uuid()}if(l===undefined){l=false}var p=new e.RenderTexture(this.game,o,m,n);if(l){this.game.cache.addRenderTexture(n,p)}return p},bitmapData:function(o,m,n,l){if(l===undefined){l=false}if(n===undefined||n===""){n=this.game.rnd.uuid()}var p=new e.BitmapData(this.game,n,o,m);if(l){this.game.cache.addBitmapData(n,p)}return p},filter:function(m){var l=Array.prototype.slice.call(arguments,1);var m=new e.Filter[m](this.game);m.init.apply(m,l);return m}};e.GameObjectCreator.prototype.constructor=e.GameObjectCreator;e.Sprite=function(m,l,p,n,o){l=l||0;p=p||0;n=n||null;o=o||null;this.type=e.SPRITE;this.physicsType=e.SPRITE;PIXI.Sprite.call(this,e.Cache.DEFAULT);e.Component.Core.init.call(this,m,l,p,n,o)};e.Sprite.prototype=Object.create(PIXI.Sprite.prototype);e.Sprite.prototype.constructor=e.Sprite;e.Component.Core.install.call(e.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);e.Sprite.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.Sprite.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Sprite.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Sprite.prototype.preUpdateCore=e.Component.Core.preUpdate;e.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.Image=function(m,l,p,n,o){l=l||0;p=p||0;n=n||null;o=o||null;this.type=e.IMAGE;PIXI.Sprite.call(this,e.Cache.DEFAULT);e.Component.Core.init.call(this,m,l,p,n,o)};e.Image.prototype=Object.create(PIXI.Sprite.prototype);e.Image.prototype.constructor=e.Image;e.Component.Core.install.call(e.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]);e.Image.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Image.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Image.prototype.preUpdateCore=e.Component.Core.preUpdate;e.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()||!this.preUpdateLifeSpan()){return false}return this.preUpdateCore()};e.Button=function(u,r,q,s,t,m,n,l,o,p){r=r||0;q=q||0;s=s||null;t=t||null;m=m||this;e.Image.call(this,u,r,q,s,l);this.type=e.BUTTON;this.physicsType=e.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new e.Signal();this.onInputOut=new e.Signal();this.onInputDown=new e.Signal();this.onInputUp=new e.Signal();this.onOverMouseOnly=true;this.justReleasedPreventsOver=e.PointerMode.TOUCH;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.input.useHandCursor=true;this.setFrames(n,l,o,p);if(t!==null){this.onInputUp.add(t,m)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};e.Button.prototype=Object.create(e.Image.prototype);e.Button.prototype.constructor=e.Button;var j="Over";var a="Out";var c="Down";var g="Up";e.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};e.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};e.Button.prototype.setStateFrame=function(n,o,m){var l="_on"+n+"Frame";if(o!==null){this[l]=o;if(m){this.changeStateFrame(n)}}else{this[l]=null}};e.Button.prototype.changeStateFrame=function(m){if(this.freezeFrames){return false}var l="_on"+m+"Frame";var n=this[l];if(typeof n==="string"){this.frameName=n;return true}else{if(typeof n==="number"){this.frame=n;return true}else{return false}}};e.Button.prototype.setFrames=function(m,o,l,n){this.setStateFrame(j,m,this.input.pointerOver());this.setStateFrame(a,o,!this.input.pointerOver());this.setStateFrame(c,l,this.input.pointerDown());this.setStateFrame(g,n,this.input.pointerUp())};e.Button.prototype.setStateSound=function(n,o,l){var p="on"+n+"Sound";var m="on"+n+"SoundMarker";if(o instanceof e.Sound||o instanceof e.AudioSprite){this[p]=o;this[m]=typeof l==="string"?l:""}else{this[p]=null;this[m]=""}};e.Button.prototype.playStateSound=function(n){var p="on"+n+"Sound";var o=this[p];if(o){var m="on"+n+"SoundMarker";var l=this[m];o.play(l);return true}else{return false}};e.Button.prototype.setSounds=function(m,q,l,p,o,s,n,r){this.setStateSound(j,m,q);this.setStateSound(a,o,s);this.setStateSound(c,l,p);this.setStateSound(g,n,r)};e.Button.prototype.setOverSound=function(m,l){this.setStateSound(j,m,l)};e.Button.prototype.setOutSound=function(m,l){this.setStateSound(a,m,l)};e.Button.prototype.setDownSound=function(m,l){this.setStateSound(c,m,l)};e.Button.prototype.setUpSound=function(m,l){this.setStateSound(g,m,l)};e.Button.prototype.onInputOverHandler=function(l,m){if(m.justReleased()&&(this.justReleasedPreventsOver&m.pointerMode)===m.pointerMode){return}this.changeStateFrame(j);if(this.onOverMouseOnly&&!m.isMouse){return}this.playStateSound(j);if(this.onInputOver){this.onInputOver.dispatch(this,m)}};e.Button.prototype.onInputOutHandler=function(l,m){this.changeStateFrame(a);this.playStateSound(a);if(this.onInputOut){this.onInputOut.dispatch(this,m)}};e.Button.prototype.onInputDownHandler=function(l,m){this.changeStateFrame(c);this.playStateSound(c);if(this.onInputDown){this.onInputDown.dispatch(this,m)}};e.Button.prototype.onInputUpHandler=function(l,o,n){this.playStateSound(g);if(this.onInputUp){this.onInputUp.dispatch(this,o,n)}if(this.freezeFrames){return}if(this.forceOut===true||(this.forceOut&o.pointerMode)===o.pointerMode){this.changeStateFrame(a)}else{var m=this.changeStateFrame(g);if(!m){if(n){this.changeStateFrame(j)}else{this.changeStateFrame(a)}}}};e.SpriteBatch=function(m,o,n,l){if(o===undefined||o===null){o=m.world}e.Group.call(this,m,o,n,l);this.type=e.SPRITEBATCH;this.fastSpriteBatch=null;this.ready=false};e.SpriteBatch.prototype=Object.create(e.Group.prototype);e.SpriteBatch.prototype.constructor=e.SpriteBatch;e.SpriteBatch.prototype._renderWebGL=function(l){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(l.gl);this.ready=true}if(this.fastSpriteBatch.gl!==l.gl){this.fastSpriteBatch.setContext(l.gl)}l.spriteBatch.stop();l.shaderManager.setShader(l.shaderManager.fastShader);this.fastSpriteBatch.begin(this,l);this.fastSpriteBatch.render(this);l.spriteBatch.start()};e.SpriteBatch.prototype._renderCanvas=function(v){if(!this.visible||this.alpha<=0||!this.children.length){return}var l=v.context;l.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var o=this.worldTransform;var u=true;for(var r=0;r<this.children.length;r++){var m=this.children[r];if(!m.visible){continue}var t=m.texture;var n=t.frame;l.globalAlpha=this.worldAlpha*m.alpha;if(m.rotation%(Math.PI*2)===0){if(u){l.setTransform(o.a,o.b,o.c,o.d,o.tx,o.ty);u=false}l.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,((m.anchor.x)*(-n.width*m.scale.x)+m.position.x+0.5+v.shakeX)|0,((m.anchor.y)*(-n.height*m.scale.y)+m.position.y+0.5+v.shakeY)|0,n.width*m.scale.x,n.height*m.scale.y)}else{if(!u){u=true}m.displayObjectUpdateTransform();var s=m.worldTransform;var q=(s.tx*v.resolution)+v.shakeX;var p=(s.ty*v.resolution)+v.shakeY;if(v.roundPixels){l.setTransform(s.a,s.b,s.c,s.d,q|0,p|0)}else{l.setTransform(s.a,s.b,s.c,s.d,q,p)}l.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,((m.anchor.x)*(-n.width)+0.5)|0,((m.anchor.y)*(-n.height)+0.5)|0,n.width,n.height)}}};e.BitmapData=function(m,o,p,l,n){if(p===undefined||p===0){p=256}if(l===undefined||l===0){l=256}if(n===undefined){n=false}this.game=m;this.key=o;this.width=p;this.height=l;this.canvas=e.Canvas.create(this,p,l,null,n);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.smoothProperty=(m.renderType===e.CANVAS)?m.renderer.renderSession.smoothProperty:e.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,p,l);this.data=null;if(this.imageData){this.data=this.imageData.data}this.pixels=null;if(this.data){if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}}this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new e.FrameData();this.textureFrame=this.frameData.addFrame(new e.Frame(0,0,0,p,l,"bitmapData"));this.texture.frame=this.textureFrame;this.type=e.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new e.Point();this._size=new e.Point();this._scale=new e.Point();this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new e.Point();this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new e.Circle();this._swapCanvas=undefined};e.BitmapData.prototype={move:function(l,n,m){if(l!==0){this.moveH(l,m)}if(n!==0){this.moveV(n,m)}return this},moveH:function(r,o){if(o===undefined){o=true}if(this._swapCanvas===undefined){this._swapCanvas=e.CanvasPool.create(this,this.width,this.height)}var q=this._swapCanvas;var m=q.getContext("2d");var n=this.height;var p=this.canvas;m.clearRect(0,0,this.width,this.height);if(r<0){r=Math.abs(r);var l=this.width-r;if(o){m.drawImage(p,0,0,r,n,l,0,r,n)}m.drawImage(p,r,0,l,n,0,0,l,n)}else{var l=this.width-r;if(o){m.drawImage(p,l,0,r,n,0,0,r,n)}m.drawImage(p,0,0,l,n,r,0,l,n)}this.clear();return this.copy(this._swapCanvas)},moveV:function(r,o){if(o===undefined){o=true}if(this._swapCanvas===undefined){this._swapCanvas=e.CanvasPool.create(this,this.width,this.height)}var q=this._swapCanvas;var m=q.getContext("2d");var l=this.width;var p=this.canvas;m.clearRect(0,0,this.width,this.height);if(r<0){r=Math.abs(r);var n=this.height-r;if(o){m.drawImage(p,0,0,l,r,0,n,l,r)}m.drawImage(p,0,r,l,n,0,0,l,n)}else{var n=this.height-r;if(o){m.drawImage(p,0,n,l,r,0,0,l,r)}m.drawImage(p,0,0,l,n,0,r,l,n)}this.clear();return this.copy(this._swapCanvas)},add:function(l){if(Array.isArray(l)){for(var m=0;m<l.length;m++){if(l[m]["loadTexture"]){l[m].loadTexture(this)}}}else{l.loadTexture(this)}return this},load:function(l){if(typeof l==="string"){l=this.game.cache.getImage(l)}if(l){this.resize(l.width,l.height);this.cls()}else{return}this.draw(l);this.update();return this},clear:function(m,o,n,l){if(m===undefined){m=0}if(o===undefined){o=0}if(n===undefined){n=this.width}if(l===undefined){l=this.height}this.context.clearRect(m,o,n,l);this.dirty=true;return this},fill:function(o,n,l,m){if(m===undefined){m=1}this.context.fillStyle="rgba("+o+","+n+","+l+","+m+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},generateTexture:function(n,q,m){var l=this.game.cache;var p=new Image();if(q){p.onload=function(){var s=l.addImage(n,"",p);var r=new PIXI.Texture(s.base);q.call(m||null,r);p.onload=null}}p.src=this.canvas.toDataURL("image/png");if(!q){var o=l.addImage(n,"",p);return new PIXI.Texture(o.base)}return null},resize:function(m,l){if(m!==this.width||l!==this.height){this.width=m;this.height=l;this.canvas.width=m;this.canvas.height=l;if(this._swapCanvas!==undefined){this._swapCanvas.width=m;this._swapCanvas.height=l}this.baseTexture.width=m;this.baseTexture.height=l;this.textureFrame.width=m;this.textureFrame.height=l;this.texture.width=m;this.texture.height=l;this.texture.crop.width=m;this.texture.crop.height=l;this.update();this.dirty=true}return this},update:function(m,o,n,l){if(m===undefined){m=0}if(o===undefined){o=0}if(n===undefined){n=Math.max(1,this.width)}if(l===undefined){l=Math.max(1,this.height)}this.imageData=this.context.getImageData(m,o,n,l);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(v,o,t,s,n,z){if(t===undefined){t=0}if(s===undefined){s=0}if(n===undefined){n=this.width}if(z===undefined){z=this.height}var u=t+n;var r=s+z;var m=e.Color.createColor();var A={r:0,g:0,b:0,a:0};var l=false;for(var p=s;p<r;p++){for(var q=t;q<u;q++){e.Color.unpackPixel(this.getPixel32(q,p),m);A=v.call(o,m,q,p);if(A!==false&&A!==null&&A!==undefined){this.setPixel32(q,p,A.r,A.g,A.b,A.a,false);l=true}}}if(l){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(v,o,t,s,n,z){if(t===undefined){t=0}if(s===undefined){s=0}if(n===undefined){n=this.width}if(z===undefined){z=this.height}var u=t+n;var r=s+z;var m=0;var A=0;var l=false;for(var p=s;p<r;p++){for(var q=t;q<u;q++){m=this.getPixel32(q,p);A=v.call(o,m,q,p);if(A!==m){this.pixels[p*this.width+q]=A;l=true}}}if(l){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(q,m,B,o,p,D,v,n,u){var A=0;var t=0;var C=this.width;var r=this.height;var l=e.Color.packPixel(q,m,B,o);if(u!==undefined&&u instanceof e.Rectangle){A=u.x;t=u.y;C=u.width;r=u.height}for(var s=0;s<r;s++){for(var z=0;z<C;z++){if(this.getPixel32(A+z,t+s)===l){this.setPixel32(A+z,t+s,p,D,v,n,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(p,w,n,r){var v=p||p===0;var o=w||w===0;var t=n||n===0;if(!v&&!o&&!t){return}if(r===undefined){r=new e.Rectangle(0,0,this.width,this.height)}var m=e.Color.createColor();for(var q=r.y;q<r.bottom;q++){for(var u=r.x;u<r.right;u++){e.Color.unpackPixel(this.getPixel32(u,q),m,true);if(v){m.h=p}if(o){m.s=w}if(t){m.l=n}e.Color.HSLtoRGB(m.h,m.s,m.l,m);this.setPixel32(u,q,m.r,m.g,m.b,m.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(q,p,n,r){if(q===undefined||q===null){q=false}if(p===undefined||p===null){p=false}if(n===undefined||n===null){n=false}if(!q&&!p&&!n){return}if(r===undefined){r=new e.Rectangle(0,0,this.width,this.height)}var o=e.Color.createColor();for(var t=r.y;t<r.bottom;t++){for(var m=r.x;m<r.right;m++){e.Color.unpackPixel(this.getPixel32(m,t),o,true);if(q){o.h=this.game.math.wrap(o.h+q,0,1)}if(p){o.s=this.game.math.clamp(o.s+p,0,1)}if(n){o.l=this.game.math.clamp(o.l+n,0,1)}e.Color.HSLtoRGB(o.h,o.s,o.l,o);this.setPixel32(m,t,o.r,o.g,o.b,o.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(m,r,q,o,l,p,n){if(n===undefined){n=true}if(m>=0&&m<=this.width&&r>=0&&r<=this.height){if(e.Device.LITTLE_ENDIAN){this.pixels[r*this.width+m]=(p<<24)|(l<<16)|(o<<8)|q}else{this.pixels[r*this.width+m]=(q<<24)|(o<<16)|(l<<8)|p}if(n){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(m,q,p,o,l,n){return this.setPixel32(m,q,p,o,l,255,n)},getPixel:function(l,o,n){if(!n){n=e.Color.createColor()}var m=~~(l+(o*this.width));m*=4;n.r=this.data[m];n.g=this.data[++m];n.b=this.data[++m];n.a=this.data[++m];return n},getPixel32:function(l,m){if(l>=0&&l<=this.width&&m>=0&&m<=this.height){return this.pixels[m*this.width+l]}},getPixelRGB:function(l,p,o,m,n){return e.Color.unpackPixel(this.getPixel32(l,p),o,m,n)},getPixels:function(l){return this.context.getImageData(l.x,l.y,l.width,l.height)},getFirstPixel:function(p){if(p===undefined){p=0}var o=e.Color.createColor();var l=0;var q=0;var n=1;var m=false;if(p===1){n=-1;q=this.height}else{if(p===3){n=-1;l=this.width}}do{e.Color.unpackPixel(this.getPixel32(l,q),o);if(p===0||p===1){l++;if(l===this.width){l=0;q+=n;if(q>=this.height||q<=0){m=true}}}else{if(p===2||p===3){q++;if(q===this.height){q=0;l+=n;if(l>=this.width||l<=0){m=true}}}}}while(o.a===0&&!m);o.x=l;o.y=q;return o},getBounds:function(l){if(l===undefined){l=new e.Rectangle()}l.x=this.getFirstPixel(2).x;if(l.x===this.width){return l.setTo(0,0,0,0)}l.y=this.getFirstPixel(0).y;l.width=(this.getFirstPixel(3).x-l.x)+1;l.height=(this.getFirstPixel(1).y-l.y)+1;return l},addToWorld:function(m,r,l,q,o,n){o=o||1;n=n||1;var p=this.game.add.image(m,r,this);p.anchor.set(l,q);p.scale.set(o,n);return p},copy:function(u,q,p,t,s,D,C,r,w,z,m,l,B,A,n,E,o){if(u===undefined||u===null){u=this}if(u instanceof e.RenderTexture){u=u.getCanvas()}this._image=u;if(u instanceof e.Sprite||u instanceof e.Image||u instanceof e.Text||u instanceof PIXI.Sprite){this._pos.set(u.texture.crop.x,u.texture.crop.y);this._size.set(u.texture.crop.width,u.texture.crop.height);this._scale.set(u.scale.x,u.scale.y);this._anchor.set(u.anchor.x,u.anchor.y);this._rotate=u.rotation;this._alpha.current=u.alpha;if(u.texture instanceof e.RenderTexture){this._image=u.texture.getCanvas()}else{this._image=u.texture.baseTexture.source}if(D===undefined||D===null){D=u.x}if(C===undefined||C===null){C=u.y}if(u.texture.trim){D+=u.texture.trim.x-u.anchor.x*u.texture.trim.width;C+=u.texture.trim.y-u.anchor.y*u.texture.trim.height}if(u.tint!==16777215){if(u.cachedTint!==u.tint){u.cachedTint=u.tint;u.tintedTexture=PIXI.CanvasTinter.getTintedTexture(u,u.tint)}this._image=u.tintedTexture;this._pos.set(0)}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(u instanceof e.BitmapData){this._image=u.canvas}else{if(typeof u==="string"){u=this.game.cache.getImage(u);if(u===null){return}else{this._image=u}}}this._size.set(this._image.width,this._image.height)}if(q===undefined||q===null){q=0}if(p===undefined||p===null){p=0}if(t){this._size.x=t}if(s){this._size.y=s}if(D===undefined||D===null){D=q}if(C===undefined||C===null){C=p}if(r===undefined||r===null){r=this._size.x}if(w===undefined||w===null){w=this._size.y}if(typeof z==="number"){this._rotate=z}if(typeof m==="number"){this._anchor.x=m}if(typeof l==="number"){this._anchor.y=l}if(typeof B==="number"){this._scale.x=B}if(typeof A==="number"){this._scale.y=A}if(typeof n==="number"){this._alpha.current=n}if(E===undefined){E=null}if(o===undefined){o=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}var v=this.context;this._alpha.prev=v.globalAlpha;v.save();v.globalAlpha=this._alpha.current;if(E){this.op=E}if(o){D|=0;C|=0}v.translate(D,C);v.scale(this._scale.x,this._scale.y);v.rotate(this._rotate);v.drawImage(this._image,this._pos.x+q,this._pos.y+p,this._size.x,this._size.y,-r*this._anchor.x,-w*this._anchor.y,r,w);v.restore();v.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyTransform:function(r,q,p){if(q===undefined){q=null}if(p===undefined){p=false}if(!r.hasOwnProperty("worldTransform")||!r.worldVisible||r.worldAlpha===0){return this}var m=r.worldTransform;this._pos.set(r.texture.crop.x,r.texture.crop.y);this._size.set(r.texture.crop.width,r.texture.crop.height);if(m.a===0||m.d===0||this._size.x===0||this._size.y===0){return this}if(r.texture instanceof e.RenderTexture){this._image=r.texture.getCanvas()}else{this._image=r.texture.baseTexture.source}var o=m.tx;var l=m.ty;if(r.texture.trim){o+=r.texture.trim.x-r.anchor.x*r.texture.trim.width;l+=r.texture.trim.y-r.anchor.y*r.texture.trim.height}if(r.tint!==16777215){if(r.cachedTint!==r.tint){r.cachedTint=r.tint;r.tintedTexture=PIXI.CanvasTinter.getTintedTexture(r,r.tint)}this._image=r.tintedTexture;this._pos.set(0)}if(p){o|=0;l|=0}var n=this.context;this._alpha.prev=n.globalAlpha;n.save();n.globalAlpha=this._alpha.current;if(q){this.op=q}n[this.smoothProperty]=(r.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR);n.setTransform(m.a,m.b,m.c,m.d,o,l);n.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*r.anchor.x,-this._size.y*r.anchor.y,this._size.x,this._size.y);n.restore();n.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(p,o,l,r,q,n,m){return this.copy(p,o.x,o.y,o.width,o.height,l,r,o.width,o.height,0,0,0,1,1,q,n,m)},draw:function(q,m,r,p,l,o,n){return this.copy(q,null,null,null,null,m,r,p,l,null,null,null,null,null,null,o,n)},drawGroup:function(n,m,l){if(n.total>0){n.forEachExists(this.drawGroupProxy,this,m,l)}return this},drawGroupProxy:function(o,n,m){if(o.hasOwnProperty("texture")){this.copyTransform(o,n,m)}if(o.type===e.GROUP&&o.exists){this.drawGroup(o,n,m)}else{if(o.hasOwnProperty("children")&&o.children.length>0){for(var l=0;l<o.children.length;l++){if(o.children[l].exists){this.copyTransform(o.children[l],n,m)}}}}},drawFull:function(o,n,m){if(o.worldVisible===false||o.worldAlpha===0||(o.hasOwnProperty("exists")&&o.exists===false)){return this}if(o.type!==e.GROUP&&o.type!==e.EMITTER&&o.type!==e.BITMAPTEXT){if(o.type===e.GRAPHICS){var p=o.getBounds();this.ctx.save();this.ctx.translate(p.x,p.y);PIXI.CanvasGraphics.renderGraphics(o,this.ctx);this.ctx.restore()}else{this.copy(o,null,null,null,null,o.worldPosition.x,o.worldPosition.y,null,null,o.worldRotation,null,null,o.worldScale.x,o.worldScale.y,o.worldAlpha,n,m)}}if(o.children){for(var l=0;l<o.children.length;l++){this.drawFull(o.children[l],n,m)}}return this},shadow:function(n,o,l,p){var m=this.context;if(n===undefined||n===null){m.shadowColor="rgba(0,0,0,0)"}else{m.shadowColor=n;m.shadowBlur=o||5;m.shadowOffsetX=l||10;m.shadowOffsetY=p||10}return this},alphaMask:function(o,l,m,n){if(n===undefined||n===null){this.draw(l).blendSourceAtop()}else{this.draw(l,n.x,n.y,n.width,n.height).blendSourceAtop()}if(m===undefined||m===null){this.draw(o).blendReset()}else{this.draw(o,m.x,m.y,m.width,m.height).blendReset()}return this},extract:function(q,l,o,s,t,m,n,u,p){if(t===undefined){t=255}if(m===undefined){m=false}if(n===undefined){n=l}if(u===undefined){u=o}if(p===undefined){p=s}if(m){q.resize(this.width,this.height)}this.processPixelRGB(function(v,r,w){if(v.r===l&&v.g===o&&v.b===s){q.setPixel32(r,w,n,u,p,t,false)}return false},this);q.context.putImageData(q.imageData,0,0);q.dirty=true;return q},rect:function(m,p,o,l,n){if(typeof n!=="undefined"){this.context.fillStyle=n}this.context.fillRect(m,p,o,l);return this},text:function(q,l,s,o,n,r){if(l===undefined){l=0}if(s===undefined){s=0}if(o===undefined){o="14px Courier"}if(n===undefined){n="rgb(255,255,255)"}if(r===undefined){r=true}var m=this.context;var p=m.font;m.font=o;if(r){m.fillStyle="rgb(0,0,0)";m.fillText(q,l+1,s+1)}m.fillStyle=n;m.fillText(q,l,s);m.font=p;return this},circle:function(m,p,l,o){var n=this.context;if(o!==undefined){n.fillStyle=o}n.beginPath();n.arc(m,p,l,0,Math.PI*2,false);n.closePath();n.fill();return this},line:function(o,r,n,p,m,q){if(m===undefined){m="#fff"}if(q===undefined){q=1}var l=this.context;l.beginPath();l.moveTo(o,r);l.lineTo(n,p);l.lineWidth=q;l.strokeStyle=m;l.stroke();l.closePath();return this},textureLine:function(m,p,o){if(o===undefined){o="repeat-x"}if(typeof p==="string"){p=this.game.cache.getImage(p);if(!p){return}}var n=m.length;if(o==="no-repeat"&&n>p.width){n=p.width}var l=this.context;l.fillStyle=l.createPattern(p,o);this._circle=new e.Circle(m.start.x,m.start.y,p.height);this._circle.circumferencePoint(m.angle-1.5707963267948966,false,this._pos);l.save();l.translate(this._pos.x,this._pos.y);l.rotate(m.angle);l.fillRect(0,0,n,p.height);l.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},destroy:function(){this.frameData.destroy();this.texture.destroy(true);e.CanvasPool.remove(this)},blendReset:function(){this.op="source-over";return this},blendSourceOver:function(){this.op="source-over";return this},blendSourceIn:function(){this.op="source-in";return this},blendSourceOut:function(){this.op="source-out";return this},blendSourceAtop:function(){this.op="source-atop";return this},blendDestinationOver:function(){this.op="destination-over";return this},blendDestinationIn:function(){this.op="destination-in";return this},blendDestinationOut:function(){this.op="destination-out";return this},blendDestinationAtop:function(){this.op="destination-atop";return this},blendXor:function(){this.op="xor";return this},blendAdd:function(){this.op="lighter";return this},blendMultiply:function(){this.op="multiply";return this},blendScreen:function(){this.op="screen";return this},blendOverlay:function(){this.op="overlay";return this},blendDarken:function(){this.op="darken";return this},blendLighten:function(){this.op="lighten";return this},blendColorDodge:function(){this.op="color-dodge";return this},blendColorBurn:function(){this.op="color-burn";return this},blendHardLight:function(){this.op="hard-light";return this},blendSoftLight:function(){this.op="soft-light";return this},blendDifference:function(){this.op="difference";return this},blendExclusion:function(){this.op="exclusion";return this},blendHue:function(){this.op="hue";return this},blendSaturation:function(){this.op="saturation";return this},blendColor:function(){this.op="color";return this},blendLuminosity:function(){this.op="luminosity";return this},copyBitmapData:function(o,l,q){o.update();for(var n=0,p;n<o.height;n++){p=(q+n)*this.width+l;for(var m=0;m<o.width;m++){this.pixels[p+m]=o.pixels[n*o.width+m]}}return this}};Object.defineProperty(e.BitmapData.prototype,"smoothed",{get:function(){e.Canvas.getSmoothingEnabled(this.context)},set:function(l){e.Canvas.setSmoothingEnabled(this.context,l)}});Object.defineProperty(e.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(l){this.context.globalCompositeOperation=l}});e.BitmapData.getTransform=function(q,p,n,l,o,m){if(typeof q!=="number"){q=0}if(typeof p!=="number"){p=0}if(typeof n!=="number"){n=1}if(typeof l!=="number"){l=1}if(typeof o!=="number"){o=0}if(typeof m!=="number"){m=0}return{sx:n,sy:l,scaleX:n,scaleY:l,skewX:o,skewY:m,translateX:q,translateY:p,tx:q,ty:p}};e.BitmapData.prototype.constructor=e.BitmapData;e.EarCut={};e.EarCut.Triangulate=function(s,w,t){t=t||2;var u=w&&w.length,q=u?w[0]*t:s.length,v=e.EarCut.linkedList(s,0,q,t,true),o=[];if(!v){return o}var p,n,m,l,A,z,B;if(u){v=e.EarCut.eliminateHoles(s,w,v,t)}if(s.length>80*t){p=m=s[0];n=l=s[1];for(var r=t;r<q;r+=t){A=s[r];z=s[r+1];if(A<p){p=A}if(z<n){n=z}if(A>m){m=A}if(z>l){l=z}}B=Math.max(m-p,l-n)}e.EarCut.earcutLinked(v,o,t,p,n,B);return o};e.EarCut.linkedList=function(p,m,n,r,l){var s=0,q,o,t;for(q=m,o=n-r;q<n;q+=r){s+=(p[o]-p[q])*(p[q+1]+p[o+1]);o=q}if(l===(s>0)){for(q=m;q<n;q+=r){t=e.EarCut.insertNode(q,p[q],p[q+1],t)}}else{for(q=n-r;q>=m;q-=r){t=e.EarCut.insertNode(q,p[q],p[q+1],t)}}return t};e.EarCut.filterPoints=function(o,l){if(!o){return o}if(!l){l=o}var n=o,m;do{m=false;if(!n.steiner&&(e.EarCut.equals(n,n.next)||e.EarCut.area(n.prev,n,n.next)===0)){e.EarCut.removeNode(n);n=l=n.prev;if(n===n.next){return null}m=true}else{n=n.next}}while(m||n!==l);return l};e.EarCut.earcutLinked=function(m,o,r,p,l,u,t){if(!m){return}if(!t&&u){e.EarCut.indexCurve(m,p,l,u)}var s=m,n,q;while(m.prev!==m.next){n=m.prev;q=m.next;if(u?e.EarCut.isEarHashed(m,p,l,u):e.EarCut.isEar(m)){o.push(n.i/r);o.push(m.i/r);o.push(q.i/r);e.EarCut.removeNode(m);m=q.next;s=q.next;continue}m=q;if(m===s){if(!t){e.EarCut.earcutLinked(e.EarCut.filterPoints(m),o,r,p,l,u,1)}else{if(t===1){m=e.EarCut.cureLocalIntersections(m,o,r);e.EarCut.earcutLinked(m,o,r,p,l,u,2)}else{if(t===2){e.EarCut.splitEarcut(m,o,r,p,l,u)}}}break}}};e.EarCut.isEar=function(n){var m=n.prev,l=n,q=n.next;if(e.EarCut.area(m,l,q)>=0){return false}var o=n.next.next;while(o!==n.prev){if(e.EarCut.pointInTriangle(m.x,m.y,l.x,l.y,q.x,q.y,o.x,o.y)&&e.EarCut.area(o.prev,o,o.next)>=0){return false}o=o.next}return true};e.EarCut.isEarHashed=function(r,s,q,y){var v=r.prev,u=r,t=r.next;if(e.EarCut.area(v,u,t)>=0){return false}var z=v.x<u.x?(v.x<t.x?v.x:t.x):(u.x<t.x?u.x:t.x),w=v.y<u.y?(v.y<t.y?v.y:t.y):(u.y<t.y?u.y:t.y),o=v.x>u.x?(v.x>t.x?v.x:t.x):(u.x>t.x?u.x:t.x),n=v.y>u.y?(v.y>t.y?v.y:t.y):(u.y>t.y?u.y:t.y);var m=e.EarCut.zOrder(z,w,s,q,y),x=e.EarCut.zOrder(o,n,s,q,y);var l=r.nextZ;while(l&&l.z<=x){if(l!==r.prev&&l!==r.next&&e.EarCut.pointInTriangle(v.x,v.y,u.x,u.y,t.x,t.y,l.x,l.y)&&e.EarCut.area(l.prev,l,l.next)>=0){return false}l=l.nextZ}l=r.prevZ;while(l&&l.z>=m){if(l!==r.prev&&l!==r.next&&e.EarCut.pointInTriangle(v.x,v.y,u.x,u.y,t.x,t.y,l.x,l.y)&&e.EarCut.area(l.prev,l,l.next)>=0){return false}l=l.prevZ}return true};e.EarCut.cureLocalIntersections=function(r,n,q){var o=r;do{var m=o.prev,l=o.next.next;if(e.EarCut.intersects(m,o,o.next,l)&&e.EarCut.locallyInside(m,l)&&e.EarCut.locallyInside(l,m)){n.push(m.i/q);n.push(o.i/q);n.push(l.i/q);e.EarCut.removeNode(o);e.EarCut.removeNode(o.next);o=r=l}o=o.next}while(o!==r);return o};e.EarCut.splitEarcut=function(l,n,p,o,m,t){var s=l;do{var r=s.next.next;while(r!==s.prev){if(s.i!==r.i&&e.EarCut.isValidDiagonal(s,r)){var q=e.EarCut.splitPolygon(s,r);s=e.EarCut.filterPoints(s,s.next);q=e.EarCut.filterPoints(q,q.next);e.EarCut.earcutLinked(s,n,p,o,m,t);e.EarCut.earcutLinked(q,n,p,o,m,t);return}r=r.next}s=s.next}while(s!==l)};e.EarCut.eliminateHoles=function(n,u,q,p){var r=[],o,s,l,m,t;for(o=0,s=u.length;o<s;o++){l=u[o]*p;m=o<s-1?u[o+1]*p:n.length;t=e.EarCut.linkedList(n,l,m,p,false);if(t===t.next){t.steiner=true}r.push(e.EarCut.getLeftmost(t))}r.sort(compareX);for(o=0;o<r.length;o++){e.EarCut.eliminateHole(r[o],q);q=e.EarCut.filterPoints(q,q.next)}return q};e.EarCut.compareX=function(m,l){return m.x-l.x};e.EarCut.eliminateHole=function(n,m){m=e.EarCut.findHoleBridge(n,m);if(m){var l=e.EarCut.splitPolygon(m,n);e.EarCut.filterPoints(l,l.next)}};e.EarCut.findHoleBridge=function(l,r){var n=r,t=l.x,s=l.y,q=-Infinity,o;do{if(s<=n.y&&s>=n.next.y){var w=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(w<=t&&w>q){q=w;o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==r);if(!o){return null}if(l.x===o.x){return o.prev}var v=o,y=Infinity,u;n=o.next;while(n!==v){if(t>=n.x&&n.x>=o.x&&e.EarCut.pointInTriangle(s<o.y?t:q,s,o.x,o.y,s<o.y?q:t,s,n.x,n.y)){u=Math.abs(s-n.y)/(t-n.x);if((u<y||(u===y&&n.x>o.x))&&e.EarCut.locallyInside(n,l)){o=n;y=u}}n=n.next}return o};e.EarCut.indexCurve=function(q,l,o,m){var n=q;do{if(n.z===null){n.z=e.EarCut.zOrder(n.x,n.y,l,o,m)}n.prevZ=n.prev;n.nextZ=n.next;n=n.next}while(n!==q);n.prevZ.nextZ=null;n.prevZ=null;e.EarCut.sortLinked(n)};e.EarCut.sortLinked=function(t){var o,n,m,s,u,l,v,r,w=1;do{n=t;t=null;u=null;l=0;while(n){l++;m=n;v=0;for(o=0;o<w;o++){v++;m=m.nextZ;if(!m){break}}r=w;while(v>0||(r>0&&m)){if(v===0){s=m;m=m.nextZ;r--}else{if(r===0||!m){s=n;n=n.nextZ;v--}else{if(n.z<=m.z){s=n;n=n.nextZ;v--}else{s=m;m=m.nextZ;r--}}}if(u){u.nextZ=s}else{t=s}s.prevZ=u;u=s}n=m}u.nextZ=null;w*=2}while(l>1);return t};e.EarCut.zOrder=function(m,p,l,o,n){m=32767*(m-l)/n;p=32767*(p-o)/n;m=(m|(m<<8))&16711935;m=(m|(m<<4))&252645135;m=(m|(m<<2))&858993459;m=(m|(m<<1))&1431655765;p=(p|(p<<8))&16711935;p=(p|(p<<4))&252645135;p=(p|(p<<2))&858993459;p=(p|(p<<1))&1431655765;return m|(p<<1)};e.EarCut.getLeftmost=function(n){var m=n,l=n;do{if(m.x<l.x){l=m}m=m.next}while(m!==n);return l};e.EarCut.pointInTriangle=function(p,o,r,q,l,s,n,m){return(l-n)*(o-m)-(p-n)*(s-m)>=0&&(p-n)*(q-m)-(r-n)*(o-m)>=0&&(r-n)*(s-m)-(l-n)*(q-m)>=0};e.EarCut.isValidDiagonal=function(m,l){return e.EarCut.equals(m,l)||m.next.i!==l.i&&m.prev.i!==l.i&&!e.EarCut.intersectsPolygon(m,l)&&e.EarCut.locallyInside(m,l)&&e.EarCut.locallyInside(l,m)&&e.EarCut.middleInside(m,l)};e.EarCut.area=function(n,m,l){return(m.y-n.y)*(l.x-m.x)-(m.x-n.x)*(l.y-m.y)};e.EarCut.equals=function(m,l){return m.x===l.x&&m.y===l.y};e.EarCut.intersects=function(n,l,m,o){return e.EarCut.area(n,l,m)>0!==e.EarCut.area(n,l,o)>0&&e.EarCut.area(m,o,n)>0!==e.EarCut.area(m,o,l)>0};e.EarCut.intersectsPolygon=function(m,l){var n=m;do{if(n.i!==m.i&&n.next.i!==m.i&&n.i!==l.i&&n.next.i!==l.i&&e.EarCut.intersects(n,n.next,m,l)){return true}n=n.next}while(n!==m);return false};e.EarCut.locallyInside=function(m,l){return e.EarCut.area(m.prev,m,m.next)<0?e.EarCut.area(m,l,m.next)>=0&&e.EarCut.area(m,m.prev,l)>=0:e.EarCut.area(m,l,m.prev)<0||e.EarCut.area(m,m.next,l)<0};e.EarCut.middleInside=function(n,m){var r=n,l=false,q=(n.x+m.x)/2,o=(n.y+m.y)/2;do{if(((r.y>o)!==(r.next.y>o))&&(q<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x)){l=!l}r=r.next}while(r!==n);return l};e.EarCut.splitPolygon=function(n,m){var l=new e.EarCut.Node(n.i,n.x,n.y),o=new e.EarCut.Node(m.i,m.x,m.y),q=n.next,p=m.prev;n.next=m;m.prev=n;l.next=q;q.prev=l;o.next=l;l.prev=o;p.next=o;o.prev=p;return o};e.EarCut.insertNode=function(m,l,q,n){var o=new e.EarCut.Node(m,l,q);if(!n){o.prev=o;o.next=o}else{o.next=n.next;o.prev=n;n.next.prev=o;n.next=o}return o};e.EarCut.removeNode=function(l){l.next.prev=l.prev;l.prev.next=l.next;if(l.prevZ){l.prevZ.nextZ=l.nextZ}if(l.nextZ){l.nextZ.prevZ=l.prevZ}};e.EarCut.Node=function(m,l,n){this.i=m;this.x=l;this.y=n;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(s,t){var n=t.gl;var q=t.projection,l=t.offset,p=t.shaderManager.primitiveShader,o;if(s.dirty){PIXI.WebGLGraphics.updateGraphics(s,n)}var r=s._webGL[n.id];if(!r){return}for(var m=0;m<r.data.length;m++){if(r.data[m].mode===1){o=r.data[m];t.stencilManager.pushStencil(s,o,t);n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,(o.indices.length-4)*2);t.stencilManager.popStencil(s,o,t)}else{o=r.data[m];t.shaderManager.setShader(p);p=t.shaderManager.primitiveShader;n.uniformMatrix3fv(p.translationMatrix,false,s.worldTransform.toArray(true));n.uniform1f(p.flipY,1);n.uniform2f(p.projectionVector,q.x,-q.y);n.uniform2f(p.offsetVector,-l.x,-l.y);n.uniform3fv(p.tintColor,e.Color.hexToRGBArray(s.tint));n.uniform1f(p.alpha,s.worldAlpha);n.bindBuffer(n.ARRAY_BUFFER,o.buffer);n.vertexAttribPointer(p.aVertexPosition,2,n.FLOAT,false,4*6,0);n.vertexAttribPointer(p.colorAttribute,4,n.FLOAT,false,4*6,2*4);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.indexBuffer);n.drawElements(n.TRIANGLE_STRIP,o.indices.length,n.UNSIGNED_SHORT,0)}}};PIXI.WebGLGraphics.updateGraphics=function(l,r){var p=l._webGL[r.id];if(!p){p=l._webGL[r.id]={lastIndex:0,data:[],gl:r}}l.dirty=false;var m;if(l.clearDirty){l.clearDirty=false;for(m=0;m<p.data.length;m++){var s=p.data[m];s.reset();PIXI.WebGLGraphics.graphicsDataPool.push(s)}p.data=[];p.lastIndex=0}var q;for(m=p.lastIndex;m<l.graphicsData.length;m++){var o=l.graphicsData[m];if(o.type===e.POLYGON){o.points=o.shape.points.slice();if(o.shape.closed){if(o.points[0]!==o.points[o.points.length-2]||o.points[1]!==o.points[o.points.length-1]){o.points.push(o.points[0],o.points[1])}}if(o.fill){if(o.points.length>=PIXI.WebGLGraphics.stencilBufferLimit){if(o.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){q=PIXI.WebGLGraphics.switchMode(p,0);var n=PIXI.WebGLGraphics.buildPoly(o,q);if(!n){q=PIXI.WebGLGraphics.switchMode(p,1);PIXI.WebGLGraphics.buildComplexPoly(o,q)}}else{q=PIXI.WebGLGraphics.switchMode(p,1);PIXI.WebGLGraphics.buildComplexPoly(o,q)}}}if(o.lineWidth>0){q=PIXI.WebGLGraphics.switchMode(p,0);PIXI.WebGLGraphics.buildLine(o,q)}}else{q=PIXI.WebGLGraphics.switchMode(p,0);if(o.type===e.RECTANGLE){PIXI.WebGLGraphics.buildRectangle(o,q)}else{if(o.type===e.CIRCLE||o.type===e.ELLIPSE){PIXI.WebGLGraphics.buildCircle(o,q)}else{if(o.type===e.ROUNDEDRECTANGLE){PIXI.WebGLGraphics.buildRoundedRectangle(o,q)}}}}p.lastIndex++}for(m=0;m<p.data.length;m++){q=p.data[m];if(q.dirty){q.upload()}}};PIXI.WebGLGraphics.switchMode=function(m,l){var n;if(!m.data.length){n=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(m.gl);n.mode=l;m.data.push(n)}else{n=m.data[m.data.length-1];if(n.mode!==l||l===1){n=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(m.gl);n.mode=l;m.data.push(n)}}n.dirty=true;return n};PIXI.WebGLGraphics.buildRectangle=function(D,q){var o=D.shape;var z=o.x;var w=o.y;var m=o.width;var C=o.height;if(D.fill){var p=e.Color.hexToRGBArray(D.fillColor);var n=D.fillAlpha;var l=p[0]*n;var s=p[1]*n;var v=p[2]*n;var A=q.points;var B=q.indices;var u=A.length/6;A.push(z,w);A.push(l,s,v,n);A.push(z+m,w);A.push(l,s,v,n);A.push(z,w+C);A.push(l,s,v,n);A.push(z+m,w+C);A.push(l,s,v,n);B.push(u,u,u+1,u+2,u+3,u+3)}if(D.lineWidth){var t=D.points;D.points=[z,w,z+m,w,z+m,w+C,z,w+C,z,w];PIXI.WebGLGraphics.buildLine(D,q);D.points=t}};PIXI.WebGLGraphics.buildRoundedRectangle=function(u,H){var l=u.shape;var t=l.x;var s=l.y;var A=l.width;var z=l.height;var n=l.radius;var v=[];v.push(t,s+n);v=v.concat(PIXI.WebGLGraphics.quadraticBezierCurve(t,s+z-n,t,s+z,t+n,s+z));v=v.concat(PIXI.WebGLGraphics.quadraticBezierCurve(t+A-n,s+z,t+A,s+z,t+A,s+z-n));v=v.concat(PIXI.WebGLGraphics.quadraticBezierCurve(t+A,s+n,t+A,s,t+A-n,s));v=v.concat(PIXI.WebGLGraphics.quadraticBezierCurve(t+n,s,t,s,t,s+n));if(u.fill){var C=e.Color.hexToRGBArray(u.fillColor);var o=u.fillAlpha;var w=C[0]*o;var E=C[1]*o;var F=C[2]*o;var G=H.points;var p=H.indices;var m=G.length/6;var B=e.EarCut.Triangulate(v,null,2);var D=0;for(D=0;D<B.length;D+=3){p.push(B[D]+m);p.push(B[D]+m);p.push(B[D+1]+m);p.push(B[D+2]+m);p.push(B[D+2]+m)}for(D=0;D<v.length;D++){G.push(v[D],v[++D],w,E,F,o)}}if(u.lineWidth){var q=u.points;u.points=v;PIXI.WebGLGraphics.buildLine(u,H);u.points=q}};PIXI.WebGLGraphics.quadraticBezierCurve=function(B,v,z,s,C,w){var m,t,E,r,A,u,o=20,D=[];function l(y,x,n){var F=x-y;return y+(F*n)}var p=0;for(var q=0;q<=o;q++){p=q/o;m=l(B,z,p);t=l(v,s,p);E=l(z,C,p);r=l(s,w,p);A=l(m,E,p);u=l(t,r,p);D.push(A,u)}return D};PIXI.WebGLGraphics.buildCircle=function(s,G){var C=s.shape;var q=C.x;var p=C.y;var w;var v;if(s.type===e.CIRCLE){w=C.radius;v=C.radius}else{w=C.width;v=C.height}var t=40;var D=(Math.PI*2)/t;var A=0;if(s.fill){var z=e.Color.hexToRGBArray(s.fillColor);var m=s.fillAlpha;var u=z[0]*m;var B=z[1]*m;var E=z[2]*m;var F=G.points;var n=G.indices;var l=F.length/6;n.push(l);for(A=0;A<t+1;A++){F.push(q,p,u,B,E,m);F.push(q+Math.sin(D*A)*w,p+Math.cos(D*A)*v,u,B,E,m);n.push(l++,l++)}n.push(l-1)}if(s.lineWidth){var o=s.points;s.points=[];for(A=0;A<t+1;A++){s.points.push(q+Math.sin(D*A)*w,p+Math.cos(D*A)*v)}PIXI.WebGLGraphics.buildLine(s,G);s.points=o}};PIXI.WebGLGraphics.buildLine=function(Z,J){var V=0;var M=Z.points;if(M.length===0){return}if(Z.lineWidth%2){for(V=0;V<M.length;V++){M[V]+=0.5}}var A=new PIXI.Point(M[0],M[1]);var t=new PIXI.Point(M[M.length-2],M[M.length-1]);if(A.x===t.x&&A.y===t.y){M=M.slice();M.pop();M.pop();t=new PIXI.Point(M[M.length-2],M[M.length-1]);var C=t.x+(A.x-t.x)*0.5;var z=t.y+(A.y-t.y)*0.5;M.unshift(C,z);M.push(C,z)}var W=J.points;var q=J.indices;var B=M.length/2;var y=M.length;var Y=W.length/6;var l=Z.lineWidth/2;var L=e.Color.hexToRGBArray(Z.lineColor);var U=Z.lineAlpha;var R=L[0]*U;var X=L[1]*U;var aa=L[2]*U;var x,w,O,N,G,F,p,o;var Q,P,E,D,n,m;var T,K,v,S,I,u;var ab,H,s;O=M[0];N=M[1];G=M[2];F=M[3];Q=-(N-F);P=O-G;s=Math.sqrt(Q*Q+P*P);Q/=s;P/=s;Q*=l;P*=l;W.push(O-Q,N-P,R,X,aa,U);W.push(O+Q,N+P,R,X,aa,U);for(V=1;V<B-1;V++){O=M[(V-1)*2];N=M[(V-1)*2+1];G=M[(V)*2];F=M[(V)*2+1];p=M[(V+1)*2];o=M[(V+1)*2+1];Q=-(N-F);P=O-G;s=Math.sqrt(Q*Q+P*P);Q/=s;P/=s;Q*=l;P*=l;E=-(F-o);D=G-p;s=Math.sqrt(E*E+D*D);E/=s;D/=s;E*=l;D*=l;T=(-P+N)-(-P+F);K=(-Q+G)-(-Q+O);v=(-Q+O)*(-P+F)-(-Q+G)*(-P+N);S=(-D+o)-(-D+F);I=(-E+G)-(-E+p);u=(-E+p)*(-D+F)-(-E+G)*(-D+o);ab=T*I-S*K;if(Math.abs(ab)<0.1){ab+=10.1;W.push(G-Q,F-P,R,X,aa,U);W.push(G+Q,F+P,R,X,aa,U);continue}x=(K*u-I*v)/ab;w=(S*v-T*u)/ab;H=(x-G)*(x-G)+(w-F)+(w-F);if(H>140*140){n=Q-E;m=P-D;s=Math.sqrt(n*n+m*m);n/=s;m/=s;n*=l;m*=l;W.push(G-n,F-m);W.push(R,X,aa,U);W.push(G+n,F+m);W.push(R,X,aa,U);W.push(G-n,F-m);W.push(R,X,aa,U);y++}else{W.push(x,w);W.push(R,X,aa,U);W.push(G-(x-G),F-(w-F));W.push(R,X,aa,U)}}O=M[(B-2)*2];N=M[(B-2)*2+1];G=M[(B-1)*2];F=M[(B-1)*2+1];Q=-(N-F);P=O-G;s=Math.sqrt(Q*Q+P*P);Q/=s;P/=s;Q*=l;P*=l;W.push(G-Q,F-P);W.push(R,X,aa,U);W.push(G+Q,F+P);W.push(R,X,aa,U);q.push(Y);for(V=0;V<y;V++){q.push(Y++)}q.push(Y-1)};PIXI.WebGLGraphics.buildComplexPoly=function(w,r){var u=w.points.slice();if(u.length<6){return}var v=r.indices;r.points=u;r.alpha=w.fillAlpha;r.color=e.Color.hexToRGBArray(w.fillColor);var p=Infinity;var m=-Infinity;var o=Infinity;var l=-Infinity;var t,s;for(var q=0;q<u.length;q+=2){t=u[q];s=u[q+1];p=t<p?t:p;m=t>m?t:m;o=s<o?s:o;l=s>l?s:l}u.push(p,o,m,o,m,l,p,l);var n=u.length/2;for(q=0;q<n;q++){v.push(q)}};PIXI.WebGLGraphics.buildPoly=function(z,s){var x=z.points;if(x.length<6){return}var w=s.points;var y=s.indices;var m=x.length/2;var p=e.Color.hexToRGBArray(z.fillColor);var o=z.fillAlpha;var l=p[0]*o;var t=p[1]*o;var v=p[2]*o;var n=e.EarCut.Triangulate(x,null,2);if(!n){return false}var u=w.length/6;var q=0;for(q=0;q<n.length;q+=3){y.push(n[q]+u);y.push(n[q]+u);y.push(n[q+1]+u);y.push(n[q+2]+u);y.push(n[q+2]+u)}for(q=0;q<m;q++){w.push(x[q*2],x[q*2+1],l,t,v,o)}return true};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(l){this.gl=l;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=l.createBuffer();this.indexBuffer=l.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var l=this.gl;this.glPoints=new Float32Array(this.points);l.bindBuffer(l.ARRAY_BUFFER,this.buffer);l.bufferData(l.ARRAY_BUFFER,this.glPoints,l.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,this.glIndicies,l.STATIC_DRAW);this.dirty=false};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(M,o){var H=M.worldAlpha;if(M.dirty){this.updateGraphicsTint(M);M.dirty=false}for(var K=0;K<M.graphicsData.length;K++){var O=M.graphicsData[K];var n=O.shape;var t=O._fillTint;var m=O._lineTint;o.lineWidth=O.lineWidth;if(O.type===e.POLYGON){o.beginPath();var J=n.points;o.moveTo(J[0],J[1]);for(var I=1;I<J.length/2;I++){o.lineTo(J[I*2],J[I*2+1])}if(n.closed){o.lineTo(J[0],J[1])}if(J[0]===J[J.length-2]&&J[1]===J[J.length-1]){o.closePath()}if(O.fill){o.globalAlpha=O.fillAlpha*H;o.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);o.fill()}if(O.lineWidth){o.globalAlpha=O.lineAlpha*H;o.strokeStyle="#"+("00000"+(m|0).toString(16)).substr(-6);o.stroke()}}else{if(O.type===e.RECTANGLE){if(O.fillColor||O.fillColor===0){o.globalAlpha=O.fillAlpha*H;o.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);o.fillRect(n.x,n.y,n.width,n.height)}if(O.lineWidth){o.globalAlpha=O.lineAlpha*H;o.strokeStyle="#"+("00000"+(m|0).toString(16)).substr(-6);o.strokeRect(n.x,n.y,n.width,n.height)}}else{if(O.type===e.CIRCLE){o.beginPath();o.arc(n.x,n.y,n.radius,0,2*Math.PI);o.closePath();if(O.fill){o.globalAlpha=O.fillAlpha*H;o.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);o.fill()}if(O.lineWidth){o.globalAlpha=O.lineAlpha*H;o.strokeStyle="#"+("00000"+(m|0).toString(16)).substr(-6);o.stroke()}}else{if(O.type===e.ELLIPSE){var B=n.width*2;var L=n.height*2;var A=n.x-B/2;var z=n.y-L/2;o.beginPath();var C=0.5522848,s=(B/2)*C,q=(L/2)*C,G=A+B,l=z+L,D=A+B/2,N=z+L/2;o.moveTo(A,N);o.bezierCurveTo(A,N-q,D-s,z,D,z);o.bezierCurveTo(D+s,z,G,N-q,G,N);o.bezierCurveTo(G,N+q,D+s,l,D,l);o.bezierCurveTo(D-s,l,A,N+q,A,N);o.closePath();if(O.fill){o.globalAlpha=O.fillAlpha*H;o.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);o.fill()}if(O.lineWidth){o.globalAlpha=O.lineAlpha*H;o.strokeStyle="#"+("00000"+(m|0).toString(16)).substr(-6);o.stroke()}}else{if(O.type===e.ROUNDEDRECTANGLE){var u=n.x;var r=n.y;var F=n.width;var E=n.height;var p=n.radius;var v=Math.min(F,E)/2|0;p=p>v?v:p;o.beginPath();o.moveTo(u,r+p);o.lineTo(u,r+E-p);o.quadraticCurveTo(u,r+E,u+p,r+E);o.lineTo(u+F-p,r+E);o.quadraticCurveTo(u+F,r+E,u+F,r+E-p);o.lineTo(u+F,r+p);o.quadraticCurveTo(u+F,r,u+F-p,r);o.lineTo(u+p,r);o.quadraticCurveTo(u,r,u,r+p);o.closePath();if(O.fillColor||O.fillColor===0){o.globalAlpha=O.fillAlpha*H;o.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);o.fill()}if(O.lineWidth){o.globalAlpha=O.lineAlpha*H;o.strokeStyle="#"+("00000"+(m|0).toString(16)).substr(-6);o.stroke()}}}}}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(K,n){var I=K.graphicsData.length;if(I===0){return}n.beginPath();for(var H=0;H<I;H++){var M=K.graphicsData[H];var m=M.shape;if(M.type===e.POLYGON){var G=m.points;n.moveTo(G[0],G[1]);for(var F=1;F<G.length/2;F++){n.lineTo(G[F*2],G[F*2+1])}if(G[0]===G[G.length-2]&&G[1]===G[G.length-1]){n.closePath()}}else{if(M.type===e.RECTANGLE){n.rect(m.x,m.y,m.width,m.height);n.closePath()}else{if(M.type===e.CIRCLE){n.arc(m.x,m.y,m.radius,0,2*Math.PI);n.closePath()}else{if(M.type===e.ELLIPSE){var z=m.width*2;var J=m.height*2;var v=m.x-z/2;var u=m.y-J/2;var A=0.5522848,r=(z/2)*A,p=(J/2)*A,E=v+z,l=u+J,B=v+z/2,L=u+J/2;n.moveTo(v,L);n.bezierCurveTo(v,L-p,B-r,u,B,u);n.bezierCurveTo(B+r,u,E,L-p,E,L);n.bezierCurveTo(E,L+p,B+r,l,B,l);n.bezierCurveTo(B-r,l,v,L+p,v,L);n.closePath()}else{if(M.type===e.ROUNDEDRECTANGLE){var s=m.x;var q=m.y;var D=m.width;var C=m.height;var o=m.radius;var t=Math.min(D,C)/2|0;o=o>t?t:o;n.moveTo(s,q+o);n.lineTo(s,q+C-o);n.quadraticCurveTo(s,q+C,s+o,q+C);n.lineTo(s+D-o,q+C);n.quadraticCurveTo(s+D,q+C,s+D,q+C-o);n.lineTo(s+D,q+o);n.quadraticCurveTo(s+D,q,s+D-o,q);n.lineTo(s+o,q);n.quadraticCurveTo(s,q,s,q+o);n.closePath()}}}}}}};PIXI.CanvasGraphics.updateGraphicsTint=function(n){if(n.tint===16777215){return}var m=(n.tint>>16&255)/255;var l=(n.tint>>8&255)/255;var q=(n.tint&255)/255;for(var o=0;o<n.graphicsData.length;o++){var p=n.graphicsData[o];var s=p.fillColor|0;var r=p.lineColor|0;p._fillTint=(((s>>16&255)/255*m*255<<16)+((s>>8&255)/255*l*255<<8)+(s&255)/255*q*255);p._lineTint=(((r>>16&255)/255*m*255<<16)+((r>>8&255)/255*l*255<<8)+(r&255)/255*q*255)}};e.GraphicsData=function(l,q,n,r,o,p,m){this.lineWidth=l;this.lineColor=q;this.lineAlpha=n;this._lineTint=q;this.fillColor=r;this.fillAlpha=o;this._fillTint=r;this.fill=p;this.shape=m;this.type=m.type};e.GraphicsData.prototype.constructor=e.GraphicsData;e.GraphicsData.prototype.clone=function(){return new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};e.Graphics=function(m,l,n){if(l===undefined){l=0}if(n===undefined){n=0}this.type=e.GRAPHICS;this.physicsType=e.SPRITE;this.anchor=new e.Point();PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new e.Rectangle(0,0,1,1);this.dirty=true;this._boundsDirty=false;this.webGLDirty=false;this.cachedSpriteDirty=false;e.Component.Core.init.call(this,m,l,n,"",null)};e.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);e.Graphics.prototype.constructor=e.Graphics;e.Component.Core.install.call(e.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);e.Graphics.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.Graphics.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Graphics.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Graphics.prototype.preUpdateCore=e.Component.Core.preUpdate;e.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.Graphics.prototype.postUpdate=function(){e.Component.PhysicsBody.postUpdate.call(this);e.Component.FixedToCamera.postUpdate.call(this);if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false}for(var l=0;l<this.children.length;l++){this.children[l].postUpdate()}};e.Graphics.prototype.destroy=function(l){this.clear();e.Component.Destroy.prototype.destroy.call(this,l)};e.Graphics.prototype.drawTriangle=function(n,m){if(m===undefined){m=false}var r=new e.Polygon(n);if(m){var p=new e.Point(this.game.camera.x-n[0].x,this.game.camera.y-n[0].y);var o=new e.Point(n[1].x-n[0].x,n[1].y-n[0].y);var l=new e.Point(n[1].x-n[2].x,n[1].y-n[2].y);var q=l.cross(o);if(p.dot(q)>0){this.drawPolygon(r)}}else{this.drawPolygon(r)}};e.Graphics.prototype.drawTriangles=function(n,s,l){if(l===undefined){l=false}var r=new e.Point();var p=new e.Point();var m=new e.Point();var q=[];var o;if(!s){if(n[0] instanceof e.Point){for(o=0;o<n.length/3;o++){this.drawTriangle([n[o*3],n[o*3+1],n[o*3+2]],l)}}else{for(o=0;o<n.length/6;o++){r.x=n[o*6+0];r.y=n[o*6+1];p.x=n[o*6+2];p.y=n[o*6+3];m.x=n[o*6+4];m.y=n[o*6+5];this.drawTriangle([r,p,m],l)}}}else{if(n[0] instanceof e.Point){for(o=0;o<s.length/3;o++){q.push(n[s[o*3]]);q.push(n[s[o*3+1]]);q.push(n[s[o*3+2]]);if(q.length===3){this.drawTriangle(q,l);q=[]}}}else{for(o=0;o<s.length;o++){r.x=n[s[o]*2];r.y=n[s[o]*2+1];q.push(r.copyTo({}));if(q.length===3){this.drawTriangle(q,l);q=[]}}}}};e.Graphics.prototype.lineStyle=function(l,m,n){this.lineWidth=l||0;this.lineColor=m||0;this.lineAlpha=(n===undefined)?1:n;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};e.Graphics.prototype.moveTo=function(l,m){this.drawShape(new e.Polygon([l,m]));return this};e.Graphics.prototype.lineTo=function(l,m){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(l,m);this.dirty=true;this._boundsDirty=true;return this};e.Graphics.prototype.quadraticCurveTo=function(u,q,w,t){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var l,r,m=20,x=this.currentPath.shape.points;if(x.length===0){this.moveTo(0,0)}var v=x[x.length-2];var s=x[x.length-1];var o=0;for(var p=1;p<=m;++p){o=p/m;l=v+((u-v)*o);r=s+((q-s)*o);x.push(l+(((u+((w-u)*o))-l)*o),r+(((q+((t-q)*o))-r)*o))}this.dirty=true;this._boundsDirty=true;return this};e.Graphics.prototype.bezierCurveTo=function(z,v,y,r,B,x){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var p=20,m,o,l,u,t,C=this.currentPath.shape.points;var A=C[C.length-2];var w=C[C.length-1];var q=0;for(var s=1;s<=p;++s){q=s/p;m=(1-q);o=m*m;l=o*m;u=q*q;t=u*q;C.push(l*A+3*o*q*z+3*m*u*y+t*B,l*w+3*o*q*v+3*m*u*r+t*x)}this.dirty=true;this._boundsDirty=true;return this};e.Graphics.prototype.arcTo=function(H,r,G,p,s){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(H,r)}}else{this.moveTo(H,r)}var E=this.currentPath.shape.points,z=E[E.length-2],x=E[E.length-1],M=x-r,u=z-H,L=p-r,t=G-H,F=Math.abs(M*t-u*L);if(F<1e-8||s===0){if(E[E.length-2]!==H||E[E.length-1]!==r){E.push(H,r)}}else{var K=M*M+u*u,B=L*L+t*t,m=M*L+u*t,w=s*Math.sqrt(K)/F,v=s*Math.sqrt(B)/F,n=w*m/K,l=v*m/B,q=w*t+v*u,o=w*L+v*M,A=u*(v+n),y=M*(v+n),J=t*(w+l),I=L*(w+l),D=Math.atan2(y-o,A-q),C=Math.atan2(I-o,J-q);this.arc(q+H,o+r,s,D,C,u*L>t*M)}this.dirty=true;this._boundsDirty=true;return this};e.Graphics.prototype.arc=function(n,m,o,A,x,l,y){if(A===x){return this}if(l===undefined){l=false}if(y===undefined){y=40}if(!l&&x<=A){x+=Math.PI*2}else{if(l&&A<=x){A+=Math.PI*2}}var t=l?(A-x)*-1:(x-A);var w=Math.ceil(Math.abs(t)/(Math.PI*2))*y;if(t===0){return this}var G=n+Math.cos(A)*o;var E=m+Math.sin(A)*o;if(l&&this.filling){this.moveTo(n,m)}else{this.moveTo(G,E)}var D=this.currentPath.shape.points;var p=t/(w*2);var v=p*2;var z=Math.cos(p);var B=Math.sin(p);var I=w-1;var q=(I%1)/I;for(var C=0;C<=I;C++){var u=C+q*C;var F=((p)+A+(v*u));var H=Math.cos(F);var r=-Math.sin(F);D.push(((z*H)+(B*r))*o+n,((z*-r)+(B*H))*o+m)}this.dirty=true;this._boundsDirty=true;return this};e.Graphics.prototype.beginFill=function(l,m){this.filling=true;this.fillColor=l||0;this.fillAlpha=(m===undefined)?1:m;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};e.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};e.Graphics.prototype.drawRect=function(m,o,n,l){this.drawShape(new e.Rectangle(m,o,n,l));return this};e.Graphics.prototype.drawRoundedRect=function(n,p,o,m,l){this.drawShape(new e.RoundedRectangle(n,p,o,m,l));return this};e.Graphics.prototype.drawCircle=function(l,n,m){this.drawShape(new e.Circle(l,n,m));return this};e.Graphics.prototype.drawEllipse=function(m,o,n,l){this.drawShape(new e.Ellipse(m,o,n,l));return this};e.Graphics.prototype.drawPolygon=function(n){if(n instanceof e.Polygon){n=n.points}var m=n;if(!Array.isArray(m)){m=new Array(arguments.length);for(var l=0;l<m.length;++l){m[l]=arguments[l]}}this.drawShape(new e.Polygon(m));return this};e.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this._boundsDirty=true;this.clearDirty=true;this.graphicsData=[];this.updateLocalBounds();return this};e.Graphics.prototype.generateTexture=function(l,n,q){if(l===undefined){l=1}if(n===undefined){n=PIXI.scaleModes.DEFAULT}if(q===undefined){q=0}var p=this.getBounds();p.width+=q;p.height+=q;var m=new PIXI.CanvasBuffer(p.width*l,p.height*l);var o=PIXI.Texture.fromCanvas(m.canvas,n);o.baseTexture.resolution=l;m.context.scale(l,l);m.context.translate(-p.x,-p.y);PIXI.CanvasGraphics.renderGraphics(this,m.context);return o};e.Graphics.prototype._renderWebGL=function(m){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,m);return}else{m.spriteBatch.stop();m.blendModeManager.setBlendMode(this.blendMode);if(this._mask){m.maskManager.pushMask(this._mask,m)}if(this._filters){m.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==m.spriteBatch.currentBlendMode){m.spriteBatch.currentBlendMode=this.blendMode;var n=PIXI.blendModesWebGL[m.spriteBatch.currentBlendMode];m.spriteBatch.gl.blendFunc(n[0],n[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}PIXI.WebGLGraphics.renderGraphics(this,m);if(this.children.length){m.spriteBatch.start();for(var l=0;l<this.children.length;l++){this.children[l]._renderWebGL(m)}m.spriteBatch.stop()}if(this._filters){m.filterManager.popFilter()}if(this._mask){m.maskManager.popMask(this.mask,m)}m.drawCount++;m.spriteBatch.start()}};e.Graphics.prototype._renderCanvas=function(r){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,r);return}else{var q=r.context;var o=this.worldTransform;if(this.blendMode!==r.currentBlendMode){r.currentBlendMode=this.blendMode;q.globalCompositeOperation=PIXI.blendModesCanvas[r.currentBlendMode]}if(this._mask){r.maskManager.pushMask(this._mask,r)}var n=r.resolution;var m=(o.tx*r.resolution)+r.shakeX;var l=(o.ty*r.resolution)+r.shakeY;q.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,m,l);PIXI.CanvasGraphics.renderGraphics(this,q);for(var p=0;p<this.children.length;p++){this.children[p]._renderCanvas(r)}if(this._mask){r.maskManager.popMask(r)}}};e.Graphics.prototype.getBounds=function(w){if(this._currentBounds){return this._currentBounds}if(!this.renderable){return e.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var p=this._localBounds;var t=p.x;var s=p.width+p.x;var r=p.y;var q=p.height+p.y;var u=w||this.worldTransform;var I=u.a;var G=u.b;var F=u.c;var D=u.d;var J=u.tx;var H=u.ty;var z=I*s+F*q+J;var o=D*q+G*s+H;var y=I*t+F*q+J;var n=D*q+G*t+H;var x=I*t+F*r+J;var m=D*r+G*t+H;var v=I*s+F*r+J;var l=D*r+G*s+H;var C=z;var A=o;var E=z;var B=o;E=y<E?y:E;E=x<E?x:E;E=v<E?v:E;B=n<B?n:B;B=m<B?m:B;B=l<B?l:B;C=y>C?y:C;C=x>C?x:C;C=v>C?v:C;A=n>A?n:A;A=m>A?m:A;A=l>A?l:A;this._bounds.x=E;this._bounds.width=C-E;this._bounds.y=B;this._bounds.height=A-B;this._currentBounds=this._bounds;return this._currentBounds};e.Graphics.prototype.getLocalBounds=function(){var l=this.worldTransform;this.worldTransform=e.identityMatrix;for(var m=0;m<this.children.length;m++){this.children[m].updateTransform()}var n=this.getBounds();this.worldTransform=l;for(m=0;m<this.children.length;m++){this.children[m].updateTransform()}return n};e.Graphics.prototype.containsPoint=function(l,o){if(o===undefined){o=new e.Point()}this.worldTransform.applyInverse(l,o);var p=this.graphicsData;for(var m=0;m<p.length;m++){var n=p[m];if(!n.fill){continue}if(n.shape){if(n.shape.contains(o.x,o.y)){return true}}}return false};e.Graphics.prototype.updateLocalBounds=function(){var o=Infinity;var m=-Infinity;var n=Infinity;var l=-Infinity;if(this.graphicsData.length){var u,D,B,z,C,s;for(var r=0;r<this.graphicsData.length;r++){var q=this.graphicsData[r];var v=q.type;var t=q.lineWidth;u=q.shape;if(v===e.RECTANGLE||v===e.ROUNDEDRECTANGLE){B=u.x-t/2;z=u.y-t/2;C=u.width+t;s=u.height+t;o=B<o?B:o;m=B+C>m?B+C:m;n=z<n?z:n;l=z+s>l?z+s:l}else{if(v===e.CIRCLE){B=u.x;z=u.y;C=u.radius+t/2;s=u.radius+t/2;o=B-C<o?B-C:o;m=B+C>m?B+C:m;n=z-s<n?z-s:n;l=z+s>l?z+s:l}else{if(v===e.ELLIPSE){B=u.x;z=u.y;C=u.width+t/2;s=u.height+t/2;o=B-C<o?B-C:o;m=B+C>m?B+C:m;n=z-s<n?z-s:n;l=z+s>l?z+s:l}else{D=u.points;for(var p=0;p<D.length;p++){if(D[p] instanceof e.Point){B=D[p].x;z=D[p].y}else{B=D[p];z=D[p+1];if(p<D.length-1){p++}}o=B-t<o?B-t:o;m=B+t>m?B+t:m;n=z-t<n?z-t:n;l=z+t>l?z+t:l}}}}}}else{o=0;m=0;n=0;l=0}var A=this.boundsPadding;this._localBounds.x=o-A;this._localBounds.width=(m-o)+A*2;this._localBounds.y=n-A;this._localBounds.height=(l-n)+A*2};e.Graphics.prototype._generateCachedSprite=function(){var n=this.getLocalBounds();if(!this._cachedSprite){var l=new PIXI.CanvasBuffer(n.width,n.height);var m=PIXI.Texture.fromCanvas(l.canvas);this._cachedSprite=new PIXI.Sprite(m);this._cachedSprite.buffer=l;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(n.width,n.height)}this._cachedSprite.anchor.x=-(n.x/n.width);this._cachedSprite.anchor.y=-(n.y/n.height);this._cachedSprite.buffer.context.translate(-n.x,-n.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};e.Graphics.prototype.updateCachedSpriteTexture=function(){var n=this._cachedSprite;var m=n.texture;var l=n.buffer.canvas;m.baseTexture.width=l.width;m.baseTexture.height=l.height;m.crop.width=m.frame.width=l.width;m.crop.height=m.frame.height=l.height;n._width=l.width;n._height=l.height;m.baseTexture.dirty()};e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};e.Graphics.prototype.drawShape=function(l){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(l instanceof e.Polygon){l=l.clone();l.flatten()}var m=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,l);this.graphicsData.push(m);if(m.type===e.POLYGON){m.shape.closed=this.filling;this.currentPath=m}this.dirty=true;this._boundsDirty=true;return m};Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(l){this._cacheAsBitmap=l;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite()}this.dirty=true;this.webGLDirty=true}});e.RenderTexture=function(r,l,s,p,q,m,o,t){if(l===undefined){l=100}if(s===undefined){s=100}if(p===undefined){p=""}if(q===undefined){q=e.scaleModes.DEFAULT}if(m===undefined){m=1}if(o===undefined){o=PIXI.defaultRenderer}if(t===undefined){t=0}this.game=r;this.key=p;this.type=e.RENDERTEXTURE;this._tempMatrix=new e.Matrix();this.width=l;this.height=s;this.resolution=m;this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=this.frame.clone();this.baseTexture=new PIXI.BaseTexture();this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=q;this.baseTexture.hasLoaded=true;PIXI.Texture.call(this,this.baseTexture,this.frame.clone());this.renderer=o;if(this.renderer.type===e.WEBGL){var n=this.renderer.gl;this.baseTexture.textureIndex=t;this.baseTexture._dirty[n.id]=false;this.textureBuffer=new PIXI.FilterTexture(n,this.width,this.height,this.baseTexture.scaleMode,t);this.baseTexture._glTextures[n.id]=this.textureBuffer.texture;this.projection=new e.Point(this.width*0.5,-this.height*0.5)}else{this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this.tempMatrix=new e.Matrix();this._updateUvs()};e.RenderTexture.prototype=Object.create(PIXI.Texture.prototype);e.RenderTexture.prototype.constructor=e.RenderTexture;e.RenderTexture.prototype.renderXY=function(n,m,o,l){n.updateTransform();this._tempMatrix.copyFrom(n.worldTransform);this._tempMatrix.tx=m;this._tempMatrix.ty=o;if(this.renderer.type===e.WEBGL){this._renderWebGL(n,this._tempMatrix,l)}else{this._renderCanvas(n,this._tempMatrix,l)}};e.RenderTexture.prototype.renderRawXY=function(n,m,o,l){this._tempMatrix.identity().translate(m,o);if(this.renderer.type===e.WEBGL){this._renderWebGL(n,this._tempMatrix,l)}else{this._renderCanvas(n,this._tempMatrix,l)}};e.RenderTexture.prototype.render=function(n,m,l){if(m===undefined||m===null){this._tempMatrix.copyFrom(n.worldTransform)}else{this._tempMatrix.copyFrom(m)}if(this.renderer.type===e.WEBGL){this._renderWebGL(n,this._tempMatrix,l)}else{this._renderCanvas(n,this._tempMatrix,l)}};e.RenderTexture.prototype.resize=function(n,l,m){if(n===this.width&&l===this.height){return}this.valid=(n>0&&l>0);this.width=n;this.height=l;this.frame.width=this.crop.width=n*this.resolution;this.frame.height=this.crop.height=l*this.resolution;if(m){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===e.WEBGL){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid){return}this.textureBuffer.resize(this.width,this.height)};e.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===e.WEBGL){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};e.RenderTexture.prototype._renderWebGL=function(q,n,m){if(!this.valid||q.alpha===0){return}var l=q.worldTransform;l.identity();l.translate(0,this.projection.y*2);if(n){l.append(n)}l.scale(1,-1);for(var o=0;o<q.children.length;o++){q.children[o].updateTransform()}var p=this.renderer.gl;p.viewport(0,0,this.width*this.resolution,this.height*this.resolution);p.bindFramebuffer(p.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(m){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(q,this.projection,this.textureBuffer.frameBuffer,n);this.renderer.spriteBatch.dirty=true;p.bindFramebuffer(p.FRAMEBUFFER,null)};e.RenderTexture.prototype._renderCanvas=function(q,n,m){if(!this.valid||q.alpha===0){return}var l=q.worldTransform;l.identity();if(n){l.append(n)}for(var o=0;o<q.children.length;o++){q.children[o].updateTransform()}if(m){this.textureBuffer.clear()}var p=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(q,this.textureBuffer.context,n);this.renderer.resolution=p};e.RenderTexture.prototype.getImage=function(){var l=new Image();l.src=this.getBase64();return l};e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL){var q=this.renderer.gl;var o=this.textureBuffer.width;var l=this.textureBuffer.height;var m=new Uint8Array(4*o*l);q.bindFramebuffer(q.FRAMEBUFFER,this.textureBuffer.frameBuffer);q.readPixels(0,0,o,l,q.RGBA,q.UNSIGNED_BYTE,m);q.bindFramebuffer(q.FRAMEBUFFER,null);var p=new PIXI.CanvasBuffer(o,l);var n=p.context.getImageData(0,0,o,l);n.data.set(m);p.context.putImageData(n,0,0);return p.canvas}else{return this.textureBuffer.canvas}};e.Text=function(m,l,p,o,n){l=l||0;p=p||0;if(o===undefined||o===null){o=""}else{o=o.toString()}n=e.Utils.extend({},n);this.type=e.TEXT;this.physicsType=e.SPRITE;this.padding=new e.Point();this.textBounds=null;this.canvas=e.CanvasPool.create(this);this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this.splitRegExp=/(?:\r\n|\r|\n)/;this.characterLimitSize=-1;this.characterLimitSuffix="";this._res=m.renderer.resolution;this._text=o;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;e.Sprite.call(this,m,l,p,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(n);if(o!==""){this.updateText()}};e.Text.prototype=Object.create(e.Sprite.prototype);e.Text.prototype.constructor=e.Text;e.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.Text.prototype.update=function(){};e.Text.prototype.destroy=function(l){this.texture.destroy(true);e.Component.Destroy.prototype.destroy.call(this,l)};e.Text.prototype.setShadow=function(l,q,m,n,p,o){if(l===undefined){l=0}if(q===undefined){q=0}if(m===undefined){m="rgba(0, 0, 0, 1)"}if(n===undefined){n=0}if(p===undefined){p=true}if(o===undefined){o=true}this.style.shadowOffsetX=l;this.style.shadowOffsetY=q;this.style.shadowColor=m;this.style.shadowBlur=n;this.style.shadowStroke=p;this.style.shadowFill=o;this.dirty=true;return this};e.Text.prototype.setStyle=function(l,o){if(o===undefined){o=false}var n=Object.assign({},l);n.font=l.font||"bold 20pt Arial";n.backgroundColor=l.backgroundColor||null;n.fill=l.fill||"black";n.align=(l.align||"left").toLowerCase();n.boundsAlignH=(l.boundsAlignH||"left").toLowerCase();n.boundsAlignV=(l.boundsAlignV||"top").toLowerCase();n.stroke=l.stroke||"black";n.strokeThickness=Number(l.strokeThickness)||0;n.wordWrap=l.wordWrap||false;n.wordWrapWidth=l.wordWrapWidth||100;n.maxLines=l.maxLines||0;n.shadowOffsetX=l.shadowOffsetX||0;n.shadowOffsetY=l.shadowOffsetY||0;n.shadowColor=l.shadowColor||"rgba(0,0,0,0)";n.shadowBlur=l.shadowBlur||0;n.tabs=l.tabs||0;var m=this.fontToComponents(n.font);if(n.fontStyle){m.fontStyle=n.fontStyle}if(n.fontVariant){m.fontVariant=n.fontVariant}if(n.fontWeight){m.fontWeight=n.fontWeight}if(n.fontSize){if(typeof n.fontSize==="number"){n.fontSize=n.fontSize+"px"}m.fontSize=n.fontSize}this._fontComponents=m;n.font=this.componentsToFont(this._fontComponents);this.style=n;this.dirty=true;if(o){this.updateText()}return this};e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var x=this.text;if(this.characterLimitSize>-1&&this.characterLimitSize<x.length){x=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix}if(this.style.wordWrap){x=this.runWordWrap(this.text)}var m=x.split(this.splitRegExp);var A=this.style.tabs;var D=[];var y=0;var r=this.determineFontProperties(this.style.font);var s=m.length;if(this.style.maxLines>0&&this.style.maxLines<m.length){s=this.style.maxLines}this._charCount=0;for(var z=0;z<s;z++){if(A===0){var l=this.style.strokeThickness+this.padding.x;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){l+=this.measureLine(m[z])}else{l+=this.context.measureText(m[z]).width}if(this.style.wordWrap){l-=this.context.measureText(" ").width}}else{var u=m[z].split(/(?:\t)/);var l=this.padding.x+this.style.strokeThickness;if(Array.isArray(A)){var n=0;for(var C=0;C<u.length;C++){var t=0;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){t=this.measureLine(u[C])}else{t=Math.ceil(this.context.measureText(u[C]).width)}if(C>0){n+=A[C-1]}l=n+t}}else{for(var C=0;C<u.length;C++){if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){l+=this.measureLine(u[C])}else{l+=Math.ceil(this.context.measureText(u[C]).width)}var v=this.game.math.snapToCeil(l,A)-l;l+=v}}}D[z]=Math.ceil(l);y=Math.max(y,D[z])}this.canvas.width=y*this._res;var o=r.fontSize+this.style.strokeThickness+this.padding.y;var w=o*s;var B=this._lineSpacing;if(B<0&&Math.abs(B)>o){B=-o}if(B!==0){w+=(B>0)?B*m.length:B*(m.length-1)}this.canvas.height=w*this._res;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var q;var p;this._charCount=0;for(z=0;z<s;z++){q=this.style.strokeThickness/2;p=(this.style.strokeThickness/2+z*o)+r.ascent;if(z>0){p+=(B*z)}if(this.style.align==="right"){q+=y-D[z]}else{if(this.style.align==="center"){q+=(y-D[z])/2}}if(this.autoRound){q=Math.round(q);p=Math.round(p)}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(m[z],q,p)}else{if(this.style.stroke&&this.style.strokeThickness){this.updateShadow(this.style.shadowStroke);if(A===0){this.context.strokeText(m[z],q,p)}else{this.renderTabLine(m[z],q,p,false)}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(A===0){this.context.fillText(m[z],q,p)}else{this.renderTabLine(m[z],q,p,true)}}}}this.updateTexture();this.dirty=false};e.Text.prototype.renderTabLine=function(u,q,o,t){var s=u.split(/(?:\t)/);var p=this.style.tabs;var m=0;if(Array.isArray(p)){var l=0;for(var n=0;n<s.length;n++){if(n>0){l+=p[n-1]}m=q+l;if(t){this.context.fillText(s[n],m,o)}else{this.context.strokeText(s[n],m,o)}}}else{for(var n=0;n<s.length;n++){var r=Math.ceil(this.context.measureText(s[n]).width);m=this.game.math.snapToCeil(q,p);if(t){this.context.fillText(s[n],m,o)}else{this.context.strokeText(s[n],m,o)}q=m+r}}};e.Text.prototype.updateShadow=function(l){if(l){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0}};e.Text.prototype.measureLine=function(m){var l=0;for(var n=0;n<m.length;n++){var p=m[n];if(this.fontWeights.length>0||this.fontStyles.length>0){var o=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){o.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){o.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(o)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill)}l+=this.context.measureText(p).width;this._charCount++}return Math.ceil(l)};e.Text.prototype.updateLine=function(m,l,q){for(var n=0;n<m.length;n++){var p=m[n];if(this.fontWeights.length>0||this.fontStyles.length>0){var o=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){o.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){o.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(o)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke);this.context.strokeText(p,l,q)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill);this.context.fillText(p,l,q)}l+=this.context.measureText(p).width;this._charCount++}};e.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this};e.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this};e.Text.prototype.addColor=function(m,l){this.colors[l]=m;this.dirty=true;return this};e.Text.prototype.addStrokeColor=function(m,l){this.strokeColors[l]=m;this.dirty=true;return this};e.Text.prototype.addFontStyle=function(m,l){this.fontStyles[l]=m;this.dirty=true;return this};e.Text.prototype.addFontWeight=function(m,l){this.fontWeights[l]=m;this.dirty=true;return this};e.Text.prototype.precalculateWordWrap=function(m){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var l=this.runWordWrap(m);return l.split(/(?:\r\n|\r|\n)/)};e.Text.prototype.runWordWrap=function(l){if(this.useAdvancedWrap){return this.advancedWordWrap(l)}else{return this.basicWordWrap(l)}};e.Text.prototype.advancedWordWrap=function(v){var o=this.context;var w=this.style.wordWrapWidth;var r="";var n=v.replace(/ +/gi," ").split(/\r?\n/gi);var C=n.length;for(var A=0;A<C;A++){var s=n[A];var B="";s=s.replace(/^ *|\s*$/gi,"");var m=o.measureText(s).width;if(m<w){r+=s+"\n";continue}var y=w;var x=s.split(" ");for(var z=0;z<x.length;z++){var D=x[z];var l=D+" ";var E=o.measureText(l).width;if(E>y){if(z===0){var p=l;while(p.length){p=p.slice(0,-1);E=o.measureText(p).width;if(E<=y){break}}if(!p.length){throw new Error("This text's wordWrapWidth setting is less than a single character!")}var t=D.substr(p.length);x[z]=t;B+=p}var q=(x[z].length)?z:z+1;var u=x.slice(q).join(" ").replace(/[ \n]*$/gi,"");n[A+1]=u+" "+(n[A+1]||"");C=n.length;break}else{B+=l;y-=E}}r+=B.replace(/[ \n]*$/gi,"")+"\n"}r=r.replace(/[\s|\n]*$/gi,"");return r};e.Text.prototype.basicWordWrap=function(q){var t="";var s=q.split("\n");for(var n=0;n<s.length;n++){var m=this.style.wordWrapWidth;var p=s[n].split(" ");for(var l=0;l<p.length;l++){var r=this.context.measureText(p[l]).width;var o=r+this.context.measureText(" ").width;if(o>m){if(l>0){t+="\n"}t+=p[l]+" ";m=this.style.wordWrapWidth-r}else{m-=o;t+=p[l]+" "}}if(n<s.length-1){t+="\n"}}return t};e.Text.prototype.updateFont=function(m){var l=this.componentsToFont(m);if(this.style.font!==l){this.style.font=l;this.dirty=true;if(this.parent){this.updateTransform()}}};e.Text.prototype.fontToComponents=function(n){var l=n.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(l){var o=l[5].trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(o)&&!/['",]/.exec(o)){o="'"+o+"'"}return{font:n,fontStyle:l[1]||"normal",fontVariant:l[2]||"normal",fontWeight:l[3]||"normal",fontSize:l[4]||"medium",fontFamily:o}}else{console.warn("Phaser.Text - unparsable CSS font: "+n);return{font:n}}};e.Text.prototype.componentsToFont=function(m){var n=[];var l;l=m.fontStyle;if(l&&l!=="normal"){n.push(l)}l=m.fontVariant;if(l&&l!=="normal"){n.push(l)}l=m.fontWeight;if(l&&l!=="normal"){n.push(l)}l=m.fontSize;if(l&&l!=="medium"){n.push(l)}l=m.fontFamily;if(l){n.push(l)}if(!n.length){n.push(m.font)}return n.join(" ")};e.Text.prototype.setText=function(m,l){if(l===undefined){l=false}this.text=m.toString()||"";if(l){this.updateText()}else{this.dirty=true}return this};e.Text.prototype.parseList=function(n){if(!Array.isArray(n)){return this}else{var m="";for(var l=0;l<n.length;l++){if(Array.isArray(n[l])){m+=n[l].join("\t");if(l<n.length-1){m+="\n"}}else{m+=n[l];if(l<n.length-1){m+="\t"}}}}this.text=m;this.dirty=true;return this};e.Text.prototype.setTextBounds=function(m,o,n,l){if(m===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new e.Rectangle(m,o,n,l)}else{this.textBounds.setTo(m,o,n,l)}if(this.style.wordWrapWidth>n){this.style.wordWrapWidth=n}}this.updateTexture();return this};e.Text.prototype.updateTexture=function(){var p=this.texture.baseTexture;var o=this.texture.crop;var q=this.texture.frame;var m=this.canvas.width;var n=this.canvas.height;p.width=m;p.height=n;o.width=m;o.height=n;q.width=m;q.height=n;this.texture.width=m;this.texture.height=n;this._width=m;this._height=n;if(this.textBounds){var l=this.textBounds.x;var r=this.textBounds.y;if(this.style.boundsAlignH==="right"){l+=this.textBounds.width-this.canvas.width/this.resolution}else{if(this.style.boundsAlignH==="center"){l+=this.textBounds.halfWidth-(this.canvas.width/this.resolution/2)}}if(this.style.boundsAlignV==="bottom"){r+=this.textBounds.height-this.canvas.height/this.resolution}else{if(this.style.boundsAlignV==="middle"){r+=this.textBounds.halfHeight-(this.canvas.height/this.resolution/2)}}this.pivot.x=-l;this.pivot.y=-r}this.renderable=(m!==0&&n!==0);this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};e.Text.prototype._renderWebGL=function(l){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,l)};e.Text.prototype._renderCanvas=function(l){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,l)};e.Text.prototype.determineFontProperties=function(q){var t=e.Text.fontPropertiesCache[q];if(!t){t={};var n=e.Text.fontPropertiesCanvas;var m=e.Text.fontPropertiesContext;m.font=q;var l=Math.ceil(m.measureText("|MÉq").width);var s=Math.ceil(m.measureText("|MÉq").width);var x=2*s;s=s*1.4|0;n.width=l;n.height=x;m.fillStyle="#f00";m.fillRect(0,0,l,x);m.font=q;m.textBaseline="alphabetic";m.fillStyle="#000";m.fillText("|MÉq",0,s);if(!m.getImageData(0,0,l,x)){t.ascent=s;t.descent=s+6;t.fontSize=t.ascent+t.descent;e.Text.fontPropertiesCache[q]=t;return t}var u=m.getImageData(0,0,l,x).data;var o=u.length;var y=l*4;var r,p;var w=0;var v=false;for(r=0;r<s;r++){for(p=0;p<y;p+=4){if(u[w+p]!==255){v=true;break}}if(!v){w+=y}else{break}}t.ascent=s-r;w=o-y;v=false;for(r=x;r>s;r--){for(p=0;p<y;p+=4){if(u[w+p]!==255){v=true;break}}if(!v){w-=y}else{break}}t.descent=r-s;t.descent+=6;t.fontSize=t.ascent+t.descent;e.Text.fontPropertiesCache[q]=t}return t};e.Text.prototype.getBounds=function(l){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,l)};e.Text.prototype.setCharacterLimit=function(m,l){this.characterLimitSuffix=(l===undefined)?"":l;this.characterLimitSize=m;this.updateText()};Object.defineProperty(e.Text.prototype,"text",{get:function(){return this._text},set:function(l){if(l!==this._text){this._text=l.toString()||"";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(e.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(l){l=l||"bold 20pt Arial";this._fontComponents=this.fontToComponents(l);this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(l){l=l||"Arial";l=l.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(l)&&!/['",]/.exec(l)){l="'"+l+"'"}this._fontComponents.fontFamily=l;this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"fontSize",{get:function(){var l=this._fontComponents.fontSize;if(l&&/(?:^0$|px$)/.exec(l)){return parseInt(l,10)}else{return l}},set:function(l){l=l||"0";if(typeof l==="number"){l=l+"px"}this._fontComponents.fontSize=l;this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(l){l=l||"normal";this._fontComponents.fontWeight=l;this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(l){l=l||"normal";this._fontComponents.fontStyle=l;this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(l){l=l||"normal";this._fontComponents.fontVariant=l;this.updateFont(this._fontComponents)}});Object.defineProperty(e.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(l){if(l!==this.style.fill){this.style.fill=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"align",{get:function(){return this.style.align},set:function(l){l=l.toLowerCase();if(l!==this.style.align){this.style.align=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"resolution",{get:function(){return this._res},set:function(l){if(l!==this._res){this._res=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(l){if(l!==this.style.tabs){this.style.tabs=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(l){l=l.toLowerCase();if(l!==this.style.boundsAlignH){this.style.boundsAlignH=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(l){l=l.toLowerCase();if(l!==this.style.boundsAlignV){this.style.boundsAlignV=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(l){if(l!==this.style.stroke){this.style.stroke=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(l){if(l!==this.style.strokeThickness){this.style.strokeThickness=Number(l);this.dirty=true}}});Object.defineProperty(e.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(l){if(l!==this.style.wordWrap){this.style.wordWrap=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(l){if(l!==this.style.wordWrapWidth){this.style.wordWrapWidth=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(l){if(l!==this._lineSpacing){this._lineSpacing=parseFloat(l);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(e.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(l){if(l!==this.style.shadowOffsetX){this.style.shadowOffsetX=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(l){if(l!==this.style.shadowOffsetY){this.style.shadowOffsetY=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(l){if(l!==this.style.shadowColor){this.style.shadowColor=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(l){if(l!==this.style.shadowBlur){this.style.shadowBlur=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(l){if(l!==this.style.shadowStroke){this.style.shadowStroke=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(l){if(l!==this.style.shadowFill){this.style.shadowFill=l;this.dirty=true}}});Object.defineProperty(e.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*(this.texture.frame.width/this.resolution)},set:function(l){this.scale.x=l/this.texture.frame.width;this._width=l}});Object.defineProperty(e.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*(this.texture.frame.height/this.resolution)},set:function(l){this.scale.y=l/this.texture.frame.height;this._height=l}});e.Text.fontPropertiesCache={};e.Text.fontPropertiesCanvas=document.createElement("canvas");e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d");e.BitmapText=function(n,l,r,m,p,o,q){l=l||0;r=r||0;m=m||"";p=p||"";o=o||32;q=q||"left";PIXI.DisplayObjectContainer.call(this);this.type=e.BITMAPTEXT;this.physicsType=e.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new e.Point();this._prevAnchor=new e.Point();this._glyphs=[];this._maxWidth=0;this._text=p.toString()||"";this._data=n.cache.getBitmapFont(m);this._font=m;this._fontSize=o;this._align=q;this._tint=16777215;this.updateText();this.dirty=false;e.Component.Core.init.call(this,n,l,r,"",null)};e.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);e.BitmapText.prototype.constructor=e.BitmapText;e.Component.Core.install.call(e.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);e.BitmapText.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.BitmapText.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.BitmapText.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.BitmapText.prototype.preUpdateCore=e.Component.Core.preUpdate;e.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.BitmapText.prototype.postUpdate=function(){e.Component.PhysicsBody.postUpdate.call(this);e.Component.FixedToCamera.postUpdate.call(this);if(this.body&&this.body.type===e.Physics.ARCADE){if((this.textWidth!==this.body.sourceWidth)||(this.textHeight!==this.body.sourceHeight)){this.body.setSize(this.textWidth,this.textHeight)}}};e.BitmapText.prototype.setText=function(l){this.text=l};e.BitmapText.prototype.scanLine=function(q,n,B){var v=0;var y=0;var C=-1;var l=0;var s=null;var z=(this._maxWidth>0)?this._maxWidth:null;var u=[];for(var p=0;p<B.length;p++){var o=(p===B.length-1)?true:false;if(/(?:\r\n|\r|\n)/.test(B.charAt(p))){return{width:y,text:B.substr(0,p),end:o,chars:u}}else{var A=B.charCodeAt(p);var m=q.chars[A];var t=0;if(m===undefined){A=32;m=q.chars[A]}var r=(s&&m.kerning[s])?m.kerning[s]:0;if(/(\s)/.test(B.charAt(p))){C=p;l=y}t=(r+m.texture.width+m.xOffset)*n;if(z&&((y+t)>=z)&&C>-1){return{width:l||y,text:B.substr(0,p-(p-C)),end:o,chars:u}}else{y+=(m.xAdvance+r)*n;u.push(v+(m.xOffset+r)*n);v+=(m.xAdvance+r)*n;s=A}}}return{width:y,text:B,end:o,chars:u}};e.BitmapText.prototype.cleanText=function(q,l){if(l===undefined){l=""}var n=this._data.font;if(!n){return""}var r=/\r\n|\n\r|\n|\r/g;var s=q.replace(r,"\n").split("\n");for(var o=0;o<s.length;o++){var m="";var t=s[o];for(var p=0;p<t.length;p++){if(n.chars[t.charCodeAt(p)]){m=m.concat(t[p])}else{m=m.concat(l)}}s[o]=m}return s.join("\n")};e.BitmapText.prototype.updateText=function(){var p=this._data.font;if(!p){return}var w=this.text;var n=this._fontSize/p.size;var A=[];var u=0;this.textWidth=0;do{var B=this.scanLine(p,n,w);B.y=u;A.push(B);if(B.width>this.textWidth){this.textWidth=B.width}u+=(p.lineHeight*n);w=w.substr(B.text.length+1)}while(B.end===false);this.textHeight=u;var x=0;var r=0;var l=this.textWidth*this.anchor.x;var z=this.textHeight*this.anchor.y;for(var o=0;o<A.length;o++){var B=A[o];if(this._align==="right"){r=this.textWidth-B.width}else{if(this._align==="center"){r=(this.textWidth-B.width)/2}}for(var s=0;s<B.text.length;s++){var v=B.text.charCodeAt(s);var m=p.chars[v];if(m===undefined){v=32;m=p.chars[v]}var q=this._glyphs[x];if(q){q.texture=m.texture}else{q=new PIXI.Sprite(m.texture);q.name=B.text[s];this._glyphs.push(q)}q.position.x=(B.chars[s]+r)-l;q.position.y=(B.y+(m.yOffset*n))-z;q.scale.set(n);q.tint=this.tint;q.texture.requiresReTint=true;q.cachedTint=16777215;if(!q.parent){this.addChild(q)}x++}}for(o=x;o<this._glyphs.length;o++){this.removeChild(this._glyphs[o])}};e.BitmapText.prototype.purgeGlyphs=function(){var l=this._glyphs.length;var n=[];for(var m=0;m<this._glyphs.length;m++){if(this._glyphs[m].parent!==this){this._glyphs[m].destroy()}else{n.push(this._glyphs[m])}}this._glyphs=[];this._glyphs=n;this.updateText();return l-n.length};e.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(e.BitmapText.prototype,"align",{get:function(){return this._align},set:function(l){if(l!==this._align&&(l==="left"||l==="center"||l==="right")){this._align=l;this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(l){if(l!==this._tint){this._tint=l;this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"font",{get:function(){return this._font},set:function(l){if(l!==this._font){this._font=l.trim();this._data=this.game.cache.getBitmapFont(this._font);this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(l){l=parseInt(l,10);if(l!==this._fontSize&&l>0){this._fontSize=l;this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"text",{get:function(){return this._text},set:function(l){if(l!==this._text){this._text=l.toString()||"";this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(l){if(l!==this._maxWidth){this._maxWidth=l;this.updateText()}}});Object.defineProperty(e.BitmapText.prototype,"smoothed",{get:function(){return !this._data.base.scaleMode},set:function(l){if(l){this._data.base.scaleMode=0}else{this._data.base.scaleMode=1}}});e.RetroFont=function(A,z,m,s,w,y,x,u,t,q){if(!A.cache.checkImageKey(z)){return false}if(y===undefined||y===null){y=A.cache.getImage(z).width/m}this.characterWidth=m;this.characterHeight=s;this.characterSpacingX=x||0;this.characterSpacingY=u||0;this.characterPerRow=y;this.offsetX=t||0;this.offsetY=q||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=A.cache.getImage(z);this._text="";this.grabData=[];this.frameData=new e.FrameData();var p=this.offsetX;var o=this.offsetY;var l=0;for(var v=0;v<w.length;v++){var n=this.frameData.addFrame(new e.Frame(v,p,o,this.characterWidth,this.characterHeight));this.grabData[w.charCodeAt(v)]=n.index;l++;if(l===this.characterPerRow){l=0;p=this.offsetX;o+=this.characterHeight+this.characterSpacingY}else{p+=this.characterWidth+this.characterSpacingX}}A.cache.updateFrameData(z,this.frameData);this.stamp=new e.Image(A,0,0,z,0);e.RenderTexture.call(this,A,100,100,"",e.scaleModes.NEAREST);this.type=e.RETROFONT};e.RetroFont.prototype=Object.create(e.RenderTexture.prototype);e.RetroFont.prototype.constructor=e.RetroFont;e.RetroFont.ALIGN_LEFT="left";e.RetroFont.ALIGN_RIGHT="right";e.RetroFont.ALIGN_CENTER="center";e.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";e.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";e.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";e.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";e.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";e.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";e.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";e.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";e.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";e.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";e.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";e.RetroFont.prototype.setFixedWidth=function(m,l){if(l===undefined){l="left"}this.fixedWidth=m;this.align=l};e.RetroFont.prototype.setText=function(o,p,n,q,m,l){this.multiLine=p||false;this.customSpacingX=n||0;this.customSpacingY=q||0;this.align=m||"left";if(l){this.autoUpperCase=false}else{this.autoUpperCase=true}if(o.length>0){this.text=o}};e.RetroFont.prototype.buildRetroFontText=function(){var l=0;var o=0;this.clear();if(this.multiLine){var m=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(m.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(m.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var n=0;n<m.length;n++){l=0;if(this.align===e.RetroFont.ALIGN_RIGHT){l=this.width-(m[n].length*(this.characterWidth+this.customSpacingX))}else{if(this.align===e.RetroFont.ALIGN_CENTER){l=(this.width/2)-((m[n].length*(this.characterWidth+this.customSpacingX))/2);l+=this.customSpacingX/2}}if(l<0){l=0}this.pasteLine(m[n],l,o,this.customSpacingX);o+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}l=0;if(this.align===e.RetroFont.ALIGN_RIGHT){l=this.width-(this._text.length*(this.characterWidth+this.customSpacingX))}else{if(this.align===e.RetroFont.ALIGN_CENTER){l=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);l+=this.customSpacingX/2}}if(l<0){l=0}this.pasteLine(this._text,l,0,this.customSpacingX)}this.requiresReTint=true};e.RetroFont.prototype.pasteLine=function(m,l,p,n){for(var o=0;o<m.length;o++){if(m.charAt(o)===" "){l+=this.characterWidth+n}else{if(this.grabData[m.charCodeAt(o)]>=0){this.stamp.frame=this.grabData[m.charCodeAt(o)];this.renderXY(this.stamp,l,p,false);l+=this.characterWidth+n;if(l>this.width){break}}}}};e.RetroFont.prototype.getLongestLine=function(){var m=0;if(this._text.length>0){var l=this._text.split("\n");for(var n=0;n<l.length;n++){if(l[n].length>m){m=l[n].length}}}return m};e.RetroFont.prototype.removeUnsupportedCharacters=function(o){var m="";for(var p=0;p<this._text.length;p++){var l=this._text[p];var n=l.charCodeAt(0);if(this.grabData[n]>=0||(!o&&l==="\n")){m=m.concat(l)}}return m};e.RetroFont.prototype.updateOffset=function(l,q){if(this.offsetX===l&&this.offsetY===q){return}var n=l-this.offsetX;var m=q-this.offsetY;var p=this.game.cache.getFrameData(this.stamp.key).getFrames();var o=p.length;while(o--){p[o].x+=n;p[o].y+=m}this.buildRetroFontText()};Object.defineProperty(e.RetroFont.prototype,"text",{get:function(){return this._text},set:function(m){var l;if(this.autoUpperCase){l=m.toUpperCase()}else{l=m}if(l!==this._text){this._text=l;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(e.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(l){this.stamp.smoothed=l;this.buildRetroFontText()}});e.Rope=function(m,l,q,n,p,o){this.points=[];this.points=o;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;l=l||0;q=q||0;n=n||null;p=p||null;this.type=e.ROPE;this.points=o;PIXI.DisplayObjectContainer.call(this);this.texture=e.Cache.DEFAULT;this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new Float32Array([0,0,100,0,100,100,0,100]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3]);if(o){this.vertices=new Float32Array(o.length*4);this.uvs=new Float32Array(o.length*4);this.colors=new Float32Array(o.length*2);this.indices=new Uint16Array(o.length*2)}this.dirty=true;this.canvasPadding=0;this.drawMode=e.Rope.TRIANGLE_STRIP;e.Component.Core.init.call(this,m,l,q,n,p);this.refresh()};e.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);e.Rope.prototype.constructor=e.Rope;e.Component.Core.install.call(e.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);e.Rope.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.Rope.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Rope.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Rope.prototype.preUpdateCore=e.Component.Core.preUpdate;e.Rope.TRIANGLE_STRIP=0;e.Rope.TRIANGLES=1;e.Rope.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};e.Rope.prototype.reset=function(l,m){e.Component.Reset.prototype.reset.call(this,l,m);return this};e.Rope.prototype.refresh=function(){var q=this.points;if(q.length<1){return}var p=this.uvs;var s=this.indices;var l=this.colors;this.count-=0.2;p[0]=0;p[1]=0;p[2]=0;p[3]=1;l[0]=1;l[1]=1;s[0]=0;s[1]=1;var r=q.length;var m;var o;for(var n=1;n<r;n++){m=n*4;o=n/(r-1);if(n%2){p[m]=o;p[m+1]=0;p[m+2]=o;p[m+3]=1}else{p[m]=o;p[m+1]=0;p[m+2]=o;p[m+3]=1}m=n*2;l[m]=1;l[m+1]=1;m=n*2;s[m]=m;s[m+1]=m+1}};e.Rope.prototype.updateTransform=function(){var w=this.points;if(w.length<1){return}var u=w[0];var s;var l={x:0,y:0};this.count-=0.2;var q=this.vertices;var t=w.length;var v;var p;var r;var m;var o;for(var n=0;n<t;n++){v=w[n];p=n*4;if(n<w.length-1){s=w[n+1]}else{s=v}l.y=-(s.x-u.x);l.x=s.y-u.y;r=(1-(n/(t-1)))*10;if(r>1){r=1}m=Math.sqrt((l.x*l.x)+(l.y*l.y));o=this.texture.height/2;l.x/=m;l.y/=m;l.x*=o;l.y*=o;q[p]=v.x+l.x;q[p+1]=v.y+l.y;q[p+2]=v.x-l.x;q[p+3]=v.y-l.y;u=v}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};e.Rope.prototype.setTexture=function(l){this.texture=l};e.Rope.prototype._renderWebGL=function(l){if(!this.visible||this.alpha<=0){return}l.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(l)}l.shaderManager.setShader(l.shaderManager.stripShader);this._renderStrip(l);l.spriteBatch.start()};e.Rope.prototype._initWebGL=function(l){var m=l.gl;this._vertexBuffer=m.createBuffer();this._indexBuffer=m.createBuffer();this._uvBuffer=m.createBuffer();this._colorBuffer=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,this._vertexBuffer);m.bufferData(m.ARRAY_BUFFER,this.vertices,m.DYNAMIC_DRAW);m.bindBuffer(m.ARRAY_BUFFER,this._uvBuffer);m.bufferData(m.ARRAY_BUFFER,this.uvs,m.STATIC_DRAW);m.bindBuffer(m.ARRAY_BUFFER,this._colorBuffer);m.bufferData(m.ARRAY_BUFFER,this.colors,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,this._indexBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,this.indices,m.STATIC_DRAW)};e.Rope.prototype._renderStrip=function(o){var q=o.gl;var l=o.projection;var p=o.offset;var m=o.shaderManager.stripShader;var n=(this.drawMode===e.Rope.TRIANGLE_STRIP)?q.TRIANGLE_STRIP:q.TRIANGLES;o.blendModeManager.setBlendMode(this.blendMode);q.uniformMatrix3fv(m.translationMatrix,false,this.worldTransform.toArray(true));q.uniform2f(m.projectionVector,l.x,-l.y);q.uniform2f(m.offsetVector,-p.x,-p.y);q.uniform1f(m.alpha,this.worldAlpha);if(!this.dirty){q.bindBuffer(q.ARRAY_BUFFER,this._vertexBuffer);q.bufferSubData(q.ARRAY_BUFFER,0,this.vertices);q.vertexAttribPointer(m.aVertexPosition,2,q.FLOAT,false,0,0);q.bindBuffer(q.ARRAY_BUFFER,this._uvBuffer);q.vertexAttribPointer(m.aTextureCoord,2,q.FLOAT,false,0,0);q.activeTexture(q.TEXTURE0);if(this.texture.baseTexture._dirty[q.id]){o.renderer.updateTexture(this.texture.baseTexture)}else{q.bindTexture(q.TEXTURE_2D,this.texture.baseTexture._glTextures[q.id])}q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;q.bindBuffer(q.ARRAY_BUFFER,this._vertexBuffer);q.bufferData(q.ARRAY_BUFFER,this.vertices,q.STATIC_DRAW);q.vertexAttribPointer(m.aVertexPosition,2,q.FLOAT,false,0,0);q.bindBuffer(q.ARRAY_BUFFER,this._uvBuffer);q.bufferData(q.ARRAY_BUFFER,this.uvs,q.STATIC_DRAW);q.vertexAttribPointer(m.aTextureCoord,2,q.FLOAT,false,0,0);q.activeTexture(q.TEXTURE0);if(this.texture.baseTexture._dirty[q.id]){o.renderer.updateTexture(this.texture.baseTexture)}else{q.bindTexture(q.TEXTURE_2D,this.texture.baseTexture._glTextures[q.id])}q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,this._indexBuffer);q.bufferData(q.ELEMENT_ARRAY_BUFFER,this.indices,q.STATIC_DRAW)}q.drawElements(n,this.indices.length,q.UNSIGNED_SHORT,0)};e.Rope.prototype._renderCanvas=function(p){var o=p.context;var n=this.worldTransform;var m=(n.tx*p.resolution)+p.shakeX;var l=(n.ty*p.resolution)+p.shakeY;if(p.roundPixels){o.setTransform(n.a,n.b,n.c,n.d,m|0,l|0)}else{o.setTransform(n.a,n.b,n.c,n.d,m,l)}if(this.drawMode===e.Rope.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(o)}else{this._renderCanvasTriangles(o)}};e.Rope.prototype._renderCanvasTriangleStrip=function(p){var m=this.vertices;var o=this.uvs;var q=m.length/2;this.count++;for(var n=0;n<q-2;n++){var l=n*2;this._renderCanvasDrawTriangle(p,m,o,l,(l+2),(l+4))}};e.Rope.prototype._renderCanvasTriangles=function(l){var q=this.vertices;var n=this.uvs;var t=this.indices;var m=t.length;this.count++;for(var o=0;o<m;o+=3){var s=t[o]*2;var r=t[o+1]*2;var p=t[o+2]*2;this._renderCanvasDrawTriangle(l,q,n,s,r,p)}};e.Rope.prototype._renderCanvasDrawTriangle=function(q,w,G,y,v,u){var n=this.texture.baseTexture.source;var l=this.texture.width;var H=this.texture.height;var S=w[y];var R=w[v];var P=w[u];var t=w[y+1];var s=w[v+1];var p=w[u+1];var Q=G[y]*l;var O=G[v]*l;var N=G[u]*l;var r=G[y+1]*H;var o=G[v+1]*H;var m=G[u+1]*H;if(this.canvasPadding>0){var M=this.canvasPadding/this.worldTransform.a;var L=this.canvasPadding/this.worldTransform.d;var E=(S+R+P)/3;var C=(t+s+p)/3;var K=S-E;var J=t-C;var I=Math.sqrt((K*K)+(J*J));S=E+(K/I)*(I+M);t=C+(J/I)*(I+L);K=R-E;J=s-C;I=Math.sqrt((K*K)+(J*J));R=E+(K/I)*(I+M);s=C+(J/I)*(I+L);K=P-E;J=p-C;I=Math.sqrt((K*K)+(J*J));P=E+(K/I)*(I+M);p=C+(J/I)*(I+L)}q.save();q.beginPath();q.moveTo(S,t);q.lineTo(R,s);q.lineTo(P,p);q.closePath();q.clip();var T=(Q*o)+(r*N)+(O*m)-(o*N)-(r*O)-(Q*m);var F=(S*o)+(r*P)+(R*m)-(o*P)-(r*R)-(S*m);var D=(Q*R)+(S*N)+(O*P)-(R*N)-(S*O)-(Q*P);var B=(Q*o*P)+(r*R*N)+(S*O*m)-(S*o*N)-(r*O*P)-(Q*R*m);var A=(t*o)+(r*p)+(s*m)-(o*p)-(r*s)-(t*m);var z=(Q*s)+(t*N)+(O*p)-(s*N)-(t*O)-(Q*p);var x=(Q*o*p)+(r*s*N)+(t*O*m)-(t*o*N)-(r*O*p)-(Q*s*m);q.transform(F/T,A/T,D/T,z/T,B/T,x/T);q.drawImage(n,0,0);q.restore()};e.Rope.prototype.renderStripFlat=function(m){var n=this.context;var t=m.vertices;var p=t.length/2;this.count++;n.beginPath();for(var r=1;r<p-2;r++){var s=r*2;var q=t[s];var o=t[s+2];var l=t[s+4];var w=t[s+1];var v=t[s+3];var u=t[s+5];n.moveTo(q,w);n.lineTo(o,v);n.lineTo(l,u)}n.fillStyle="#FF0000";n.fill();n.closePath()};e.Rope.prototype.getBounds=function(s){var r=s||this.worldTransform;var E=r.a;var C=r.b;var A=r.c;var v=r.d;var F=r.tx;var D=r.ty;var z=-Infinity;var u=-Infinity;var B=Infinity;var w=Infinity;var n=this.vertices;for(var t=0;t<n.length;t+=2){var m=n[t];var l=n[t+1];var q=(E*m)+(A*l)+F;var p=(v*l)+(C*m)+D;B=q<B?q:B;w=p<w?p:w;z=q>z?q:z;u=p>u?p:u}if(B===-Infinity||u===Infinity){return PIXI.EmptyRectangle}var o=this._bounds;o.x=B;o.width=z-B;o.y=w;o.height=u-w;this._currentBounds=o;return o};Object.defineProperty(e.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(l){if(l&&typeof l==="function"){this._hasUpdateAnimation=true;this._updateAnimation=l}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(e.Rope.prototype,"segments",{get:function(){var p=[];var q,n,t,l,s,m,u,r;for(var o=0;o<this.points.length;o++){q=o*4;n=this.vertices[q]*this.scale.x;t=this.vertices[q+1]*this.scale.y;l=this.vertices[q+4]*this.scale.x;s=this.vertices[q+3]*this.scale.y;m=e.Math.difference(n,l);u=e.Math.difference(t,s);n+=this.world.x;t+=this.world.y;r=new e.Rectangle(n,t,m,u);p.push(r)}return p}});e.TileSprite=function(n,m,s,p,l,o,r){m=m||0;s=s||0;p=p||256;l=l||256;o=o||null;r=r||null;var q=n.cache.getImage("__default",true);PIXI.Sprite.call(this,new PIXI.Texture(q.base),p,l);this.type=e.TILESPRITE;this.physicsType=e.SPRITE;this._scroll=new e.Point();this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point();this.textureDebug=false;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=true;this.frameWidth=0;this.frameHeight=0;this._width=p;this._height=l;e.Component.Core.init.call(this,n,m,s,o,r)};e.TileSprite.prototype=Object.create(PIXI.Sprite.prototype);e.TileSprite.prototype.constructor=e.TileSprite;e.Component.Core.install.call(e.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);e.TileSprite.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.TileSprite.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.TileSprite.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.TileSprite.prototype.preUpdateCore=e.Component.Core.preUpdate;e.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};e.TileSprite.prototype.autoScroll=function(l,m){this._scroll.set(l,m);return this};e.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0);return this};e.TileSprite.prototype.destroy=function(l){e.Component.Destroy.prototype.destroy.call(this,l);PIXI.Sprite.prototype.destroy.call(this);if(this.canvasBuffer){this.canvasBuffer.destroy();this.canvasBuffer=null}this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};e.TileSprite.prototype.reset=function(l,m){e.Component.Reset.prototype.reset.call(this,l,m);this.tilePosition.x=0;this.tilePosition.y=0;return this};e.TileSprite.prototype.setTexture=function(l){if(this.texture!==l){this.texture=l;this.refreshTexture=true;this.cachedTint=16777215}return this};e.TileSprite.prototype._renderWebGL=function(n){if(!this.visible||!this.renderable||this.alpha===0){return}if(this._mask){n.spriteBatch.stop();n.maskManager.pushMask(this.mask,n);n.spriteBatch.start()}if(this._filters){n.spriteBatch.flush();n.filterManager.pushFilter(this._filterBlock)}if(this.refreshTexture){this.generateTilingTexture(true,n);if(this.tilingTexture){if(this.tilingTexture.needsUpdate){this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex;n.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{return}}n.spriteBatch.renderTilingSprite(this);for(var m=0;m<this.children.length;m++){this.children[m]._renderWebGL(n)}var l=false;if(this._filters){l=true;n.spriteBatch.stop();n.filterManager.popFilter()}if(this._mask){if(!l){n.spriteBatch.stop()}n.maskManager.popMask(this._mask,n)}if(l){n.spriteBatch.start()}};e.TileSprite.prototype._renderCanvas=function(v){if(!this.visible||!this.renderable||this.alpha===0){return}var m=v.context;if(this._mask){v.maskManager.pushMask(this._mask,v)}m.globalAlpha=this.worldAlpha;var t=this.worldTransform;var n=v.resolution;var q=(t.tx*n)+v.shakeX;var o=(t.ty*n)+v.shakeY;m.setTransform(t.a*n,t.b*n,t.c*n,t.d*n,q,o);if(this.refreshTexture){this.generateTilingTexture(false,v);if(this.tilingTexture){this.tilePattern=m.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}var u=v.currentBlendMode;if(this.blendMode!==v.currentBlendMode){v.currentBlendMode=this.blendMode;m.globalCompositeOperation=PIXI.blendModesCanvas[v.currentBlendMode]}var r=this.tilePosition;var w=this.tileScale;r.x%=this.tilingTexture.baseTexture.width;r.y%=this.tilingTexture.baseTexture.height;m.scale(w.x,w.y);m.translate(r.x+(this.anchor.x*-this._width),r.y+(this.anchor.y*-this._height));m.fillStyle=this.tilePattern;q=-r.x;o=-r.y;var s=this._width/w.x;var l=this._height/w.y;if(v.roundPixels){q|=0;o|=0;s|=0;l|=0}m.fillRect(q,o,s,l);m.scale(1/w.x,1/w.y);m.translate(-r.x+(this.anchor.x*this._width),-r.y+(this.anchor.y*this._height));if(this._mask){v.maskManager.popMask(v)}for(var p=0;p<this.children.length;p++){this.children[p]._renderCanvas(v)}if(u!==this.blendMode){v.currentBlendMode=u;m.globalCompositeOperation=PIXI.blendModesCanvas[u]}};e.TileSprite.prototype.onTextureUpdate=function(){};e.TileSprite.prototype.generateTilingTexture=function(s){if(!this.texture.baseTexture.hasLoaded){return}var o=this.texture;var l=o.frame;var p=this._frame.sourceSizeW||this._frame.width;var n=this._frame.sourceSizeH||this._frame.height;var t=0;var r=0;if(this._frame.trimmed){t=this._frame.spriteSourceSizeX;r=this._frame.spriteSourceSizeY}if(s){p=e.Math.getNextPowerOfTwo(p);n=e.Math.getNextPowerOfTwo(n)}if(this.canvasBuffer){this.canvasBuffer.resize(p,n);this.tilingTexture.baseTexture.width=p;this.tilingTexture.baseTexture.height=n;this.tilingTexture.needsUpdate=true}else{this.canvasBuffer=new PIXI.CanvasBuffer(p,n);this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas);this.tilingTexture.isTiling=true;this.tilingTexture.needsUpdate=true}if(this.textureDebug){this.canvasBuffer.context.strokeStyle="#00ff00";this.canvasBuffer.context.strokeRect(0,0,p,n)}var q=o.crop.width;var m=o.crop.height;if(q!==p||m!==n){q=p;m=n}this.canvasBuffer.context.drawImage(o.baseTexture.source,o.crop.x,o.crop.y,o.crop.width,o.crop.height,t,r,q,m);this.tileScaleOffset.x=l.width/p;this.tileScaleOffset.y=l.height/n;this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};e.TileSprite.prototype.getBounds=function(){var v=this._width;var u=this._height;var t=v*(1-this.anchor.x);var s=v*-this.anchor.x;var r=u*(1-this.anchor.y);var q=u*-this.anchor.y;var w=this.worldTransform;var J=w.a;var H=w.b;var G=w.c;var E=w.d;var K=w.tx;var I=w.ty;var A=(J*s)+(G*q)+K;var o=(E*q)+(H*s)+I;var z=(J*t)+(G*q)+K;var n=(E*q)+(H*t)+I;var y=(J*t)+(G*r)+K;var m=(E*r)+(H*t)+I;var x=J*s+G*r+K;var l=E*r+H*s+I;var D=-Infinity;var B=-Infinity;var F=Infinity;var C=Infinity;F=A<F?A:F;F=z<F?z:F;F=y<F?y:F;F=x<F?x:F;C=o<C?o:C;C=n<C?n:C;C=m<C?m:C;C=l<C?l:C;D=A>D?A:D;D=z>D?z:D;D=y>D?y:D;D=x>D?x:D;B=o>B?o:B;B=n>B?n:B;B=m>B?m:B;B=l>B?l:B;var p=this._bounds;p.x=F;p.width=D-F;p.y=C;p.height=B-C;this._currentBounds=p;return p};Object.defineProperty(e.TileSprite.prototype,"width",{get:function(){return this._width},set:function(l){this._width=l}});Object.defineProperty(e.TileSprite.prototype,"height",{get:function(){return this._height},set:function(l){this._height=l}});e.CanvasPool={create:function(q,p,m){var l=e.CanvasPool.getFirst();var o;if(l===-1){var n={parent:q,canvas:document.createElement("canvas")};e.CanvasPool.pool.push(n);o=n.canvas}else{e.CanvasPool.pool[l].parent=q;o=e.CanvasPool.pool[l].canvas}if(p!==undefined){o.width=p;o.height=m}return o},getFirst:function(){var m=e.CanvasPool.pool;for(var l=0;l<m.length;l++){if(!m[l].parent){return l}}return -1},remove:function(n){var m=e.CanvasPool.pool;for(var l=0;l<m.length;l++){if(m[l].parent===n){m[l].parent=null;m[l].canvas.width=1;m[l].canvas.height=1}}},removeByCanvas:function(l){var n=e.CanvasPool.pool;for(var m=0;m<n.length;m++){if(n[m].canvas===l){n[m].parent=null;n[m].canvas.width=1;n[m].canvas.height=1}}},getTotal:function(){var m=e.CanvasPool.pool;var n=0;for(var l=0;l<m.length;l++){if(m[l].parent){n++}}return n},getFree:function(){var m=e.CanvasPool.pool;var n=0;for(var l=0;l<m.length;l++){if(!m[l].parent){n++}}return n}};e.CanvasPool.pool=[];e.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.iOSVersion=0;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.electron=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.canHandleAlpha=false;this.canUseMultiply=false;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=true;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.chromeVersion=0;this.epiphany=false;this.firefox=false;this.firefoxVersion=0;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.edge=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.safariVersion=0;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.dolby=false;this.oggVideo=false;this.h264Video=false;this.mp4Video=false;this.webmVideo=false;this.vp9Video=false;this.hlsVideo=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};e.Device=new e.Device();e.Device.onInitialized=new e.Signal();e.Device.whenReady=function(q,n,m){var o=this._readyCheck;if(this.deviceReadyAt||!o){q.call(n,this)}else{if(o._monitor||m){o._queue=o._queue||[];o._queue.push([q,n])}else{o._monitor=o.bind(this);o._queue=o._queue||[];o._queue.push([q,n]);var p=typeof window.cordova!=="undefined";var l=navigator.isCocoonJS;if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(o._monitor,0)}else{if(p&&!l){document.addEventListener("deviceready",o._monitor,false)}else{document.addEventListener("DOMContentLoaded",o._monitor,false);window.addEventListener("load",o._monitor,false)}}}}};e.Device._readyCheck=function(){var m=this._readyCheck;if(!document.body){window.setTimeout(m._monitor,20)}else{if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",m._monitor);document.removeEventListener("DOMContentLoaded",m._monitor);window.removeEventListener("load",m._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var n;while((n=m._queue.shift())){var o=n[0];var l=n[1];o.call(l,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}}};e.Device._initialize=function(){var o=this;function n(){var z=navigator.userAgent;if(/Playstation Vita/.test(z)){o.vita=true}else{if(/Kindle/.test(z)||/\bKF[A-Z][A-Z]+/.test(z)||/Silk.*Mobile Safari/.test(z)){o.kindle=true}else{if(/Android/.test(z)){o.android=true}else{if(/CrOS/.test(z)){o.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(z)){o.iOS=true;(navigator.appVersion).match(/OS (\d+)/);o.iOSVersion=parseInt(RegExp.$1,10)}else{if(/Linux/.test(z)){o.linux=true}else{if(/Mac OS/.test(z)){o.macOS=true}else{if(/Windows/.test(z)){o.windows=true}}}}}}}}if(/Windows Phone/i.test(z)||/IEMobile/i.test(z)){o.android=false;o.iOS=false;o.macOS=false;o.windows=true;o.windowsPhone=true}var y=/Silk/.test(z);if(o.windows||o.macOS||(o.linux&&!y)||o.chromeOS){o.desktop=true}if(o.windowsPhone||((/Windows NT/i.test(z))&&(/Touch/i.test(z)))){o.desktop=false}}function r(){var z=e.CanvasPool.create(this,6,1);var B=z.getContext("2d");B.fillStyle="rgba(10, 20, 30, 0.5)";B.fillRect(0,0,1,1);var A=B.getImageData(0,0,1,1);if(A){B.putImageData(A,1,0);var y=B.getImageData(1,0,1,1);o.canHandleAlpha=(y.data[0]===A.data[0]&&y.data[1]===A.data[1]&&y.data[2]===A.data[2]&&y.data[3]===A.data[3])}B.globalCompositeOperation="multiply";o.canUseMultiply=(B.globalCompositeOperation==="multiply");e.CanvasPool.removeByCanvas(z);PIXI.CanvasTinter.tintMethod=(o.canUseMultiply)?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}function x(){o.canvas=!!window.CanvasRenderingContext2D||o.cocoonJS;try{o.localStorage=!!localStorage.getItem}catch(y){o.localStorage=false}o.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;o.fileSystem=!!window.requestFileSystem;o.webGL=(function(){try{var z=document.createElement("canvas");z.screencanvas=false;return !!window.WebGLRenderingContext&&(z.getContext("webgl")||z.getContext("experimental-webgl"))}catch(A){return false}})();o.webGL=!!o.webGL;o.worker=!!window.Worker;o.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;o.quirksMode=(document.compatMode==="CSS1Compat")?false:true;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;o.getUserMedia=o.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(o.firefox&&o.firefoxVersion<21){o.getUserMedia=false}if(!o.iOS&&(o.ie||o.firefox||o.chrome)){o.canvasBitBltShift=true}if(o.safari||o.mobileSafari){o.canvasBitBltShift=false}}function w(){if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){o.touch=true}if(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled){o.mspointer=true}if(!o.cocoonJS){if("onwheel" in window||(o.ie&&"WheelEvent" in window)){o.wheelEvent="wheel"}else{if("onmousewheel" in window){o.wheelEvent="mousewheel"}else{if(o.firefox&&"MouseScrollEvent" in window){o.wheelEvent="DOMMouseScroll"}}}}}function u(){var z=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var B=document.createElement("div");for(var A=0;A<z.length;A++){if(B[z[A]]){o.fullscreen=true;o.requestFullscreen=z[A];break}}var y=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(o.fullscreen){for(var A=0;A<y.length;A++){if(document[y[A]]){o.cancelFullscreen=y[A];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){o.fullscreenKeyboard=true}}function v(){var z=navigator.userAgent;if(/Arora/.test(z)){o.arora=true}else{if(/Edge\/\d+/.test(z)){o.edge=true}else{if(/Chrome\/(\d+)/.test(z)&&!o.windowsPhone){o.chrome=true;o.chromeVersion=parseInt(RegExp.$1,10)}else{if(/Epiphany/.test(z)){o.epiphany=true}else{if(/Firefox\D+(\d+)/.test(z)){o.firefox=true;o.firefoxVersion=parseInt(RegExp.$1,10)}else{if(/AppleWebKit/.test(z)&&o.iOS){o.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(z)){o.ie=true;o.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(z)){o.midori=true}else{if(/Opera/.test(z)){o.opera=true}else{if(/Safari\/(\d+)/.test(z)&&!o.windowsPhone){o.safari=true;if(/Version\/(\d+)\./.test(z)){o.safariVersion=parseInt(RegExp.$1,10)}}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(z)){o.ie=true;o.trident=true;o.tridentVersion=parseInt(RegExp.$1,10);o.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}}if(/Silk/.test(z)){o.silk=true}if(navigator.standalone){o.webApp=true}if(typeof window.cordova!=="undefined"){o.cordova=true}if(typeof process!=="undefined"&&typeof require!=="undefined"){o.node=true}if(o.node&&typeof process.versions==="object"){o.nodeWebkit=!!process.versions["node-webkit"];o.electron=!!process.versions.electron}if(navigator.isCocoonJS){o.cocoonJS=true}if(o.cocoonJS){try{o.cocoonJSApp=(typeof CocoonJS!=="undefined")}catch(y){o.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){o.ejecta=true}if(/Crosswalk/.test(z)){o.crosswalk=true}}function p(){var z=document.createElement("video");var y=false;try{if(y=!!z.canPlayType){if(z.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")){o.oggVideo=true}if(z.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")){o.h264Video=true;o.mp4Video=true}if(z.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")){o.webmVideo=true}if(z.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")){o.vp9Video=true}if(z.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")){o.hlsVideo=true}}}catch(A){}}function t(){o.audioData=!!(window.Audio);o.webAudio=!!(window.AudioContext||window.webkitAudioContext);var C=document.createElement("audio");var y=false;try{if(y=!!C.canPlayType){if(C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){o.ogg=true}if(C.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||C.canPlayType("audio/opus;").replace(/^no$/,"")){o.opus=true}if(C.canPlayType("audio/mpeg;").replace(/^no$/,"")){o.mp3=true}if(C.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){o.wav=true}if(C.canPlayType("audio/x-m4a;")||C.canPlayType("audio/aac;").replace(/^no$/,"")){o.m4a=true}if(C.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){o.webm=true}if(C.canPlayType('audio/mp4;codecs="ec-3"')!==""){if(o.edge){o.dolby=true}else{if(o.safari&&o.safariVersion>=9){if(/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var z=parseInt(RegExp.$1,10);var A=parseInt(RegExp.$2,10);if((z===10&&A>=11)||z>10){o.dolby=true}}}}}}}catch(B){}}function s(){var z=new ArrayBuffer(4);var y=new Uint8Array(z);var A=new Uint32Array(z);y[0]=161;y[1]=178;y[2]=195;y[3]=212;if(A[0]===3569595041){return true}if(A[0]===2712847316){return false}else{return null}}function q(){if(Uint8ClampedArray===undefined){return false}var z=e.CanvasPool.create(this,1,1);var y=z.getContext("2d");if(!y){return false}var A=y.createImageData(1,1);e.CanvasPool.remove(this);return A.data instanceof Uint8ClampedArray}function l(){o.pixelRatio=window.devicePixelRatio||1;o.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!==-1;o.iPhone4=(o.pixelRatio===2&&o.iPhone);o.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!==-1;if(typeof Int8Array!=="undefined"){o.typedArray=true}else{o.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){o.littleEndian=s();o.LITTLE_ENDIAN=o.littleEndian}o.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&o.littleEndian!==null&&q());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){o.vibration=true}}function m(){var A=document.createElement("p");var B;var z={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(A,null);for(var y in z){if(A.style[y]!==undefined){A.style[y]="translate3d(1px,1px,1px)";B=window.getComputedStyle(A).getPropertyValue(z[y])}}document.body.removeChild(A);o.css3D=(B!==undefined&&B.length>0&&B!=="none")}n();v();t();p();m();l();x();r();u();w()};e.Device.canPlayAudio=function(l){if(l==="mp3"&&this.mp3){return true}else{if(l==="ogg"&&(this.ogg||this.opus)){return true}else{if(l==="m4a"&&this.m4a){return true}else{if(l==="opus"&&this.opus){return true}else{if(l==="wav"&&this.wav){return true}else{if(l==="webm"&&this.webm){return true}else{if(l==="mp4"&&this.dolby){return true}}}}}}}return false};e.Device.canPlayVideo=function(l){if(l==="webm"&&(this.webmVideo||this.vp9Video)){return true}else{if(l==="mp4"&&(this.mp4Video||this.h264Video)){return true}else{if((l==="ogg"||l==="ogv")&&this.oggVideo){return true}else{if(l==="mpeg"&&this.hlsVideo){return true}}}}return false};e.Device.isConsoleOpen=function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false};e.Device.isAndroidStockBrowser=function(){var l=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return l&&l[1]<537};e.Canvas={create:function(p,o,l,q,n){o=o||256;l=l||256;var m=(n)?document.createElement("canvas"):e.CanvasPool.create(p,o,l);if(typeof q==="string"&&q!==""){m.id=q}m.width=o;m.height=l;m.style.display="block";return m},setBackgroundColor:function(m,l){l=l||"rgb(0,0,0)";m.style.backgroundColor=l;return m},setTouchAction:function(l,m){m=m||"none";l.style.msTouchAction=m;l.style["ms-touch-action"]=m;l.style["touch-action"]=m;return l},setUserSelect:function(l,m){m=m||"none";l.style["-webkit-touch-callout"]=m;l.style["-webkit-user-select"]=m;l.style["-khtml-user-select"]=m;l.style["-moz-user-select"]=m;l.style["-ms-user-select"]=m;l.style["user-select"]=m;l.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return l},addToDOM:function(l,m,o){var n;if(o===undefined){o=true}if(m){if(typeof m==="string"){n=document.getElementById(m)}else{if(typeof m==="object"&&m.nodeType===1){n=m}}}if(!n){n=document.body}if(o&&n.style){n.style.overflow="hidden"}n.appendChild(l);return l},removeFromDOM:function(l){if(l.parentNode){l.parentNode.removeChild(l)}},setTransform:function(p,r,q,n,l,o,m){p.setTransform(n,o,m,l,r,q);return p},setSmoothingEnabled:function(l,n){var m=e.Canvas.getSmoothingPrefix(l);if(m){l[m]=n}return l},getSmoothingPrefix:function(l){var o=["i","webkitI","msI","mozI","oI"];for(var n in o){var m=o[n]+"mageSmoothingEnabled";if(m in l){return m}}return null},getSmoothingEnabled:function(l){var m=e.Canvas.getSmoothingPrefix(l);if(m){return l[m]}},setImageRenderingCrisp:function(l){var n=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"];for(var m=0;m<n.length;m++){l.style["image-rendering"]=n[m]}l.style.msInterpolationMode="nearest-neighbor";return l},setImageRenderingBicubic:function(l){l.style["image-rendering"]="auto";l.style.msInterpolationMode="bicubic";return l}};e.RequestAnimationFrame=function(m,n){if(n===undefined){n=false}this.game=m;this.isRunning=false;this.forceSetTimeOut=n;var o=["ms","moz","webkit","o"];for(var l=0;l<o.length&&!window.requestAnimationFrame;l++){window.requestAnimationFrame=window[o[l]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[o[l]+"CancelAnimationFrame"]||window[o[l]+"CancelRequestAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};e.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var l=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return l.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(m){return l.updateRAF(m)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(l){if(this.isRunning){this.game.update(Math.floor(l));this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateSetTimeout:function(){if(this.isRunning){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)}},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};e.RequestAnimationFrame.prototype.constructor=e.RequestAnimationFrame;e.Math={PI2:Math.PI*2,HALF_PI:Math.PI*0.5,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(l){return l*e.Math.DEG_TO_RAD},radToDeg:function(l){return l*e.Math.RAD_TO_DEG},getNextPowerOfTwo:function(m){if(m>0&&(m&(m-1))===0){return m}else{var l=1;while(l<m){l<<=1}return l}},isPowerOfTwo:function(m,l){return(m>0&&(m&(m-1))===0&&l>0&&(l&(l-1))===0)},random:function(n,l){if(n===undefined){n=0}if(l===undefined){l=1}if(n===l){return n}if(n>l){var m=n;n=l;l=m}return(Math.random()*(l-n)+n)},between:function(n,l){if(n===undefined){n=0}if(l===undefined){l=1}if(n===l){return n}if(n>l){var m=n;n=l;l=m}n=Math.ceil(n);l=Math.floor(l);return Math.floor(Math.random()*(l-n+1))+n},fuzzyEqual:function(m,l,n){if(n===undefined){n=0.0001}return Math.abs(m-l)<n},fuzzyLessThan:function(m,l,n){if(n===undefined){n=0.0001}return m<l+n},fuzzyGreaterThan:function(m,l,n){if(n===undefined){n=0.0001}return m>l-n},fuzzyCeil:function(l,m){if(m===undefined){m=0.0001}return Math.ceil(l-m)},fuzzyFloor:function(l,m){if(m===undefined){m=0.0001}return Math.floor(l+m)},average:function(){var n=0;var l=arguments.length;for(var m=0;m<l;m++){n+=(+arguments[m])}return n/l},shear:function(l){return l%1},snapTo:function(l,n,m){if(m===undefined){m=0}if(n===0){return l}l-=m;l=n*Math.round(l/n);return m+l},snapToFloor:function(l,n,m){if(m===undefined){m=0}if(n===0){return l}l-=m;l=n*Math.floor(l/n);return m+l},snapToCeil:function(l,n,m){if(m===undefined){m=0}if(n===0){return l}l-=m;l=n*Math.ceil(l/n);return m+l},roundTo:function(n,l,m){if(l===undefined){l=0}if(m===undefined){m=10}var o=Math.pow(m,-l);return Math.round(n*o)/o},floorTo:function(n,l,m){if(l===undefined){l=0}if(m===undefined){m=10}var o=Math.pow(m,-l);return Math.floor(n*o)/o},ceilTo:function(n,l,m){if(l===undefined){l=0}if(m===undefined){m=10}var o=Math.pow(m,-l);return Math.ceil(n*o)/o},rotateToAngle:function(m,n,l){if(l===undefined){l=0.05}if(m===n){return m}if(Math.abs(n-m)<=l||Math.abs(n-m)>=(e.Math.PI2-l)){m=n}else{if(Math.abs(n-m)>Math.PI){if(n<m){n+=e.Math.PI2}else{n-=e.Math.PI2}}if(n>m){m+=l}else{if(n<m){m-=l}}}return m},getShortestAngle:function(n,l){var o=l-n;if(o===0){return 0}var m=Math.floor((o-(-180))/360);return o-(m*360)},angleBetween:function(m,o,l,n){return Math.atan2(n-o,l-m)},angleBetweenY:function(m,o,l,n){return Math.atan2(l-m,n-o)},angleBetweenPoints:function(m,l){return Math.atan2(l.y-m.y,l.x-m.x)},angleBetweenPointsY:function(m,l){return Math.atan2(l.x-m.x,l.y-m.y)},reverseAngle:function(l){return this.normalizeAngle(l+Math.PI,true)},normalizeAngle:function(l){l=l%(2*Math.PI);return l>=0?l:l+2*Math.PI},maxAdd:function(n,m,l){return Math.min(n+m,l)},minSub:function(n,m,l){return Math.max(n-m,l)},wrap:function(p,o,m){var n=m-o;if(n<=0){return 0}var l=(p-o)%n;if(l<0){l+=n}return l+o},wrapValue:function(n,m,l){var o;n=Math.abs(n);m=Math.abs(m);l=Math.abs(l);o=(n+m)%l;return o},isOdd:function(l){return !!(l&1)},isEven:function(l){return !(l&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var o=arguments[0]}else{var o=arguments}for(var n=1,m=0,l=o.length;n<l;n++){if(o[n]<o[m]){m=n}}return o[m]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var o=arguments[0]}else{var o=arguments}for(var n=1,m=0,l=o.length;n<l;n++){if(o[n]>o[m]){m=n}}return o[m]},minProperty:function(p){if(arguments.length===2&&typeof arguments[1]==="object"){var o=arguments[1]}else{var o=arguments.slice(1)}for(var n=1,m=0,l=o.length;n<l;n++){if(o[n][p]<o[m][p]){m=n}}return o[m][p]},maxProperty:function(p){if(arguments.length===2&&typeof arguments[1]==="object"){var o=arguments[1]}else{var o=arguments.slice(1)}for(var n=1,m=0,l=o.length;n<l;n++){if(o[n][p]>o[m][p]){m=n}}return o[m][p]},wrapAngle:function(m,l){return l?this.wrap(m,-Math.PI,Math.PI):this.wrap(m,-180,180)},linearInterpolation:function(o,n){var l=o.length-1;var q=l*n;var p=Math.floor(q);if(n<0){return this.linear(o[0],o[1],q)}if(n>1){return this.linear(o[l],o[l-1],l-q)}return this.linear(o[p],o[p+1>l?l:p+1],q-p)},bezierInterpolation:function(o,m){var l=0;var q=o.length-1;for(var p=0;p<=q;p++){l+=Math.pow(1-m,q-p)*Math.pow(m,p)*o[p]*this.bernstein(q,p)}return l},catmullRomInterpolation:function(o,n){var l=o.length-1;var q=l*n;var p=Math.floor(q);if(o[0]===o[l]){if(n<0){p=Math.floor(q=l*(1+n))}return this.catmullRom(o[(p-1+l)%l],o[p],o[(p+1)%l],o[(p+2)%l],q-p)}else{if(n<0){return o[0]-(this.catmullRom(o[0],o[0],o[1],o[1],-q)-o[0])}if(n>1){return o[l]-(this.catmullRom(o[l],o[l],o[l-1],o[l-1],q-l)-o[l])}return this.catmullRom(o[p?p-1:0],o[p],o[l<p+1?l:p+1],o[l<p+2?l:p+2],q-p)}},linear:function(n,m,l){return(m-n)*l+n},bernstein:function(m,l){return this.factorial(m)/this.factorial(l)/this.factorial(m-l)},factorial:function(m){if(m===0){return 1}var l=m;while(--m){l*=m}return l},catmullRom:function(s,r,p,o,u){var q=(p-s)*0.5,n=(o-r)*0.5,m=u*u,l=u*m;return(2*r-2*p+q+n)*l+(-3*r+3*p-2*q-n)*m+q*u+r},difference:function(m,l){return Math.abs(m-l)},roundAwayFromZero:function(l){return(l>0)?Math.ceil(l):Math.floor(l)},sinCosGenerator:function(l,s,m,q){if(s===undefined){s=1}if(m===undefined){m=1}if(q===undefined){q=1}var r=s;var u=m;var o=q*Math.PI/l;var n=[];var t=[];for(var p=0;p<l;p++){u-=r*o;r+=u*o;n[p]=u;t[p]=r}return{sin:t,cos:n,length:l}},hypot:function(m,l){return Math.sqrt(m*m+l*l)},distance:function(o,q,n,p){var m=o-n;var l=q-p;return Math.sqrt(m*m+l*l)},distanceSq:function(o,q,n,p){var m=o-n;var l=q-p;return m*m+l*l},distancePow:function(m,o,l,n,p){if(p===undefined){p=2}return Math.sqrt(Math.pow(l-m,p)+Math.pow(n-o,p))},clamp:function(m,n,l){if(m<n){return n}else{if(l<m){return l}else{return m}}},clampBottom:function(l,m){return l<m?m:l},within:function(m,l,n){return(Math.abs(m-l)<=n)},mapLinear:function(m,n,l,p,o){return p+(m-n)*(o-p)/(l-n)},smoothstep:function(m,n,l){m=Math.max(0,Math.min(1,(m-n)/(l-n)));return m*m*(3-2*m)},smootherstep:function(m,n,l){m=Math.max(0,Math.min(1,(m-n)/(l-n)));return m*m*m*(m*(m*6-15)+10)},sign:function(l){return(l<0)?-1:((l>0)?1:0)},percent:function(m,l,n){if(n===undefined){n=0}if(m>l||n>l){return 1}else{if(m<n||n>m){return 0}else{return(m-n)/l}}}};e.RandomDataGenerator=function(l){if(l===undefined){l=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;if(typeof l==="string"){this.state(l)}else{this.sow(l)}};e.RandomDataGenerator.prototype={rnd:function(){var l=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=l|0;this.s0=this.s1;this.s1=this.s2;this.s2=l-this.c;return this.s2},sow:function(m){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!m){return}for(var n=0;n<m.length&&(m[n]!=null);n++){var l=m[n];this.s0-=this.hash(l);this.s0+=~~(this.s0<0);this.s1-=this.hash(l);this.s1+=~~(this.s1<0);this.s2-=this.hash(l);this.s2+=~~(this.s2<0)}},hash:function(o){var m,l,p;p=4022871197;o=o.toString();for(l=0;l<o.length;l++){p+=o.charCodeAt(l);m=0.02519603282416938*p;p=m>>>0;m-=p;m*=p;p=m>>>0;m-=p;p+=m*4294967296}return(p>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(m,l){return Math.floor(this.realInRange(0,l-m+1)+m)},between:function(m,l){return this.integerInRange(m,l)},realInRange:function(m,l){return this.frac()*(l-m)+m},normal:function(){return 1-2*this.frac()},uuid:function(){var m="";var l="";for(l=m="";m++<36;l+=~m%5|m*3&4?(m^15?8^this.frac()*(m^20?16:4):4).toString(16):"-"){}return l},pick:function(l){return l[this.integerInRange(0,l.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(l){return l[~~(Math.pow(this.frac(),2)*(l.length-1)+0.5)]},timestamp:function(m,l){return this.realInRange(m||946684800000,l||1577862000000)},angle:function(){return this.integerInRange(-180,180)},state:function(l){if(typeof l==="string"&&l.match(/^!rnd/)){l=l.split(",");this.c=parseFloat(l[1]);this.s0=parseFloat(l[2]);this.s1=parseFloat(l[3]);this.s2=parseFloat(l[4])}return["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}};e.RandomDataGenerator.prototype.constructor=e.RandomDataGenerator;e.QuadTree=function(m,r,p,l,o,n,q){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(m,r,p,l,o,n,q)};e.QuadTree.prototype={reset:function(m,r,p,l,o,n,q){this.maxObjects=o||10;this.maxLevels=n||4;this.level=q||0;this.bounds={x:Math.round(m),y:Math.round(r),width:p,height:l,subWidth:Math.floor(p/2),subHeight:Math.floor(l/2),right:Math.round(m)+Math.floor(p/2),bottom:Math.round(r)+Math.floor(l/2)};this.objects.length=0;this.nodes.length=0},populate:function(l){l.forEach(this.populateHandler,this,true)},populateHandler:function(l){if(l.body&&l.exists){this.insert(l.body)}},split:function(){this.nodes[0]=new e.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new e.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new e.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new e.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(l){var n=0;var m;if(this.nodes[0]!=null){m=this.getIndex(l);if(m!==-1){this.nodes[m].insert(l);return}}this.objects.push(l);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(n<this.objects.length){m=this.getIndex(this.objects[n]);if(m!==-1){this.nodes[m].insert(this.objects.splice(n,1)[0])}else{n++}}}},getIndex:function(m){var l=-1;if(m.x<this.bounds.right&&m.right<this.bounds.right){if(m.y<this.bounds.bottom&&m.bottom<this.bounds.bottom){l=1}else{if(m.y>this.bounds.bottom){l=2}}}else{if(m.x>this.bounds.right){if(m.y<this.bounds.bottom&&m.bottom<this.bounds.bottom){l=0}else{if(m.y>this.bounds.bottom){l=3}}}}return l},retrieve:function(m){if(m instanceof e.Rectangle){var n=this.objects;var l=this.getIndex(m)}else{if(!m.body){return this._empty}var n=this.objects;var l=this.getIndex(m.body)}if(this.nodes[0]){if(l!==-1){n=n.concat(this.nodes[l].retrieve(m))}else{n=n.concat(this.nodes[0].retrieve(m));n=n.concat(this.nodes[1].retrieve(m));n=n.concat(this.nodes[2].retrieve(m));n=n.concat(this.nodes[3].retrieve(m))}}return n},clear:function(){this.objects.length=0;var l=this.nodes.length;while(l--){this.nodes[l].clear();this.nodes.splice(l,1)}this.nodes.length=0}};e.QuadTree.prototype.constructor=e.QuadTree;e.Net=function(l){this.game=l};e.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(l){return window.location.hostname.indexOf(l)!==-1},updateQueryString:function(n,p,s,m){if(s===undefined){s=false}if(m===undefined||m===""){m=window.location.href}var l="";var o=new RegExp("([?|&])"+n+"=.*?(&|#|$)(.*)","gi");if(o.test(m)){if(typeof p!=="undefined"&&p!==null){l=m.replace(o,"$1"+n+"="+p+"$2$3")}else{l=m.replace(o,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof p!=="undefined"&&p!==null){var r=m.indexOf("?")!==-1?"&":"?";var q=m.split("#");m=q[0]+r+n+"="+p;if(q[1]){m+="#"+q[1]}l=m}else{l=m}}if(s){window.location.href=l}else{return l}},getQueryString:function(p){if(p===undefined){p=""}var m={};var l=location.search.substring(1).split("&");for(var o in l){var n=l[o].split("=");if(n.length>1){if(p&&p===this.decodeURI(n[0])){return this.decodeURI(n[1])}else{m[this.decodeURI(n[0])]=this.decodeURI(n[1])}}}return m},decodeURI:function(l){return decodeURIComponent(l.replace(/\+/g," "))}};e.Net.prototype.constructor=e.Net;e.TweenManager=function(l){this.game=l;this.frameBased=false;this._tweens=[];this._add=[];this.easeMap={Power0:e.Easing.Power0,Power1:e.Easing.Power1,Power2:e.Easing.Power2,Power3:e.Easing.Power3,Power4:e.Easing.Power4,Linear:e.Easing.Linear.None,Quad:e.Easing.Quadratic.Out,Cubic:e.Easing.Cubic.Out,Quart:e.Easing.Quartic.Out,Quint:e.Easing.Quintic.Out,Sine:e.Easing.Sinusoidal.Out,Expo:e.Easing.Exponential.Out,Circ:e.Easing.Circular.Out,Elastic:e.Easing.Elastic.Out,Back:e.Easing.Back.Out,Bounce:e.Easing.Bounce.Out,"Quad.easeIn":e.Easing.Quadratic.In,"Cubic.easeIn":e.Easing.Cubic.In,"Quart.easeIn":e.Easing.Quartic.In,"Quint.easeIn":e.Easing.Quintic.In,"Sine.easeIn":e.Easing.Sinusoidal.In,"Expo.easeIn":e.Easing.Exponential.In,"Circ.easeIn":e.Easing.Circular.In,"Elastic.easeIn":e.Easing.Elastic.In,"Back.easeIn":e.Easing.Back.In,"Bounce.easeIn":e.Easing.Bounce.In,"Quad.easeOut":e.Easing.Quadratic.Out,"Cubic.easeOut":e.Easing.Cubic.Out,"Quart.easeOut":e.Easing.Quartic.Out,"Quint.easeOut":e.Easing.Quintic.Out,"Sine.easeOut":e.Easing.Sinusoidal.Out,"Expo.easeOut":e.Easing.Exponential.Out,"Circ.easeOut":e.Easing.Circular.Out,"Elastic.easeOut":e.Easing.Elastic.Out,"Back.easeOut":e.Easing.Back.Out,"Bounce.easeOut":e.Easing.Bounce.Out,"Quad.easeInOut":e.Easing.Quadratic.InOut,"Cubic.easeInOut":e.Easing.Cubic.InOut,"Quart.easeInOut":e.Easing.Quartic.InOut,"Quint.easeInOut":e.Easing.Quintic.InOut,"Sine.easeInOut":e.Easing.Sinusoidal.InOut,"Expo.easeInOut":e.Easing.Exponential.InOut,"Circ.easeInOut":e.Easing.Circular.InOut,"Elastic.easeInOut":e.Easing.Elastic.InOut,"Back.easeInOut":e.Easing.Back.InOut,"Bounce.easeInOut":e.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};e.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var l=0;l<this._tweens.length;l++){this._tweens[l].pendingDelete=true}this._add=[]},removeFrom:function(o,n){if(n===undefined){n=true}var m;var l;if(Array.isArray(o)){for(m=0,l=o.length;m<l;m++){this.removeFrom(o[m])}}else{if(o.type===e.GROUP&&n){for(var m=0,l=o.children.length;m<l;m++){this.removeFrom(o.children[m])}}else{for(m=0,l=this._tweens.length;m<l;m++){if(o===this._tweens[m].target){this.remove(this._tweens[m])}}for(m=0,l=this._add.length;m<l;m++){if(o===this._add[m].target){this.remove(this._add[m])}}}}},add:function(l){l._manager=this;this._add.push(l)},create:function(l){return new e.Tween(l,this.game,this)},remove:function(m){var l=this._tweens.indexOf(m);if(l!==-1){this._tweens[l].pendingDelete=true}else{l=this._add.indexOf(m);if(l!==-1){this._add[l].pendingDelete=true}}},update:function(){var n=this._add.length;var m=this._tweens.length;if(m===0&&n===0){return false}var l=0;while(l<m){if(this._tweens[l].update(this.game.time.time)){l++}else{this._tweens.splice(l,1);m--}}if(n>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(l){return this._tweens.some(function(m){return m.target===l})},_pauseAll:function(){for(var l=this._tweens.length-1;l>=0;l--){this._tweens[l]._pause()}},_resumeAll:function(){for(var l=this._tweens.length-1;l>=0;l--){this._tweens[l]._resume()}},pauseAll:function(){for(var l=this._tweens.length-1;l>=0;l--){this._tweens[l].pause()}},resumeAll:function(){for(var l=this._tweens.length-1;l>=0;l--){this._tweens[l].resume(true)}}};e.TweenManager.prototype.constructor=e.TweenManager;e.Tween=function(n,l,m){this.game=l;this.target=n;this.manager=m;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new e.Signal();this.onLoop=new e.Signal();this.onRepeat=new e.Signal();this.onChildComplete=new e.Signal();this.onComplete=new e.Signal();this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this.frameBased=m.frameBased;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false;this._hasStarted=false};e.Tween.prototype={to:function(n,q,r,m,l,p,o){if(q===undefined||q<=0){q=1000}if(r===undefined||r===null){r=e.Easing.Default}if(m===undefined){m=false}if(l===undefined){l=0}if(p===undefined){p=0}if(o===undefined){o=false}if(typeof r==="string"&&this.manager.easeMap[r]){r=this.manager.easeMap[r]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new e.TweenData(this).to(n,q,r,l,p,o));if(m){this.start()}return this},from:function(n,q,r,m,l,p,o){if(q===undefined){q=1000}if(r===undefined||r===null){r=e.Easing.Default}if(m===undefined){m=false}if(l===undefined){l=0}if(p===undefined){p=0}if(o===undefined){o=false}if(typeof r==="string"&&this.manager.easeMap[r]){r=this.manager.easeMap[r]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new e.TweenData(this).from(n,q,r,l,p,o));if(m){this.start()}return this},start:function(l){if(l===undefined){l=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var m=0;m<this.timeline.length;m++){for(var n in this.timeline[m].vEnd){this.properties[n]=this.target[n]||0;if(!Array.isArray(this.properties[n])){this.properties[n]*=1}}}for(var m=0;m<this.timeline.length;m++){this.timeline[m].loadValues()}this.manager.add(this);this.isRunning=true;if(l<0||l>this.timeline.length-1){l=0}this.current=l;this.timeline[this.current].start();return this},stop:function(l){if(l===undefined){l=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(l){this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(o,n,l){if(this.timeline.length===0){return this}if(l===undefined){l=0}if(l===-1){for(var m=0;m<this.timeline.length;m++){this.timeline[m][o]=n}}else{this.timeline[l][o]=n}return this},delay:function(m,l){return this.updateTweenData("delay",m,l)},repeat:function(m,n,l){if(n===undefined){n=0}this.updateTweenData("repeatCounter",m,l);return this.updateTweenData("repeatDelay",n,l)},repeatDelay:function(m,l){return this.updateTweenData("repeatDelay",m,l)},yoyo:function(m,n,l){if(n===undefined){n=0}this.updateTweenData("yoyo",m,l);return this.updateTweenData("yoyoDelay",n,l)},yoyoDelay:function(m,l){return this.updateTweenData("yoyoDelay",m,l)},easing:function(m,l){if(typeof m==="string"&&this.manager.easeMap[m]){m=this.manager.easeMap[m]}return this.updateTweenData("easingFunction",m,l)},interpolation:function(l,n,m){if(n===undefined){n=e.Math}this.updateTweenData("interpolationFunction",l,m);return this.updateTweenData("interpolationContext",n,m)},repeatAll:function(l){if(l===undefined){l=0}this.repeatCounter=l;return this},chain:function(){var l=arguments.length;while(l--){if(l>0){arguments[l-1].chainedTween=arguments[l]}else{this.chainedTween=arguments[l]}}return this},loop:function(l){if(l===undefined){l=true}this.repeatCounter=(l)?-1:0;return this},onUpdateCallback:function(m,l){this._onUpdateCallback=m;this._onUpdateCallbackContext=l;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var l=0;l<this.timeline.length;l++){if(!this.timeline[l].isRunning){this.timeline[l].startTime+=(this.game.time.time-this._pausedTime)}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(n){if(this.pendingDelete||!this.target){return false}if(this.isPaused){return true}var m=this.timeline[this.current].update(n);if(m===e.TweenData.PENDING){return true}else{if(m===e.TweenData.RUNNING){if(!this._hasStarted){this.onStart.dispatch(this.target,this);this._hasStarted=true}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else{if(m===e.TweenData.LOOPED){if(this.timeline[this.current].repeatCounter===-1){this.onLoop.dispatch(this.target,this)}else{this.onRepeat.dispatch(this.target,this)}return true}else{if(m===e.TweenData.COMPLETE){var l=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;l=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;l=true}}if(l){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onLoop.dispatch(this.target,this);return true}else{if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}return false}}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}}}}},generateData:function(l,o){if(this.game===null||this.target===null){return null}if(l===undefined){l=60}if(o===undefined){o=[]}for(var m=0;m<this.timeline.length;m++){for(var n in this.timeline[m].vEnd){this.properties[n]=this.target[n]||0;if(!Array.isArray(this.properties[n])){this.properties[n]*=1}}}for(var m=0;m<this.timeline.length;m++){this.timeline[m].loadValues()}for(var m=0;m<this.timeline.length;m++){o=o.concat(this.timeline[m].generateData(l))}return o}};Object.defineProperty(e.Tween.prototype,"totalDuration",{get:function(){var m=0;for(var l=0;l<this.timeline.length;l++){m+=this.timeline[l].duration}return m}});e.Tween.prototype.constructor=e.Tween;e.TweenData=function(l){this.parent=l;this.game=l.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1000;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=e.Easing.Default;this.interpolationFunction=e.Math.linearInterpolation;this.interpolationContext=e.Math;this.isRunning=false;this.isFrom=false};e.TweenData.PENDING=0;e.TweenData.RUNNING=1;e.TweenData.LOOPED=2;e.TweenData.COMPLETE=3;e.TweenData.prototype={to:function(m,p,q,l,o,n){this.vEnd=m;this.duration=p;this.easingFunction=q;this.delay=l;this.repeatTotal=o;this.yoyo=n;this.isFrom=false;return this},from:function(m,p,q,l,o,n){this.vEnd=m;this.duration=p;this.easingFunction=q;this.delay=l;this.repeatTotal=o;this.yoyo=n;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var l in this.vStartCache){this.vStart[l]=this.vEndCache[l];this.vEnd[l]=this.vStartCache[l];this.parent.target[l]=this.vStart[l]}}this.value=0;this.yoyoCounter=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var l in this.parent.properties){this.vStart[l]=this.parent.properties[l];if(Array.isArray(this.vEnd[l])){if(this.vEnd[l].length===0){continue}if(this.percent===0){this.vEnd[l]=[this.vStart[l]].concat(this.vEnd[l])}}if(typeof this.vEnd[l]!=="undefined"){if(typeof this.vEnd[l]==="string"){this.vEnd[l]=this.vStart[l]+parseFloat(this.vEnd[l],10)}this.parent.properties[l]=this.vEnd[l]}else{this.vEnd[l]=this.vStart[l]}this.vStartCache[l]=this.vStart[l];this.vEndCache[l]=this.vEnd[l]}return this},update:function(o){if(!this.isRunning){if(o>=this.startTime){this.isRunning=true}else{return e.TweenData.PENDING}}else{if(o<this.startTime){return e.TweenData.RUNNING}}var m=(this.parent.frameBased)?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;if(this.parent.reverse){this.dt-=m*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=m*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var n in this.vEnd){var p=this.vStart[n];var l=this.vEnd[n];if(Array.isArray(l)){this.parent.target[n]=this.interpolationFunction.call(this.interpolationContext,l,this.value)}else{this.parent.target[n]=p+((l-p)*this.value)}}if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){return this.repeat()}return e.TweenData.RUNNING},generateData:function(t){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var r=[];var n=false;var o=(1/t)*1000;do{if(this.parent.reverse){this.dt-=o;this.dt=Math.max(this.dt,0)}else{this.dt+=o;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var l={};for(var s in this.vEnd){var m=this.vStart[s];var p=this.vEnd[s];if(Array.isArray(p)){l[s]=this.interpolationFunction(p,this.value)}else{l[s]=m+((p-m)*this.value)}}r.push(l);if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){n=true}}while(!n);if(this.yoyo){var q=r.slice();q.reverse();r=r.concat(q)}return r},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var l in this.vStartCache){this.vStart[l]=this.vStartCache[l];this.vEnd[l]=this.vEndCache[l]}this.inReverse=false;return e.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return e.TweenData.COMPLETE}}if(this.inReverse){for(var l in this.vStartCache){this.vStart[l]=this.vEndCache[l];this.vEnd[l]=this.vStartCache[l]}}else{for(var l in this.vStartCache){this.vStart[l]=this.vStartCache[l];this.vEnd[l]=this.vEndCache[l]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else{if(!this.inReverse){this.startTime+=this.repeatDelay}}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return e.TweenData.LOOPED}};e.TweenData.prototype.constructor=e.TweenData;e.Easing={Linear:{None:function(l){return l}},Quadratic:{In:function(l){return l*l},Out:function(l){return l*(2-l)},InOut:function(l){if((l*=2)<1){return 0.5*l*l}return -0.5*(--l*(l-2)-1)}},Cubic:{In:function(l){return l*l*l},Out:function(l){return --l*l*l+1},InOut:function(l){if((l*=2)<1){return 0.5*l*l*l}return 0.5*((l-=2)*l*l+2)}},Quartic:{In:function(l){return l*l*l*l},Out:function(l){return 1-(--l*l*l*l)},InOut:function(l){if((l*=2)<1){return 0.5*l*l*l*l}return -0.5*((l-=2)*l*l*l-2)}},Quintic:{In:function(l){return l*l*l*l*l},Out:function(l){return --l*l*l*l*l+1},InOut:function(l){if((l*=2)<1){return 0.5*l*l*l*l*l}return 0.5*((l-=2)*l*l*l*l+2)}},Sinusoidal:{In:function(l){if(l===0){return 0}if(l===1){return 1}return 1-Math.cos(l*Math.PI/2)},Out:function(l){if(l===0){return 0}if(l===1){return 1}return Math.sin(l*Math.PI/2)},InOut:function(l){if(l===0){return 0}if(l===1){return 1}return 0.5*(1-Math.cos(Math.PI*l))}},Exponential:{In:function(l){return l===0?0:Math.pow(1024,l-1)},Out:function(l){return l===1?1:1-Math.pow(2,-10*l)},InOut:function(l){if(l===0){return 0}if(l===1){return 1}if((l*=2)<1){return 0.5*Math.pow(1024,l-1)}return 0.5*(-Math.pow(2,-10*(l-1))+2)}},Circular:{In:function(l){return 1-Math.sqrt(1-l*l)},Out:function(l){return Math.sqrt(1-(--l*l))},InOut:function(l){if((l*=2)<1){return -0.5*(Math.sqrt(1-l*l)-1)}return 0.5*(Math.sqrt(1-(l-=2)*l)+1)}},Elastic:{In:function(m){var n,l=0.1,o=0.4;if(m===0){return 0}if(m===1){return 1}if(!l||l<1){l=1;n=o/4}else{n=o*Math.asin(1/l)/(2*Math.PI)}return -(l*Math.pow(2,10*(m-=1))*Math.sin((m-n)*(2*Math.PI)/o))},Out:function(m){var n,l=0.1,o=0.4;if(m===0){return 0}if(m===1){return 1}if(!l||l<1){l=1;n=o/4}else{n=o*Math.asin(1/l)/(2*Math.PI)}return(l*Math.pow(2,-10*m)*Math.sin((m-n)*(2*Math.PI)/o)+1)},InOut:function(m){var n,l=0.1,o=0.4;if(m===0){return 0}if(m===1){return 1}if(!l||l<1){l=1;n=o/4}else{n=o*Math.asin(1/l)/(2*Math.PI)}if((m*=2)<1){return -0.5*(l*Math.pow(2,10*(m-=1))*Math.sin((m-n)*(2*Math.PI)/o))}return l*Math.pow(2,-10*(m-=1))*Math.sin((m-n)*(2*Math.PI)/o)*0.5+1}},Back:{In:function(l){var m=1.70158;return l*l*((m+1)*l-m)},Out:function(l){var m=1.70158;return --l*l*((m+1)*l+m)+1},InOut:function(l){var m=1.70158*1.525;if((l*=2)<1){return 0.5*(l*l*((m+1)*l-m))}return 0.5*((l-=2)*l*((m+1)*l+m)+2)}},Bounce:{In:function(l){return 1-e.Easing.Bounce.Out(1-l)},Out:function(l){if(l<(1/2.75)){return 7.5625*l*l}else{if(l<(2/2.75)){return 7.5625*(l-=(1.5/2.75))*l+0.75}else{if(l<(2.5/2.75)){return 7.5625*(l-=(2.25/2.75))*l+0.9375}else{return 7.5625*(l-=(2.625/2.75))*l+0.984375}}}},InOut:function(l){if(l<0.5){return e.Easing.Bounce.In(l*2)*0.5}return e.Easing.Bounce.Out(l*2-1)*0.5+0.5}}};e.Easing.Default=e.Easing.Linear.None;e.Easing.Power0=e.Easing.Linear.None;e.Easing.Power1=e.Easing.Quadratic.Out;e.Easing.Power2=e.Easing.Cubic.Out;e.Easing.Power3=e.Easing.Quartic.Out;e.Easing.Power4=e.Easing.Quintic.Out;e.Time=function(l){this.game=l;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=1/60;this.physicsElapsedMS=(1/60)*1000;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new e.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};e.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(l){this._timers.push(l);return l},create:function(l){if(l===undefined){l=true}var m=new e.Timer(this.game,l);this._timers.push(m);return m},removeAll:function(){for(var l=0;l<this._timers.length;l++){this._timers[l].destroy()}this._timers=[];this.events.removeAll()},refresh:function(){var l=this.time;this.time=Date.now();this.elapsedMS=this.time-l},update:function(m){var l=this.time;this.time=Date.now();this.elapsedMS=this.time-l;this.prevTime=this.now;this.now=m;this.elapsed=this.now-this.prevTime;if(this.game.raf._isSetTimeOut){this.timeToCall=Math.floor(Math.max(0,(1000/this._desiredFps)-(this.timeExpected-m)));this.timeExpected=m+this.timeToCall}if(this.advancedTiming){this.updateAdvancedTiming()}if(!this.game.paused){this.events.update(this.time);if(this._timers.length){this.updateTimers()}}},updateTimers:function(){var m=0;var l=this._timers.length;while(m<l){if(this._timers[m].update(this.time)){m++}else{this._timers.splice(m,1);l--}}},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this._desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var l=this._timers.length;while(l--){this._timers[l]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var l=this._timers.length;while(l--){this._timers[l]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*0.001},elapsedSince:function(l){return this.time-l},elapsedSecondsSince:function(l){return(this.time-l)*0.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(e.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(l){this._desiredFps=l;this.physicsElapsed=1/l;this.physicsElapsedMS=this.physicsElapsed*1000;this.desiredFpsMult=1/l}});e.Time.prototype.constructor=e.Time;e.Timer=function(l,m){if(m===undefined){m=true}this.game=l;this.running=false;this.autoDestroy=m;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new e.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};e.Timer.MINUTE=60000;e.Timer.SECOND=1000;e.Timer.HALF=500;e.Timer.QUARTER=250;e.Timer.prototype={create:function(p,l,n,s,m,o){p=Math.round(p);var q=p;if(this._now===0){q+=this.game.time.time}else{q+=this._now}var r=new e.TimerEvent(this,p,q,n,l,s,m,o);this.events.push(r);this.order();this.expired=false;return r},add:function(m,n,l){return this.create(m,false,0,n,l,Array.prototype.slice.call(arguments,3))},repeat:function(n,m,o,l){return this.create(n,false,m,o,l,Array.prototype.slice.call(arguments,4))},loop:function(m,n,l){return this.create(m,true,0,n,l,Array.prototype.slice.call(arguments,3))},start:function(l){if(this.running){return}this._started=this.game.time.time+(l||0);this.running=true;for(var m=0;m<this.events.length;m++){this.events[m].tick=this.events[m].delay+this._started}},stop:function(l){this.running=false;if(l===undefined){l=true}if(l){this.events.length=0}},remove:function(m){for(var l=0;l<this.events.length;l++){if(this.events[l]===m){this.events[l].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(m,l){if(m.tick<l.tick){return -1}else{if(m.tick>l.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(l){if(this.paused){return true}this.elapsed=l-this._now;this._now=l;if(this.elapsed>this.timeCap){this.adjustEvents(l-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(o){for(var m=0;m<this.events.length;m++){if(!this.events[m].pendingDelete){var l=this.events[m].tick-o;if(l<0){l=0}this.events[m].tick=this._now+l}}var n=this.nextTick-o;if(n<0){this.nextTick=this._now}else{this.nextTick=this._now+n}},resume:function(){if(!this.paused){return}var l=this.game.time.time;this._pauseTotal+=l-this._now;this._now=l;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.expired=true;this.events=[];this._len=0;this._i=0}};Object.defineProperty(e.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(e.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(e.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(e.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(e.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});e.Timer.prototype.constructor=e.Timer;e.TimerEvent=function(s,p,q,n,l,r,m,o){this.timer=s;this.delay=p;this.tick=q;this.repeatCount=n-1;this.loop=l;this.callback=r;this.callbackContext=m;this.args=o;this.pendingDelete=false};e.TimerEvent.prototype.constructor=e.TimerEvent;e.AnimationManager=function(l){this.sprite=l;this.game=l.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};e.AnimationManager.prototype={loadFrameData:function(l,n){if(l===undefined){return false}if(this.isLoaded){for(var m in this._anims){this._anims[m].updateFrameData(l)}}this._frameData=l;if(n===undefined||n===null){this.frame=0}else{if(typeof n==="string"){this.frameName=n}else{this.frame=n}}this.isLoaded=true;return true},copyFrameData:function(l,n){this._frameData=l.clone();if(this.isLoaded){for(var m in this._anims){this._anims[m].updateFrameData(this._frameData)}}if(n===undefined||n===null){this.frame=0}else{if(typeof n==="string"){this.frameName=n}else{this.frame=n}}this.isLoaded=true;return true},add:function(o,p,n,m,l){p=p||[];n=n||60;if(m===undefined){m=false}if(l===undefined){if(p&&typeof p[0]==="number"){l=true}else{l=false}}this._outputFrames=[];this._frameData.getFrameIndexes(p,l,this._outputFrames);this._anims[o]=new e.Animation(this.game,this.sprite,o,this._frameData,this._outputFrames,n,m);this.currentAnim=this._anims[o];if(this.sprite.tilingTexture){this.sprite.refreshTexture=true}return this._anims[o]},validateFrames:function(n,l){if(l===undefined){l=true}for(var m=0;m<n.length;m++){if(l===true){if(n[m]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(n[m])===false){return false}}}return true},play:function(o,n,m,l){if(this._anims[o]){if(this.currentAnim===this._anims[o]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(n,m,l)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[o];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(n,m,l)}}},stop:function(m,l){if(l===undefined){l=false}if(this.currentAnim&&(typeof m!=="string"||m===this.currentAnim.name)){this.currentAnim.stop(l)}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(l){if(this.currentAnim){this.currentAnim.next(l);this.currentFrame=this.currentAnim.currentFrame}},previous:function(l){if(this.currentAnim){this.currentAnim.previous(l);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(l){if(typeof l==="string"){if(this._anims[l]){return this._anims[l]}}return null},refreshFrame:function(){},destroy:function(){var l=null;for(var l in this._anims){if(this._anims.hasOwnProperty(l)){this._anims[l].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};e.AnimationManager.prototype.constructor=e.AnimationManager;Object.defineProperty(e.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(e.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(e.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(l){this.currentAnim.paused=l}});Object.defineProperty(e.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(e.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(l){if(typeof l==="number"&&this._frameData&&this._frameData.getFrame(l)!==null){this.currentFrame=this._frameData.getFrame(l);if(this.currentFrame){this.sprite.setFrame(this.currentFrame)}}}});Object.defineProperty(e.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(l){if(typeof l==="string"&&this._frameData&&this._frameData.getFrameByName(l)!==null){this.currentFrame=this._frameData.getFrameByName(l);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame)}}else{console.warn("Cannot set frameName: "+l)}}});e.Animation=function(m,q,o,p,r,n,l){if(l===undefined){l=false}this.game=m;this._parent=q;this._frameData=p;this.name=o;this._frames=[];this._frames=this._frames.concat(r);this.delay=1000/n;this.loop=l;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new e.Signal();this.onUpdate=null;this.onComplete=new e.Signal();this.onLoop=new e.Signal();this.isReversed=false;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};e.Animation.prototype={play:function(n,m,l){if(typeof n==="number"){this.delay=1000/n}if(typeof m==="boolean"){this.loop=m}if(typeof l!=="undefined"){this.killOnComplete=l}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(false,true);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(n,l){var p;if(l===undefined){l=false}if(typeof n==="string"){for(var m=0;m<this._frames.length;m++){if(this._frameData.getFrame(this._frames[m]).name===n){p=m}}}else{if(typeof n==="number"){if(l){p=n}else{for(var m=0;m<this._frames.length;m++){if(this._frames[m]===n){p=m}}}}}if(p){var o=this.isReversed?-1:1;this._frameIndex=p-o;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(l,m){if(l===undefined){l=false}if(m===undefined){m=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(l){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(m){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);if(this.isReversed){this._frameIndex-=this._frameSkip}else{this._frameIndex+=this._frameSkip}if(!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;if(this.isReversed){this._frameIndex=this._frames.length-1-this._frameIndex}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame)}this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(n,m){if(m===undefined){m=false}if(!this._frameData){return false}var l=this.currentFrame.index;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame&&(m||(!m&&l!==this.currentFrame.index))){this._parent.setFrame(this.currentFrame)}if(this.onUpdate&&n){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}},next:function(l){if(l===undefined){l=1}var m=this._frameIndex+l;if(m>=this._frames.length){if(this.loop){m%=this._frames.length}else{m=this._frames.length-1}}if(m!==this._frameIndex){this._frameIndex=m;this.updateCurrentFrame(true)}},previous:function(l){if(l===undefined){l=1}var m=this._frameIndex-l;if(m<0){if(this.loop){m=this._frames.length+m}else{m++}}if(m!==this._frameIndex){this._frameIndex=m;this.updateCurrentFrame(true)}},updateFrameData:function(l){this._frameData=l;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};e.Animation.prototype.constructor=e.Animation;Object.defineProperty(e.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(l){this.isPaused=l;if(l){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(e.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(l){this.isReversed=l}});Object.defineProperty(e.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(e.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(l){this.currentFrame=this._frameData.getFrame(this._frames[l]);if(this.currentFrame!==null){this._frameIndex=l;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(e.Animation.prototype,"speed",{get:function(){return 1000/this.delay},set:function(l){if(l>0){this.delay=1000/l}}});Object.defineProperty(e.Animation.prototype,"enableUpdate",{get:function(){return(this.onUpdate!==null)},set:function(l){if(l&&this.onUpdate===null){this.onUpdate=new e.Signal()}else{if(!l&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}}});e.Animation.generateFrameNames=function(p,s,n,q,o){if(q===undefined){q=""}var l=[];var r="";if(s<n){for(var m=s;m<=n;m++){if(typeof o==="number"){r=e.Utils.pad(m.toString(),o,"0",1)}else{r=m.toString()}r=p+r+q;l.push(r)}}else{for(var m=s;m>=n;m--){if(typeof o==="number"){r=e.Utils.pad(m.toString(),o,"0",1)}else{r=m.toString()}r=p+r+q;l.push(r)}}return l};e.Frame=function(o,m,q,p,l,n){this.index=o;this.x=m;this.y=q;this.width=p;this.height=l;if(this.width===0||this.height===0){console.warn('Phaser.Frame: Frame "'+this.name+'" has a width or height of zero')}this.name=n;this.centerX=Math.floor(p/2);this.centerY=Math.floor(l/2);this.distance=e.Math.distance(0,0,p,l);this.rotated=false;this.trimmed=false;this.sourceSizeW=p;this.sourceSizeH=l;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};e.Frame.prototype={resize:function(m,l){this.width=m;this.height=l;this.centerX=Math.floor(m/2);this.centerY=Math.floor(l/2);this.distance=e.Math.distance(0,0,m,l);this.sourceSizeW=m;this.sourceSizeH=l;this.right=this.x+m;this.bottom=this.y+l},setTrim:function(p,o,r,m,l,n,q){this.trimmed=p;if(p){this.sourceSizeW=o;this.sourceSizeH=r;this.centerX=Math.floor(o/2);this.centerY=Math.floor(r/2);this.spriteSourceSizeX=m;this.spriteSourceSizeY=l;this.spriteSourceSizeW=n;this.spriteSourceSizeH=q}},clone:function(){var l=new e.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var m in this){if(this.hasOwnProperty(m)){l[m]=this[m]}}return l},getRect:function(l){if(l===undefined){l=new e.Rectangle(this.x,this.y,this.width,this.height)}else{l.setTo(this.x,this.y,this.width,this.height)}return l}};e.Frame.prototype.constructor=e.Frame;e.FrameData=function(){this._frames=[];this._frameNames=[]};e.FrameData.prototype={addFrame:function(l){l.index=this._frames.length;this._frames.push(l);if(l.name!==""){this._frameNames[l.name]=l.index}return l},getFrame:function(l){if(l>=this._frames.length){l=0}return this._frames[l]},getFrameByName:function(l){if(typeof this._frameNames[l]==="number"){return this._frames[this._frameNames[l]]}return null},checkFrameName:function(l){if(this._frameNames[l]==null){return false}return true},clone:function(){var l=new e.FrameData();for(var m=0;m<this._frames.length;m++){l._frames.push(this._frames[m].clone())}for(var n in this._frameNames){if(this._frameNames.hasOwnProperty(n)){l._frameNames.push(this._frameNames[n])}}return l},getFrameRange:function(o,l,m){if(m===undefined){m=[]}for(var n=o;n<=l;n++){m.push(this._frames[n])}return m},getFrames:function(o,l,m){if(l===undefined){l=true}if(m===undefined){m=[]}if(o===undefined||o.length===0){for(var n=0;n<this._frames.length;n++){m.push(this._frames[n])}}else{for(var n=0;n<o.length;n++){if(l){m.push(this.getFrame(o[n]))}else{m.push(this.getFrameByName(o[n]))}}}return m},getFrameIndexes:function(o,l,m){if(l===undefined){l=true}if(m===undefined){m=[]}if(o===undefined||o.length===0){for(var n=0;n<this._frames.length;n++){m.push(this._frames[n].index)}}else{for(var n=0;n<o.length;n++){if(l&&this._frames[o[n]]){m.push(this._frames[o[n]].index)}else{if(this.getFrameByName(o[n])){m.push(this.getFrameByName(o[n]).index)}}}}return m},destroy:function(){this._frames=null;this._frameNames=null}};e.FrameData.prototype.constructor=e.FrameData;Object.defineProperty(e.FrameData.prototype,"total",{get:function(){return this._frames.length}});e.AnimationParser={spriteSheet:function(A,C,v,p,z,s,n,m){if(z===undefined){z=-1}if(s===undefined){s=0}if(n===undefined){n=0}if(m===undefined){m=0}var E=C;if(typeof C==="string"){E=A.cache.getImage(C)}if(E===null){return null}var u=E.width;var t=E.height;if(v<=0){v=Math.floor(-u/Math.min(-1,v))}if(p<=0){p=Math.floor(-t/Math.min(-1,p))}var o=Math.floor((u-s)/(v+n));var l=Math.floor((t-s)/(p+n));var D=o*l;if(m>D||m<-D){console.warn("Phaser.AnimationParser.spriteSheet: skipFrames = "+m.toString()+" is larger than total sprite number "+D.toString());return null}if(m<0){m=D+m}if(z!==-1){D=m+z}if(u===0||t===0||u<v||t<p||D===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+C+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var B=new e.FrameData();var r=s;var q=s;for(var w=0;w<D;w++){B.addFrame(new e.Frame(w,r,q,v,p,""));r+=v+n;if(r+v>u){r=s;q+=p+n}}return B},JSONData:function(l,n){if(!n.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(n);return}var o=new e.FrameData();var p=n.frames;var q;for(var m=0;m<p.length;m++){q=o.addFrame(new e.Frame(m,p[m].frame.x,p[m].frame.y,p[m].frame.w,p[m].frame.h,p[m].filename));if(p[m].trimmed){q.setTrim(p[m].trimmed,p[m].sourceSize.w,p[m].sourceSize.h,p[m].spriteSourceSize.x,p[m].spriteSourceSize.y,p[m].spriteSourceSize.w,p[m].spriteSourceSize.h)}if(p[m].rotated){q.rotated=true}}return o},JSONDataPyxel:function(r,s){var l=["layers","tilewidth","tileheight","tileswide","tileshigh"];l.forEach(function(u){if(!s[u]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+u+'" key.');console.log(s);return}});if(s.layers.length!==1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.");console.log(s);return}var o=new e.FrameData();var m=s.tileheight;var t=s.tilewidth;var q=s.layers[0]["tiles"];var p;for(var n=0;n<q.length;n++){p=o.addFrame(new e.Frame(n,q[n].x,q[n].y,t,m,"frame_"+n));p.setTrim(false)}return o},JSONDataHash:function(l,o){if(!o.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(o);return}var p=new e.FrameData();var q=o.frames;var r;var n=0;for(var m in q){r=p.addFrame(new e.Frame(n,q[m].frame.x,q[m].frame.y,q[m].frame.w,q[m].frame.h,m));if(q[m].trimmed){r.setTrim(q[m].trimmed,q[m].sourceSize.w,q[m].sourceSize.h,q[m].spriteSourceSize.x,q[m].spriteSourceSize.y,q[m].spriteSourceSize.w,q[m].spriteSourceSize.h)}if(q[m].rotated){r.rotated=true}n++}return p},XMLData:function(C,s){if(!s.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var q=new e.FrameData();var t=s.getElementsByTagName("SubTexture");var r;var l;var n;var z;var v;var m;var B;var A;var w;var u;var o;for(var p=0;p<t.length;p++){n=t[p].attributes;l=n.name.value;z=parseInt(n.x.value,10);v=parseInt(n.y.value,10);m=parseInt(n.width.value,10);B=parseInt(n.height.value,10);A=null;w=null;if(n.frameX){A=Math.abs(parseInt(n.frameX.value,10));w=Math.abs(parseInt(n.frameY.value,10));u=parseInt(n.frameWidth.value,10);o=parseInt(n.frameHeight.value,10)}r=q.addFrame(new e.Frame(p,z,v,m,B,l));if(A!==null||w!==null){r.setTrim(true,m,B,A,w,u,o)}}return q}};e.Cache=function(l){this.game=l;this.autoResolveURL=false;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{}};this._urlMap={};this._urlResolver=new Image();this._urlTemp=null;this.onSoundUnlock=new e.Signal();this._cacheMap=[];this._cacheMap[e.Cache.CANVAS]=this._cache.canvas;this._cacheMap[e.Cache.IMAGE]=this._cache.image;this._cacheMap[e.Cache.TEXTURE]=this._cache.texture;this._cacheMap[e.Cache.SOUND]=this._cache.sound;this._cacheMap[e.Cache.TEXT]=this._cache.text;this._cacheMap[e.Cache.PHYSICS]=this._cache.physics;this._cacheMap[e.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[e.Cache.BINARY]=this._cache.binary;this._cacheMap[e.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[e.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[e.Cache.JSON]=this._cache.json;this._cacheMap[e.Cache.XML]=this._cache.xml;this._cacheMap[e.Cache.VIDEO]=this._cache.video;this._cacheMap[e.Cache.SHADER]=this._cache.shader;this._cacheMap[e.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this.addDefaultImage();this.addMissingImage()};e.Cache.CANVAS=1;e.Cache.IMAGE=2;e.Cache.TEXTURE=3;e.Cache.SOUND=4;e.Cache.TEXT=5;e.Cache.PHYSICS=6;e.Cache.TILEMAP=7;e.Cache.BINARY=8;e.Cache.BITMAPDATA=9;e.Cache.BITMAPFONT=10;e.Cache.JSON=11;e.Cache.XML=12;e.Cache.VIDEO=13;e.Cache.SHADER=14;e.Cache.RENDER_TEXTURE=15;e.Cache.DEFAULT=null;e.Cache.MISSING=null;e.Cache.prototype={addCompressedTextureMetaData:function(m,l,q,n){if(this.checkImageKey(m)){this.removeImage(m)}var p=(q in e.LoaderParser)?e.LoaderParser[q](n):n;var o={key:m,url:l,data:p,base:new PIXI.BaseTexture(p,null,this.game.resolution),frame:new e.Frame(0,0,0,p.width,p.height,m),frameData:new e.FrameData(),fileFormat:q};o.frameData.addFrame(new e.Frame(0,0,0,p.width,p.height,l));this._cache.image[m]=o;this._resolveURL(l,o);return o},addCanvas:function(n,l,m){if(m===undefined){m=l.getContext("2d")}this._cache.canvas[n]={canvas:l,context:m}},addImage:function(n,m,o){if(this.checkImageKey(n)){this.removeImage(n)}if(o.complete===false){console.warn('Phaser.Cache.addImage: Image "'+n+"\" hasn't been retrieved yet")}var l={key:n,url:m,data:o,base:new PIXI.BaseTexture(o,null,this.game.resolution),frame:new e.Frame(0,0,0,o.width,o.height,n),frameData:new e.FrameData()};l.frameData.addFrame(new e.Frame(0,0,0,o.width,o.height,m));this._cache.image[n]=l;this._resolveURL(m,l);if(n==="__default"){e.Cache.DEFAULT=new PIXI.Texture(l.base)}else{if(n==="__missing"){e.Cache.MISSING=new PIXI.Texture(l.base)}}return l},addDefaultImage:function(){var m=this;var l=new Image();l.onload=function(){var n=m.addImage("__default",null,l);n.base.skipRender=true;e.Cache.DEFAULT=new PIXI.Texture(n.base);l.onload=null};l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg=="},addMissingImage:function(){var m=this;var l=new Image();l.onload=function(){var n=m.addImage("__missing",null,l);e.Cache.MISSING=new PIXI.Texture(n.base);l.onload=null};l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg=="},addSound:function(o,n,q,m,p){if(m===undefined){m=true;p=false}if(p===undefined){m=false;p=true}var l=false;if(p){l=true}this._cache.sound[o]={url:n,data:q,isDecoding:false,decoded:l,webAudio:m,audioTag:p,locked:this.game.sound.touchLocked};this._resolveURL(n,this._cache.sound[o])},addText:function(m,l,n){this._cache.text[m]={url:l,data:n};this._resolveURL(l,this._cache.text[m])},addPhysicsData:function(m,l,n,o){this._cache.physics[m]={url:l,data:n,format:o};this._resolveURL(l,this._cache.physics[m])},addTilemap:function(m,l,o,n){this._cache.tilemap[m]={url:l,data:o,format:n};this._resolveURL(l,this._cache.tilemap[m])},addBinary:function(m,l){this._cache.binary[m]=l},addBitmapData:function(l,n,m){n.key=l;if(m===undefined){m=new e.FrameData();m.addFrame(n.textureFrame)}this._cache.bitmapData[l]={data:n,frameData:m};return n},addBitmapFont:function(o,n,r,m,l,q,p){var s={url:n,data:r,font:null,base:new PIXI.BaseTexture(r,null,this.game.resolution)};if(q===undefined){q=0}if(p===undefined){p=0}if(l==="json"){s.font=e.LoaderParser.jsonBitmapFont(m,s.base,q,p,false,this.game.resolution)}else{s.font=e.LoaderParser.xmlBitmapFont(m,s.base,q,p,false,this.game.resolution)}this._cache.bitmapFont[o]=s;this._resolveURL(n,s)},addBitmapFontFromAtlas:function(u,m,p,q,t,s,r){var l=this.getFrameByName(m,p);if(!l){return}var o={font:null,base:this.getBaseTexture(m),frame:l};if(s===undefined){s=0}if(r===undefined){r=0}var n;if(t==="json"){n=this.getJSON(q);o.font=e.LoaderParser.jsonBitmapFont(n,o.base,s,r,l,this.game.resolution)}else{n=this.getXML(q);o.font=e.LoaderParser.xmlBitmapFont(n,o.base,s,r,l,this.game.resolution)}this._cache.bitmapFont[u]=o},addJSON:function(m,l,n){this._cache.json[m]={url:l,data:n};this._resolveURL(l,this._cache.json[m])},addXML:function(m,l,n){this._cache.xml[m]={url:l,data:n};this._resolveURL(l,this._cache.xml[m])},addVideo:function(n,m,o,l){this._cache.video[n]={url:m,data:o,isBlob:l,locked:true};this._resolveURL(m,this._cache.video[n])},addShader:function(m,l,n){this._cache.shader[m]={url:l,data:n};this._resolveURL(l,this._cache.shader[m])},addRenderTexture:function(l,m){this._cache.renderTexture[l]={texture:m,frame:new e.Frame(0,0,0,m.width,m.height,"","")}},addSpriteSheet:function(u,l,r,t,o,n,p,s,m){if(n===undefined){n=-1}if(p===undefined){p=0}if(s===undefined){s=0}var q={key:u,url:l,data:r,frameWidth:t,frameHeight:o,margin:p,spacing:s,base:new PIXI.BaseTexture(r,null,this.game.resolution),frameData:e.AnimationParser.spriteSheet(this.game,r,t,o,n,p,s,m)};this._cache.image[u]=q;this._resolveURL(l,q)},addTextureAtlas:function(n,m,o,l,q){var p={key:n,url:m,data:o,base:new PIXI.BaseTexture(o,null,this.game.resolution)};if(q===e.Loader.TEXTURE_ATLAS_XML_STARLING){p.frameData=e.AnimationParser.XMLData(this.game,l,n)}else{if(q===e.Loader.TEXTURE_ATLAS_JSON_PYXEL){p.frameData=e.AnimationParser.JSONDataPyxel(this.game,l,n)}else{if(Array.isArray(l.frames)){p.frameData=e.AnimationParser.JSONData(this.game,l,n)}else{p.frameData=e.AnimationParser.JSONDataHash(this.game,l,n)}}}this._cache.image[n]=p;this._resolveURL(m,p)},reloadSound:function(l){var n=this;var m=this.getSound(l);if(m){m.data.src=m.url;m.data.addEventListener("canplaythrough",function(){return n.reloadSoundComplete(l)},false);m.data.load()}},reloadSoundComplete:function(l){var m=this.getSound(l);if(m){m.locked=false;this.onSoundUnlock.dispatch(l)}},updateSound:function(l,n,m){var o=this.getSound(l);if(o){o[n]=m}},decodedSound:function(l,m){var n=this.getSound(l);n.data=m;n.decoded=true;n.isDecoding=false},isSoundDecoded:function(l){var m=this.getItem(l,e.Cache.SOUND,"isSoundDecoded");if(m){return m.decoded}},isSoundReady:function(l){var m=this.getItem(l,e.Cache.SOUND,"isSoundDecoded");if(m){return(m.decoded&&!this.game.sound.touchLocked)}},checkKey:function(l,m){if(this._cacheMap[l][m]){return true}return false},checkURL:function(l){if(this._urlMap[this._resolveURL(l)]){return true}return false},checkCanvasKey:function(l){return this.checkKey(e.Cache.CANVAS,l)},checkImageKey:function(l){return this.checkKey(e.Cache.IMAGE,l)},checkTextureKey:function(l){return this.checkKey(e.Cache.TEXTURE,l)},checkSoundKey:function(l){return this.checkKey(e.Cache.SOUND,l)},checkTextKey:function(l){return this.checkKey(e.Cache.TEXT,l)},checkPhysicsKey:function(l){return this.checkKey(e.Cache.PHYSICS,l)},checkTilemapKey:function(l){return this.checkKey(e.Cache.TILEMAP,l)},checkBinaryKey:function(l){return this.checkKey(e.Cache.BINARY,l)},checkBitmapDataKey:function(l){return this.checkKey(e.Cache.BITMAPDATA,l)},checkBitmapFontKey:function(l){return this.checkKey(e.Cache.BITMAPFONT,l)},checkJSONKey:function(l){return this.checkKey(e.Cache.JSON,l)},checkXMLKey:function(l){return this.checkKey(e.Cache.XML,l)},checkVideoKey:function(l){return this.checkKey(e.Cache.VIDEO,l)},checkShaderKey:function(l){return this.checkKey(e.Cache.SHADER,l)},checkRenderTextureKey:function(l){return this.checkKey(e.Cache.RENDER_TEXTURE,l)},getItem:function(m,l,o,n){if(!this.checkKey(l,m)){if(o){console.warn("Phaser.Cache."+o+': Key "'+m+'" not found in Cache.')}}else{if(n===undefined){return this._cacheMap[l][m]}else{return this._cacheMap[l][m][n]}}return null},getCanvas:function(l){return this.getItem(l,e.Cache.CANVAS,"getCanvas","canvas")},getImage:function(n,m){if(n===undefined||n===null){n="__default"}if(m===undefined){m=false}var l=this.getItem(n,e.Cache.IMAGE,"getImage");if(l===null){l=this.getItem("__missing",e.Cache.IMAGE,"getImage")}if(m){return l}else{return l.data}},getTextureFrame:function(l){return this.getItem(l,e.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(l){return this.getItem(l,e.Cache.SOUND,"getSound")},getSoundData:function(l){return this.getItem(l,e.Cache.SOUND,"getSoundData","data")},getText:function(l){return this.getItem(l,e.Cache.TEXT,"getText","data")},getPhysicsData:function(n,m,l){var q=this.getItem(n,e.Cache.PHYSICS,"getPhysicsData","data");if(q===null||m===undefined||m===null){return q}else{if(q[m]){var o=q[m];if(o&&l){for(var p in o){p=o[p];if(p.fixtureKey===l){return p}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+l+" in "+n+'"')}else{return o}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+n+" / "+m+'"')}}return null},getTilemapData:function(l){return this.getItem(l,e.Cache.TILEMAP,"getTilemapData")},getBinary:function(l){return this.getItem(l,e.Cache.BINARY,"getBinary")},getBitmapData:function(l){return this.getItem(l,e.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(l){return this.getItem(l,e.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(l,n){var m=this.getItem(l,e.Cache.JSON,"getJSON","data");if(m){if(n){return e.Utils.extend(true,Array.isArray(m)?[]:{},m)}else{return m}}else{return null}},getXML:function(l){return this.getItem(l,e.Cache.XML,"getXML","data")},getVideo:function(l){return this.getItem(l,e.Cache.VIDEO,"getVideo")},getShader:function(l){return this.getItem(l,e.Cache.SHADER,"getShader","data")},getRenderTexture:function(l){return this.getItem(l,e.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(m,l){if(l===undefined){l=e.Cache.IMAGE}return this.getItem(m,l,"getBaseTexture","base")},getFrame:function(m,l){if(l===undefined){l=e.Cache.IMAGE}return this.getItem(m,l,"getFrame","frame")},getFrameCount:function(m,l){var n=this.getFrameData(m,l);if(n){return n.total}else{return 0}},getFrameData:function(m,l){if(l===undefined){l=e.Cache.IMAGE}return this.getItem(m,l,"getFrameData","frameData")},hasFrameData:function(m,l){if(l===undefined){l=e.Cache.IMAGE}return(this.getItem(m,l,"","frameData")!==null)},updateFrameData:function(m,n,l){if(l===undefined){l=e.Cache.IMAGE}if(this._cacheMap[l][m]){this._cacheMap[l][m].frameData=n}},getFrameByIndex:function(n,m,l){var o=this.getFrameData(n,l);if(o){return o.getFrame(m)}else{return null}},getFrameByName:function(n,m,l){var o=this.getFrameData(n,l);if(o){return o.getFrameByName(m)}else{return null}},getURL:function(l){var l=this._resolveURL(l);if(l){return this._urlMap[l]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+l+'" or Cache.autoResolveURL was false');return null}},getKeys:function(l){if(l===undefined){l=e.Cache.IMAGE}var m=[];if(this._cacheMap[l]){for(var n in this._cacheMap[l]){if(n!=="__default"&&n!=="__missing"){m.push(n)}}}return m},removeCanvas:function(l){delete this._cache.canvas[l]},removeImage:function(m,n){if(n===undefined){n=true}var l=this.getImage(m,true);if(n&&l.base){l.base.destroy()}delete this._cache.image[m]},removeSound:function(l){delete this._cache.sound[l]},removeText:function(l){delete this._cache.text[l]},removePhysics:function(l){delete this._cache.physics[l]},removeTilemap:function(l){delete this._cache.tilemap[l]},removeBinary:function(l){delete this._cache.binary[l]},removeBitmapData:function(l){delete this._cache.bitmapData[l]},removeBitmapFont:function(l){delete this._cache.bitmapFont[l]},removeJSON:function(l){delete this._cache.json[l]},removeXML:function(l){delete this._cache.xml[l]},removeVideo:function(l){delete this._cache.video[l]},removeShader:function(l){delete this._cache.shader[l]},removeRenderTexture:function(l){delete this._cache.renderTexture[l]},removeSpriteSheet:function(l){delete this._cache.spriteSheet[l]},removeTextureAtlas:function(l){delete this._cache.image[l]},clearGLTextures:function(){for(var l in this._cache.image){this._cache.image[l].base._glTextures=[]}},_resolveURL:function(l,m){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+l;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(m){this._urlMap[this._urlTemp]=m}return this._urlTemp},destroy:function(){for(var n=0;n<this._cacheMap.length;n++){var l=this._cacheMap[n];for(var m in l){if(m!=="__default"&&m!=="__missing"){this.destroyItem(l[m]);delete l[m]}}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null},destroyItem:function(l){if(l.destroy){l.destroy()}else{if(l.base&&l.base.destroy){l.base.destroy()}if(l.data&&l.data.destroy){l.data.destroy()}if(l.frameData&&l.frameData.destroy){l.frameData.destroy()}if(l.texture&&l.texture.destroy){l.texture.destroy(true)}}}};e.Cache.prototype.constructor=e.Cache;e.Loader=function(l){this.game=l;this.cache=l.cache;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.path="";this.headers={requestedWith:false,json:"application/json",xml:"application/xml"};this.onLoadStart=new e.Signal();this.onLoadComplete=new e.Signal();this.onPackComplete=new e.Signal();this.onFileStart=new e.Signal();this.onFileComplete=new e.Signal();this.onFileError=new e.Signal();this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};e.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;e.Loader.TEXTURE_ATLAS_JSON_HASH=1;e.Loader.TEXTURE_ATLAS_XML_STARLING=2;e.Loader.PHYSICS_LIME_CORONA_JSON=3;e.Loader.PHYSICS_PHASER_JSON=4;e.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;e.Loader.prototype={setPreloadSprite:function(l,m){m=m||0;this.preloadSprite={sprite:l,direction:m,width:l.width,height:l.height,rect:null};if(m===0){this.preloadSprite.rect=new e.Rectangle(0,0,1,l.height)}else{this.preloadSprite.rect=new e.Rectangle(0,0,l.width,1)}l.crop(this.preloadSprite.rect);l.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(m,l){return this.getAssetIndex(m,l)>-1},getAssetIndex:function(o,n){var p=-1;for(var m=0;m<this._fileList.length;m++){var l=this._fileList[m];if(l.type===o&&l.key===n){p=m;if(!l.loaded&&!l.loading){break}}}return p},getAsset:function(m,l){var n=this.getAssetIndex(m,l);if(n>-1){return{index:n,file:this._fileList[n]}}return false},reset:function(m,l){if(l===undefined){l=false}if(this.resetLocked){return}if(m){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(l){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(s,u,m,r,q,t){if(q===undefined){q=false}if(u===undefined||u===""){console.warn("Phaser.Loader: Invalid or no key given of type "+s);return this}if(m===undefined||m===null){if(t){m=u+t}else{console.warn("Phaser.Loader: No URL given for file type: "+s+" key: "+u);return this}}var p={type:s,key:u,path:this.path,url:m,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(r){for(var l in r){p[l]=r[l]}}var o=this.getAssetIndex(s,u);if(q&&o>-1){var n=this._fileList[o];if(!n.loading&&!n.loaded){this._fileList[o]=p}else{this._fileList.push(p);this._totalFileCount++}}else{if(o===-1){this._fileList.push(p);this._totalFileCount++}}return this},replaceInFileList:function(o,n,l,m){return this.addToFileList(o,n,l,m,true)},pack:function(q,m,r,l){if(m===undefined){m=null}if(r===undefined){r=null}if(l===undefined){l=null}if(!m&&!r){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var p={type:"packfile",key:q,url:m,path:this.path,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:l};if(r){if(typeof r==="string"){r=JSON.parse(r)}p.data=r||{};p.loaded=true}for(var o=0;o<this._fileList.length+1;o++){var n=this._fileList[o];if(!n||(!n.loaded&&!n.loading&&n.type!=="packfile")){this._fileList.splice(o,0,p);this._totalPackCount++;break}}return this},image:function(n,m,l){if(typeof m==="object"){return this.texture(n,m,l)}else{return this.addToFileList("image",n,m,undefined,l,".png")}},imageFromBitmapData:function(m,n,l){return this.image(m,n.canvas.toDataURL("image/png"),l)},texture:function(o,n,m){if(this.game.renderType===e.WEBGL){var l=this.game.renderer.extensions.compression;var p;for(p in n){if(p.toUpperCase() in l){return this.addToFileList("texture",o,n[p],undefined,m,".pvr")}}}if(n.truecolor){this.addToFileList("image",o,n.truecolor,undefined,m,".png")}return this},images:function(m,n){if(Array.isArray(n)){for(var l=0;l<m.length;l++){this.image(m[l],n[l])}}else{for(var l=0;l<m.length;l++){this.image(m[l])}}return this},text:function(n,m,l){return this.addToFileList("text",n,m,undefined,l,".txt")},json:function(n,m,l){return this.addToFileList("json",n,m,undefined,l,".json")},shader:function(n,m,l){return this.addToFileList("shader",n,m,undefined,l,".frag")},xml:function(n,m,l){return this.addToFileList("xml",n,m,undefined,l,".xml")},script:function(n,m,o,l){if(o===undefined){o=false}if(o!==false&&l===undefined){l=this}return this.addToFileList("script",n,m,{syncPoint:true,callback:o,callbackContext:l},false,".js")},binary:function(n,m,o,l){if(o===undefined){o=false}if(o!==false&&l===undefined){l=o}return this.addToFileList("binary",n,m,{callback:o,callbackContext:l},false,".bin")},spritesheet:function(o,n,l,m,r,q,s,p){if(r===undefined){r=-1}if(q===undefined){q=0}if(s===undefined){s=0}if(p===undefined){p=0}return this.addToFileList("spritesheet",o,n,{frameWidth:l,frameHeight:m,frameMax:r,margin:q,spacing:s,skipFrames:p},false,".png")},audio:function(m,n,l){if(this.game.sound.noAudio){return this}if(l===undefined){l=true}if(typeof n==="string"){n=[n]}return this.addToFileList("audio",m,n,{buffer:null,autoDecode:l})},audioSprite:function(m,p,o,n,l){if(this.game.sound.noAudio){return this}if(o===undefined){o=null}if(n===undefined){n=null}if(l===undefined){l=true}this.audio(m,p,l);if(o){this.json(m+"-audioatlas",o)}else{if(n){if(typeof n==="string"){n=JSON.parse(n)}this.cache.addJSON(m+"-audioatlas","",n)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}}return this},audiosprite:function(m,p,o,n,l){return this.audioSprite(m,p,o,n,l)},video:function(m,o,n,l){if(n===undefined){if(this.game.device.firefox){n="loadeddata"}else{n="canplaythrough"}}if(l===undefined){l=false}if(typeof o==="string"){o=[o]}return this.addToFileList("video",m,o,{buffer:null,asBlob:l,loadEvent:n})},tilemap:function(m,l,n,o){if(l===undefined){l=null}if(n===undefined){n=null}if(o===undefined){o=e.Tilemap.CSV}if(!l&&!n){if(o===e.Tilemap.CSV){l=m+".csv"}else{l=m+".json"}}if(n){switch(o){case e.Tilemap.CSV:break;case e.Tilemap.TILED_JSON:if(typeof n==="string"){n=JSON.parse(n)}break}this.cache.addTilemap(m,null,n,o)}else{this.addToFileList("tilemap",m,l,{format:o})}return this},physics:function(m,l,n,o){if(l===undefined){l=null}if(n===undefined){n=null}if(o===undefined){o=e.Physics.LIME_CORONA_JSON}if(!l&&!n){l=m+".json"}if(n){if(typeof n==="string"){n=JSON.parse(n)}this.cache.addPhysicsData(m,null,n,o)}else{this.addToFileList("physics",m,l,{format:o})}return this},bitmapFont:function(r,l,s,m,q,p){if(l===undefined||l===null){l=r+".png"}if(s===undefined){s=null}if(m===undefined){m=null}if(s===null&&m===null){s=r+".xml"}if(q===undefined){q=0}if(p===undefined){p=0}if(s){this.addToFileList("bitmapfont",r,l,{atlasURL:s,xSpacing:q,ySpacing:p})}else{if(typeof m==="string"){var t,n;try{t=JSON.parse(m)}catch(o){n=this.parseXml(m)}if(!n&&!t){throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given")}this.addToFileList("bitmapfont",r,l,{atlasURL:null,atlasData:t||n,atlasType:(!!t?"json":"xml"),xSpacing:q,ySpacing:p})}}return this},atlasJSONArray:function(n,m,o,l){return this.atlas(n,m,o,l,e.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(n,m,o,l){return this.atlas(n,m,o,l,e.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(n,m,o,l){if(o===undefined){o=null}if(l===undefined){l=null}if(!o&&!l){o=n+".xml"}return this.atlas(n,m,o,l,e.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(o,n,p,l,q){if(n===undefined||n===null){n=o+".png"}if(p===undefined){p=null}if(l===undefined){l=null}if(q===undefined){q=e.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(!p&&!l){if(q===e.Loader.TEXTURE_ATLAS_XML_STARLING){p=o+".xml"}else{p=o+".json"}}if(p){this.addToFileList("textureatlas",o,n,{atlasURL:p,format:q})}else{switch(q){case e.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof l==="string"){l=JSON.parse(l)}break;case e.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof l==="string"){var m=this.parseXml(l);if(!m){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}l=m}break}this.addToFileList("textureatlas",o,n,{atlasURL:null,atlasData:l,format:q})}return this},withSyncPoint:function(m,l){this._withSyncPointDepth++;try{m.call(l||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(n,l){var m=this.getAsset(n,l);if(m){m.file.syncPoint=true}return this},removeFile:function(n,l){var m=this.getAsset(n,l);if(m){if(!m.loaded&&!m.loading){this._fileList.splice(m.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var o=0;o<this._flightQueue.length;o++){var n=this._flightQueue[o];if(n.loaded||n.error){this._flightQueue.splice(o,1);o--;n.loading=false;n.requestUrl=null;n.requestObject=null;if(n.error){this.onFileError.dispatch(n.key,n)}if(n.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,n.key,!n.error,this._loadedFileCount,this._totalFileCount)}else{if(n.type==="packfile"&&n.error){this._loadedPackCount++;this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)}}}}var l=false;var m=this.enableParallel?Math.max(1,this.maxParallelDownloads):1;for(var o=this._processingHead;o<this._fileList.length;o++){var n=this._fileList[o];if(n.type==="packfile"&&!n.error&&n.loaded&&o===this._processingHead){this.processPack(n);this._loadedPackCount++;this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)}if(n.loaded||n.error){if(o===this._processingHead){this._processingHead=o+1}}else{if(!n.loading&&this._flightQueue.length<m){if(n.type==="packfile"&&!n.data){this._flightQueue.push(n);n.loading=true;this.loadFile(n)}else{if(!l){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(n);n.loading=true;this.onFileStart.dispatch(this.progress,n.key,n.url);this.loadFile(n)}}}}if(!n.loaded&&n.syncPoint){l=true}if(this._flightQueue.length>=m||(l&&this._loadedPackCount===this._totalPackCount)){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else{if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var p=this;setTimeout(function(){p.finishedLoading(true)},2000)}}},finishedLoading:function(l){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!l&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.reset();this.onLoadComplete.dispatch();this.game.state.loadComplete()},asyncComplete:function(m,l){if(l===undefined){l=""}m.loaded=true;m.error=!!l;if(l){m.errorMessage=l;console.warn("Phaser.Loader - "+m.type+"["+m.key+"]: "+l)}this.processLoadQueue()},processPack:function(o){var l=o.data[o.key];if(!l){console.warn("Phaser.Loader - "+o.key+": pack has data, but not for pack key");return}for(var n=0;n<l.length;n++){var m=l[n];switch(m.type){case"image":this.image(m.key,m.url,m.overwrite);break;case"text":this.text(m.key,m.url,m.overwrite);break;case"json":this.json(m.key,m.url,m.overwrite);break;case"xml":this.xml(m.key,m.url,m.overwrite);break;case"script":this.script(m.key,m.url,m.callback,o.callbackContext||this);break;case"binary":this.binary(m.key,m.url,m.callback,o.callbackContext||this);break;case"spritesheet":this.spritesheet(m.key,m.url,m.frameWidth,m.frameHeight,m.frameMax,m.margin,m.spacing,m.skipFrames);break;case"video":this.video(m.key,m.urls);break;case"audio":this.audio(m.key,m.urls,m.autoDecode);break;case"audiosprite":this.audiosprite(m.key,m.urls,m.jsonURL,m.jsonData,m.autoDecode);break;case"tilemap":this.tilemap(m.key,m.url,m.data,e.Tilemap[m.format]);break;case"physics":this.physics(m.key,m.url,m.data,e.Loader[m.format]);break;case"bitmapFont":this.bitmapFont(m.key,m.textureURL,m.atlasURL,m.atlasData,m.xSpacing,m.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(m.key,m.textureURL,m.atlasURL,m.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(m.key,m.textureURL,m.atlasURL,m.atlasData);break;case"atlasXML":this.atlasXML(m.key,m.textureURL,m.atlasURL,m.atlasData);break;case"atlas":this.atlas(m.key,m.textureURL,m.atlasURL,m.atlasData,e.Loader[m.format]);break;case"shader":this.shader(m.key,m.url,m.overwrite);break}}},transformUrl:function(l,m){if(!l){return false}if(l.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)){return l}else{return this.baseURL+m.path+l}},loadFile:function(l){switch(l.type){case"packfile":this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(l);break;case"audio":l.url=this.getAudioURL(l.url);if(l.url){if(this.game.sound.usingWebAudio){this.xhrLoad(l,this.transformUrl(l.url,l),"arraybuffer",this.fileComplete)}else{if(this.game.sound.usingAudioTag){this.loadAudioTag(l)}}}else{this.fileError(l,null,"No supported audio URL specified or device does not have audio playback support")}break;case"video":l.url=this.getVideoURL(l.url);if(l.url){if(l.asBlob){this.xhrLoad(l,this.transformUrl(l.url,l),"blob",this.fileComplete)}else{this.loadVideoTag(l)}}else{this.fileError(l,null,"No supported video URL specified or device does not have video playback support")}break;case"json":this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.xmlLoadComplete);break;case"tilemap":if(l.format===e.Tilemap.TILED_JSON){this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.jsonLoadComplete)}else{if(l.format===e.Tilemap.CSV){this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.csvLoadComplete)}else{this.asyncComplete(l,"invalid Tilemap format: "+l.format)}}break;case"text":case"script":case"shader":case"physics":this.xhrLoad(l,this.transformUrl(l.url,l),"text",this.fileComplete);break;case"texture":if(l.key.split("_").pop()==="truecolor"){this.loadImageTag(l)}else{this.xhrLoad(l,this.transformUrl(l.url,l),"arraybuffer",this.fileComplete)}break;case"binary":this.xhrLoad(l,this.transformUrl(l.url,l),"arraybuffer",this.fileComplete);break}},loadImageTag:function(l){var m=this;l.data=new Image();l.data.name=l.key;if(this.crossOrigin){l.data.crossOrigin=this.crossOrigin}l.data.onload=function(){if(l.data.onload){l.data.onload=null;l.data.onerror=null;m.fileComplete(l)}};l.data.onerror=function(){if(l.data.onload){l.data.onload=null;l.data.onerror=null;m.fileError(l)}};l.data.src=this.transformUrl(l.url,l);if(!this.game.device.firefox&&l.data.complete&&l.data.width&&l.data.height){l.data.onload=null;l.data.onerror=null;this.fileComplete(l)}},loadVideoTag:function(l){var n=this;l.data=document.createElement("video");l.data.name=l.key;l.data.controls=false;l.data.autoplay=false;var m=function(){l.data.removeEventListener(l.loadEvent,m,false);l.data.onerror=null;l.data.canplay=true;e.GAMES[n.game.id].load.fileComplete(l)};l.data.onerror=function(){l.data.removeEventListener(l.loadEvent,m,false);l.data.onerror=null;l.data.canplay=false;n.fileError(l)};l.data.addEventListener(l.loadEvent,m,false);l.data.src=this.transformUrl(l.url,l);l.data.load()},loadAudioTag:function(m){var n=this;if(this.game.sound.touchLocked){m.data=new Audio();m.data.name=m.key;m.data.preload="auto";m.data.src=this.transformUrl(m.url,m);this.fileComplete(m)}else{m.data=new Audio();m.data.name=m.key;var l=function(){m.data.removeEventListener("canplaythrough",l,false);m.data.onerror=null;n.fileComplete(m)};m.data.onerror=function(){m.data.removeEventListener("canplaythrough",l,false);m.data.onerror=null;n.fileError(m)};m.data.preload="auto";m.data.src=this.transformUrl(m.url,m);m.data.addEventListener("canplaythrough",l,false);m.data.load()}},xhrLoad:function(n,m,o,p,l){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(n,m,o,p,l);return}var q=new XMLHttpRequest();q.open("GET",m,true);q.responseType=o;if(this.headers.requestedWith!==false){q.setRequestHeader("X-Requested-With",this.headers.requestedWith)}if(this.headers[n.type]){q.setRequestHeader("Accept",this.headers[n.type])}l=l||this.fileError;var r=this;q.onload=function(){try{if(q.readyState===4&&q.status>=400&&q.status<=599){return l.call(r,n,q)}else{return p.call(r,n,q)}}catch(s){if(!r.hasLoaded){r.asyncComplete(n,s.message||"Exception")}else{if(window.console){console.error(s)}}}};q.onerror=function(){try{return l.call(r,n,q)}catch(s){if(!r.hasLoaded){r.asyncComplete(n,s.message||"Exception")}else{if(window.console){console.error(s)}}}};n.requestObject=q;n.requestUrl=m;q.send()},xhrLoadWithXDR:function(n,m,o,p,l){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var q=new window.XDomainRequest();q.open("GET",m,true);q.responseType=o;q.timeout=3000;l=l||this.fileError;var r=this;q.onerror=function(){try{return l.call(r,n,q)}catch(s){r.asyncComplete(n,s.message||"Exception")}};q.ontimeout=function(){try{return l.call(r,n,q)}catch(s){r.asyncComplete(n,s.message||"Exception")}};q.onprogress=function(){};q.onload=function(){try{if(q.readyState===4&&q.status>=400&&q.status<=599){return l.call(r,n,q)}else{return p.call(r,n,q)}return p.call(r,n,q)}catch(s){r.asyncComplete(n,s.message||"Exception")}};n.requestObject=q;n.requestUrl=m;setTimeout(function(){q.send()},0)},getVideoURL:function(o){for(var m=0;m<o.length;m++){var l=o[m];var n;if(l.uri){n=l.type;l=l.uri;if(this.game.device.canPlayVideo(n)){return l}}else{if(l.indexOf("blob:")===0||l.indexOf("data:")===0){return l}if(l.indexOf("?")>=0){l=l.substr(0,l.indexOf("?"))}var p=l.substr((Math.max(0,l.lastIndexOf("."))||Infinity)+1);n=p.toLowerCase();if(this.game.device.canPlayVideo(n)){return o[m]}}}return null},getAudioURL:function(o){if(this.game.sound.noAudio){return null}for(var n=0;n<o.length;n++){var m=o[n];var l;if(m.uri){l=m.type;m=m.uri;if(this.game.device.canPlayAudio(l)){return m}}else{if(m.indexOf("blob:")===0||m.indexOf("data:")===0){return m}if(m.indexOf("?")>=0){m=m.substr(0,m.indexOf("?"))}var p=m.substr((Math.max(0,m.lastIndexOf("."))||Infinity)+1);l=p.toLowerCase();if(this.game.device.canPlayAudio(l)){return o[n]}}}return null},fileError:function(m,p,o){var l=m.requestUrl||this.transformUrl(m.url,m);var n="error loading asset from URL "+l;if(!o&&p){o=p.status}if(o){n=n+" ("+o+")"}this.asyncComplete(m,n)},fileComplete:function(l,p){var o=true;switch(l.type){case"packfile":var m=JSON.parse(p.responseText);l.data=m||{};break;case"texture":var q=/\.([^.]+)$/.exec(l.url.split("?",1)[0])[1].toLowerCase();if(l.data!==null){this.cache.addCompressedTextureMetaData(l.key,l.url,q,l.data)}else{this.cache.addCompressedTextureMetaData(l.key,l.url,q,p.response)}break;case"image":this.cache.addImage(l.key,l.url,l.data);break;case"spritesheet":this.cache.addSpriteSheet(l.key,l.url,l.data,l.frameWidth,l.frameHeight,l.frameMax,l.margin,l.spacing,l.skipFrames);break;case"textureatlas":if(l.atlasURL==null){this.cache.addTextureAtlas(l.key,l.url,l.data,l.atlasData,l.format)}else{o=false;if(l.format===e.Loader.TEXTURE_ATLAS_JSON_ARRAY||l.format===e.Loader.TEXTURE_ATLAS_JSON_HASH||l.format===e.Loader.TEXTURE_ATLAS_JSON_PYXEL){this.xhrLoad(l,this.transformUrl(l.atlasURL,l),"text",this.jsonLoadComplete)}else{if(l.format===e.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(l,this.transformUrl(l.atlasURL,l),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+l.format)}}}break;case"bitmapfont":if(!l.atlasURL){this.cache.addBitmapFont(l.key,l.url,l.data,l.atlasData,l.atlasType,l.xSpacing,l.ySpacing)}else{o=false;this.xhrLoad(l,this.transformUrl(l.atlasURL,l),"text",function(s,u){var r;try{r=JSON.parse(u.responseText)}catch(t){}if(!!r){s.atlasType="json";this.jsonLoadComplete(s,u)}else{s.atlasType="xml";this.xmlLoadComplete(s,u)}})}break;case"video":if(l.asBlob){try{l.data=p.response}catch(n){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+l.key)}}this.cache.addVideo(l.key,l.url,l.data,l.asBlob);break;case"audio":if(this.game.sound.usingWebAudio){l.data=p.response;this.cache.addSound(l.key,l.url,l.data,true,false);if(l.autoDecode){this.game.sound.decode(l.key)}}else{this.cache.addSound(l.key,l.url,l.data,false,true)}break;case"text":l.data=p.responseText;this.cache.addText(l.key,l.url,l.data);break;case"shader":l.data=p.responseText;this.cache.addShader(l.key,l.url,l.data);break;case"physics":var m=JSON.parse(p.responseText);this.cache.addPhysicsData(l.key,l.url,m,l.format);break;case"script":l.data=document.createElement("script");l.data.language="javascript";l.data.type="text/javascript";l.data.defer=false;l.data.text=p.responseText;document.head.appendChild(l.data);if(l.callback){l.data=l.callback.call(l.callbackContext,l.key,p.responseText)}break;case"binary":if(l.callback){l.data=l.callback.call(l.callbackContext,l.key,p.response)}else{l.data=p.response}this.cache.addBinary(l.key,l.data);break}if(o){this.asyncComplete(l)}},jsonLoadComplete:function(l,n){var m=JSON.parse(n.responseText);if(l.type==="tilemap"){this.cache.addTilemap(l.key,l.url,m,l.format)}else{if(l.type==="bitmapfont"){this.cache.addBitmapFont(l.key,l.url,l.data,m,l.atlasType,l.xSpacing,l.ySpacing)}else{if(l.type==="json"){this.cache.addJSON(l.key,l.url,m)}else{this.cache.addTextureAtlas(l.key,l.url,l.data,m,l.format)}}}this.asyncComplete(l)},csvLoadComplete:function(l,n){var m=n.responseText;this.cache.addTilemap(l.key,l.url,m,l.format);this.asyncComplete(l)},xmlLoadComplete:function(n,p){var o=p.responseText;var m=this.parseXml(o);if(!m){var l=p.responseType||p.contentType;console.warn("Phaser.Loader - "+n.key+": invalid XML ("+l+")");this.asyncComplete(n,"invalid XML");return}if(n.type==="bitmapfont"){this.cache.addBitmapFont(n.key,n.url,n.data,m,n.atlasType,n.xSpacing,n.ySpacing)}else{if(n.type==="textureatlas"){this.cache.addTextureAtlas(n.key,n.url,n.data,m,n.format)}else{if(n.type==="xml"){this.cache.addXML(n.key,n.url,m)}}}this.asyncComplete(n)},parseXml:function(m){var l;try{if(window.DOMParser){var o=new DOMParser();l=o.parseFromString(m,"text/xml")}else{l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML(m)}}catch(n){l=null}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length){return null}else{return l}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(e.Loader.prototype,"progressFloat",{get:function(){var l=(this._loadedFileCount/this._totalFileCount)*100;return e.Math.clamp(l||0,0,100)}});Object.defineProperty(e.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});e.Loader.prototype.constructor=e.Loader;e.LoaderParser={bitmapFont:function(m,p,o,n,q,l){return this.xmlBitmapFont(m,p,o,n,q,l)},xmlBitmapFont:function(m,s,n,w,t,v){if(v==null){v=1}var E={};var A=m.getElementsByTagName("info")[0];var u=m.getElementsByTagName("common")[0];E.font=A.getAttribute("face");E.size=parseInt(A.getAttribute("size"),10);E.lineHeight=parseInt(u.getAttribute("lineHeight"),10)+w;E.chars={};var D=m.getElementsByTagName("char");var r=(t)?t.x:0;var q=(t)?t.y:0;for(var z=0;z<D.length;z++){var l=parseInt(D[z].getAttribute("id"),10);E.chars[l]={x:r+parseInt(D[z].getAttribute("x"),10),y:q+parseInt(D[z].getAttribute("y"),10),width:parseInt(D[z].getAttribute("width"),10),height:parseInt(D[z].getAttribute("height"),10),xOffset:parseInt(D[z].getAttribute("xoffset"),10)/v,yOffset:parseInt(D[z].getAttribute("yoffset"),10)/v,xAdvance:(parseInt(D[z].getAttribute("xadvance"),10)+n)/v,kerning:{}}}var B=m.getElementsByTagName("kerning");for(z=0;z<B.length;z++){var p=parseInt(B[z].getAttribute("first"),10);var C=parseInt(B[z].getAttribute("second"),10);var o=parseInt(B[z].getAttribute("amount"),10)/v;E.chars[C].kerning[p]=o}return this.finalizeBitmapFont(s,E)},jsonBitmapFont:function(v,l,s,q,m,o){if(o==null){o=1}var p={font:v.font.info._face,size:parseInt(v.font.info._size,10),lineHeight:parseInt(v.font.common._lineHeight,10)+q,chars:{}};var t=(m)?m.x:0;var r=(m)?m.y:0;v.font.chars["char"].forEach(function u(x){var w=parseInt(x._id,10);p.chars[w]={x:t+parseInt(x._x,10),y:r+parseInt(x._y,10),width:parseInt(x._width,10),height:parseInt(x._height,10),xOffset:parseInt(x._xoffset,10)/o,yOffset:parseInt(x._yoffset,10)/o,xAdvance:(parseInt(x._xadvance,10)+s)/o,kerning:{}}});if(v.font.kernings&&v.font.kernings.kerning){v.font.kernings.kerning.forEach(function n(w){p.chars[w._second].kerning[w._first]=parseInt(w._amount,10)/o})}return this.finalizeBitmapFont(l,p)},finalizeBitmapFont:function(l,m){Object.keys(m.chars).forEach(function n(o){var p=m.chars[o];p.texture=new PIXI.Texture(l,new e.Rectangle(p.x,p.y,p.width,p.height))});return m},pvr:function(p){var o=new Uint32Array(p.slice(0,52)),n=new Uint8Array(p),l=null,m=(o[3]<<32|o[2]),r,q=0;if(o[0]===55727696&&[0,1,2,3,6,7,9,11].indexOf(m)>=0){if(m>=0&&m<=3){r="PVRTC"}else{if(m>=7&&m<=11){r="S3TC"}else{if(m===6){r="ETC1"}}}switch(m){case 0:q=35841;break;case 1:q=35843;break;case 2:q=35840;break;case 3:q=35842;break;case 6:q=36196;break;case 7:q=33777;break;case 9:q=33778;break;case 11:q=33779;break;default:q=-1}l={complete:true,fileFormat:"PVR",compressionAlgorithm:r,flags:o[1],pixelFormat:m,colorSpace:o[4],channelType:o[5],height:o[6],width:o[7],depth:o[8],numberOfSurfaces:o[9],numberOfFaces:o[10],numberOfMipmaps:o[11],metaDataSize:o[12],textureData:n.subarray(52+o[12],n.byteLength),glExtensionFormat:q}}return l},dds:function(n){var l=new Uint8Array(n),m=new Uint32Array(n),o=null;if(l[0]===68&&l[1]===68&&l[2]===83&&l[3]===32){o={complete:true,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:m[1],flags:m[2],height:m[3],width:m[4],pitch:m[5],depth:m[6],mipmapCount:m[7],formatSize:m[19],formatFlag:m[19],formatFourCC:[String.fromCharCode(l[84]),String.fromCharCode(l[85]),String.fromCharCode(l[86]),String.fromCharCode(l[87])].join(""),formatBitCount:m[21],formatRBitMask:m[22],formatGBitMask:m[23],formatBBitMask:m[24],formatABitMask:m[25],caps1:m[26],caps2:m[27],caps3:m[28],caps4:m[29],reserved2:m[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:l.subarray(m[1]+4,l.byteLength)};if(o.formatFourCC==="DX10"){o.DXGIFormat=m[31];o.resourceDimension=m[32];o.miscFlag=m[33];o.arraySize=m[34];o.miscFlag=m[35]}}return o},ktx:function(n){var l=new Uint8Array(n),m=new Uint32Array(n),s=null,p=16+(m[15]/4)|0,q=m[p],o=m[7],r=0;if(l[0]===171&&l[1]===75&&l[2]===84&&l[3]===88&&l[4]===32&&l[5]===49&&l[6]===49&&l[7]===187&&l[8]===13&&l[9]===10&&l[10]===26&&l[11]===10&&[36196,35840,35841,35842,35843,33776,33777,33778,33779].indexOf(o)>=0){switch(o){case 36196:r="ETC1";break;case 35840:case 35841:case 35842:case 35843:r="PVRTC";break;case 33776:case 33777:case 33778:case 33779:r="S3TC";break}s={complete:true,fileFormat:"KTX",compressionAlgorithm:r,endianness:m[3],glType:m[4],glTypeSize:m[5],glFormat:m[6],glInternalFormat:m[7],glBaseInternalFormat:m[8],width:m[9],height:m[10],pixelDepth:m[11],numberOfArrayElements:m[12],numberOfFaces:m[13],numberOfMipmapLevels:m[14],bytesOfKeyValueData:m[15],keyAndValueByteSize:m[16],imageSize:q,textureData:l.subarray((p+1)*4,q+100)}}return s},pkm:function(n){var m=new Uint8Array(n),l=null;if(m[0]===80&&m[1]===75&&m[2]===77&&m[3]===32){l={complete:true,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:((m[6]<<8|m[7]))&65535,width:((m[8]<<8|m[9]))&65535,height:((m[10]<<8|m[11]))&65535,originalWidth:((m[12]<<8|m[13]))&65535,originalHeight:((m[14]<<8|m[15]))&65535,textureData:m.subarray(16,m.length)}}return l}};e.AudioSprite=function(n,o){this.game=n;this.key=o;this.config=this.game.cache.getJSON(o+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var m in this.config.spritemap){var l=this.config.spritemap[m];var p=this.game.add.sound(this.key);p.addMarker(m,l.start,(l.end-l.start),null,l.loop);this.sounds[m]=p}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};e.AudioSprite.prototype={play:function(l,m){if(m===undefined){m=1}return this.sounds[l].play(l,null,m)},stop:function(l){if(!l){for(var m in this.sounds){this.sounds[m].stop()}}else{this.sounds[l].stop()}},get:function(l){return this.sounds[l]}};e.AudioSprite.prototype.constructor=e.AudioSprite;e.Sound=function(n,o,p,l,m){if(p===undefined){p=1}if(l===undefined){l=false}if(m===undefined){m=n.sound.connectToMaster}this.game=n;this.name=o;this.key=o;this.loop=l;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;this._globalVolume=1;this._markedToDelete=false;this._removeFromSoundManager=false;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(this.context.createGain===undefined){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=p*this.game.sound.volume;if(m){this.gainNode.connect(this.masterGainNode)}}else{if(this.usingAudioTag){if(this.game.cache.getSound(o)&&this.game.cache.isSoundReady(o)){this._sound=this.game.cache.getSoundData(o);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}}this.onDecoded=new e.Signal();this.onPlay=new e.Signal();this.onPause=new e.Signal();this.onResume=new e.Signal();this.onLoop=new e.Signal();this.onStop=new e.Signal();this.onMute=new e.Signal();this.onMarkerComplete=new e.Signal();this.onFadeComplete=new e.Signal();this._volume=p;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};e.Sound.prototype={soundHasUnlocked:function(l){if(l===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(m,p,o,n,l){if(o===undefined||o===null){o=1}if(n===undefined||n===null){n=1}if(l===undefined){l=false}this.markers[m]={name:m,start:p,stop:p+o,volume:n,duration:o,durationMS:o*1000,loop:l}},removeMarker:function(l){delete this.markers[l]},onEndedHandler:function(){this._sound.onended=null;this.isPlaying=false;this.currentTime=this.durationMS;this.stop();if(this._markedToDelete){if(this.externalNode){this._sound.disconnect(this.externalNode)}else{if(this.gainNode){this._sound.disconnect(this.gainNode)}}if(this._removeFromSoundManager){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);this.isPlaying=false;if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time;this.isPlaying=true}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}this.isPlaying=false;this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(l){return this.play(null,0,l,true)},play:function(n,l,p,m,o){if(n===undefined||n===false||n===null){n=""}if(o===undefined){o=true}if(this.isPlaying&&!this.allowMultiple&&!o&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||o)){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(q){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else{if(this.gainNode){this._sound.disconnect(this.gainNode)}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.isPlaying=false}if(n===""&&Object.keys(this.markers).length>0){return this}if(n!==""){if(this.markers[n]){this.currentMarker=n;this.position=this.markers[n].start;this.volume=this.markers[n].volume;this.loop=this.markers[n].loop;this.duration=this.markers[n].duration;this.durationMS=this.markers[n].durationMS;if(typeof p!=="undefined"){this.volume=p}if(typeof m!=="undefined"){this.loop=m}this._tempMarker=n;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+n+" doesn't exist");return this}}else{l=l||0;if(p===undefined){p=this._volume}if(m===undefined){m=this.loop}this.position=Math.max(0,l);this.volume=p;this.loop=m;this.duration=0;this.durationMS=0;this._tempMarker=n;this._tempPosition=l;this._tempVolume=p;this._tempLoop=m}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){this._sound=this.context.createBufferSource();if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;if(this.loop&&n===""){this._sound.loop=true}if(!this.loop&&n===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1000)}if(this._sound.start===undefined){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&n===""){this._sound.start(0,0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted||this.game.sound.mute){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(n,l,o,m){n=n||"";l=l||0;o=o||1;if(m===undefined){m=false}this.play(n,l,o,m,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this._tempPause=this._sound.currentTime;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var m=Math.max(0,this.position+(this.pausedPosition/1000));this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var l=this.duration-(this.pausedPosition/1000);if(this._sound.start===undefined){this._sound.noteGrainOn(0,m,l)}else{if(this.loop&&this.game.device.chrome){if(this.game.device.chromeVersion===42){this._sound.start(0)}else{this._sound.start(0,m)}}else{this._sound.start(0,m,l)}}}else{this._sound.currentTime=this._tempPause;this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.time-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(m){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else{if(this.gainNode){this._sound.disconnect(this.gainNode)}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.pendingPlayback=false;this.isPlaying=false;if(!this.paused){var l=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}this.onStop.dispatch(this,l)}},fadeIn:function(n,m,l){if(m===undefined){m=false}if(l===undefined){l=this.currentMarker}if(this.paused){return}this.play(l,0,0,m);this.fadeTo(n,1)},fadeOut:function(l){this.fadeTo(l,0)},fadeTo:function(m,l){if(!this.isPlaying||this.paused||l===this.volume){return}if(m===undefined){m=1000}if(l===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:l},m,e.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},updateGlobalVolume:function(l){if(this.usingAudioTag&&this._sound){this._globalVolume=l;this._sound.volume=this._globalVolume*this._volume}},destroy:function(l){if(l===undefined){l=true}this._markedToDelete=true;this._removeFromSoundManager=l;this.stop();if(l){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};e.Sound.prototype.constructor=e.Sound;Object.defineProperty(e.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(e.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(e.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(l){l=l||false;if(l===this._muted){return}if(l){this._muted=true;this._muteVolume=this._tempVolume;if(this.usingWebAudio){this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(e.Sound.prototype,"volume",{get:function(){return this._volume},set:function(l){if(this.usingAudioTag){l=this.game.math.clamp(l,0,1)}if(this._muted){this._muteVolume=l;return}this._tempVolume=l;this._volume=l;if(this.usingWebAudio){this.gainNode.gain.value=l}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._globalVolume*l}}}});e.SoundManager=function(l){this.game=l;this.onSoundDecode=new e.Signal();this.onVolumeChange=new e.Signal();this.onMute=new e.Signal();this.onUnMute=new e.Signal();this.context=null;this.usingWebAudio=false;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32;this.muteOnPause=true;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new e.ArraySet();this._watching=false;this._watchCallback=null;this._watchContext=null};e.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.noAudio=true;this.touchLocked=false;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingAudioTag=true;this.touchLocked=false;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext){this.context=window.PhaserGlobal.audioContext}else{if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(l){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(l){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}}}if(this.context===null){if(window.Audio===undefined){this.noAudio=true;return}else{this.usingAudioTag=true}}else{this.usingWebAudio=true;if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}if(!this.noAudio){if(!this.game.device.cocoonJS&&this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.setTouchLock()}}},setTouchLock:function(){if(this.noAudio||(window.PhaserGlobal&&window.PhaserGlobal.disableAudio===true)){return}if(this.game.device.iOSVersion>8){this.game.input.touch.addTouchLockCallback(this.unlock,this,true)}else{this.game.input.touch.addTouchLockCallback(this.unlock,this)}this.touchLocked=true},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null){return true}if(this.usingAudioTag){this.touchLocked=false;this._unlockSource=null}else{if(this.usingWebAudio){var l=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=l;this._unlockSource.connect(this.context.destination);if(this._unlockSource.start===undefined){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}}return true},stopAll:function(){if(this.noAudio){return}for(var l=0;l<this._sounds.length;l++){if(this._sounds[l]){this._sounds[l].stop()}}},pauseAll:function(){if(this.noAudio){return}for(var l=0;l<this._sounds.length;l++){if(this._sounds[l]){this._sounds[l].pause()}}},resumeAll:function(){if(this.noAudio){return}for(var l=0;l<this._sounds.length;l++){if(this._sounds[l]){this._sounds[l].resume()}}},decode:function(m,o){o=o||null;var l=this.game.cache.getSoundData(m);if(l){if(this.game.cache.isSoundDecoded(m)===false){this.game.cache.updateSound(m,"isDecoding",true);var p=this;try{this.context.decodeAudioData(l,function(q){if(q){p.game.cache.decodedSound(m,q);p.onSoundDecode.dispatch(m,o)}})}catch(n){}}}},setDecodedCallback:function(n,o,l){if(typeof n==="string"){n=[n]}this._watchList.reset();for(var m=0;m<n.length;m++){if(n[m] instanceof e.Sound){if(!this.game.cache.isSoundDecoded(n[m].key)){this._watchList.add(n[m].key)}}else{if(!this.game.cache.isSoundDecoded(n[m])){this._watchList.add(n[m])}}}if(this._watchList.total===0){this._watching=false;o.call(l)}else{this._watching=true;this._watchCallback=o;this._watchContext=l}},update:function(){if(this.noAudio){return}if(this.touchLocked&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null}for(var m=0;m<this._sounds.length;m++){this._sounds[m].update()}if(this._watching){var l=this._watchList.first;while(l){if(this.game.cache.isSoundDecoded(l)){this._watchList.remove(l)}l=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(n,o,l,m){if(o===undefined){o=1}if(l===undefined){l=false}if(m===undefined){m=this.connectToMaster}var p=new e.Sound(this.game,n,o,l,m);this._sounds.push(p);return p},addSprite:function(m){var l=new e.AudioSprite(this.game,m);return l},remove:function(m){var l=this._sounds.length;while(l--){if(this._sounds[l]===m){this._sounds[l].destroy(false);this._sounds.splice(l,1);return true}}return false},removeByKey:function(m){var l=this._sounds.length;var n=0;while(l--){if(this._sounds[l].key===m){this._sounds[l].destroy(false);this._sounds.splice(l,1);n++}}return n},play:function(m,n,l){if(this.noAudio){return}var o=this.add(m,n,l);o.play();return o},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var l=0;l<this._sounds.length;l++){if(this._sounds[l].usingAudioTag){this._sounds[l].mute=true}}this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var l=0;l<this._sounds.length;l++){if(this._sounds[l].usingAudioTag){this._sounds[l].mute=false}}this.onUnMute.dispatch()},destroy:function(){this.stopAll();for(var l=0;l<this._sounds.length;l++){if(this._sounds[l]){this._sounds[l].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context){if(window.PhaserGlobal){window.PhaserGlobal.audioContext=this.context}else{if(this.context.close){this.context.close()}}}}};e.SoundManager.prototype.constructor=e.SoundManager;Object.defineProperty(e.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(l){l=l||false;if(l){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(e.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(m){if(m<0){m=0}else{if(m>1){m=1}}if(this._volume!==m){this._volume=m;if(this.usingWebAudio){this.masterGain.gain.value=m}else{for(var l=0;l<this._sounds.length;l++){if(this._sounds[l].usingAudioTag){this._sounds[l].updateGlobalVolume(m)}}}this.onVolumeChange.dispatch(m)}}});e.ScaleManager=function(m,n,l){this.game=m;this.dom=e.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new e.Point();this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.onOrientationChange=new e.Signal();this.enterIncorrectOrientation=new e.Signal();this.leaveIncorrectOrientation=new e.Signal();this.hasPhaserSetFullScreen=false;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new e.Signal();this.onFullScreenChange=new e.Signal();this.onFullScreenError=new e.Signal();this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new e.Point(1,1);this.scaleFactorInversed=new e.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new e.Rectangle();this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=e.ScaleManager.NO_SCALE;this._fullScreenScaleMode=e.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new e.Point(1,1);this.trackParentInterval=2000;this.onSizeChange=new e.Signal();this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new e.Rectangle();this._userScaleFactor=new e.Point(1,1);this._userScaleTrim=new e.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new e.Rectangle();this._tempBounds=new e.Rectangle();this._lastReportedCanvasSize=new e.Rectangle();this._lastReportedGameSize=new e.Rectangle();this._booted=false;if(m.config){this.parseConfig(m.config)}this.setupScale(n,l)};e.ScaleManager.EXACT_FIT=0;e.ScaleManager.NO_SCALE=1;e.ScaleManager.SHOW_ALL=2;e.ScaleManager.RESIZE=3;e.ScaleManager.USER_SCALE=4;e.ScaleManager.prototype={boot:function(){var l=this.compatibility;l.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){l.scrollTo=new e.Point(0,1)}else{l.scrollTo=new e.Point(0,0)}}if(this.game.device.desktop){l.orientationFallback="screen";l.clickTrampoline="when-not-mouse"}else{l.orientationFallback="";l.clickTrampoline=""}var m=this;this._orientationChange=function(n){return m.orientationChange(n)};this._windowResize=function(n){return m.windowResize(n)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(n){return m.fullScreenChange(n)};this._fullScreenError=function(n){return m.fullScreenError(n)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);if(e.FlexGrid){this.grid=new e.FlexGrid(this,this.width,this.height)}this._booted=true;if(this._pendingScaleMode!==null){this.scaleMode=this._pendingScaleMode;this._pendingScaleMode=null}},parseConfig:function(l){if(l.scaleMode!==undefined){if(this._booted){this.scaleMode=l.scaleMode}else{this._pendingScaleMode=l.scaleMode}}if(l.fullScreenScaleMode!==undefined){this.fullScreenScaleMode=l.fullScreenScaleMode}if(l.fullScreenTarget){this.fullScreenTarget=l.fullScreenTarget}},setupScale:function(n,l){var q;var p=new e.Rectangle();if(this.game.parent!==""){if(typeof this.game.parent==="string"){q=document.getElementById(this.game.parent)}else{if(this.game.parent&&this.game.parent.nodeType===1){q=this.game.parent}}}if(!q){this.parentNode=null;this.parentIsWindow=true;p.width=this.dom.visualBounds.width;p.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=q;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);p.width=this._parentBounds.width;p.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var o=0;var m=0;if(typeof n==="number"){o=n}else{this.parentScaleFactor.x=parseInt(n,10)/100;o=p.width*this.parentScaleFactor.x}if(typeof l==="number"){m=l}else{this.parentScaleFactor.y=parseInt(l,10)/100;m=p.height*this.parentScaleFactor.y}o=Math.floor(o);m=Math.floor(m);this._gameSize.setTo(0,0,o,m);this.updateDimensions(o,m,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(m,l){this._gameSize.setTo(0,0,m,l);if(this.currentScaleMode!==e.ScaleManager.RESIZE){this.updateDimensions(m,l,true)}this.queueUpdate(true)},setUserScale:function(m,q,o,l,n,p){this._userScaleFactor.setTo(m,q);this._userScaleTrim.setTo(o|0,l|0);if(n===undefined){n=true}if(p===undefined){p=true}if(n){this.queueUpdate(p)}},setResizeCallback:function(m,l){this.onResize=m;this.onResizeContext=l},signalSizeChange:function(){if(!e.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!e.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var m=this.width;var l=this.height;this._lastReportedCanvasSize.setTo(0,0,m,l);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid){this.grid.onResize(m,l)}this.onSizeChange.dispatch(this,m,l);if(this.currentScaleMode===e.ScaleManager.RESIZE){this.game.state.resize(m,l);this.game.load.resize(m,l)}}},setMinMax:function(l,o,n,m){this.minWidth=l;this.minHeight=o;if(typeof n!=="undefined"){this.maxWidth=n}if(typeof m!=="undefined"){this.maxHeight=m}},preUpdate:function(){if(this.game.time.time<(this._lastUpdate+this._updateThrottle)){return}var m=this._updateThrottle;this._updateThrottleReset=m>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var p=this._parentBounds.width;var r=this._parentBounds.height;var o=this.getParentBounds(this._parentBounds);var n=o.width!==p||o.height!==r;var l=this.updateOrientationState();if(n||l){if(this.onResize){this.onResize.call(this.onResizeContext,this,o)}this.updateLayout();this.signalSizeChange()}var q=this._updateThrottle*2;if(this._updateThrottle<m){q=Math.min(m,this._updateThrottleReset)}this._updateThrottle=e.Math.clamp(q,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(n,l,m){this.width=n*this.parentScaleFactor.x;this.height=l*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(m){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(m,l){if(l===undefined){l=false}if(m===true&&l===true){console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.");return}this.forceLandscape=m;this.forcePortrait=l;this.queueUpdate(true)},classifyOrientation:function(l){if(l==="portrait-primary"||l==="portrait-secondary"){return"portrait"}else{if(l==="landscape-primary"||l==="landscape-secondary"){return"landscape"}else{return null}}},updateOrientationState:function(){var n=this.screenOrientation;var m=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=(this.forceLandscape&&!this.isLandscape)||(this.forcePortrait&&!this.isPortrait);var o=n!==this.screenOrientation;var l=m!==this.incorrectOrientation;if(l){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(o||l){this.onOrientationChange.dispatch(this,n,m)}return o||l},orientationChange:function(l){this.event=l;this.queueUpdate(true)},windowResize:function(l){this.event=l;this.queueUpdate(true)},scrollTop:function(){var l=this.compatibility.scrollTo;if(l){window.scrollTo(l.x,l.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var l=this.currentScaleMode;if(l===e.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(l===e.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(l===e.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else{if(l===e.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else{if(l===e.ScaleManager.USER_SCALE){this.width=(this.game.width*this._userScaleFactor.x)-this._userScaleTrim.x;this.height=(this.game.height*this._userScaleFactor.y)-this._userScaleTrim.y}}}}}if(!this.compatibility.canExpandParent&&(l===e.ScaleManager.SHOW_ALL||l===e.ScaleManager.USER_SCALE)){var m=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,m.width);this.height=Math.min(this.height,m.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(r){var l=r||new e.Rectangle();var q=this.boundingParent;var o=this.dom.visualBounds;var t=this.dom.layoutBounds;if(!q){l.setTo(0,0,o.width,o.height)}else{var m=q.getBoundingClientRect();var s=(q.offsetParent)?q.offsetParent.getBoundingClientRect():q.getBoundingClientRect();l.setTo(m.left-s.left,m.top-s.top,m.width,m.height);var p=this.windowConstraints;if(p.right){var n=p.right==="layout"?t:o;l.right=Math.min(l.right,n.width)}if(p.bottom){var n=p.bottom==="layout"?t:o;l.bottom=Math.min(l.bottom,n.height)}}l.setTo(Math.round(l.x),Math.round(l.y),Math.round(l.width),Math.round(l.height));return l},alignCanvas:function(m,o){var t=this.getParentBounds(this._tempBounds);var n=this.game.canvas;var p=this.margin;if(m){p.left=p.right=0;var s=n.getBoundingClientRect();if(this.width<t.width&&!this.incorrectOrientation){var l=s.left-t.x;var r=(t.width/2)-(this.width/2);r=Math.max(r,0);var q=r-l;p.left=Math.round(q)}n.style.marginLeft=p.left+"px";if(p.left!==0){p.right=-(t.width-s.width-p.left);n.style.marginRight=p.right+"px"}}if(o){p.top=p.bottom=0;var s=n.getBoundingClientRect();if(this.height<t.height&&!this.incorrectOrientation){var l=s.top-t.y;var r=(t.height/2)-(this.height/2);r=Math.max(r,0);var q=r-l;p.top=Math.round(q)}n.style.marginTop=p.top+"px";if(p.top!==0){p.bottom=-(t.height-s.height-p.top);n.style.marginBottom=p.bottom+"px"}}p.x=p.left;p.y=p.top},reflowGame:function(){this.resetCanvas("","");var l=this.getParentBounds(this._tempBounds);this.updateDimensions(l.width,l.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=e.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=e.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(n,m){if(n===undefined){n=this.width+"px"}if(m===undefined){m=this.height+"px"}var l=this.game.canvas;if(!this.compatibility.noMargins){l.style.marginLeft="";l.style.marginTop="";l.style.marginRight="";l.style.marginBottom=""}l.style.width=n;l.style.height=m},queueUpdate:function(l){if(l){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(l){if(l&&this.grid){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(p){var n=this.getParentBounds(this._tempBounds);var m=n.width;var l=n.height;var o;if(p){o=Math.max((l/this.game.height),(m/this.game.width))}else{o=Math.min((l/this.game.height),(m/this.game.width))}this.width=Math.round(this.game.width*o);this.height=Math.round(this.game.height*o)},setExactFit:function(){var l=this.getParentBounds(this._tempBounds);this.width=l.width;this.height=l.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var l=document.createElement("div");l.style.margin="0";l.style.padding="0";l.style.background="#000";return l},startFullScreen:function(m,r){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var s=this;setTimeout(function(){s.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var n=this.game.input;if(n.activePointer&&n.activePointer!==n.mousePointer&&(r||r!==false)){n.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[m,false]);return}}if(m!==undefined&&this.game.renderType===e.CANVAS){this.game.stage.smoothed=m}var q=this.fullScreenTarget;if(!q){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();q=this._createdFullScreenTarget}var l={targetElement:q};this.hasPhaserSetFullScreen=true;this.onFullScreenInit.dispatch(this,l);if(this._createdFullScreenTarget){var o=this.game.canvas;var p=o.parentNode;p.insertBefore(q,o);q.appendChild(o)}if(this.game.device.fullscreenKeyboard){q[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{q[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}this.hasPhaserSetFullScreen=false;document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var m=this._createdFullScreenTarget;if(m&&m.parentNode){var l=m.parentNode;l.insertBefore(this.game.canvas,m);l.removeChild(m)}this._createdFullScreenTarget=null},prepScreenMode:function(n){var l=!!this._createdFullScreenTarget;var m=this._createdFullScreenTarget||this.fullScreenTarget;if(n){if(l||this.fullScreenScaleMode===e.ScaleManager.EXACT_FIT){if(m!==this.game.canvas){this._fullScreenRestore={targetWidth:m.style.width,targetHeight:m.style.height};m.style.width="100%";m.style.height="100%"}}}else{if(this._fullScreenRestore){m.style.width=this._fullScreenRestore.targetWidth;m.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(l){this.event=l;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true)}this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(l){this.event=l;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(r,m,s,l){if(m===undefined){m=this.width}if(s===undefined){s=this.height}if(l===undefined){l=false}if(!r||!r.scale){return r}r.scale.x=1;r.scale.y=1;if((r.width<=0)||(r.height<=0)||(m<=0)||(s<=0)){return r}var o=m;var t=(r.height*m)/r.width;var n=(r.width*s)/r.height;var q=s;var p=(n>m);if(p){p=l}else{p=!l}if(p){r.width=Math.floor(o);r.height=Math.floor(t)}else{r.width=Math.floor(n);r.height=Math.floor(q)}return r},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};e.ScaleManager.prototype.constructor=e.ScaleManager;Object.defineProperty(e.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||(this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)){return null}var l=this.game.canvas&&this.game.canvas.parentNode;return l||null}});Object.defineProperty(e.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(l){if(l!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=l}return this._scaleMode}});Object.defineProperty(e.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(l){if(l!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=l;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=l}}return this._fullScreenScaleMode}});Object.defineProperty(e.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(e.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(l){if(l!==this._pageAlignHorizontally){this._pageAlignHorizontally=l;this.queueUpdate(true)}}});Object.defineProperty(e.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(l){if(l!==this._pageAlignVertically){this._pageAlignVertically=l;this.queueUpdate(true)}}});Object.defineProperty(e.ScaleManager.prototype,"isFullScreen",{get:function(){return !!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(e.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(e.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(e.ScaleManager.prototype,"isGamePortrait",{get:function(){return(this.height>this.width)}});Object.defineProperty(e.ScaleManager.prototype,"isGameLandscape",{get:function(){return(this.width>this.height)}});e.Utils.Debug=function(l){this.game=l;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.lineWidth=1;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false;this.isDisabled=false;this._line=null;this._rect=null};e.Utils.Debug.prototype={boot:function(){if(this.game.renderType===e.CANVAS){this.context=this.game.context}else{this.bmd=new e.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,true);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.game.scale.onSizeChange.add(this.resize,this);this.canvas=e.CanvasPool.create(this,this.game.width,this.game.height);this.context=this.canvas.getContext("2d")}this._line=new e.Line();this._rect=new e.Rectangle()},resize:function(m,n,l){this.bmd.resize(n,l);this.canvas.width=n;this.canvas.height=l},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(l,o,m,n){if(typeof l!=="number"){l=0}if(typeof o!=="number"){o=0}m=m||"rgb(255,255,255)";if(n===undefined){n=0}this.currentX=l;this.currentY=o;this.currentColor=m;this.columnWidth=n;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=m;this.context.fillStyle=m;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var l=this.currentX;for(var m=0;m<arguments.length;m++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[m],l+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[m],l,this.currentY);l+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(n,l,o,m){this.start(l,o,m);this.line("Sound: "+n.key+" Locked: "+n.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(n.key)+" Pending Playback: "+n.pendingPlayback);this.line("Decoded: "+n.isDecoded+" Decoding: "+n.isDecoding);this.line("Total Duration: "+n.totalDuration+" Playing: "+n.isPlaying);this.line("Time: "+n.currentTime);this.line("Volume: "+n.volume+" Muted: "+n.mute);this.line("WebAudio: "+n.usingWebAudio+" Audio: "+n.usingAudioTag);if(n.currentMarker!==""){this.line("Marker: "+n.currentMarker+" Duration: "+n.duration+" (ms: "+n.durationMS+")");this.line("Start: "+n.markers[n.currentMarker].start+" Stop: "+n.markers[n.currentMarker].stop);this.line("Position: "+n.position)}this.stop()},camera:function(n,m,p){var o=n.deadzone;var q=n.target;var l=n.view;if(o){this._rect.setTo(l.x+o.x,l.y+o.y,o.width,o.height);this.rectangle(this._rect,m,p)}if(q){this._line.setTo(l.centerX,l.centerY,q.x,q.y);this.geom(this._line,m,p);this.geom(q,m,false,3)}},cameraInfo:function(o,l,s,n){var q=o.bounds;var p=o.deadzone;var r=o.target;var m=o.view;this.start(l,s,n);this.line("Camera ("+o.width+" x "+o.height+")");this.line("x: "+o.x+" y: "+o.y);if(q){this.line("Bounds x: "+q.x+" y: "+q.y+" w: "+q.width+" h: "+q.height)}this.line("View x: "+m.x+" y: "+m.y+" w: "+m.width+" h: "+m.height);this.line("Deadzone: "+(p?("x: "+p.x+" y: "+p.y+" w: "+p.width+" h: "+p.height):p));this.line("Total in view: "+o.totalInView);this.line("At limit: x: "+o.atLimit.x+" y: "+o.atLimit.y);this.line("Target: "+(r?(r.name||r):r));this.stop()},timer:function(o,l,n,m){this.start(l,n,m);this.line("Timer (running: "+o.running+" expired: "+o.expired+")");this.line("Next Tick: "+o.next+" Duration: "+o.duration);this.line("Paused: "+o.paused+" Length: "+o.length);this.stop()},pointer:function(p,o,m,n,l){if(p==null){return}if(o===undefined){o=false}m=m||"rgba(0,255,0,0.5)";n=n||"rgba(255,0,0,0.5)";if(o===true&&p.isUp===true){return}this.start(p.x,p.y-100,l);this.context.beginPath();this.context.arc(p.x,p.y,p.circle.radius,0,Math.PI*2);if(p.active){this.context.fillStyle=m}else{this.context.fillStyle=n}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(p.positionDown.x,p.positionDown.y);this.context.lineTo(p.position.x,p.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+p.id+" Active: "+p.active);this.line("World X: "+p.worldX+" World Y: "+p.worldY);this.line("Screen X: "+p.x+" Screen Y: "+p.y+" In: "+p.withinGame);this.line("Duration: "+p.duration+" ms");this.line("is Down: "+p.isDown+" is Up: "+p.isUp);this.stop()},spriteInputInfo:function(n,l,o,m){this.start(l,o,m);this.line("Sprite Input: ("+n.width+" x "+n.height+")");this.line("x: "+n.input.pointerX().toFixed(1)+" y: "+n.input.pointerY().toFixed(1));this.line("over: "+n.input.pointerOver()+" duration: "+n.input.overDuration().toFixed(0));this.line("down: "+n.input.pointerDown()+" duration: "+n.input.downDuration().toFixed(0));this.line("just over: "+n.input.justOver()+" just out: "+n.input.justOut());this.stop()},key:function(n,l,o,m){this.start(l,o,m,150);this.line("Key:",n.keyCode,"isDown:",n.isDown);this.line("justDown:",n.justDown,"justUp:",n.justUp);this.line("Time Down:",n.timeDown.toFixed(0),"duration:",n.duration.toFixed(0));this.stop()},inputInfo:function(l,n,m){this.start(l,n,m);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(m,l,o){var n=m.getBounds();n.x+=this.game.camera.x;n.y+=this.game.camera.y;this.rectangle(n,l,o)},ropeSegments:function(p,m,o){var n=p.segments;var l=this;n.forEach(function(q){l.rectangle(q,m,o)},this)},spriteInfo:function(n,l,o,m){this.start(l,o,m);this.line("Sprite:  ("+n.width+" x "+n.height+") anchor: "+n.anchor.x+" x "+n.anchor.y);this.line("x: "+n.x.toFixed(1)+" y: "+n.y.toFixed(1));this.line("angle: "+n.angle.toFixed(1)+" rotation: "+n.rotation.toFixed(1));this.line("visible: "+n.visible+" in camera: "+n.inCamera);this.line("bounds x: "+n._bounds.x.toFixed(1)+" y: "+n._bounds.y.toFixed(1)+" w: "+n._bounds.width.toFixed(1)+" h: "+n._bounds.height.toFixed(1));this.stop()},spriteCoords:function(n,l,o,m){this.start(l,o,m,100);if(n.name){this.line(n.name)}this.line("x:",n.x.toFixed(2),"y:",n.y.toFixed(2));this.line("pos x:",n.position.x.toFixed(2),"pos y:",n.position.y.toFixed(2));this.line("world x:",n.world.x.toFixed(2),"world y:",n.world.y.toFixed(2));this.stop()},lineInfo:function(m,l,o,n){this.start(l,o,n,80);this.line("start.x:",m.start.x.toFixed(2),"start.y:",m.start.y.toFixed(2));this.line("end.x:",m.end.x.toFixed(2),"end.y:",m.end.y.toFixed(2));this.line("length:",m.length.toFixed(2),"angle:",m.angle);this.stop()},pixel:function(l,o,m,n){n=n||2;this.start();this.context.fillStyle=m;this.context.fillRect(l,o,n,n);this.stop()},geom:function(m,l,o,n){if(o===undefined){o=true}if(n===undefined){n=0}l=l||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=l;this.context.strokeStyle=l;if(m instanceof e.Rectangle||n===1){if(o){this.context.fillRect(m.x-this.game.camera.x,m.y-this.game.camera.y,m.width,m.height)}else{this.context.lineWidth=this.lineWidth;this.context.strokeRect(m.x-this.game.camera.x,m.y-this.game.camera.y,m.width,m.height)}}else{if(m instanceof e.Circle||n===2){this.context.beginPath();this.context.arc(m.x-this.game.camera.x,m.y-this.game.camera.y,m.radius,0,Math.PI*2,false);this.context.closePath();if(o){this.context.fill()}else{this.context.stroke()}}else{if(m instanceof e.Point||n===3){this.context.fillRect(m.x-this.game.camera.x,m.y-this.game.camera.y,4,4)}else{if(m instanceof e.Line||n===4){this.context.lineWidth=this.lineWidth;this.context.beginPath();this.context.moveTo((m.start.x+0.5)-this.game.camera.x,(m.start.y+0.5)-this.game.camera.y);this.context.lineTo((m.end.x+0.5)-this.game.camera.x,(m.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(m,l,n){if(n===undefined){n=true}l=l||"rgba(0, 255, 0, 0.4)";this.start();if(n){this.context.fillStyle=l;this.context.fillRect(m.x-this.game.camera.x,m.y-this.game.camera.y,m.width,m.height)}else{this.context.strokeStyle=l;this.context.strokeRect(m.x-this.game.camera.x,m.y-this.game.camera.y,m.width,m.height)}this.stop()},text:function(o,l,p,n,m){n=n||"rgb(255,255,255)";m=m||"16px Courier";this.start();this.context.font=m;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(o,l+1,p+1)}this.context.fillStyle=n;this.context.fillText(o,l,p);this.stop()},quadTree:function(l,m){m=m||"rgba(255,0,0,0.3)";this.start();var o=l.bounds;if(l.nodes.length===0){this.context.strokeStyle=m;this.context.strokeRect(o.x,o.y,o.width,o.height);this.text("size: "+l.objects.length,o.x+4,o.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var n=0;n<l.objects.length;n++){this.context.strokeRect(l.objects[n].x,l.objects[n].y,l.objects[n].width,l.objects[n].height)}}else{for(var n=0;n<l.nodes.length;n++){this.quadTree(l.nodes[n])}}this.stop()},body:function(m,l,n){if(m.body){this.start();if(m.body.type===e.Physics.ARCADE){e.Physics.Arcade.Body.render(this.context,m.body,l,n)}else{if(m.body.type===e.Physics.NINJA){e.Physics.Ninja.Body.render(this.context,m.body,l,n)}else{if(m.body.type===e.Physics.BOX2D){e.Physics.Box2D.renderBody(this.context,m.body,l)}}}this.stop()}},bodyInfo:function(n,l,o,m){if(n.body){this.start(l,o,m,210);if(n.body.type===e.Physics.ARCADE){e.Physics.Arcade.Body.renderBodyInfo(this,n.body)}else{if(n.body.type===e.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,n.body)}}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(l,m){this.start();e.Physics.Box2D.renderBody(this.context,l,m);this.stop()},displayList:function(m){if(m===undefined){m=this.game.world}if(m.hasOwnProperty("renderOrderID")){console.log("["+m.renderOrderID+"]",m)}else{console.log("[]",m)}if(m.children&&m.children.length>0){for(var l=0;l<m.children.length;l++){this.game.debug.displayList(m.children[l])}}},renderer:function(l,p,m){var o=this.game.renderer;var n=o.renderSession;this.start(l,p,m);this.line((o.gl?"WebGL":"Canvas")+" Renderer ("+o.width+" x "+o.height+")");this.line("autoResize: "+o.autoResize);this.line("clearBeforeRender: "+o.clearBeforeRender);this.line("resolution: "+o.resolution);this.line("transparent: "+o.transparent);if(o.gl){this.line("drawCount: "+n.drawCount);this.line("flushCount: "+n.flushCount);this.line("maxTextures: "+o.maxTextures);this.line("maxTextureSize: "+o.maxTextureSize);this.line("maxTextureAvailableSpace: "+n.maxTextureAvailableSpace);this.line("currentBatchedTextures: "+o.currentBatchedTextures.length)}else{this.line("roundPx: "+n.roundPixels);this.line("scaleMode: "+(n.scaleMode===0?"LINEAR":(n.scaleMode===1?"NEAREST":n.scaleMode)))}this.stop()},destroy:function(){e.CanvasPool.remove(this)}};e.Utils.Debug.prototype.constructor=e.Utils.Debug;e.DOM={getOffset:function(m,l){l=l||new e.Point();var n=m.getBoundingClientRect();var o=e.DOM.scrollY;var p=e.DOM.scrollX;var r=document.documentElement.clientTop;var q=document.documentElement.clientLeft;l.x=n.left+p-q;l.y=n.top+o-r;return l},getBounds:function(m,l){if(l===undefined){l=0}m=m&&!m.nodeType?m[0]:m;if(!m||m.nodeType!==1){return false}else{return this.calibrate(m.getBoundingClientRect(),l)}},calibrate:function(n,m){m=+m||0;var l={width:0,height:0,left:0,right:0,top:0,bottom:0};l.width=(l.right=n.right+m)-(l.left=n.left-m);l.height=(l.bottom=n.bottom+m)-(l.top=n.top-m);return l},getAspectRatio:function(m){m=null==m?this.visualBounds:1===m.nodeType?this.getBounds(m):m;var l=m.width;var n=m.height;if(typeof l==="function"){l=l.call(m)}if(typeof n==="function"){n=n.call(m)}return l/n},inLayoutViewport:function(m,l){var n=this.getBounds(m,l);return !!n&&n.bottom>=0&&n.right>=0&&n.top<=this.layoutBounds.width&&n.left<=this.layoutBounds.height},getScreenOrientation:function(p){var m=window.screen;var l=m.orientation||m.mozOrientation||m.msOrientation;if(l&&typeof l.type==="string"){return l.type}else{if(typeof l==="string"){return l}}var o="portrait-primary";var n="landscape-primary";if(p==="screen"){return(m.height>m.width)?o:n}else{if(p==="viewport"){return(this.visualBounds.height>this.visualBounds.width)?o:n}else{if(p==="window.orientation"&&typeof window.orientation==="number"){return(window.orientation===0||window.orientation===180)?o:n}else{if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return o}else{if(window.matchMedia("(orientation: landscape)").matches){return n}}}}}}return(this.visualBounds.height>this.visualBounds.width)?o:n},visualBounds:new e.Rectangle(),layoutBounds:new e.Rectangle(),documentBounds:new e.Rectangle()};e.Device.whenReady(function(n){var q=window&&("pageXOffset" in window)?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var o=window&&("pageYOffset" in window)?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(e.DOM,"scrollX",{get:q});Object.defineProperty(e.DOM,"scrollY",{get:o});Object.defineProperty(e.DOM.visualBounds,"x",{get:q});Object.defineProperty(e.DOM.visualBounds,"y",{get:o});Object.defineProperty(e.DOM.layoutBounds,"x",{value:0});Object.defineProperty(e.DOM.layoutBounds,"y",{value:0});var m=n.desktop&&(document.documentElement.clientWidth<=window.innerWidth)&&(document.documentElement.clientHeight<=window.innerHeight);if(m){var p=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var l=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(e.DOM.visualBounds,"width",{get:p});Object.defineProperty(e.DOM.visualBounds,"height",{get:l});Object.defineProperty(e.DOM.layoutBounds,"width",{get:p});Object.defineProperty(e.DOM.layoutBounds,"height",{get:l})}else{Object.defineProperty(e.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(e.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(e.DOM.layoutBounds,"width",{get:function(){var s=document.documentElement.clientWidth;var r=window.innerWidth;return s<r?r:s}});Object.defineProperty(e.DOM.layoutBounds,"height",{get:function(){var s=document.documentElement.clientHeight;var r=window.innerHeight;return s<r?r:s}})}Object.defineProperty(e.DOM.documentBounds,"x",{value:0});Object.defineProperty(e.DOM.documentBounds,"y",{value:0});Object.defineProperty(e.DOM.documentBounds,"width",{get:function(){var r=document.documentElement;return Math.max(r.clientWidth,r.offsetWidth,r.scrollWidth)}});Object.defineProperty(e.DOM.documentBounds,"height",{get:function(){var r=document.documentElement;return Math.max(r.clientHeight,r.offsetHeight,r.scrollHeight)}})},null,true);e.ArraySet=function(l){this.position=0;this.list=l||[]};e.ArraySet.prototype={add:function(l){if(!this.exists(l)){this.list.push(l)}return l},getIndex:function(l){return this.list.indexOf(l)},getByKey:function(n,m){var l=this.list.length;while(l--){if(this.list[l][n]===m){return this.list[l]}}return null},exists:function(l){return(this.list.indexOf(l)>-1)},reset:function(){this.list.length=0},remove:function(m){var l=this.list.indexOf(m);if(l>-1){this.list.splice(l,1);return m}},setAll:function(m,n){var l=this.list.length;while(l--){if(this.list[l]){this.list[l][m]=n}}},callAll:function(n){var l=Array.prototype.slice.call(arguments,1);var m=this.list.length;while(m--){if(this.list[m]&&this.list[m][n]){this.list[m][n].apply(this.list[m],l)}}},removeAll:function(m){if(m===undefined){m=false}var l=this.list.length;while(l--){if(this.list[l]){var n=this.remove(this.list[l]);if(m){n.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(e.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(e.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(e.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});e.ArraySet.prototype.constructor=e.ArraySet;e.ArrayUtils={getRandomItem:function(n,o,m){if(n===null){return null}if(o===undefined){o=0}if(m===undefined){m=n.length}var l=o+Math.floor(Math.random()*m);return n[l]===undefined?null:n[l]},removeRandomItem:function(n,p,m){if(n==null){return null}if(p===undefined){p=0}if(m===undefined){m=n.length}var l=p+Math.floor(Math.random()*m);if(l<n.length){var o=n.splice(l,1);return o[0]===undefined?null:o[0]}else{return null}},shuffle:function(o){for(var n=o.length-1;n>0;n--){var m=Math.floor(Math.random()*(n+1));var l=o[n];o[n]=o[m];o[m]=l}return o},transposeMatrix:function(q){var p=q.length;var m=q[0].length;var l=new Array(m);for(var o=0;o<m;o++){l[o]=new Array(p);for(var n=p-1;n>-1;n--){l[o][n]=q[n][o]}}return l},rotateMatrix:function(l,n){if(typeof n!=="string"){n=((n%360)+360)%360}if(n===90||n===-270||n==="rotateLeft"){l=e.ArrayUtils.transposeMatrix(l);l=l.reverse()}else{if(n===-90||n===270||n==="rotateRight"){l=l.reverse();l=e.ArrayUtils.transposeMatrix(l)}else{if(Math.abs(n)===180||n==="rotate180"){for(var m=0;m<l.length;m++){l[m].reverse()}l=l.reverse()}}}return l},findClosest:function(p,m){if(!m.length){return NaN}else{if(m.length===1||p<m[0]){return m[0]}}var n=1;while(m[n]<p){n++}var l=m[n-1];var o=(n<m.length)?m[n]:Number.POSITIVE_INFINITY;return((o-p)<=(p-l))?o:l},rotateRight:function(m){var l=m.pop();m.unshift(l);return l},rotateLeft:function(m){var l=m.shift();m.push(l);return l},rotate:function(m){var l=m.shift();m.push(l);return l},numberArray:function(o,m){var l=[];for(var n=o;n<=m;n++){l.push(n)}return l},numberArrayStep:function(q,m,p){if(q===undefined||q===null){q=0}if(m===undefined||m===null){m=q;q=0}if(p===undefined){p=1}var l=[];var o=Math.max(e.Math.roundAwayFromZero((m-q)/(p||1)),0);for(var n=0;n<o;n++){l.push(q);q+=p}return l}};e.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};e.LinkedList.prototype={add:function(l){if(this.total===0&&this.first===null&&this.last===null){this.first=l;this.last=l;this.next=l;l.prev=this;this.total++;return l}this.last.next=l;l.prev=this.last;this.last=l;this.total++;return l},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(l){if(this.total===1){this.reset();l.next=l.prev=null;return}if(l===this.first){this.first=this.first.next}else{if(l===this.last){this.last=this.last.prev}}if(l.prev){l.prev.next=l.next}if(l.next){l.next.prev=l.prev}l.next=l.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(m){if(!this.first||!this.last){return}var l=this.first;do{if(l&&l[m]){l[m].call(l)}l=l.next}while(l!==this.last.next)}};e.LinkedList.prototype.constructor=e.LinkedList;e.Create=function(l){this.game=l;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};e.Create.PALETTE_ARNE=0;e.Create.PALETTE_JMP=1;e.Create.PALETTE_CGA=2;e.Create.PALETTE_C64=3;e.Create.PALETTE_JAPANESE_MACHINE=4;e.Create.prototype={texture:function(v,o,q,m,l,A,z,n){if(q===undefined){q=8}if(m===undefined){m=q}if(l===undefined){l=0}if(A===undefined){A=true}var u=o[0].length*q;var p=o.length*m;if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(u,p);this.bmd.clear();for(var s=0;s<o.length;s++){var B=o[s];for(var t=0;t<B.length;t++){var r=B[t];if(r!=="."&&r!==" "){this.ctx.fillStyle=this.palettes[l][r];this.ctx.fillRect(t*q,s*m,q,m)}}}return A?this.bmd.generateTexture(v,z,n):this.copy()},grid:function(s,l,u,m,p,o,v,t,n){if(v===undefined){v=true}if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(l,u);this.ctx.fillStyle=o;for(var q=0;q<u;q+=p){this.ctx.fillRect(0,q,l,1)}for(var r=0;r<l;r+=m){this.ctx.fillRect(r,0,1,u)}return v?this.bmd.generateTexture(s,t,n):this.copy()},copy:function(n,m,r,q,l,p,o){if(n==null){n=this.game.make.bitmapData()}n.resize(this.bmd.width,this.bmd.height);return n.draw(this.bmd,m,r,q,l,p,o)}};e.Create.prototype.constructor=e.Create;e.FlexGrid=function(m,n,l){this.game=m.game;this.manager=m;this.width=n;this.height=l;this.boundsCustom=new e.Rectangle(0,0,n,l);this.boundsFluid=new e.Rectangle(0,0,n,l);this.boundsFull=new e.Rectangle(0,0,n,l);this.boundsNone=new e.Rectangle(0,0,n,l);this.positionCustom=new e.Point(0,0);this.positionFluid=new e.Point(0,0);this.positionFull=new e.Point(0,0);this.positionNone=new e.Point(0,0);this.scaleCustom=new e.Point(1,1);this.scaleFluid=new e.Point(1,1);this.scaleFluidInversed=new e.Point(1,1);this.scaleFull=new e.Point(1,1);this.scaleNone=new e.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=n/l;this.ratioV=l/n;this.multiplier=0;this.layers=[]};e.FlexGrid.prototype={setSize:function(m,l){this.width=m;this.height=l;this.ratioH=m/l;this.ratioV=l/m;this.scaleNone=new e.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(p,l,n,o){if(o===undefined){o=true}this.customWidth=p;this.customHeight=l;this.boundsCustom.width=p;this.boundsCustom.height=l;var m=new e.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(o){this.game.world.add(m)}this.layers.push(m);if(typeof n!=="undefined"&&typeof n!==null){m.addMultiple(n)}return m},createFluidLayer:function(m,n){if(n===undefined){n=true}var l=new e.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(n){this.game.world.add(l)}this.layers.push(l);if(typeof m!=="undefined"&&typeof m!==null){l.addMultiple(m)}return l},createFullLayer:function(m){var l=new e.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(l);this.layers.push(l);if(typeof m!=="undefined"){l.addMultiple(m)}return l},createFixedLayer:function(m){var l=new e.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(l);this.layers.push(l);if(typeof m!=="undefined"){l.addMultiple(m)}return l},reset:function(){var l=this.layers.length;while(l--){if(!this.layers[l].persist){this.layers[l].position=null;this.layers[l].scale=null;this.layers.slice(l,1)}}},onResize:function(m,l){this.ratioH=m/l;this.ratioV=l/m;this.refresh(m,l)},refresh:function(){this.multiplier=Math.min((this.manager.height/this.height),(this.manager.width/this.width));this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(l){this.manager.scaleSprite(l);l.x=this.manager.bounds.centerX;l.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};e.FlexGrid.prototype.constructor=e.FlexGrid;e.FlexLayer=function(m,l,n,o){e.Group.call(this,m.game,null,"__flexLayer"+m.game.rnd.uuid(),false);this.manager=m.manager;this.grid=m;this.persist=false;this.position=l;this.bounds=n;this.scale=o;this.topLeft=n.topLeft;this.topMiddle=new e.Point(n.halfWidth,0);this.topRight=n.topRight;this.bottomLeft=n.bottomLeft;this.bottomMiddle=new e.Point(n.halfWidth,n.bottom);this.bottomRight=n.bottomRight};e.FlexLayer.prototype=Object.create(e.Group.prototype);e.FlexLayer.prototype.constructor=e.FlexLayer;e.FlexLayer.prototype.resize=function(){};e.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};e.Color={packPixel:function(o,n,l,m){if(e.Device.LITTLE_ENDIAN){return((m<<24)|(l<<16)|(n<<8)|o)>>>0}else{return((o<<24)|(n<<16)|(l<<8)|m)>>>0}},unpackPixel:function(o,n,l,m){if(n===undefined||n===null){n=e.Color.createColor()}if(l===undefined||l===null){l=false}if(m===undefined||m===null){m=false}if(e.Device.LITTLE_ENDIAN){n.a=((o&4278190080)>>>24);n.b=((o&16711680)>>>16);n.g=((o&65280)>>>8);n.r=((o&255))}else{n.r=((o&4278190080)>>>24);n.g=((o&16711680)>>>16);n.b=((o&65280)>>>8);n.a=((o&255))}n.color=o;n.rgba="rgba("+n.r+","+n.g+","+n.b+","+(n.a/255)+")";if(l){e.Color.RGBtoHSL(n.r,n.g,n.b,n)}if(m){e.Color.RGBtoHSV(n.r,n.g,n.b,n)}return n},fromRGBA:function(m,l){if(!l){l=e.Color.createColor()}l.r=((m&4278190080)>>>24);l.g=((m&16711680)>>>16);l.b=((m&65280)>>>8);l.a=((m&255));l.rgba="rgba("+l.r+","+l.g+","+l.b+","+l.a+")";return l},toRGBA:function(o,n,l,m){return(o<<24)|(n<<16)|(l<<8)|m},toABGR:function(o,n,l,m){return((m<<24)|(l<<16)|(n<<8)|o)>>>0},hexToRGBArray:function(l){return[(l>>16&255)/255,(l>>8&255)/255,(l&255)/255]},RGBArrayToHex:function(l){return((l[0]*255<<16)+(l[1]*255<<8)+l[2]*255)},RGBtoHSL:function(q,p,m,n){if(!n){n=e.Color.createColor(q,p,m,1)}q/=255;p/=255;m/=255;var o=Math.min(q,p,m);var l=Math.max(q,p,m);n.h=0;n.s=0;n.l=(l+o)/2;if(l!==o){var s=l-o;n.s=n.l>0.5?s/(2-l-o):s/(l+o);if(l===q){n.h=(p-m)/s+(p<m?6:0)}else{if(l===p){n.h=(m-q)/s+2}else{if(l===m){n.h=(q-p)/s+4}}}n.h/=6}return n},HSLtoRGB:function(r,o,m,n){if(!n){n=e.Color.createColor(m,m,m)}else{n.r=m;n.g=m;n.b=m}if(o!==0){var t=m<0.5?m*(1+o):m+o-m*o;var u=2*m-t;n.r=e.Color.hueToColor(u,t,r+1/3);n.g=e.Color.hueToColor(u,t,r);n.b=e.Color.hueToColor(u,t,r-1/3)}n.r=Math.floor((n.r*255|0));n.g=Math.floor((n.g*255|0));n.b=Math.floor((n.b*255|0));e.Color.updateColor(n);return n},RGBtoHSV:function(q,p,m,n){if(!n){n=e.Color.createColor(q,p,m,255)}q/=255;p/=255;m/=255;var o=Math.min(q,p,m);var l=Math.max(q,p,m);var s=l-o;n.h=0;n.s=l===0?0:s/l;n.v=l;if(l!==o){if(l===q){n.h=(p-m)/s+(p<m?6:0)}else{if(l===p){n.h=(m-q)/s+2}else{if(l===m){n.h=(q-p)/s+4}}}n.h/=6}return n},HSVtoRGB:function(w,C,A,o){if(o===undefined){o=e.Color.createColor(0,0,0,1,w,C,0,A)}var l,x,z;var u=Math.floor(w*6);var y=w*6-u;var n=A*(1-C);var m=A*(1-y*C);var B=A*(1-(1-y)*C);switch(u%6){case 0:l=A;x=B;z=n;break;case 1:l=m;x=A;z=n;break;case 2:l=n;x=A;z=B;break;case 3:l=n;x=m;z=A;break;case 4:l=B;x=n;z=A;break;case 5:l=A;x=n;z=m;break}o.r=Math.floor(l*255);o.g=Math.floor(x*255);o.b=Math.floor(z*255);e.Color.updateColor(o);return o},hueToColor:function(n,m,l){if(l<0){l+=1}if(l>1){l-=1}if(l<1/6){return n+(m-n)*6*l}if(l<1/2){return m}if(l<2/3){return n+(m-n)*(2/3-l)*6}return n},createColor:function(m,q,t,u,p,x,n,w){var o={r:m||0,g:q||0,b:t||0,a:u||1,h:p||0,s:x||0,l:n||0,v:w||0,color:0,color32:0,rgba:""};return e.Color.updateColor(o)},updateColor:function(l){l.rgba="rgba("+l.r.toString()+","+l.g.toString()+","+l.b.toString()+","+l.a.toString()+")";l.color=e.Color.getColor(l.r,l.g,l.b);l.color32=e.Color.getColor32(l.a*255,l.r,l.g,l.b);return l},getColor32:function(m,o,n,l){return m<<24|o<<16|n<<8|l},getColor:function(n,m,l){return n<<16|m<<8|l},RGBtoString:function(o,n,l,m,p){if(m===undefined){m=255}if(p===undefined){p="#"}if(p==="#"){return"#"+((1<<24)+(o<<16)+(n<<8)+l).toString(16).slice(1)}else{return"0x"+e.Color.componentToHex(m)+e.Color.componentToHex(o)+e.Color.componentToHex(n)+e.Color.componentToHex(l)}},hexToRGB:function(m){var l=e.Color.hexToColor(m);if(l){return e.Color.getColor32(l.a,l.r,l.g,l.b)}},hexToColor:function(q,n){q=q.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,v,u,s){return v+v+u+u+s+s});var m=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(q);if(m){var p=parseInt(m[1],16);var o=parseInt(m[2],16);var l=parseInt(m[3],16);if(!n){n=e.Color.createColor(p,o,l)}else{n.r=p;n.g=o;n.b=l}}return n},webToColor:function(m,n){if(!n){n=e.Color.createColor()}var l=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(m);if(l){n.r=parseInt(l[1],10);n.g=parseInt(l[2],10);n.b=parseInt(l[3],10);n.a=l[4]!==undefined?parseFloat(l[4]):1;e.Color.updateColor(n)}return n},valueToColor:function(n,m){if(!m){m=e.Color.createColor()}if(typeof n==="string"){if(n.indexOf("rgb")===0){return e.Color.webToColor(n,m)}else{m.a=1;return e.Color.hexToColor(n,m)}}else{if(typeof n==="number"){var l=e.Color.getRGB(n);m.r=l.r;m.g=l.g;m.b=l.b;m.a=l.a/255;return m}else{return m}}},componentToHex:function(l){var m=l.toString(16);return(m.length===1)?"0"+m:m},HSVColorWheel:function(n,m){if(n===undefined){n=1}if(m===undefined){m=1}var l=[];for(var o=0;o<=359;o++){l.push(e.Color.HSVtoRGB(o/359,n,m))}return l},HSLColorWheel:function(o,n){if(o===undefined){o=0.5}if(n===undefined){n=0.5}var m=[];for(var p=0;p<=359;p++){m.push(e.Color.HSLtoRGB(p/359,o,n))}return m},interpolateColor:function(v,u,t,m,p){if(p===undefined){p=255}var o=e.Color.getRGB(v);var n=e.Color.getRGB(u);var l=(((n.red-o.red)*m)/t)+o.red;var q=(((n.green-o.green)*m)/t)+o.green;var s=(((n.blue-o.blue)*m)/t)+o.blue;return e.Color.getColor32(p,l,q,s)},interpolateColorWithRGB:function(p,m,s,u,t,n){var l=e.Color.getRGB(p);var q=(((m-l.red)*n)/t)+l.red;var v=(((s-l.green)*n)/t)+l.green;var o=(((u-l.blue)*n)/t)+l.blue;return e.Color.getColor(q,v,o)},interpolateRGB:function(p,m,v,o,w,t,u,n){var l=(((o-p)*n)/u)+p;var q=(((w-m)*n)/u)+m;var s=(((t-v)*n)/u)+v;return e.Color.getColor(l,q,s)},getRandomColor:function(n,m,q){if(n===undefined){n=0}if(m===undefined){m=255}if(q===undefined){q=255}if(m>255||n>m){return e.Color.getColor(255,255,255)}var p=n+Math.round(Math.random()*(m-n));var o=n+Math.round(Math.random()*(m-n));var l=n+Math.round(Math.random()*(m-n));return e.Color.getColor32(q,p,o,l)},getRGB:function(l){if(l>16777215){return{alpha:l>>>24,red:l>>16&255,green:l>>8&255,blue:l&255,a:l>>>24,r:l>>16&255,g:l>>8&255,b:l&255}}else{return{alpha:255,red:l>>16&255,green:l>>8&255,blue:l&255,a:255,r:l>>16&255,g:l>>8&255,b:l&255}}},getWebRGB:function(l){if(typeof l==="object"){return"rgba("+l.r.toString()+","+l.g.toString()+","+l.b.toString()+","+(l.a/255).toString()+")"}else{var m=e.Color.getRGB(l);return"rgba("+m.r.toString()+","+m.g.toString()+","+m.b.toString()+","+(m.a/255).toString()+")"}},getAlpha:function(l){return l>>>24},getAlphaFloat:function(l){return(l>>>24)/255},getRed:function(l){return l>>16&255},getGreen:function(l){return l>>8&255},getBlue:function(l){return l&255},blendNormal:function(l){return l},blendLighten:function(m,l){return(l>m)?l:m},blendDarken:function(m,l){return(l>m)?m:l},blendMultiply:function(m,l){return(m*l)/255},blendAverage:function(m,l){return(m+l)/2},blendAdd:function(m,l){return Math.min(255,m+l)},blendSubtract:function(m,l){return Math.max(0,m+l-255)},blendDifference:function(m,l){return Math.abs(m-l)},blendNegation:function(m,l){return 255-Math.abs(255-m-l)},blendScreen:function(m,l){return 255-(((255-m)*(255-l))>>8)},blendExclusion:function(m,l){return m+l-2*m*l/255},blendOverlay:function(m,l){return l<128?(2*m*l/255):(255-2*(255-m)*(255-l)/255)},blendSoftLight:function(m,l){return l<128?(2*((m>>1)+64))*(l/255):255-(2*(255-((m>>1)+64))*(255-l)/255)},blendHardLight:function(m,l){return e.Color.blendOverlay(l,m)},blendColorDodge:function(m,l){return l===255?l:Math.min(255,((m<<8)/(255-l)))},blendColorBurn:function(m,l){return l===0?l:Math.max(0,(255-((255-m)<<8)/l))},blendLinearDodge:function(m,l){return e.Color.blendAdd(m,l)},blendLinearBurn:function(m,l){return e.Color.blendSubtract(m,l)},blendLinearLight:function(m,l){return l<128?e.Color.blendLinearBurn(m,2*l):e.Color.blendLinearDodge(m,(2*(l-128)))},blendVividLight:function(m,l){return l<128?e.Color.blendColorBurn(m,2*l):e.Color.blendColorDodge(m,(2*(l-128)))},blendPinLight:function(m,l){return l<128?e.Color.blendDarken(m,2*l):e.Color.blendLighten(m,(2*(l-128)))},blendHardMix:function(m,l){return e.Color.blendVividLight(m,l)<128?0:255},blendReflect:function(m,l){return l===255?l:Math.min(255,(m*m/(255-l)))},blendGlow:function(m,l){return e.Color.blendReflect(l,m)},blendPhoenix:function(m,l){return Math.min(m,l)-Math.max(m,l)+255}};e.Physics=function(l,m){m=m||{};this.game=l;this.config=m;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};e.Physics.ARCADE=0;e.Physics.P2JS=1;e.Physics.NINJA=2;e.Physics.BOX2D=3;e.Physics.CHIPMUNK=4;e.Physics.MATTERJS=5;e.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&e.Physics.hasOwnProperty("Arcade")){this.arcade=new e.Physics.Arcade(this.game)}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&e.Physics.hasOwnProperty("Ninja")){this.ninja=new e.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&e.Physics.hasOwnProperty("P2")){this.p2=new e.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config.box2d===true&&e.Physics.hasOwnProperty("BOX2D")){this.box2d=new e.Physics.BOX2D(this.game,this.config)}if(this.config.hasOwnProperty("matter")&&this.config.matter===true&&e.Physics.hasOwnProperty("Matter")){this.matter=new e.Physics.Matter(this.game,this.config)}},startSystem:function(l){if(l===e.Physics.ARCADE){this.arcade=new e.Physics.Arcade(this.game)}else{if(l===e.Physics.P2JS){if(this.p2===null){this.p2=new e.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else{if(l===e.Physics.NINJA){this.ninja=new e.Physics.Ninja(this.game)}else{if(l===e.Physics.BOX2D){if(this.box2d===null){this.box2d=new e.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}else{if(l===e.Physics.MATTERJS){if(this.matter===null){this.matter=new e.Physics.Matter(this.game,this.config)}else{this.matter.reset()}}}}}}},enable:function(m,n,l){if(n===undefined){n=e.Physics.ARCADE}if(l===undefined){l=false}if(n===e.Physics.ARCADE){this.arcade.enable(m)}else{if(n===e.Physics.P2JS&&this.p2){this.p2.enable(m,l)}else{if(n===e.Physics.NINJA&&this.ninja){this.ninja.enableAABB(m)}else{if(n===e.Physics.BOX2D&&this.box2d){this.box2d.enable(m)}else{if(n===e.Physics.MATTERJS&&this.matter){this.matter.enable(m)}else{console.warn(m.key+" is attempting to enable a physics body using an unknown physics system.")}}}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}if(this.matter){this.matter.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}if(this.matter){this.matter.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}if(this.matter){this.matter.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}if(this.matter){this.matter.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}if(this.matter){this.matter.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}if(this.matter){this.matter.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};e.Physics.prototype.constructor=e.Physics;e.Physics.Arcade=function(l){this.game=l;this.gravity=new e.Point();this.bounds=new e.Rectangle(0,0,l.world.width,l.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=e.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new e.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};e.Physics.Arcade.prototype.constructor=e.Physics.Arcade;e.Physics.Arcade.SORT_NONE=0;e.Physics.Arcade.LEFT_RIGHT=1;e.Physics.Arcade.RIGHT_LEFT=2;e.Physics.Arcade.TOP_BOTTOM=3;e.Physics.Arcade.BOTTOM_TOP=4;e.Physics.Arcade.prototype={setBounds:function(m,o,n,l){this.bounds.setTo(m,o,n,l)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(l,n){if(n===undefined){n=true}var m=1;if(Array.isArray(l)){m=l.length;while(m--){if(l[m] instanceof e.Group){this.enable(l[m].children,n)}else{this.enableBody(l[m]);if(n&&l[m].hasOwnProperty("children")&&l[m].children.length>0){this.enable(l[m],true)}}}}else{if(l instanceof e.Group){this.enable(l.children,n)}else{this.enableBody(l);if(n&&l.hasOwnProperty("children")&&l.children.length>0){this.enable(l.children,true)}}}},enableBody:function(l){if(l.hasOwnProperty("body")&&l.body===null){l.body=new e.Physics.Arcade.Body(l);if(l.parent&&l.parent instanceof e.Group){l.parent.addToHash(l)}}},updateMotion:function(l){if(l.allowRotation){var m=this.computeVelocity(0,l,l.angularVelocity,l.angularAcceleration,l.angularDrag,l.maxAngular)-l.angularVelocity;l.angularVelocity+=m;l.rotation+=(l.angularVelocity*this.game.time.physicsElapsed)}l.velocity.x=this.computeVelocity(1,l,l.velocity.x,l.acceleration.x,l.drag.x,l.maxVelocity.x);l.velocity.y=this.computeVelocity(2,l,l.velocity.y,l.acceleration.y,l.drag.y,l.maxVelocity.y)},computeVelocity:function(o,m,q,p,n,l){if(l===undefined){l=10000}if(o===1&&m.allowGravity){q+=(this.gravity.x+m.gravity.x)*this.game.time.physicsElapsed}else{if(o===2&&m.allowGravity){q+=(this.gravity.y+m.gravity.y)*this.game.time.physicsElapsed}}if(p){q+=p*this.game.time.physicsElapsed}else{if(n&&m.allowDrag){n*=this.game.time.physicsElapsed;if(q-n>0){q-=n}else{if(q+n<0){q+=n}else{q=0}}}}if(q>l){q=l}else{if(q<-l){q=-l}}return q},overlap:function(r,q,l,p,m){l=l||null;p=p||null;m=m||l;this._total=0;if(!Array.isArray(r)&&Array.isArray(q)){for(var o=0;o<q.length;o++){this.collideHandler(r,q[o],l,p,m,true)}}else{if(Array.isArray(r)&&!Array.isArray(q)){for(var o=0;o<r.length;o++){this.collideHandler(r[o],q,l,p,m,true)}}else{if(Array.isArray(r)&&Array.isArray(q)){for(var o=0;o<r.length;o++){for(var n=0;n<q.length;n++){this.collideHandler(r[o],q[n],l,p,m,true)}}}else{this.collideHandler(r,q,l,p,m,true)}}}return(this._total>0)},collide:function(r,q,p,o,l){p=p||null;o=o||null;l=l||p;this._total=0;if(!Array.isArray(r)&&Array.isArray(q)){for(var n=0;n<q.length;n++){this.collideHandler(r,q[n],p,o,l,false)}}else{if(Array.isArray(r)&&!Array.isArray(q)){for(var n=0;n<r.length;n++){this.collideHandler(r[n],q,p,o,l,false)}}else{if(Array.isArray(r)&&Array.isArray(q)){for(var n=0;n<r.length;n++){for(var m=0;m<q.length;m++){this.collideHandler(r[n],q[m],p,o,l,false)}}}else{this.collideHandler(r,q,p,o,l,false)}}}return(this._total>0)},sortLeftRight:function(m,l){if(!m.body||!l.body){return 0}return m.body.x-l.body.x},sortRightLeft:function(m,l){if(!m.body||!l.body){return 0}return l.body.x-m.body.x},sortTopBottom:function(m,l){if(!m.body||!l.body){return 0}return m.body.y-l.body.y},sortBottomTop:function(m,l){if(!m.body||!l.body){return 0}return l.body.y-m.body.y},sort:function(m,l){if(m.physicsSortDirection!==null){l=m.physicsSortDirection}else{if(l===undefined){l=this.sortDirection}}if(l===e.Physics.Arcade.LEFT_RIGHT){m.hash.sort(this.sortLeftRight)}else{if(l===e.Physics.Arcade.RIGHT_LEFT){m.hash.sort(this.sortRightLeft)}else{if(l===e.Physics.Arcade.TOP_BOTTOM){m.hash.sort(this.sortTopBottom)}else{if(l===e.Physics.Arcade.BOTTOM_TOP){m.hash.sort(this.sortBottomTop)}}}}},collideHandler:function(q,p,o,n,l,m){if(p===undefined&&q.physicsType===e.GROUP){this.sort(q);this.collideGroupVsSelf(q,o,n,l,m);return}if(!q||!p||!q.exists||!p.exists){return}if(this.sortDirection!==e.Physics.Arcade.SORT_NONE){if(q.physicsType===e.GROUP){this.sort(q)}if(p.physicsType===e.GROUP){this.sort(p)}}if(q.physicsType===e.SPRITE){if(p.physicsType===e.SPRITE){this.collideSpriteVsSprite(q,p,o,n,l,m)}else{if(p.physicsType===e.GROUP){this.collideSpriteVsGroup(q,p,o,n,l,m)}else{if(p.physicsType===e.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(q,p,o,n,l,m)}}}}else{if(q.physicsType===e.GROUP){if(p.physicsType===e.SPRITE){this.collideSpriteVsGroup(p,q,o,n,l,m)}else{if(p.physicsType===e.GROUP){this.collideGroupVsGroup(q,p,o,n,l,m)}else{if(p.physicsType===e.TILEMAPLAYER){this.collideGroupVsTilemapLayer(q,p,o,n,l,m)}}}}else{if(q.physicsType===e.TILEMAPLAYER){if(p.physicsType===e.SPRITE){this.collideSpriteVsTilemapLayer(p,q,o,n,l,m)}else{if(p.physicsType===e.GROUP){this.collideGroupVsTilemapLayer(p,q,o,n,l,m)}}}}}},collideSpriteVsSprite:function(q,p,o,n,l,m){if(!q.body||!p.body){return false}if(this.separate(q.body,p.body,n,l,m)){if(o){o.call(l,q,p)}this._total++}return true},collideSpriteVsGroup:function(t,s,u,m,n,q){if(s.length===0||!t.body){return}if(this.skipQuadTree||t.body.skipQuadTree){var l={};for(var o=0;o<s.hash.length;o++){var r=s.hash[o];if(!r||!r.exists||!r.body){continue}l=r.body.getBounds(l);if(this.sortDirection===e.Physics.Arcade.LEFT_RIGHT){if(t.body.right<l.x){break}else{if(l.right<t.body.x){continue}}}else{if(this.sortDirection===e.Physics.Arcade.RIGHT_LEFT){if(t.body.x>l.right){break}else{if(l.x>t.body.right){continue}}}else{if(this.sortDirection===e.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<l.y){break}else{if(l.bottom<t.body.y){continue}}}else{if(this.sortDirection===e.Physics.Arcade.BOTTOM_TOP){if(t.body.y>l.bottom){break}else{if(l.y>t.body.bottom){continue}}}}}}this.collideSpriteVsSprite(t,r,u,m,n,q)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(s);var p=this.quadTree.retrieve(t);for(var o=0;o<p.length;o++){if(this.separate(t.body,p[o],m,n,q)){if(u){u.call(n,t,p[o].sprite)}this._total++}}}},collideGroupVsSelf:function(u,v,n,o,r){if(u.length===0){return}for(var q=0;q<u.hash.length;q++){var m={};var t=u.hash[q];if(!t||!t.exists||!t.body){continue}m=t.body.getBounds(m);for(var p=q+1;p<u.hash.length;p++){var l={};var s=u.hash[p];if(!s||!s.exists||!s.body){continue}l=s.body.getBounds(l);if(this.sortDirection===e.Physics.Arcade.LEFT_RIGHT){if(m.right<l.x){break}else{if(l.right<m.x){continue}}}else{if(this.sortDirection===e.Physics.Arcade.RIGHT_LEFT){if(m.x>l.right){continue}else{if(l.x>m.right){break}}}else{if(this.sortDirection===e.Physics.Arcade.TOP_BOTTOM){if(m.bottom<l.y){continue}else{if(l.bottom<m.y){break}}}else{if(this.sortDirection===e.Physics.Arcade.BOTTOM_TOP){if(m.y>l.bottom){continue}else{if(l.y>t.body.bottom){break}}}}}}this.collideSpriteVsSprite(t,s,v,n,o,r)}}},collideGroupVsGroup:function(l,r,q,p,m,n){if(l.length===0||r.length===0){return}for(var o=0;o<l.children.length;o++){if(l.children[o].exists){if(l.children[o].physicsType===e.GROUP){this.collideGroupVsGroup(l.children[o],r,q,p,m,n)}else{this.collideSpriteVsGroup(l.children[o],r,q,p,m,n)}}}},separate:function(l,w,o,p,s){if(!l.enable||!w.enable||l.checkCollision.none||w.checkCollision.none||!this.intersects(l,w)){return false}if(o&&o.call(p,l.sprite,w.sprite)===false){return false}if(l.isCircle&&w.isCircle){return this.separateCircle(l,w,s)}if(l.isCircle!==w.isCircle){var u=(l.isCircle)?w:l;var n=(l.isCircle)?l:w;var t={x:u.x,y:u.y,right:u.right,bottom:u.bottom};var m=n.center;if(m.y<t.y||m.y>t.bottom){if(m.x<t.x||m.x>t.right){return this.separateCircle(l,w,s)}}}var r=false;var q=false;if(this.forceX||Math.abs(this.gravity.y+l.gravity.y)<Math.abs(this.gravity.x+l.gravity.x)){r=this.separateX(l,w,s);if(this.intersects(l,w)){q=this.separateY(l,w,s)}}else{q=this.separateY(l,w,s);if(this.intersects(l,w)){r=this.separateX(l,w,s)}}var v=(r||q);if(v){if(s){if(l.onOverlap){l.onOverlap.dispatch(l.sprite,w.sprite)}if(w.onOverlap){w.onOverlap.dispatch(w.sprite,l.sprite)}}else{if(l.onCollide){l.onCollide.dispatch(l.sprite,w.sprite)}if(w.onCollide){w.onCollide.dispatch(w.sprite,l.sprite)}}}return v},intersects:function(m,l){if(m===l){return false}if(m.isCircle){if(l.isCircle){return e.Math.distance(m.center.x,m.center.y,l.center.x,l.center.y)<=(m.halfWidth+l.halfWidth)}else{return this.circleBodyIntersects(m,l)}}else{if(l.isCircle){return this.circleBodyIntersects(l,m)}else{if(m.right<=l.position.x){return false}if(m.bottom<=l.position.y){return false}if(m.position.x>=l.right){return false}if(m.position.y>=l.bottom){return false}return true}}},circleBodyIntersects:function(p,m){var l=e.Math.clamp(p.center.x,m.left,m.right);var q=e.Math.clamp(p.center.y,m.top,m.bottom);var o=(p.center.x-l)*(p.center.x-l);var n=(p.center.y-q)*(p.center.y-q);return(o+n)<=(p.halfWidth*p.halfWidth)},separateCircle:function(l,w,q){this.getOverlapX(l,w);this.getOverlapY(l,w);var x=w.center.x-l.center.x;var v=w.center.y-l.center.y;var n=Math.atan2(v,x);var t=0;if(l.isCircle!==w.isCircle){var r={x:(w.isCircle)?l.position.x:w.position.x,y:(w.isCircle)?l.position.y:w.position.y,right:(w.isCircle)?l.right:w.right,bottom:(w.isCircle)?l.bottom:w.bottom};var m={x:(l.isCircle)?l.center.x:w.center.x,y:(l.isCircle)?l.center.y:w.center.y,radius:(l.isCircle)?l.halfWidth:w.halfWidth};if(m.y<r.y){if(m.x<r.x){t=e.Math.distance(m.x,m.y,r.x,r.y)-m.radius}else{if(m.x>r.right){t=e.Math.distance(m.x,m.y,r.right,r.y)-m.radius}}}else{if(m.y>r.bottom){if(m.x<r.x){t=e.Math.distance(m.x,m.y,r.x,r.bottom)-m.radius}else{if(m.x>r.right){t=e.Math.distance(m.x,m.y,r.right,r.bottom)-m.radius}}}}t*=-1}else{t=(l.halfWidth+w.halfWidth)-e.Math.distance(l.center.x,l.center.y,w.center.x,w.center.y)}if(q||t===0||(l.immovable&&w.immovable)||l.customSeparateX||w.customSeparateX){if(t!==0){if(l.onOverlap){l.onOverlap.dispatch(l.sprite,w.sprite)}if(w.onOverlap){w.onOverlap.dispatch(w.sprite,l.sprite)}}return(t!==0)}var u={x:l.velocity.x*Math.cos(n)+l.velocity.y*Math.sin(n),y:l.velocity.x*Math.sin(n)-l.velocity.y*Math.cos(n)};var s={x:w.velocity.x*Math.cos(n)+w.velocity.y*Math.sin(n),y:w.velocity.x*Math.sin(n)-w.velocity.y*Math.cos(n)};var p=((l.mass-w.mass)*u.x+2*w.mass*s.x)/(l.mass+w.mass);var o=(2*l.mass*u.x+(w.mass-l.mass)*s.x)/(l.mass+w.mass);if(!l.immovable){l.velocity.x=(p*Math.cos(n)-u.y*Math.sin(n))*l.bounce.x;l.velocity.y=(u.y*Math.cos(n)+p*Math.sin(n))*l.bounce.y}if(!w.immovable){w.velocity.x=(o*Math.cos(n)-s.y*Math.sin(n))*w.bounce.x;w.velocity.y=(s.y*Math.cos(n)+o*Math.sin(n))*w.bounce.y}if(Math.abs(n)<Math.PI/2){if((l.velocity.x>0)&&!l.immovable&&(w.velocity.x>l.velocity.x)){l.velocity.x*=-1}else{if((w.velocity.x<0)&&!w.immovable&&(l.velocity.x<w.velocity.x)){w.velocity.x*=-1}else{if((l.velocity.y>0)&&!l.immovable&&(w.velocity.y>l.velocity.y)){l.velocity.y*=-1}else{if((w.velocity.y<0)&&!w.immovable&&(l.velocity.y<w.velocity.y)){w.velocity.y*=-1}}}}}else{if(Math.abs(n)>Math.PI/2){if((l.velocity.x<0)&&!l.immovable&&(w.velocity.x<l.velocity.x)){l.velocity.x*=-1}else{if((w.velocity.x>0)&&!w.immovable&&(l.velocity.x>w.velocity.x)){w.velocity.x*=-1}else{if((l.velocity.y<0)&&!l.immovable&&(w.velocity.y<l.velocity.y)){l.velocity.y*=-1}else{if((w.velocity.y>0)&&!w.immovable&&(l.velocity.x>w.velocity.y)){w.velocity.y*=-1}}}}}}if(!l.immovable){l.x+=(l.velocity.x*this.game.time.physicsElapsed)-t*Math.cos(n);l.y+=(l.velocity.y*this.game.time.physicsElapsed)-t*Math.sin(n)}if(!w.immovable){w.x+=(w.velocity.x*this.game.time.physicsElapsed)+t*Math.cos(n);w.y+=(w.velocity.y*this.game.time.physicsElapsed)+t*Math.sin(n)}if(l.onCollide){l.onCollide.dispatch(l.sprite,w.sprite)}if(w.onCollide){w.onCollide.dispatch(w.sprite,l.sprite)}return true},getOverlapX:function(o,m,n){var l=0;var p=o.deltaAbsX()+m.deltaAbsX()+this.OVERLAP_BIAS;if(o.deltaX()===0&&m.deltaX()===0){o.embedded=true;m.embedded=true}else{if(o.deltaX()>m.deltaX()){l=o.right-m.x;if((l>p&&!n)||o.checkCollision.right===false||m.checkCollision.left===false){l=0}else{o.touching.none=false;o.touching.right=true;m.touching.none=false;m.touching.left=true}}else{if(o.deltaX()<m.deltaX()){l=o.x-m.width-m.x;if((-l>p&&!n)||o.checkCollision.left===false||m.checkCollision.right===false){l=0}else{o.touching.none=false;o.touching.left=true;m.touching.none=false;m.touching.right=true}}}}o.overlapX=l;m.overlapX=l;return l},getOverlapY:function(o,m,n){var l=0;var p=o.deltaAbsY()+m.deltaAbsY()+this.OVERLAP_BIAS;if(o.deltaY()===0&&m.deltaY()===0){o.embedded=true;m.embedded=true}else{if(o.deltaY()>m.deltaY()){l=o.bottom-m.y;if((l>p&&!n)||o.checkCollision.down===false||m.checkCollision.up===false){l=0}else{o.touching.none=false;o.touching.down=true;m.touching.none=false;m.touching.up=true}}else{if(o.deltaY()<m.deltaY()){l=o.y-m.bottom;if((-l>p&&!n)||o.checkCollision.up===false||m.checkCollision.down===false){l=0}else{o.touching.none=false;o.touching.up=true;m.touching.none=false;m.touching.down=true}}}}o.overlapY=l;m.overlapY=l;return l},separateX:function(l,t,n){var r=this.getOverlapX(l,t,n);if(n||r===0||(l.immovable&&t.immovable)||l.customSeparateX||t.customSeparateX){return(r!==0)||(l.embedded&&t.embedded)}var s=l.velocity.x;var q=t.velocity.x;if(!l.immovable&&!t.immovable){r*=0.5;l.x-=r;t.x+=r;var p=Math.sqrt((q*q*t.mass)/l.mass)*((q>0)?1:-1);var o=Math.sqrt((s*s*l.mass)/t.mass)*((s>0)?1:-1);var m=(p+o)*0.5;p-=m;o-=m;l.velocity.x=m+p*l.bounce.x;t.velocity.x=m+o*t.bounce.x}else{if(!l.immovable){l.x-=r;l.velocity.x=q-s*l.bounce.x;if(t.moves){l.y+=(t.y-t.prev.y)*t.friction.y}}else{t.x+=r;t.velocity.x=s-q*t.bounce.x;if(l.moves){t.y+=(l.y-l.prev.y)*l.friction.y}}}return true},separateY:function(l,t,n){var r=this.getOverlapY(l,t,n);if(n||r===0||(l.immovable&&t.immovable)||l.customSeparateY||t.customSeparateY){return(r!==0)||(l.embedded&&t.embedded)}var s=l.velocity.y;var q=t.velocity.y;if(!l.immovable&&!t.immovable){r*=0.5;l.y-=r;t.y+=r;var p=Math.sqrt((q*q*t.mass)/l.mass)*((q>0)?1:-1);var o=Math.sqrt((s*s*l.mass)/t.mass)*((s>0)?1:-1);var m=(p+o)*0.5;p-=m;o-=m;l.velocity.y=m+p*l.bounce.y;t.velocity.y=m+o*t.bounce.y}else{if(!l.immovable){l.y-=r;l.velocity.y=q-s*l.bounce.y;if(t.moves){l.x+=(t.x-t.prev.x)*t.friction.x}}else{t.y+=r;t.velocity.y=s-q*t.bounce.y;if(l.moves){t.x+=(l.x-l.prev.x)*l.friction.x}}}return true},getObjectsUnderPointer:function(n,m,o,l){if(m.length===0||!n.exists){return}return this.getObjectsAtLocation(n.x,n.y,m,o,l,n)},getObjectsAtLocation:function(s,q,t,u,m,o){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(t);var r=new e.Rectangle(s,q,1,1);var l=[];var p=this.quadTree.retrieve(r);for(var n=0;n<p.length;n++){if(p[n].hitTest(s,q)){if(u){u.call(m,o,p[n].sprite)}l.push(p[n].sprite)}}return l},moveToObject:function(p,l,n,m){if(n===undefined){n=60}if(m===undefined){m=0}var o=Math.atan2(l.y-p.y,l.x-p.x);if(m>0){n=this.distanceBetween(p,l)/(m/1000)}p.body.velocity.setToPolar(o,n);return o},moveToPointer:function(p,m,o,l){if(m===undefined){m=60}o=o||this.game.input.activePointer;if(l===undefined){l=0}var n=this.angleToPointer(p,o);if(l>0){m=this.distanceToPointer(p,o)/(l/1000)}p.body.velocity.setToPolar(n,m);return n},moveToXY:function(p,l,q,n,m){if(n===undefined){n=60}if(m===undefined){m=0}var o=Math.atan2(q-p.y,l-p.x);if(m>0){n=this.distanceToXY(p,l,q)/(m/1000)}p.body.velocity.setToPolar(o,n);return o},velocityFromAngle:function(n,m,l){if(m===undefined){m=60}l=l||new e.Point();return l.setToPolar(n,m,true)},velocityFromRotation:function(m,n,l){if(n===undefined){n=60}l=l||new e.Point();return l.setToPolar(m,n)},accelerationFromRotation:function(m,n,l){if(n===undefined){n=60}l=l||new e.Point();return l.setToPolar(m,n)},accelerateToObject:function(p,m,n,l,q){if(n===undefined){n=60}if(l===undefined){l=1000}if(q===undefined){q=1000}var o=this.angleBetween(p,m);p.body.acceleration.setToPolar(o,n);p.body.maxVelocity.setTo(l,q);return o},accelerateToPointer:function(p,o,m,l,q){if(m===undefined){m=60}if(o===undefined){o=this.game.input.activePointer}if(l===undefined){l=1000}if(q===undefined){q=1000}var n=this.angleToPointer(p,o);p.body.acceleration.setToPolar(n,m);p.body.maxVelocity.setTo(l,q);return n},accelerateToXY:function(p,m,r,n,l,q){if(n===undefined){n=60}if(l===undefined){l=1000}if(q===undefined){q=1000}var o=this.angleToXY(p,m,r);p.body.acceleration.setTo(o,n);p.body.maxVelocity.setTo(l,q);return o},distanceBetween:function(o,p,n){if(n===undefined){n=false}var m=(n)?o.world.x-p.world.x:o.x-p.x;var l=(n)?o.world.y-p.world.y:o.y-p.y;return Math.sqrt(m*m+l*l)},distanceToXY:function(p,l,q,o){if(o===undefined){o=false}var n=(o)?p.world.x-l:p.x-l;var m=(o)?p.world.y-q:p.y-q;return Math.sqrt(n*n+m*m)},distanceToPointer:function(p,o,n){if(o===undefined){o=this.game.input.activePointer}if(n===undefined){n=false}var m=(n)?p.world.x-o.worldX:p.x-o.worldX;var l=(n)?p.world.y-o.worldY:p.y-o.worldY;return Math.sqrt(m*m+l*l)},angleBetween:function(m,n,l){if(l===undefined){l=false}if(l){return Math.atan2(n.world.y-m.world.y,n.world.x-m.world.x)}else{return Math.atan2(n.y-m.y,n.x-m.x)}},angleBetweenCenters:function(n,o){var m=o.centerX-n.centerX;var l=o.centerY-n.centerY;return Math.atan2(l,m)},angleToXY:function(n,l,o,m){if(m===undefined){m=false}if(m){return Math.atan2(o-n.world.y,l-n.world.x)}else{return Math.atan2(o-n.y,l-n.x)}},angleToPointer:function(n,m,l){if(m===undefined){m=this.game.input.activePointer}if(l===undefined){l=false}if(l){return Math.atan2(m.worldY-n.world.y,m.worldX-n.world.x)}else{return Math.atan2(m.worldY-n.y,m.worldX-n.x)}},worldAngleToPointer:function(m,l){return this.angleToPointer(m,l,true)}};e.Physics.Arcade.Body=function(l){this.sprite=l;this.game=l.game;this.type=e.Physics.ARCADE;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new e.Point();this.position=new e.Point(l.x,l.y);this.prev=new e.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=l.angle;this.preRotation=l.angle;this.width=l.width;this.height=l.height;this.sourceWidth=l.width;this.sourceHeight=l.height;if(l.texture){this.sourceWidth=l.texture.frame.width;this.sourceHeight=l.texture.frame.height}this.halfWidth=Math.abs(l.width/2);this.halfHeight=Math.abs(l.height/2);this.center=new e.Point(l.x+this.halfWidth,l.y+this.halfHeight);this.velocity=new e.Point();this.newVelocity=new e.Point();this.deltaMax=new e.Point();this.acceleration=new e.Point();this.allowDrag=true;this.drag=new e.Point();this.allowGravity=true;this.gravity=new e.Point();this.bounce=new e.Point();this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new e.Point(10000,10000);this.friction=new e.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=e.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={none:true,up:false,down:false,left:false,right:false};this.tilePadding=new e.Point();this.dirty=false;this.skipQuadTree=false;this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new e.Signal();this.movementCallback=null;this.movementCallbackContext=null;this._reset=true;this._sx=l.scale.x;this._sy=l.scale.y;this._dx=0;this._dy=0};e.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var l=this.sprite.getBounds();l.ceilAll();if(l.width!==this.width||l.height!==this.height){this.width=l.width;this.height=l.height;this._reset=true}}else{var n=Math.abs(this.sprite.scale.x);var m=Math.abs(this.sprite.scale.y);if(n!==this._sx||m!==this._sy){this.width=this.sourceWidth*n;this.height=this.sourceHeight*m;this._sx=n;this._sy=m;this._reset=true}}if(this._reset){this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.updateCenter()}},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.none=true;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.overlapR=0;this.overlapX=0;this.overlapY=0;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.updateCenter();this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;this.updateCenter();if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.angle=Math.atan2(this.velocity.y,this.velocity.x)}this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(this.collideWorldBounds){if(this.checkWorldBounds()&&this.onWorldBounds){this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},updateMovement:function(){var n=0;var m=(this.overlapX!==0||this.overlapY!==0);if(this.moveDuration>0){this.moveTimer+=this.game.time.elapsedMS;n=this.moveTimer/this.moveDuration}else{this.moveTarget.end.set(this.position.x,this.position.y);n=this.moveTarget.length/this.moveDistance}if(this.movementCallback){var l=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,n)}if(m||n>=1||(l!==undefined&&l!==true)){this.stopMovement((n>=1)||(this.stopVelocityOnCollide&&m));return false}return true},stopMovement:function(l){if(this.isMoving){this.isMoving=false;if(l){this.velocity.set(0)}this.onMoveComplete.dispatch(this.sprite,(this.overlapX!==0||this.overlapY!==0))}},postUpdate:function(){if(!this.enable||!this.dirty){return}if(this.isMoving){this.updateMovement()}this.dirty=false;if(this.deltaX()<0){this.facing=e.LEFT}else{if(this.deltaX()>0){this.facing=e.RIGHT}}if(this.deltaY()<0){this.facing=e.UP}else{if(this.deltaY()>0){this.facing=e.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.updateCenter();if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},checkWorldBounds:function(){var p=this.position;var m=this.game.physics.arcade.bounds;var l=this.game.physics.arcade.checkCollision;var o=(this.worldBounce)?-this.worldBounce.x:-this.bounce.x;var n=(this.worldBounce)?-this.worldBounce.y:-this.bounce.y;if(p.x<m.x&&l.left){p.x=m.x;this.velocity.x*=o;this.blocked.left=true;this.blocked.none=false}else{if(this.right>m.right&&l.right){p.x=m.right-this.width;this.velocity.x*=o;this.blocked.right=true;this.blocked.none=false}}if(p.y<m.y&&l.up){p.y=m.y;this.velocity.y*=n;this.blocked.up=true;this.blocked.none=false}else{if(this.bottom>m.bottom&&l.down){p.y=m.bottom-this.height;this.velocity.y*=n;this.blocked.down=true;this.blocked.none=false}}return !this.blocked.none},moveFrom:function(n,l,m){if(l===undefined){l=this.speed}if(l===0){return false}var o;if(m===undefined){o=this.angle;m=this.game.math.radToDeg(o)}else{o=this.game.math.degToRad(m)}this.moveTimer=0;this.moveDuration=n;if(m===0||m===180){this.velocity.set(Math.cos(o)*l,0)}else{if(m===90||m===270){this.velocity.set(0,Math.sin(o)*l)}else{this.velocity.setToPolar(o,l)}}this.isMoving=true;return true},moveTo:function(n,p,m){var l=p/(n/1000);if(l===0){return false}var o;if(m===undefined){o=this.angle;m=this.game.math.radToDeg(o)}else{o=this.game.math.degToRad(m)}p=Math.abs(p);this.moveDuration=0;this.moveDistance=p;if(this.moveTarget===null){this.moveTarget=new e.Line();this.moveEnd=new e.Point()}this.moveTarget.fromAngle(this.x,this.y,o,p);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);if(m===0||m===180){this.velocity.set(Math.cos(o)*l,0)}else{if(m===90||m===270){this.velocity.set(0,Math.sin(o)*l)}else{this.velocity.setToPolar(o,l)}}this.isMoving=true;return true},setSize:function(n,m,l,o){if(l===undefined){l=this.offset.x}if(o===undefined){o=this.offset.y}this.sourceWidth=n;this.sourceHeight=m;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(l,o);this.updateCenter();this.isCircle=false;this.radius=0},setCircle:function(m,l,n){if(l===undefined){l=this.offset.x}if(n===undefined){n=this.offset.y}if(m>0){this.isCircle=true;this.radius=m;this.sourceWidth=m*2;this.sourceHeight=m*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(l,n);this.updateCenter()}else{this.isCircle=false}},reset:function(l,m){this.stop();this.position.x=(l-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(m-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this.updateBounds();this.updateCenter()},stop:function(){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0},getBounds:function(l){l.x=this.x;l.y=this.y;l.right=this.right;l.bottom=this.bottom;return l},hitTest:function(l,m){return(this.isCircle)?e.Circle.contains(this,l,m):e.Rectangle.contains(this,l,m)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){if(this.sprite.parent&&this.sprite.parent instanceof e.Group){this.sprite.parent.removeFromHash(this.sprite)}this.sprite.body=null;this.sprite=null}};Object.defineProperty(e.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}});Object.defineProperty(e.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(e.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(e.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(e.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(l){this.position.x=l}});Object.defineProperty(e.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(l){this.position.y=l}});e.Physics.Arcade.Body.render=function(n,l,m,o){if(o===undefined){o=true}m=m||"rgba(0,255,0,0.4)";n.fillStyle=m;n.strokeStyle=m;if(l.isCircle){n.beginPath();n.arc(l.center.x-l.game.camera.x,l.center.y-l.game.camera.y,l.halfWidth,0,2*Math.PI);if(o){n.fill()}else{n.stroke()}}else{if(o){n.fillRect(l.position.x-l.game.camera.x,l.position.y-l.game.camera.y,l.width,l.height)}else{n.strokeRect(l.position.x-l.game.camera.x,l.position.y-l.game.camera.y,l.width,l.height)}}};e.Physics.Arcade.Body.renderBodyInfo=function(m,l){m.line("x: "+l.x.toFixed(2),"y: "+l.y.toFixed(2),"width: "+l.width,"height: "+l.height);m.line("velocity x: "+l.velocity.x.toFixed(2),"y: "+l.velocity.y.toFixed(2),"deltaX: "+l._dx.toFixed(2),"deltaY: "+l._dy.toFixed(2));m.line("acceleration x: "+l.acceleration.x.toFixed(2),"y: "+l.acceleration.y.toFixed(2),"speed: "+l.speed.toFixed(2),"angle: "+l.angle.toFixed(2));m.line("gravity x: "+l.gravity.x,"y: "+l.gravity.y,"bounce x: "+l.bounce.x.toFixed(2),"y: "+l.bounce.y.toFixed(2));m.line("touching left: "+l.touching.left,"right: "+l.touching.right,"up: "+l.touching.up,"down: "+l.touching.down);m.line("blocked left: "+l.blocked.left,"right: "+l.blocked.right,"up: "+l.blocked.up,"down: "+l.blocked.down)};e.Physics.Arcade.Body.prototype.constructor=e.Physics.Arcade.Body;e.Physics.Arcade.TilemapCollision=function(){};e.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(p,l,r,q,m,n){if(!p.body){return}var s=l.getTiles(p.body.position.x-p.body.tilePadding.x-l.getTileOffsetX(),p.body.position.y-p.body.tilePadding.y-l.getTileOffsetY(),p.body.width+p.body.tilePadding.x,p.body.height+p.body.tilePadding.y,false,false);if(s.length===0){return}for(var o=0;o<s.length;o++){if(q){if(q.call(m,p,s[o])){if(this.separateTile(o,p.body,s[o],l,n)){this._total++;if(r){r.call(m,p,s[o])}}}}else{if(this.separateTile(o,p.body,s[o],l,n)){this._total++;if(r){r.call(m,p,s[o])}}}}},collideGroupVsTilemapLayer:function(r,l,q,p,m,n){if(r.length===0){return}for(var o=0;o<r.children.length;o++){if(r.children[o].exists){this.collideSpriteVsTilemapLayer(r.children[o],l,q,p,m,n)}}},separateTile:function(s,t,u,l,v){if(!t.enable){return false}var o=l.getTileOffsetX();var n=l.getTileOffsetY();if(!u.intersects((t.position.x-o),(t.position.y-n),(t.right-o),(t.bottom-n))){return false}else{if(v){return true}}if(u.collisionCallback&&!u.collisionCallback.call(u.collisionCallbackContext,t.sprite,u)){return false}else{if(typeof u.layer.callbacks!=="undefined"&&u.layer.callbacks[u.index]&&!u.layer.callbacks[u.index].callback.call(u.layer.callbacks[u.index].callbackContext,t.sprite,u)){return false}}if(!u.faceLeft&&!u.faceRight&&!u.faceTop&&!u.faceBottom){return false}var p=0;var m=0;var r=0;var q=1;if(t.deltaAbsX()>t.deltaAbsY()){r=-1}else{if(t.deltaAbsX()<t.deltaAbsY()){q=-1}}if(t.deltaX()!==0&&t.deltaY()!==0&&(u.faceLeft||u.faceRight)&&(u.faceTop||u.faceBottom)){r=Math.min(Math.abs((t.position.x-o)-u.right),Math.abs((t.right-o)-u.left));q=Math.min(Math.abs((t.position.y-n)-u.bottom),Math.abs((t.bottom-n)-u.top))}if(r<q){if(u.faceLeft||u.faceRight){p=this.tileCheckX(t,u,l);if(p!==0&&!u.intersects((t.position.x-o),(t.position.y-n),(t.right-o),(t.bottom-n))){return true}}if(u.faceTop||u.faceBottom){m=this.tileCheckY(t,u,l)}}else{if(u.faceTop||u.faceBottom){m=this.tileCheckY(t,u,l);if(m!==0&&!u.intersects((t.position.x-o),(t.position.y-n),(t.right-o),(t.bottom-n))){return true}}if(u.faceLeft||u.faceRight){p=this.tileCheckX(t,u,l)}}return(p!==0||m!==0)},tileCheckX:function(l,o,m){var n=0;var p=m.getTileOffsetX();if(l.deltaX()<0&&!l.blocked.left&&o.collideRight&&l.checkCollision.left){if(o.faceRight&&(l.x-p)<o.right){n=(l.x-p)-o.right;if(n<-this.TILE_BIAS){n=0}}}else{if(l.deltaX()>0&&!l.blocked.right&&o.collideLeft&&l.checkCollision.right){if(o.faceLeft&&(l.right-p)>o.left){n=(l.right-p)-o.left;if(n>this.TILE_BIAS){n=0}}}}if(n!==0){if(l.customSeparateX){l.overlapX=n}else{this.processTileSeparationX(l,n)}}return n},tileCheckY:function(l,o,n){var m=0;var p=n.getTileOffsetY();if(l.deltaY()<0&&!l.blocked.up&&o.collideDown&&l.checkCollision.up){if(o.faceBottom&&(l.y-p)<o.bottom){m=(l.y-p)-o.bottom;if(m<-this.TILE_BIAS){m=0}}}else{if(l.deltaY()>0&&!l.blocked.down&&o.collideUp&&l.checkCollision.down){if(o.faceTop&&(l.bottom-p)>o.top){m=(l.bottom-p)-o.top;if(m>this.TILE_BIAS){m=0}}}}if(m!==0){if(l.customSeparateY){l.overlapY=m}else{this.processTileSeparationY(l,m)}}return m},processTileSeparationX:function(m,l){if(l<0){m.blocked.left=true;m.blocked.none=false}else{if(l>0){m.blocked.right=true;m.blocked.none=false}}m.position.x-=l;if(m.bounce.x===0){m.velocity.x=0}else{m.velocity.x=-m.velocity.x*m.bounce.x}},processTileSeparationY:function(l,m){if(m<0){l.blocked.up=true;l.blocked.none=false}else{if(m>0){l.blocked.down=true;l.blocked.none=false}}l.position.y-=m;if(l.bounce.y===0){l.velocity.y=0}else{l.velocity.y=-l.velocity.y*l.bounce.y}}};e.Utils.mixinPrototype(e.Physics.Arcade.prototype,e.Physics.Arcade.TilemapCollision.prototype);e.ImageCollection=function(m,q,o,l,p,r,n){if(o===undefined||o<=0){o=32}if(l===undefined||l<=0){l=32}if(p===undefined){p=0}if(r===undefined){r=0}this.name=m;this.firstgid=q|0;this.imageWidth=o|0;this.imageHeight=l|0;this.imageMargin=p|0;this.imageSpacing=r|0;this.properties=n||{};this.images=[];this.total=0};e.ImageCollection.prototype={containsImageIndex:function(l){return(l>=this.firstgid&&l<(this.firstgid+this.total))},addImage:function(l,m){this.images.push({gid:l,image:m});this.total++}};e.ImageCollection.prototype.constructor=e.ImageCollection;e.Tile=function(o,n,m,q,p,l){this.layer=o;this.index=n;this.x=m;this.y=q;this.rotation=0;this.flipped=false;this.worldX=m*p;this.worldY=q*l;this.width=p;this.height=l;this.centerX=Math.abs(p/2);this.centerY=Math.abs(l/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};e.Tile.prototype={containsPoint:function(l,m){return !(l<this.worldX||m<this.worldY||l>this.right||m>this.bottom)},intersects:function(l,o,n,m){if(n<=this.worldX){return false}if(m<=this.worldY){return false}if(l>=this.worldX+this.width){return false}if(o>=this.worldY+this.height){return false}return true},setCollisionCallback:function(m,l){this.collisionCallback=m;this.collisionCallbackContext=l},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(n,m,l,o){this.collideLeft=n;this.collideRight=m;this.collideUp=l;this.collideDown=o;this.faceLeft=n;this.faceRight=m;this.faceTop=l;this.faceBottom=o},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(m,l){if(m&&l){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(m){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(l){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(l){this.index=l.index;this.alpha=l.alpha;this.properties=l.properties;this.collideUp=l.collideUp;this.collideDown=l.collideDown;this.collideLeft=l.collideLeft;this.collideRight=l.collideRight;this.collisionCallback=l.collisionCallback;this.collisionCallbackContext=l.collisionCallbackContext}};e.Tile.prototype.constructor=e.Tile;Object.defineProperty(e.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(e.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(e.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(e.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(e.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(e.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});e.Tilemap=function(n,o,r,m,p,l){this.game=n;this.key=o;var q=e.TilemapParser.parse(this.game,o,r,m,p,l);if(q===null){return}this.width=q.width;this.height=q.height;this.tileWidth=q.tileWidth;this.tileHeight=q.tileHeight;this.orientation=q.orientation;this.format=q.format;this.version=q.version;this.properties=q.properties;this.widthInPixels=q.widthInPixels;this.heightInPixels=q.heightInPixels;this.layers=q.layers;this.tilesets=q.tilesets;this.imagecollections=q.imagecollections;this.tiles=q.tiles;this.objects=q.objects;this.collideIndexes=[];this.collision=q.collision;this.images=q.images;this.enableDebug=false;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};e.Tilemap.CSV=0;e.Tilemap.TILED_JSON=1;e.Tilemap.NORTH=0;e.Tilemap.EAST=1;e.Tilemap.SOUTH=2;e.Tilemap.WEST=3;e.Tilemap.prototype={create:function(n,o,l,q,m,p){if(p===undefined){p=this.game.world}this.width=o;this.height=l;this.setTileSize(q,m);this.layers.length=0;return this.createBlankLayer(n,o,l,q,m,p)},setTileSize:function(m,l){this.tileWidth=m;this.tileHeight=l;this.widthInPixels=this.width*m;this.heightInPixels=this.height*l},addTilesetImage:function(l,A,w,q,E,r,o){if(l===undefined){return null}if(w===undefined){w=this.tileWidth}if(q===undefined){q=this.tileHeight}if(E===undefined){E=0}if(r===undefined){r=0}if(o===undefined){o=0}if(w===0){w=32}if(q===0){q=32}var n=null;if(A===undefined||A===null){A=l}if(A instanceof e.BitmapData){n=A.canvas}else{if(!this.game.cache.checkImageKey(A)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+A+'"');return null}n=this.game.cache.getImage(A)}var z=this.getTilesetIndex(l);if(z===null&&this.format===e.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+l+'"');return null}if(this.tilesets[z]){this.tilesets[z].setImage(n);return this.tilesets[z]}else{var v=new e.Tileset(l,o,w,q,E,r,{});v.setImage(n);this.tilesets.push(v);var m=this.tilesets.length-1;var u=E;var s=E;var p=0;var D=0;var B=0;for(var C=o;C<o+v.total;C++){this.tiles[C]=[u,s,m];u+=w+r;p++;if(p===v.total){break}D++;if(D===v.columns){u=E;s+=q+r;D=0;B++;if(B===v.rows){break}}}return v}return null},createFromObjects:function(m,r,x,n,t,s,w,l,o){if(t===undefined){t=true}if(s===undefined){s=false}if(w===undefined){w=this.game.world}if(l===undefined){l=e.Sprite}if(o===undefined){o=true}if(!this.objects[m]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+m);return}for(var q=0;q<this.objects[m].length;q++){var y=false;var p=this.objects[m][q];if(p.gid!==undefined&&typeof r==="number"&&p.gid===r){y=true}else{if(p.id!==undefined&&typeof r==="number"&&p.id===r){y=true}else{if(p.name!==undefined&&typeof r==="string"&&p.name===r){y=true}}}if(y){var v=new l(this.game,parseFloat(p.x,10),parseFloat(p.y,10),x,n);v.name=p.name;v.visible=p.visible;v.autoCull=s;v.exists=t;if(p.width){v.width=p.width}if(p.height){v.height=p.height}if(p.rotation){v.angle=p.rotation}if(o){v.y-=v.height}w.add(v);for(var u in p.properties){w.set(v,u,p.properties[u],false,false,0,true)}}}},createFromTiles:function(w,m,v,o,u,q){if(typeof w==="number"){w=[w]}if(m===undefined||m===null){m=[]}else{if(typeof m==="number"){m=[m]}}o=this.getLayer(o);if(u===undefined){u=this.game.world}if(q===undefined){q={}}if(q.customClass===undefined){q.customClass=e.Sprite}if(q.adjustY===undefined){q.adjustY=true}var l=this.layers[o].width;var x=this.layers[o].height;this.copy(0,0,l,x,o);if(this._results.length<2){return 0}var r=0;var t;for(var n=1,p=this._results.length;n<p;n++){if(w.indexOf(this._results[n].index)!==-1){t=new q.customClass(this.game,this._results[n].worldX,this._results[n].worldY,v);for(var s in q){t[s]=q[s]}u.add(t);r++}}if(m.length===1){for(n=0;n<w.length;n++){this.replace(w[n],m[0],0,0,l,x,o)}}else{if(m.length>1){for(n=0;n<w.length;n++){this.replace(w[n],m[n],0,0,l,x,o)}}}return r},createLayer:function(o,p,l,q){if(p===undefined){p=this.game.width}if(l===undefined){l=this.game.height}if(q===undefined){q=this.game.world}var n=o;if(typeof o==="string"){n=this.getLayerIndex(o)}if(n===null||n>this.layers.length){console.warn('Tilemap.createLayer: Invalid layer ID given: "'+o+'"');return}if(p===undefined||p<=0){p=Math.min(this.game.width,this.layers[n].widthInPixels)}else{if(p>this.game.width){p=this.game.width}}if(l===undefined||l<=0){l=Math.min(this.game.height,this.layers[n].heightInPixels)}else{if(l>this.game.height){l=this.game.height}}if(this.enableDebug){console.group("Tilemap.createLayer");console.log("Name:",this.layers[n].name);console.log("Size:",p,"x",l);console.log("Tileset:",this.tilesets[0].name,"index:",n)}var m=q.add(new e.TilemapLayer(this.game,this,n,p,l));if(this.enableDebug){console.groupEnd()}return m},createBlankLayer:function(l,m,z,t,q,v){if(v===undefined){v=this.game.world}if(this.getLayerIndex(l)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+l);return}var p={name:l,x:0,y:0,width:m,height:z,widthInPixels:m*t,heightInPixels:z*q,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var A;var n=[];for(var r=0;r<z;r++){A=[];for(var s=0;s<m;s++){A.push(new e.Tile(p,-1,s,r,t,q))}n.push(A)}p.data=n;this.layers.push(p);this.currentLayer=this.layers.length-1;var u=p.widthInPixels;var o=p.heightInPixels;if(u>this.game.width){u=this.game.width}if(o>this.game.height){o=this.game.height}var n=new e.TilemapLayer(this.game,this,this.layers.length-1,u,o);n.name=l;return v.add(n)},getIndex:function(l,m){for(var n=0;n<l.length;n++){if(l[n].name===m){return n}}return null},getLayerIndex:function(l){return this.getIndex(this.layers,l)},getTilesetIndex:function(l){return this.getIndex(this.tilesets,l)},getImageIndex:function(l){return this.getIndex(this.images,l)},setTileIndexCallback:function(n,q,m,p){p=this.getLayer(p);if(typeof n==="number"){this.layers[p].callbacks[n]={callback:q,callbackContext:m}}else{for(var o=0,l=n.length;o<l;o++){this.layers[p].callbacks[n[o]]={callback:q,callbackContext:m}}}},setTileLocationCallback:function(m,s,q,l,r,n,p){p=this.getLayer(p);this.copy(m,s,q,l,p);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){this._results[o].setCollisionCallback(r,n)}},setCollision:function(n,l,p,m){if(l===undefined){l=true}if(m===undefined){m=true}p=this.getLayer(p);if(typeof n==="number"){return this.setCollisionByIndex(n,l,p,true)}else{if(Array.isArray(n)){for(var o=0;o<n.length;o++){this.setCollisionByIndex(n[o],l,p,false)}if(m){this.calculateFaces(p)}}}},setCollisionBetween:function(q,p,l,o,n){if(l===undefined){l=true}if(n===undefined){n=true}o=this.getLayer(o);if(q>p){return}for(var m=q;m<=p;m++){this.setCollisionByIndex(m,l,o,false)}if(n){this.calculateFaces(o)}},setCollisionByExclusion:function(o,m,q,n){if(m===undefined){m=true}if(n===undefined){n=true}q=this.getLayer(q);for(var p=0,l=this.tiles.length;p<l;p++){if(o.indexOf(p)===-1){this.setCollisionByIndex(p,m,q,false)}}if(n){this.calculateFaces(q)}},setCollisionByIndex:function(o,m,q,n){if(m===undefined){m=true}if(q===undefined){q=this.currentLayer}if(n===undefined){n=true}if(m){this.collideIndexes.push(o)}else{var p=this.collideIndexes.indexOf(o);if(p>-1){this.collideIndexes.splice(p,1)}}for(var s=0;s<this.layers[q].height;s++){for(var l=0;l<this.layers[q].width;l++){var r=this.layers[q].data[s][l];if(r&&r.index===o){if(m){r.setCollision(true,true,true,true)}else{r.resetCollision()}r.faceTop=m;r.faceBottom=m;r.faceLeft=m;r.faceRight=m}}}if(n){this.calculateFaces(q)}return q},getLayer:function(l){if(l===undefined){l=this.currentLayer}else{if(typeof l==="string"){l=this.getLayerIndex(l)}else{if(l instanceof e.TilemapLayer){l=l.index}}}return l},setPreventRecalculate:function(m){if(m===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(m===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var l in this.needToRecalculate){this.calculateFaces(l)}this.needToRecalculate=false}},calculateFaces:function(n){if(this.preventingRecalculate){this.needToRecalculate[n]=true;return}var p=null;var t=null;var l=null;var u=null;for(var q=0,m=this.layers[n].height;q<m;q++){for(var r=0,s=this.layers[n].width;r<s;r++){var o=this.layers[n].data[q][r];if(o){p=this.getTileAbove(n,r,q);t=this.getTileBelow(n,r,q);l=this.getTileLeft(n,r,q);u=this.getTileRight(n,r,q);if(o.collides){o.faceTop=true;o.faceBottom=true;o.faceLeft=true;o.faceRight=true}if(p&&p.collides){o.faceTop=false}if(t&&t.collides){o.faceBottom=false}if(l&&l.collides){o.faceLeft=false}if(u&&u.collides){o.faceRight=false}}}}},getTileAbove:function(m,l,n){if(n>0){return this.layers[m].data[n-1][l]}return null},getTileBelow:function(m,l,n){if(n<this.layers[m].height-1){return this.layers[m].data[n+1][l]}return null},getTileLeft:function(m,l,n){if(l>0){return this.layers[m].data[n][l-1]}return null},getTileRight:function(m,l,n){if(l<this.layers[m].width-1){return this.layers[m].data[n][l+1]}return null},setLayer:function(l){l=this.getLayer(l);if(this.layers[l]){this.currentLayer=l}},hasTile:function(l,n,m){m=this.getLayer(m);if(this.layers[m].data[n]===undefined||this.layers[m].data[n][l]===undefined){return false}return(this.layers[m].data[n][l].index>-1)},removeTile:function(l,o,m){m=this.getLayer(m);if(l>=0&&l<this.layers[m].width&&o>=0&&o<this.layers[m].height){if(this.hasTile(l,o,m)){var n=this.layers[m].data[o][l];this.layers[m].data[o][l]=new e.Tile(this.layers[m],-1,l,o,this.tileWidth,this.tileHeight);this.layers[m].dirty=true;this.calculateFaces(m);return n}}},removeTileWorldXY:function(l,p,o,m,n){n=this.getLayer(n);l=this.game.math.snapToFloor(l,o)/o;p=this.game.math.snapToFloor(p,m)/m;return this.removeTile(l,p,n)},putTile:function(o,l,p,n){if(o===null){return this.removeTile(l,p,n)}n=this.getLayer(n);if(l>=0&&l<this.layers[n].width&&p>=0&&p<this.layers[n].height){var m;if(o instanceof e.Tile){m=o.index;if(this.hasTile(l,p,n)){this.layers[n].data[p][l].copy(o)}else{this.layers[n].data[p][l]=new e.Tile(n,m,l,p,o.width,o.height)}}else{m=o;if(this.hasTile(l,p,n)){this.layers[n].data[p][l].index=m}else{this.layers[n].data[p][l]=new e.Tile(this.layers[n],m,l,p,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(m)>-1){this.layers[n].data[p][l].setCollision(true,true,true,true)}else{this.layers[n].data[p][l].resetCollision()}this.layers[n].dirty=true;this.calculateFaces(n);return this.layers[n].data[p][l]}return null},putTileWorldXY:function(o,l,q,p,m,n){n=this.getLayer(n);l=this.game.math.snapToFloor(l,p)/p;q=this.game.math.snapToFloor(q,m)/m;return this.putTile(o,l,q,n)},searchTileIndex:function(n,p,m,o){if(p===undefined){p=0}if(m===undefined){m=false}o=this.getLayer(o);var r=0;if(m){for(var q=this.layers[o].height-1;q>=0;q--){for(var l=this.layers[o].width-1;l>=0;l--){if(this.layers[o].data[q][l].index===n){if(r===p){return this.layers[o].data[q][l]}else{r++}}}}}else{for(var q=0;q<this.layers[o].height;q++){for(var l=0;l<this.layers[o].width;l++){if(this.layers[o].data[q][l].index===n){if(r===p){return this.layers[o].data[q][l]}else{r++}}}}}return null},getTile:function(l,o,n,m){if(m===undefined){m=false}n=this.getLayer(n);if(l>=0&&l<this.layers[n].width&&o>=0&&o<this.layers[n].height){if(this.layers[n].data[o][l].index===-1){if(m){return this.layers[n].data[o][l]}else{return null}}else{return this.layers[n].data[o][l]}}else{return null}},getTileWorldXY:function(l,q,p,n,o,m){if(p===undefined){p=this.tileWidth}if(n===undefined){n=this.tileHeight}o=this.getLayer(o);l=this.game.math.snapToFloor(l,p)/p;q=this.game.math.snapToFloor(q,n)/n;return this.getTile(l,q,o,m)},copy:function(n,r,q,m,p){p=this.getLayer(p);if(!this.layers[p]){this._results.length=0;return}if(n===undefined){n=0}if(r===undefined){r=0}if(q===undefined){q=this.layers[p].width}if(m===undefined){m=this.layers[p].height}if(n<0){n=0}if(r<0){r=0}if(q>this.layers[p].width){q=this.layers[p].width}if(m>this.layers[p].height){m=this.layers[p].height}this._results.length=0;this._results.push({x:n,y:r,width:q,height:m,layer:p});for(var l=r;l<r+m;l++){for(var o=n;o<n+q;o++){this._results.push(this.layers[p].data[l][o])}}return this._results},paste:function(l,r,q,p){if(l===undefined){l=0}if(r===undefined){r=0}p=this.getLayer(p);if(!q||q.length<2){return}var n=l-q[1].x;var m=r-q[1].y;for(var o=1;o<q.length;o++){this.layers[p].data[m+q[o].y][n+q[o].x].copy(q[o])}this.layers[p].dirty=true;this.calculateFaces(p)},swap:function(q,p,m,r,o,l,n){n=this.getLayer(n);this.copy(m,r,o,l,n);if(this._results.length<2){return}this._tempA=q;this._tempB=p;this._results.forEach(this.swapHandler,this);this.paste(m,r,this._results,n)},swapHandler:function(l){if(l.index===this._tempA){l.index=this._tempB}else{if(l.index===this._tempB){l.index=this._tempA}}},forEach:function(r,o,m,q,p,l,n){n=this.getLayer(n);this.copy(m,q,p,l,n);if(this._results.length<2){return}this._results.forEach(r,o);this.paste(m,q,this._results,n)},replace:function(r,n,m,s,q,l,p){p=this.getLayer(p);this.copy(m,s,q,l,p);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){if(this._results[o].index===r){this._results[o].index=n}}this.paste(m,s,this._results,p)},random:function(q,p,l,s,n){n=this.getLayer(n);this.copy(q,p,l,s,n);if(this._results.length<2){return}var o=[];for(var u=1;u<this._results.length;u++){if(this._results[u].index){var r=this._results[u].index;if(o.indexOf(r)===-1){o.push(r)}}}for(var m=1;m<this._results.length;m++){this._results[m].index=this.game.rnd.pick(o)}this.paste(q,p,this._results,n)},shuffle:function(m,s,r,l,q){q=this.getLayer(q);this.copy(m,s,r,l,q);if(this._results.length<2){return}var n=[];for(var p=1;p<this._results.length;p++){if(this._results[p].index){n.push(this._results[p].index)}}e.ArrayUtils.shuffle(n);for(var o=1;o<this._results.length;o++){this._results[o].index=n[o-1]}this.paste(m,s,this._results,q)},fill:function(n,m,r,q,l,p){p=this.getLayer(p);this.copy(m,r,q,l,p);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){this._results[o].index=n}this.paste(m,r,this._results,p)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var m="";var n=[""];for(var o=0;o<this.layers[this.currentLayer].height;o++){for(var l=0;l<this.layers[this.currentLayer].width;l++){m+="%c  ";if(this.layers[this.currentLayer].data[o][l]>1){if(this.debugMap[this.layers[this.currentLayer].data[o][l]]){n.push("background: "+this.debugMap[this.layers[this.currentLayer].data[o][l]])}else{n.push("background: #ffffff")}}else{n.push("background: rgb(0, 0, 0)")}}m+="\n"}n[0]=m;console.log.apply(console,n)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};e.Tilemap.prototype.constructor=e.Tilemap;Object.defineProperty(e.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(l){if(l!==this.currentLayer){this.setLayer(l)}}});e.TilemapLayer=function(m,p,n,o,l){o|=0;l|=0;e.Sprite.call(this,m,0,0);this.map=p;this.index=n;this.layer=p.layers[n];this.canvas=e.CanvasPool.create(this,o,l);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution)));this.type=e.TILEMAPLAYER;this.physicsType=e.TILEMAPLAYER;this.renderSettings={enableScrollDelta:true,overdrawRatio:0.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:0.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:p.tileWidth,tileHeight:p.tileHeight,cw:p.tileWidth,ch:p.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this.tileOffset=new e.Point(this.layer.offsetX||0,this.layer.offsetY||0);this._results=[];if(!m.device.canvasBitBltShift){this.renderSettings.copyCanvas=e.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};e.TilemapLayer.prototype=Object.create(e.Sprite.prototype);e.TilemapLayer.prototype.constructor=e.TilemapLayer;e.TilemapLayer.prototype.preUpdateCore=e.Component.Core.preUpdate;e.TilemapLayer.sharedCopyCanvas=null;e.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=e.CanvasPool.create(this,2,2)}return this.sharedCopyCanvas};e.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};e.TilemapLayer.prototype.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y};e.TilemapLayer.prototype._renderCanvas=function(l){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,l)};e.TilemapLayer.prototype._renderWebGL=function(l){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,l)};e.TilemapLayer.prototype.destroy=function(){e.CanvasPool.remove(this);e.Component.Destroy.prototype.destroy.call(this)};e.TilemapLayer.prototype.resize=function(m,l){this.canvas.width=m;this.canvas.height=l;this.texture.frame.resize(m,l);this.texture.width=m;this.texture.height=l;this.texture.crop.width=m;this.texture.crop.height=l;this.texture.baseTexture.width=m;this.texture.baseTexture.height=l;this.texture.baseTexture.dirty();this.texture.requiresUpdate=true;this.texture._updateUvs();this.dirty=true};e.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};e.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||((!this.fixedToCamera)?this.position.x:0)};e.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||((!this.fixedToCamera)?this.position.y:0)};e.TilemapLayer.prototype._fixX=function(l){if(this.scrollFactorX===1||(this.scrollFactorX===0&&this.position.x===0)){return l}if(this.scrollFactorX===0&&this.position.x!==0){return l-this.position.x}return this._scrollX+(l-(this._scrollX/this.scrollFactorX))};e.TilemapLayer.prototype._unfixX=function(l){if(this.scrollFactorX===1){return l}return(this._scrollX/this.scrollFactorX)+(l-this._scrollX)};e.TilemapLayer.prototype._fixY=function(l){if(this.scrollFactorY===1||(this.scrollFactorY===0&&this.position.y===0)){return l}if(this.scrollFactorY===0&&this.position.y!==0){return l-this.position.y}return this._scrollY+(l-(this._scrollY/this.scrollFactorY))};e.TilemapLayer.prototype._unfixY=function(l){if(this.scrollFactorY===1){return l}return(this._scrollY/this.scrollFactorY)+(l-this._scrollY)};e.TilemapLayer.prototype.getTileX=function(l){return Math.floor(this._fixX(l)/this._mc.tileWidth)};e.TilemapLayer.prototype.getTileY=function(l){return Math.floor(this._fixY(l)/this._mc.tileHeight)};e.TilemapLayer.prototype.getTileXY=function(m,n,l){l.x=this.getTileX(m);l.y=this.getTileY(n);return l};e.TilemapLayer.prototype.getRayCastTiles=function(w,o,l,s){if(!o){o=this.rayStepRate}if(l===undefined){l=false}if(s===undefined){s=false}var u=this.getTiles(w.x,w.y,w.width,w.height,l,s);if(u.length===0){return[]}var r=w.coordinatesOnLine(o);var m=[];for(var n=0;n<u.length;n++){for(var v=0;v<r.length;v++){var q=u[n];var p=r[v];if(q.containsPoint(p[0],p[1])){m.push(q);break}}}return m};e.TilemapLayer.prototype.getTiles=function(v,u,m,z,p,w){if(p===undefined){p=false}if(w===undefined){w=false}var n=!(p||w);v=this._fixX(v);u=this._fixY(u);var s=Math.floor(v/(this._mc.cw*this.scale.x));var r=Math.floor(u/(this._mc.ch*this.scale.y));var t=Math.ceil((v+m)/(this._mc.cw*this.scale.x))-s;var l=Math.ceil((u+z)/(this._mc.ch*this.scale.y))-r;while(this._results.length){this._results.pop()}for(var o=r;o<r+l;o++){for(var q=s;q<s+t;q++){var A=this.layer.data[o];if(A&&A[q]){if(n||A[q].isInteresting(p,w)){this._results.push(A[q])}}}}return this._results.slice()};e.TilemapLayer.prototype.resolveTileset=function(o){var l=this._mc.tilesets;if(o<2000){while(l.length<o){l.push(undefined)}}var m=this.map.tiles[o]&&this.map.tiles[o][2];if(m!==null){var n=this.map.tilesets[m];if(n&&n.containsTileIndex(o)){return(l[o]=n)}}return(l[o]=null)};e.TilemapLayer.prototype.resetTilesetCache=function(){var l=this._mc.tilesets;while(l.length){l.pop()}};e.TilemapLayer.prototype.setScale=function(o,n){o=o||1;n=n||o;for(var q=0;q<this.layer.data.length;q++){var p=this.layer.data[q];for(var l=0;l<p.length;l++){var m=p[l];m.width=this.map.tileWidth*o;m.height=this.map.tileHeight*n;m.worldX=m.x*m.width;m.worldY=m.y*m.height}}this.scale.setTo(o,n)};e.TilemapLayer.prototype.shiftCanvas=function(l,t,r){var m=l.canvas;var u=m.width-Math.abs(t);var p=m.height-Math.abs(r);var w=0;var v=0;var s=t;var q=r;if(t<0){w=-t;s=0}if(r<0){v=-r;q=0}var o=this.renderSettings.copyCanvas;if(o){if(o.width<u||o.height<p){o.width=u;o.height=p}var n=o.getContext("2d");n.clearRect(0,0,u,p);n.drawImage(m,w,v,u,p,0,0,u,p);l.clearRect(s,q,u,p);l.drawImage(o,0,0,u,p,s,q,u,p)}else{l.save();l.globalCompositeOperation="copy";l.drawImage(m,w,v,u,p,s,q,u,p);l.restore()}};e.TilemapLayer.prototype.renderRegion=function(F,E,o,A,J,s){var n=this.context;var D=this.layer.width;var B=this.layer.height;var M=this._mc.tileWidth;var p=this._mc.tileHeight;var H=this._mc.tilesets;var G=NaN;if(!this._wrap){if(o<=J){o=Math.max(0,o);J=Math.min(D-1,J)}if(A<=s){A=Math.max(0,A);s=Math.min(B-1,s)}}var m=(o*M)-F;var l=(A*p)-E;var z=(o+((1<<20)*D))%D;var v=(A+((1<<20)*B))%B;var L,K,u,t,C,I;for(t=v,I=s-A,K=l;I>=0;t++,I--,K+=p){if(t>=B){t-=B}var r=this.layer.data[t];for(u=z,C=J-o,L=m;C>=0;u++,C--,L+=M){if(u>=D){u-=D}var N=r[u];if(!N||N.index<0){continue}var q=N.index;var w=H[q];if(w===undefined){w=this.resolveTileset(q)}if(N.alpha!==G&&!this.debug){n.globalAlpha=N.alpha;G=N.alpha}if(w){if(N.rotation||N.flipped){n.save();n.translate(L+N.centerX,K+N.centerY);n.rotate(N.rotation);if(N.flipped){n.scale(-1,1)}w.draw(n,-N.centerX,-N.centerY,q);n.restore()}else{w.draw(n,L,K,q)}}else{if(this.debugSettings.missingImageFill){n.fillStyle=this.debugSettings.missingImageFill;n.fillRect(L,K,M,p)}}if(N.debug&&this.debugSettings.debuggedTileOverfill){n.fillStyle=this.debugSettings.debuggedTileOverfill;n.fillRect(L,K,M,p)}}}};e.TilemapLayer.prototype.renderDeltaScroll=function(x,w){var A=this._mc.scrollX;var y=this._mc.scrollY;var t=this.canvas.width;var q=this.canvas.height;var r=this._mc.tileWidth;var n=this._mc.tileHeight;var p=0;var z=-r;var u=0;var m=-n;if(x<0){p=t+x;z=t-1}else{if(x>0){z=x}}if(w<0){u=q+w;m=q-1}else{if(w>0){m=w}}this.shiftCanvas(this.context,x,w);p=Math.floor((p+A)/r);z=Math.floor((z+A)/r);u=Math.floor((u+y)/n);m=Math.floor((m+y)/n);if(p<=z){this.context.clearRect(((p*r)-A),0,(z-p+1)*r,q);var o=Math.floor((0+y)/n);var l=Math.floor((q-1+y)/n);this.renderRegion(A,y,p,o,z,l)}if(u<=m){this.context.clearRect(0,((u*n)-y),t,(m-u+1)*n);var s=Math.floor((0+A)/r);var v=Math.floor((t-1+A)/r);this.renderRegion(A,y,s,u,v,m)}};e.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX;var s=this._mc.scrollY;var q=this.canvas.width;var o=this.canvas.height;var p=this._mc.tileWidth;var m=this._mc.tileHeight;var n=Math.floor(t/p);var u=Math.floor((q-1+t)/p);var r=Math.floor(s/m);var l=Math.floor((o-1+s)/m);this.context.clearRect(0,0,q,o);this.renderRegion(t,s,n,r,u,l)};e.TilemapLayer.prototype.render=function(){var l=false;if(!this.visible){return}if(this.dirty||this.layer.dirty){this.layer.dirty=false;l=true}var m=this.canvas.width;var s=this.canvas.height;var r=this._scrollX|0;var q=this._scrollY|0;var p=this._mc;var o=p.scrollX-r;var n=p.scrollY-q;if(!l&&o===0&&n===0&&p.renderWidth===m&&p.renderHeight===s){return}this.context.save();p.scrollX=r;p.scrollY=q;if(p.renderWidth!==m||p.renderHeight!==s){p.renderWidth=m;p.renderHeight=s}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){l=true}}if(!l&&this.renderSettings.enableScrollDelta&&(Math.abs(o)+Math.abs(n))<Math.min(m,s)){this.renderDeltaScroll(o,n)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.texture.baseTexture.dirty();this.dirty=false;this.context.restore();return true};e.TilemapLayer.prototype.renderDebug=function(){var F=this._mc.scrollX;var E=this._mc.scrollY;var o=this.context;var n=this.canvas.width;var t=this.canvas.height;var D=this.layer.width;var B=this.layer.height;var K=this._mc.tileWidth;var q=this._mc.tileHeight;var p=Math.floor(F/K);var H=Math.floor((n-1+F)/K);var A=Math.floor(E/q);var s=Math.floor((t-1+E)/q);var m=(p*K)-F;var l=(A*q)-E;var z=(p+((1<<20)*D))%D;var w=(A+((1<<20)*B))%B;var J,I,v,u,C,G;o.strokeStyle=this.debugSettings.facingEdgeStroke;for(u=w,G=s-A,I=l;G>=0;u++,G--,I+=q){if(u>=B){u-=B}var r=this.layer.data[u];for(v=z,C=H-p,J=m;C>=0;v++,C--,J+=K){if(v>=D){v-=D}var L=r[v];if(!L||L.index<0||!L.collides){continue}if(this.debugSettings.collidingTileOverfill){o.fillStyle=this.debugSettings.collidingTileOverfill;o.fillRect(J,I,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){o.beginPath();if(L.faceTop){o.moveTo(J,I);o.lineTo(J+this._mc.cw,I)}if(L.faceBottom){o.moveTo(J,I+this._mc.ch);o.lineTo(J+this._mc.cw,I+this._mc.ch)}if(L.faceLeft){o.moveTo(J,I);o.lineTo(J,I+this._mc.ch)}if(L.faceRight){o.moveTo(J+this._mc.cw,I);o.lineTo(J+this._mc.cw,I+this._mc.ch)}o.closePath();o.stroke()}}}};Object.defineProperty(e.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(l){this._wrap=l;this.dirty=true}});Object.defineProperty(e.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(l){this._scrollX=l}});Object.defineProperty(e.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(l){this._scrollY=l}});Object.defineProperty(e.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(l){this._mc.cw=l|0;this.dirty=true}});Object.defineProperty(e.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(l){this._mc.ch=l|0;this.dirty=true}});e.TilemapParser={INSERT_NULL:false,parse:function(n,o,r,m,p,l){if(r===undefined){r=32}if(m===undefined){m=32}if(p===undefined){p=10}if(l===undefined){l=10}if(o===undefined){return this.getEmptyData()}if(o===null){return this.getEmptyData(r,m,p,l)}var q=n.cache.getTilemapData(o);if(q){if(q.format===e.Tilemap.CSV){return this.parseCSV(o,q.data,r,m)}else{if(!q.format||q.format===e.Tilemap.TILED_JSON){return this.parseTiledJSON(q.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+o)}},parseCSV:function(u,p,t,q){var l=this.getEmptyData();p=p.trim();var n=[];var w=p.split("\n");var v=w.length;var m=0;for(var r=0;r<w.length;r++){n[r]=[];var o=w[r].split(",");for(var s=0;s<o.length;s++){n[r][s]=new e.Tile(l.layers[0],parseInt(o[s],10),s,r,t,q)}if(m===0){m=o.length}}l.format=e.Tilemap.CSV;l.name=u;l.width=m;l.height=v;l.tileWidth=t;l.tileHeight=q;l.widthInPixels=m*t;l.heightInPixels=v*q;l.layers[0].width=m;l.layers[0].height=v;l.layers[0].widthInPixels=l.widthInPixels;l.layers[0].heightInPixels=l.heightInPixels;l.layers[0].data=n;return l},getEmptyData:function(o,m,n,l){return{width:(n!==undefined&&n!==null)?n:0,height:(l!==undefined&&l!==null)?l:0,tileWidth:(o!==undefined&&o!==null)?o:0,tileHeight:(m!==undefined&&m!==null)?m:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(ab){if(ab.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var J={width:ab.width,height:ab.height,tileWidth:ab.tilewidth,tileHeight:ab.tileheight,orientation:ab.orientation,format:e.Tilemap.TILED_JSON,version:ab.version,properties:ab.properties,widthInPixels:ab.width*ab.tilewidth,heightInPixels:ab.height*ab.tileheight};var T=[];for(var ae=0;ae<ab.layers.length;ae++){if(ab.layers[ae].type!=="tilelayer"){continue}var P=ab.layers[ae];if(!P.compression&&P.encoding&&P.encoding==="base64"){var Z=window.atob(P.data);var E=Z.length;var z=new Array(E);for(var ad=0;ad<E;ad+=4){z[ad/4]=(Z.charCodeAt(ad)|Z.charCodeAt(ad+1)<<8|Z.charCodeAt(ad+2)<<16|Z.charCodeAt(ad+3)<<24)>>>0}P.data=z;delete P.encoding}else{if(P.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+P.name+"'");continue}}var n={name:P.name,x:P.x,y:P.y,width:P.width,height:P.height,widthInPixels:P.width*ab.tilewidth,heightInPixels:P.height*ab.tileheight,alpha:P.opacity,offsetX:P.offsetx,offsetY:P.offsety,visible:P.visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(P.properties){n.properties=P.properties}var O=0;var B=[];var H=[];var K,A,q,R;for(var U=0,E=P.data.length;U<E;U++){K=0;A=false;R=P.data[U];q=0;if(R>536870912){if(R>2147483648){R-=2147483648;q+=4}if(R>1073741824){R-=1073741824;q+=2}if(R>536870912){R-=536870912;q+=1}switch(q){case 5:K=Math.PI/2;break;case 6:K=Math.PI;break;case 3:K=3*Math.PI/2;break;case 4:K=0;A=true;break;case 7:K=Math.PI/2;A=true;break;case 2:K=Math.PI;A=true;break;case 1:K=3*Math.PI/2;A=true;break}}if(R>0){var r=new e.Tile(n,R,O,H.length,ab.tilewidth,ab.tileheight);r.rotation=K;r.flipped=A;if(q!==0){r.flippedVal=q}B.push(r)}else{if(e.TilemapParser.INSERT_NULL){B.push(null)}else{B.push(new e.Tile(n,-1,O,H.length,ab.tilewidth,ab.tileheight))}}O++;if(O===P.width){H.push(B);O=0;B=[]}}n.data=H;T.push(n)}J.layers=T;var m=[];for(var ae=0;ae<ab.layers.length;ae++){if(ab.layers[ae].type!=="imagelayer"){continue}var V=ab.layers[ae];var o={name:V.name,image:V.image,x:V.x,y:V.y,alpha:V.opacity,visible:V.visible,properties:{}};if(V.properties){o.properties=V.properties}m.push(o)}J.images=m;var af=[];var F=[];var L=null;for(var ae=0;ae<ab.tilesets.length;ae++){var G=ab.tilesets[ae];if(G.image){var s=new e.Tileset(G.name,G.firstgid,G.tilewidth,G.tileheight,G.margin,G.spacing,G.properties);if(G.tileproperties){s.tileProperties=G.tileproperties}s.updateTileData(G.imagewidth,G.imageheight);af.push(s)}else{var I=new e.ImageCollection(G.name,G.firstgid,G.tilewidth,G.tileheight,G.margin,G.spacing,G.properties);for(var l in G.tiles){var o=G.tiles[l].image;var R=G.firstgid+parseInt(l,10);I.addImage(R,o)}F.push(I)}if(L){L.lastgid=G.firstgid-1}L=G}J.tilesets=af;J.imagecollections=F;var W={};var X={};function C(y,p){var v={};for(var t in p){var x=p[t];if(typeof y[x]!=="undefined"){v[x]=y[x]}}return v}for(var ae=0;ae<ab.layers.length;ae++){if(ab.layers[ae].type!=="objectgroup"){continue}var N=ab.layers[ae];W[N.name]=[];X[N.name]=[];for(var S=0,E=N.objects.length;S<E;S++){if(N.objects[S].gid){var Q={gid:N.objects[S].gid,name:N.objects[S].name,type:N.objects[S].hasOwnProperty("type")?N.objects[S].type:"",x:N.objects[S].x,y:N.objects[S].y,visible:N.objects[S].visible,properties:N.objects[S].properties};if(N.objects[S].rotation){Q.rotation=N.objects[S].rotation}W[N.name].push(Q)}else{if(N.objects[S].polyline){var Q={name:N.objects[S].name,type:N.objects[S].type,x:N.objects[S].x,y:N.objects[S].y,width:N.objects[S].width,height:N.objects[S].height,visible:N.objects[S].visible,properties:N.objects[S].properties};if(N.objects[S].rotation){Q.rotation=N.objects[S].rotation}Q.polyline=[];for(var aa=0;aa<N.objects[S].polyline.length;aa++){Q.polyline.push([N.objects[S].polyline[aa].x,N.objects[S].polyline[aa].y])}X[N.name].push(Q);W[N.name].push(Q)}else{if(N.objects[S].polygon){var Q=C(N.objects[S],["name","type","x","y","visible","rotation","properties"]);Q.polygon=[];for(var aa=0;aa<N.objects[S].polygon.length;aa++){Q.polygon.push([N.objects[S].polygon[aa].x,N.objects[S].polygon[aa].y])}W[N.name].push(Q)}else{if(N.objects[S].ellipse){var Q=C(N.objects[S],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);W[N.name].push(Q)}else{var Q=C(N.objects[S],["name","type","x","y","width","height","visible","rotation","properties"]);Q.rectangle=true;W[N.name].push(Q)}}}}}}J.objects=W;J.collision=X;J.tiles=[];for(var ae=0;ae<J.tilesets.length;ae++){var G=J.tilesets[ae];var O=G.tileMargin;var M=G.tileMargin;var Y=0;var w=0;var u=0;for(var U=G.firstgid;U<G.firstgid+G.total;U++){J.tiles[U]=[O,M,ae];O+=G.tileWidth+G.tileSpacing;Y++;if(Y===G.total){break}w++;if(w===G.columns){O=G.tileMargin;M+=G.tileHeight+G.tileSpacing;w=0;u++;if(u===G.rows){break}}}}var n;var r;var D;var G;for(var ae=0;ae<J.layers.length;ae++){n=J.layers[ae];G=null;for(var ad=0;ad<n.data.length;ad++){B=n.data[ad];for(var ac=0;ac<B.length;ac++){r=B[ac];if(r===null||r.index<0){continue}D=J.tiles[r.index][2];G=J.tilesets[D];if(G.tileProperties&&G.tileProperties[r.index-G.firstgid]){r.properties=e.Utils.mixin(G.tileProperties[r.index-G.firstgid],r.properties)}}}}return J}};e.Tileset=function(m,q,o,l,p,r,n){if(o===undefined||o<=0){o=32}if(l===undefined||l<=0){l=32}if(p===undefined){p=0}if(r===undefined){r=0}this.name=m;this.firstgid=q|0;this.tileWidth=o|0;this.tileHeight=l|0;this.tileMargin=p|0;this.tileSpacing=r|0;this.properties=n||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};e.Tileset.prototype={draw:function(n,l,p,m){var o=(m-this.firstgid)<<1;if(o>=0&&(o+1)<this.drawCoords.length){n.drawImage(this.image,this.drawCoords[o],this.drawCoords[o+1],this.tileWidth,this.tileHeight,l,p,this.tileWidth,this.tileHeight)}},containsTileIndex:function(l){return(l>=this.firstgid&&l<(this.firstgid+this.total))},setImage:function(l){this.image=l;this.updateTileData(l.width,l.height)},setSpacing:function(l,m){this.tileMargin=l|0;this.tileSpacing=m|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(q,n){var p=(n-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var r=(q-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(p%1!==0||r%1!==0){console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size")}p=Math.floor(p);r=Math.floor(r);if((this.rows&&this.rows!==p)||(this.columns&&this.columns!==r)){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=p;this.columns=r;this.total=p*r;this.drawCoords.length=0;var o=this.tileMargin;var m=this.tileMargin;for(var s=0;s<this.rows;s++){for(var l=0;l<this.columns;l++){this.drawCoords.push(o);this.drawCoords.push(m);o+=this.tileWidth+this.tileSpacing}o=this.tileMargin;m+=this.tileHeight+this.tileSpacing}}};e.Tileset.prototype.constructor=e.Tileset;e.Particle=function(m,l,p,n,o){e.Sprite.call(this,m,l,p,n,o);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};e.Particle.prototype=Object.create(e.Sprite.prototype);e.Particle.prototype.constructor=e.Particle;e.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};e.Particle.prototype.onEmit=function(){};e.Particle.prototype.setAlphaData=function(l){this.alphaData=l;this._a=l.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};e.Particle.prototype.setScaleData=function(l){this.scaleData=l;this._s=l.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};e.Particle.prototype.reset=function(l,n,m){e.Component.Reset.prototype.reset.call(this,l,n,m);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};e.Particles=function(l){this.game=l;this.emitters={};this.ID=0};e.Particles.prototype={add:function(l){this.emitters[l.id]=l;return l},remove:function(l){delete this.emitters[l.id]},update:function(){for(var l in this.emitters){if(this.emitters[l].exists){this.emitters[l].update()}}}};e.Particles.prototype.constructor=e.Particles;e.Particles.Arcade={};e.Particles.Arcade.Emitter=function(m,l,o,n){this.maxParticles=n||50;e.Group.call(this,m);this._id=this.game.particles.ID++;this.name="emitter"+this.id;this.type=e.EMITTER;this.physicsType=e.GROUP;this.area=new e.Rectangle(l,o,1,1);this.minAngle=null;this.maxAngle=null;this.minSpeed=0;this.maxSpeed=100;this.minParticleSpeed=new e.Point(-100,-100);this.maxParticleSpeed=new e.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.particleClass=e.Particle;this.particleDrag=new e.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new e.Point();this.on=false;this.particleAnchor=new e.Point(0.5,0.5);this.blendMode=e.blendModes.NORMAL;this.emitX=l;this.emitY=o;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this.count={emitted:0,failed:0,totalEmitted:0,totalFailed:0};this._gravity=new e.Point(0,100);this._minParticleScale=new e.Point(1,1);this._maxParticleScale=new e.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};e.Particles.Arcade.Emitter.prototype=Object.create(e.Group.prototype);e.Particles.Arcade.Emitter.prototype.constructor=e.Particles.Arcade.Emitter;e.Particles.Arcade.Emitter.prototype.update=function(){this.count.emitted=0;this.count.failed=0;if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var l=0;l<this._flowQuantity;l++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var l=this.children.length;while(l--){if(this.children[l].exists){this.children[l].update()}}};e.Particles.Arcade.Emitter.prototype.makeParticles=function(t,q,n,s,u,l){if(q===undefined){q=0}if(n===undefined){n=this.maxParticles}if(s===undefined){s=false}if(u===undefined){u=false}if(l===undefined){l=null}var p;var o=0;var m=t;var r=q;this._frames=q;if(n>this.maxParticles){this.maxParticles=n}while(o<n){if(Array.isArray(t)){m=this.game.rnd.pick(t)}if(Array.isArray(q)){r=this.game.rnd.pick(q)}p=new this.particleClass(this.game,0,0,m,r,l);this.game.physics.arcade.enable(p,false);p.body.checkCollision.none=!s;p.body.collideWorldBounds=u;p.body.skipQuadTree=true;p.exists=false;p.visible=false;p.anchor.copyFrom(this.particleAnchor);this.add(p);o++}return this};e.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false;return this};e.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true;return this};e.Particles.Arcade.Emitter.prototype.explode=function(m,l){if(l===undefined){l=this.maxParticles}this._flowTotal=0;this.start(true,m,0,l,false);return this};e.Particles.Arcade.Emitter.prototype.flow=function(p,o,n,m,l){if(o===undefined||o===null){o=250}if(n===undefined||n===0){n=1}if(m===undefined){m=-1}if(l===undefined){l=true}if(n>this.maxParticles){n=this.maxParticles}this._counter=0;this._flowQuantity=n;this._flowTotal=m;if(l){this.start(true,p,o,n);this._counter+=n;this.on=true;this._timer=this.game.time.time+o*this.game.time.slowMotion}else{this.start(false,p,o,n)}return this};e.Particles.Arcade.Emitter.prototype.start=function(n,q,p,o,l){if(n===undefined){n=true}if(q===undefined){q=0}if(p===undefined||p===null){p=250}if(o===undefined){o=0}if(l===undefined){l=false}if(o>this.maxParticles){o=this.maxParticles}this.revive();this.visible=true;this.lifespan=q;this.frequency=p;if(n||l){for(var m=0;m<o;m++){this.emitParticle()}}else{this.on=true;this._quantity=o;this._counter=0;this._timer=this.game.time.time+p*this.game.time.slowMotion}return this};e.Particles.Arcade.Emitter.prototype.emitParticle=function(s,r,t,l){if(s===undefined){s=null}if(r===undefined){r=null}var q=this.getFirstExists(false);if(q===null){this.count.failed++;this.count.totalFailed++;return false}this.count.emitted++;this.count.totalEmitted++;var m=this.game.rnd;if(t!==undefined&&l!==undefined){q.loadTexture(t,l)}else{if(t!==undefined){q.loadTexture(t)}}var o=this.emitX;var n=this.emitY;if(s!==null){o=s}else{if(this.width>1){o=m.between(this.left,this.right)}}if(r!==null){n=r}else{if(this.height>1){n=m.between(this.top,this.bottom)}}q.reset(o,n);q.angle=0;q.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(q)}else{if(this.particleSendToBack){this.sendToBack(q)}}if(this.autoScale){q.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){q.scale.set(m.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){q.scale.set(m.realInRange(this._minParticleScale.x,this._maxParticleScale.x),m.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}else{q.scale.set(this._minParticleScale.x,this._minParticleScale.y)}}}if(l===undefined){if(Array.isArray(this._frames)){q.frame=this.game.rnd.pick(this._frames)}else{q.frame=this._frames}}if(this.autoAlpha){q.setAlphaData(this.alphaData)}else{q.alpha=m.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}q.blendMode=this.blendMode;var p=q.body;p.updateBounds();p.bounce.copyFrom(this.bounce);p.drag.copyFrom(this.particleDrag);if(this.minAngle!=null&&this.maxAngle!=null){this.game.physics.arcade.velocityFromAngle((this.minAngle===this.maxAngle)?this.minAngle:m.between(this.minAngle,this.maxAngle),(this.minSpeed===this.maxSpeed)?this.minSpeed:m.between(this.minSpeed,this.maxSpeed),p.velocity)}else{p.velocity.x=m.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);p.velocity.y=m.between(this.minParticleSpeed.y,this.maxParticleSpeed.y)}p.angularVelocity=m.between(this.minRotation,this.maxRotation);p.gravity.copyFrom(this.gravity);p.angularDrag=this.angularDrag;q.onEmit();return true};e.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);e.Group.prototype.destroy.call(this,true,false)};e.Particles.Arcade.Emitter.prototype.setSize=function(m,l){this.area.width=m;this.area.height=l;return this};e.Particles.Arcade.Emitter.prototype.setXSpeed=function(m,l){m=m||0;l=l||0;this.minParticleSpeed.x=m;this.maxParticleSpeed.x=l;return this};e.Particles.Arcade.Emitter.prototype.setYSpeed=function(m,l){m=m||0;l=l||0;this.minParticleSpeed.y=m;this.maxParticleSpeed.y=l;return this};e.Particles.Arcade.Emitter.prototype.setRotation=function(m,l){m=m||0;l=l||0;this.minRotation=m;this.maxRotation=l;return this};e.Particles.Arcade.Emitter.prototype.setAlpha=function(o,l,q,r,p){if(o===undefined){o=1}if(l===undefined){l=1}if(q===undefined){q=0}if(r===undefined){r=e.Easing.Linear.None}if(p===undefined){p=false}this.minParticleAlpha=o;this.maxParticleAlpha=l;this.autoAlpha=false;if(q>0&&o!==l){var m={v:o};var n=this.game.make.tween(m).to({v:l},q,r);n.yoyo(p);this.alphaData=n.generateData(60);this.alphaData.reverse();this.autoAlpha=true}return this};e.Particles.Arcade.Emitter.prototype.setScale=function(o,m,n,l,q,p,r){if(o===undefined){o=1}if(m===undefined){m=1}if(n===undefined){n=1}if(l===undefined){l=1}if(q===undefined){q=0}if(p===undefined){p=e.Easing.Linear.None}if(r===undefined){r=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(o,n);this._maxParticleScale.set(m,l);this.autoScale=false;if(q>0&&((o!==m)||(n!==l))){var t={x:o,y:n};var s=this.game.make.tween(t).to({x:m,y:l},q,p);s.yoyo(r);this.scaleData=s.generateData(60);this.scaleData.reverse();this.autoScale=true}return this};e.Particles.Arcade.Emitter.prototype.setAngle=function(n,o,l,m){this.minAngle=n;this.maxAngle=o;if(l!=null){this.minSpeed=l}if(m!=null){this.maxSpeed=m}return this};e.Particles.Arcade.Emitter.prototype.at=function(l){if(l.center){this.emitX=l.center.x;this.emitY=l.center.y}else{this.emitX=l.world.x+(l.anchor.x*l.width);this.emitY=l.world.y+(l.anchor.y*l.height)}return this};Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(l){if(typeof l==="number"){this._gravity.y=l}else{this._gravity=l}}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(l){this.area.width=l}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(l){this.area.height=l}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(l){this.emitX=l}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(l){this.emitY=l}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.area.height/2))}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1000*this._flowQuantity/this.frequency}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"lifespanOutput",{get:function(){return(this.lifespan===0?Infinity:this.lifespan)*this._flowQuantity/this.frequency}});Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}});e.Weapon=function(l,m){e.Plugin.call(this,l,m);this.bullets=null;this.autoExpandBulletsGroup=false;this.autofire=false;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new e.Rectangle(0,0,1,1);this.fireAngle=e.ANGLE_UP;this.bulletInheritSpriteSpeed=false;this.bulletAnimation="";this.bulletFrameRandom=false;this.bulletFrameCycle=false;this.bulletWorldWrap=false;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new e.Point(0,0);this.bulletRotateToVelocity=false;this.bulletKey="";this.bulletFrame="";this._bulletClass=e.Bullet;this._bulletCollideWorldBounds=false;this._bulletKillType=e.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:false,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new e.Rectangle();this.bulletBounds=l.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new e.Signal();this.onKill=new e.Signal();this.onFireLimit=new e.Signal();this.trackedSprite=null;this.trackedPointer=null;this.multiFire=false;this._hasFired=false;this.trackRotation=false;this.trackOffset=new e.Point();this._nextFire=0;this._tempNextFire=0;this._rotatedPoint=new e.Point()};e.Weapon.prototype=Object.create(e.Plugin.prototype);e.Weapon.prototype.constructor=e.Weapon;e.Weapon.KILL_NEVER=0;e.Weapon.KILL_LIFESPAN=1;e.Weapon.KILL_DISTANCE=2;e.Weapon.KILL_WEAPON_BOUNDS=3;e.Weapon.KILL_CAMERA_BOUNDS=4;e.Weapon.KILL_WORLD_BOUNDS=5;e.Weapon.KILL_STATIC_BOUNDS=6;e.Weapon.prototype.createBullets=function(n,l,o,m){if(n===undefined){n=1}if(m===undefined){m=this.game.world}if(!this.bullets){this.bullets=this.game.add.physicsGroup(e.Physics.ARCADE,m);this.bullets.classType=this._bulletClass}if(n!==0){if(n===-1){this.autoExpandBulletsGroup=true;n=1}this.bullets.createMultiple(n,l,o);this.bullets.setAll("data.bulletManager",this);this.bulletKey=l;this.bulletFrame=o}return this};e.Weapon.prototype.forEach=function(m,l){this.bullets.forEachExists(m,l,arguments);return this};e.Weapon.prototype.pauseAll=function(){this.bullets.setAll("body.enable",false);return this};e.Weapon.prototype.resumeAll=function(){this.bullets.setAll("body.enable",true);return this};e.Weapon.prototype.killAll=function(){this.bullets.callAllExists("kill",true);this.bullets.setAll("body.enable",true);return this};e.Weapon.prototype.resetShots=function(l){this.shots=0;if(l!==undefined){this.fireLimit=l}return this};e.Weapon.prototype.destroy=function(){this.parent.remove(this,false);this.bullets.destroy();this.game=null;this.parent=null;this.active=false;this.visible=false};e.Weapon.prototype.update=function(){if(this._bulletKillType===e.Weapon.KILL_WEAPON_BOUNDS){if(this.trackedSprite){this.trackedSprite.updateTransform();this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)}else{if(this.trackedPointer){this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)}}}if(this.autofire){this.fire()}};e.Weapon.prototype.postRender=function(){if(!this.multiFire||!this._hasFired){return}this._hasFired=false;this._nextFire=this._tempNextFire};e.Weapon.prototype.trackSprite=function(n,l,o,m){if(l===undefined){l=0}if(o===undefined){o=0}if(m===undefined){m=false}this.trackedPointer=null;this.trackedSprite=n;this.trackRotation=m;this.trackOffset.set(l,o);return this};e.Weapon.prototype.trackPointer=function(m,l,n){if(m===undefined){m=this.game.input.activePointer}if(l===undefined){l=0}if(n===undefined){n=0}this.trackedPointer=m;this.trackedSprite=null;this.trackRotation=false;this.trackOffset.set(l,n);return this};e.Weapon.prototype.fireMany=function(m,o){this.multiFire=true;var l=[];var n=this;if(o||this.trackedSprite||this.trackedPointer){m.forEach(function(p){l.push(n.fire(o,null,null,p.x,p.y))})}else{m.forEach(function(p){l.push(n.fire(p))})}return l};e.Weapon.prototype.fireOffset=function(l,m){if(l===undefined){l=0}if(m===undefined){m=0}return this.fire(null,null,null,l,m)};e.Weapon.prototype.fire=function(B,A,v,t,r){if(A===undefined){A=null}if(v===undefined){v=null}if(this.game.time.now<this._nextFire||(this.fireLimit>0&&this.shots===this.fireLimit)){return null}var o=this.bulletSpeed;if(this.bulletSpeedVariance!==0){o+=e.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)}if(B){if(this.fireFrom.width>1){this.fireFrom.centerOn(B.x,B.y)}else{this.fireFrom.x=B.x;this.fireFrom.y=B.y}}else{if(this.trackedSprite){if(this.trackRotation){this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y);this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation);if(this.fireFrom.width>1){this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y)}else{this.fireFrom.x=this._rotatedPoint.x;this.fireFrom.y=this._rotatedPoint.y}}else{if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y}}if(this.bulletInheritSpriteSpeed){o+=this.trackedSprite.body.speed}}else{if(this.trackedPointer){if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y}}}}if(t!==undefined){this.fireFrom.x+=t}if(r!==undefined){this.fireFrom.y+=r}var z=(this.fireFrom.width>1)?this.fireFrom.randomX:this.fireFrom.x;var w=(this.fireFrom.height>1)?this.fireFrom.randomY:this.fireFrom.y;var p=(this.trackRotation)?this.trackedSprite.angle:this.fireAngle;if(A!==null&&v!==null){p=this.game.math.radToDeg(Math.atan2(v-w,A-z))}if(this.bulletAngleVariance!==0){p+=e.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)}var n=0;var m=0;if(p===0||p===180){n=Math.cos(this.game.math.degToRad(p))*o}else{if(p===90||p===270){m=Math.sin(this.game.math.degToRad(p))*o}else{n=Math.cos(this.game.math.degToRad(p))*o;m=Math.sin(this.game.math.degToRad(p))*o}}var l=null;if(this.autoExpandBulletsGroup){l=this.bullets.getFirstExists(false,true,z,w,this.bulletKey,this.bulletFrame);l.data.bulletManager=this}else{l=this.bullets.getFirstExists(false)}if(l){l.reset(z,w);l.data.fromX=z;l.data.fromY=w;l.data.killType=this.bulletKillType;l.data.killDistance=this.bulletKillDistance;l.data.rotateToVelocity=this.bulletRotateToVelocity;if(this.bulletKillType===e.Weapon.KILL_LIFESPAN){l.lifespan=this.bulletLifespan}l.angle=p+this.bulletAngleOffset;if(this.bulletAnimation!==""){if(l.animations.getAnimation(this.bulletAnimation)===null){var q=this.anims[this.bulletAnimation];l.animations.add(q.name,q.frames,q.frameRate,q.loop,q.useNumericIndex)}l.animations.play(this.bulletAnimation)}else{if(this.bulletFrameCycle){l.frame=this.bulletFrames[this.bulletFrameIndex];this.bulletFrameIndex++;if(this.bulletFrameIndex>=this.bulletFrames.length){this.bulletFrameIndex=0}}else{if(this.bulletFrameRandom){l.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]}}}if(l.data.bodyDirty){if(this._data.customBody){l.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY)}l.body.collideWorldBounds=this.bulletCollideWorldBounds;l.data.bodyDirty=false}l.body.velocity.set(n,m);l.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);var s=0;if(this.bulletSpeedVariance!==0){var u=this.fireRate;u+=e.Math.between(-this.fireRateVariance,this.fireRateVariance);if(u<0){u=0}s=this.game.time.now+u}else{s=this.game.time.now+this.fireRate}if(this.multiFire){if(!this._hasFired){this._hasFired=true;this._tempNextFire=s;this.shots++}}else{this._nextFire=s;this.shots++}this.onFire.dispatch(l,this,o);if(this.fireLimit>0&&this.shots===this.fireLimit){this.onFireLimit.dispatch(this,this.fireLimit)}}return l};e.Weapon.prototype.fireAtPointer=function(l){if(l===undefined){l=this.game.input.activePointer}return this.fire(null,l.worldX,l.worldY)};e.Weapon.prototype.fireAtSprite=function(l){return this.fire(null,l.world.x,l.world.y)};e.Weapon.prototype.fireAtXY=function(l,m){return this.fire(null,l,m)};e.Weapon.prototype.setBulletBodyOffset=function(n,m,l,o){if(l===undefined){l=0}if(o===undefined){o=0}this._data.customBody=true;this._data.width=n;this._data.height=m;this._data.offsetX=l;this._data.offsetY=o;this.bullets.callAll("body.setSize","body",n,m,l,o);this.bullets.setAll("data.bodyDirty",false);return this};e.Weapon.prototype.setBulletFrames=function(n,l,m,o){if(m===undefined){m=true}if(o===undefined){o=false}this.bulletFrames=e.ArrayUtils.numberArray(n,l);this.bulletFrameIndex=0;this.bulletFrameCycle=m;this.bulletFrameRandom=o;return this};e.Weapon.prototype.addBulletAnimation=function(o,p,n,m,l){this.anims[o]={name:o,frames:p,frameRate:n,loop:m,useNumericIndex:l};this.bullets.callAll("animations.add","animations",o,p,n,m,l);this.bulletAnimation=o;return this};e.Weapon.prototype.debug=function(l,n,m){if(l===undefined){l=16}if(n===undefined){n=32}if(m===undefined){m=false}this.game.debug.text("Weapon Plugin",l,n);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,l,n+24);if(m){this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")}};Object.defineProperty(e.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(l){this._bulletClass=l;if(this.bullets){this.bullets.classType=this._bulletClass}}});Object.defineProperty(e.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(l){switch(l){case e.Weapon.KILL_STATIC_BOUNDS:case e.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case e.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case e.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds;break}this._bulletKillType=l}});Object.defineProperty(e.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(l){this._bulletCollideWorldBounds=l;this.bullets.setAll("body.collideWorldBounds",l);this.bullets.setAll("data.bodyDirty",false)}});Object.defineProperty(e.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(l){this.fireFrom.x=l}});Object.defineProperty(e.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(l){this.fireFrom.y=l}});e.Bullet=function(m,l,p,n,o){e.Sprite.call(this,m,l,p,n,o);this.anchor.set(0.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:true,rotateToVelocity:false,killType:0,killDistance:0}};e.Bullet.prototype=Object.create(e.Sprite.prototype);e.Bullet.prototype.constructor=e.Bullet;e.Bullet.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;this.data.bulletManager.onKill.dispatch(this);return this};e.Bullet.prototype.update=function(){if(!this.exists){return}if(this.data.killType>e.Weapon.KILL_LIFESPAN){if(this.data.killType===e.Weapon.KILL_DISTANCE){if(this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,true)>this.data.killDistance){this.kill()}}else{if(!this.data.bulletManager.bulletBounds.intersects(this)){this.kill()}}}if(this.data.rotateToVelocity){this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)}if(this.data.bulletManager.bulletWorldWrap){this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding)}};e.Video=function(m,o,n){if(o===undefined){o=null}if(n===undefined){n=null}this.game=m;this.key=o;this.width=0;this.height=0;this.type=e.VIDEO;this.disableTextureUpload=false;this.touchLocked=false;this.onPlay=new e.Signal();this.onChangeSource=new e.Signal();this.onComplete=new e.Signal();this.onAccess=new e.Signal();this.onError=new e.Signal();this.onTimeout=new e.Signal();this.timeout=15000;this._timeOutID=null;this.video=null;this.videoStream=null;this.isStreaming=false;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._codeMuted=false;this._muted=false;this._codePaused=false;this._paused=false;this._pending=false;this._pendingChangeSource=false;this._autoplay=false;this._endCallback=null;this._playCallback=null;if(o&&this.game.cache.checkVideoKey(o)){var l=this.game.cache.getVideo(o);if(l.isBlob){this.createVideoFromBlob(l.data)}else{this.video=l.data}this.width=this.video.videoWidth;this.height=this.video.videoHeight}else{if(n){this.createVideoFromURL(n,false)}}if(this.video&&!n){this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution);this.baseTexture.forceLoaded(this.width,this.height)}else{this.baseTexture=new PIXI.BaseTexture(e.Cache.DEFAULT.baseTexture.source,null,this.game.resolution);this.baseTexture.forceLoaded(this.width,this.height)}this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new e.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=false;if(o!==null&&this.video){this.texture.valid=this.video.canplay}this.snapshot=null;if(e.BitmapData){this.snapshot=new e.BitmapData(this.game,"",this.width,this.height)}if(!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.setTouchLock()}else{if(l){l.locked=false}}};e.Video.prototype={connectToMediaStream:function(l,m){if(l&&m){this.video=l;this.videoStream=m;this.isStreaming=true;this.baseTexture.source=this.video;this.updateTexture(null,this.video.videoWidth,this.video.videoHeight);this.onAccess.dispatch(this)}return this},startMediaStream:function(o,n,l){if(o===undefined){o=false}if(n===undefined){n=null}if(l===undefined){l=null}if(!this.game.device.getUserMedia){this.onError.dispatch(this,"No getUserMedia");return false}if(this.videoStream!==null){if(this.videoStream.active){this.videoStream.active=false}else{this.videoStream.stop()}}this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");if(n!==null){this.video.width=n}if(l!==null){this.video.height=l}this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:o,video:true},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(m){this.getUserMediaError(m)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(l){clearTimeout(this._timeOutID);this.onError.dispatch(this,l)},getUserMediaSuccess:function(m){clearTimeout(this._timeOutID);this.videoStream=m;if(this.video.mozSrcObject!==undefined){this.video.mozSrcObject=m}else{this.video.src=(window.URL&&window.URL.createObjectURL(m))||m}var l=this;this.video.onloadeddata=function(){var n=10;function o(){if(n>0){if(l.video.videoWidth>0){var q=l.video.videoWidth;var p=l.video.videoHeight;if(isNaN(l.video.videoHeight)){p=q/(4/3)}l.video.play();l.isStreaming=true;l.baseTexture.source=l.video;l.updateTexture(null,q,p);l.onAccess.dispatch(l)}else{window.setTimeout(o,500)}}else{console.warn("Unable to connect to video stream. Webcam error?")}n--}o()}},createVideoFromBlob:function(l){var m=this;this.video=document.createElement("video");this.video.controls=false;this.video.setAttribute("autoplay","autoplay");this.video.addEventListener("loadeddata",function(n){m.updateTexture(n)},true);this.video.src=window.URL.createObjectURL(l);this.video.canplay=true;return this},createVideoFromURL:function(l,m){if(m===undefined){m=false}if(this.texture){this.texture.valid=false}this.video=document.createElement("video");this.video.controls=false;if(m){this.video.setAttribute("autoplay","autoplay")}this.video.src=l;this.video.canplay=true;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=l;return this},updateTexture:function(n,m,l){var o=false;if(m===undefined||m===null){m=this.video.videoWidth;o=true}if(l===undefined||l===null){l=this.video.videoHeight}this.width=m;this.height=l;if(this.baseTexture.source!==this.video){this.baseTexture.source=this.video}this.baseTexture.forceLoaded(m,l);this.texture.frame.resize(m,l);this.texture.width=m;this.texture.height=l;this.texture.valid=true;if(this.snapshot){this.snapshot.resize(m,l)}if(o&&this.key!==null){this.onChangeSource.dispatch(this,m,l);if(this._autoplay){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}}},complete:function(){this.onComplete.dispatch(this)},play:function(l,m){if(this._pendingChangeSource){return this}if(l===undefined){l=false}if(m===undefined){m=1}if(this.game.sound.onMute){this.game.sound.onMute.add(this.setMute,this);this.game.sound.onUnMute.add(this.unsetMute,this);if(this.game.sound.mute){this.setMute()}}this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener("ended",this._endCallback,true);this.video.addEventListener("webkitendfullscreen",this._endCallback,true);if(l){this.video.loop="loop"}else{this.video.loop=""}this.video.playbackRate=m;if(this.touchLocked){this._pending=true}else{this._pending=false;if(this.key!==null){if(this.video.readyState!==4){this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{this._playCallback=this.playHandler.bind(this);this.video.addEventListener("playing",this._playCallback,true)}}this.video.play();this.onPlay.dispatch(this,l,m)}return this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,true);this.updateTexture()},stop:function(){if(this.game.sound.onMute){this.game.sound.onMute.remove(this.setMute,this);this.game.sound.onUnMute.remove(this.unsetMute,this)}this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);if(this.isStreaming){if(this.video.mozSrcObject){this.video.mozSrcObject.stop();this.video.src=null}else{this.video.src="";if(this.videoStream.active){this.videoStream.active=false}else{if(this.videoStream.getTracks){this.videoStream.getTracks().forEach(function(l){l.stop()})}else{this.videoStream.stop()}}}this.videoStream=null;this.isStreaming=false}else{this.video.removeEventListener("ended",this._endCallback,true);this.video.removeEventListener("webkitendfullscreen",this._endCallback,true);this.video.removeEventListener("playing",this._playCallback,true);if(this.touchLocked){this._pending=false}else{this.video.pause()}}return this},add:function(l){if(Array.isArray(l)){for(var m=0;m<l.length;m++){if(l[m]["loadTexture"]){l[m].loadTexture(this)}}}else{l.loadTexture(this)}return this},addToWorld:function(m,r,l,q,o,n){o=o||1;n=n||1;var p=this.game.add.image(m,r,this);p.anchor.set(l,q);p.scale.set(o,n);return p},render:function(){if(!this.disableTextureUpload&&this.playing){this.baseTexture.dirty()}},setMute:function(){if(this._muted){return}this._muted=true;this.video.muted=true},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;this.video.muted=false},setPause:function(){if(this._paused||this.touchLocked){return}this._paused=true;this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked){return}this._paused=false;if(!this.video.ended){this.video.play()}},changeSource:function(m,l){if(l===undefined){l=true}this.texture.valid=false;this.video.pause();this._pendingChangeSource=true;this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=m;this.video.load();this._autoplay=l;if(!l){this.paused=true}return this},checkVideoProgress:function(){if(this.video.readyState===4){this._pendingChangeSource=false;this.updateTexture()}else{this.retry--;if(this.retry>0){this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming)}}},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this);this.touchLocked=true},unlock:function(){this.touchLocked=false;this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var l=this.game.cache.getVideo(this.key);if(l&&!l.isBlob){l.locked=false}}return true},grab:function(l,n,m){if(l===undefined){l=false}if(n===undefined){n=1}if(m===undefined){m=null}if(this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}if(l){this.snapshot.cls()}this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,n,m);return this.snapshot},removeVideoElement:function(){if(!this.video){return}if(this.video.parentNode){this.video.parentNode.removeChild(this.video)}while(this.video.hasChildNodes()){this.video.removeChild(this.video.firstChild)}this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null},destroy:function(){this.stop();this.removeVideoElement();if(this.touchLocked){this.game.input.touch.removeTouchLockCallback(this.unlock,this)}if(this._retryID){window.clearTimeout(this._retryID)}}};Object.defineProperty(e.Video.prototype,"currentTime",{get:function(){return(this.video)?this.video.currentTime:0},set:function(l){this.video.currentTime=l}});Object.defineProperty(e.Video.prototype,"duration",{get:function(){return(this.video)?this.video.duration:0}});Object.defineProperty(e.Video.prototype,"progress",{get:function(){return(this.video)?(this.video.currentTime/this.video.duration):0}});Object.defineProperty(e.Video.prototype,"mute",{get:function(){return this._muted},set:function(l){l=l||null;if(l){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(e.Video.prototype,"paused",{get:function(){return this._paused},set:function(l){l=l||null;if(this.touchLocked){return}if(l){if(this._paused){return}this._codePaused=true;this.setPause()}else{if(!this._paused){return}this._codePaused=false;this.setResume()}}});Object.defineProperty(e.Video.prototype,"volume",{get:function(){return(this.video)?this.video.volume:1},set:function(l){if(l<0){l=0}else{if(l>1){l=1}}if(this.video){this.video.volume=l}}});Object.defineProperty(e.Video.prototype,"playbackRate",{get:function(){return(this.video)?this.video.playbackRate:1},set:function(l){if(this.video){this.video.playbackRate=l}}});Object.defineProperty(e.Video.prototype,"loop",{get:function(){return(this.video)?this.video.loop:false},set:function(l){if(l&&this.video){this.video.loop="loop"}else{if(this.video){this.video.loop=""}}}});Object.defineProperty(e.Video.prototype,"playing",{get:function(){return(this.video)?!(this.video.paused&&this.video.ended):false}});e.Video.prototype.constructor=e.Video;if(PIXI.blendModes===undefined){PIXI.blendModes=e.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=e.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix()}PIXI.TextureSilentFail=true;PIXI.canUseNewCanvasBlendModes=function(){return e.Device.canUseMultiply};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=e}exports.Phaser=e}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return h.Phaser=e})())}else{h.Phaser=e}}return e}).call(this);