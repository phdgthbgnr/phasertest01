var playState={init:function(b){this.nbballfrz=0;this.levelFrz=b.levelFrz;this.levelID=b.levelID;this.score=b.score;this.actuallife=b.curpts;this.difficulty=b.difficulty;var a=0;switch(this.levelID){case 1:this.ptslife=100;break;case 2:if(b.elovfrz==1){a=100-b.curpts}this.ptslife=150;break;case 3:if(b.elovfrz==1){a=150-b.curpts}this.ptslife=200;break;case 4:if(b.elovfrz==1){a=200-b.curpts}this.ptslife=250;break;case 5:if(b.elovfrz==1){a=250-b.curpts}this.ptslife=300;break}if(b.elovfrz==1){this.actuallife=this.ptslife-a}switch(this.levelID){case 2:this.nbballfrz=4;break;case 3:this.nbballfrz=0;break;case 4:this.nbballfrz=3;break;case 5:this.nbballfrz=0;break}if(b.evolfrz==0){this.nbballfrz=0}},preload:function(){game.addDisplayLoader();game.load.onFileComplete.add(this.filecomplete,this);game.load.onLoadComplete.add(this.loadcomplete,this);game.load.image("level",game.pathText+"level"+this.levelID+".png");game.load.image("lifepoint",game.pathText+"lifepoints-1.png");game.load.image("dragonballs",game.pathText+"dragonballs.png");game.load.image("points",game.pathImg+"png/ball.png");game.load.image("mask",game.pathImg+"png/mask.png");game.load.image("lifes",game.pathImg+"png/lifes.png");switch(this.levelID){case 1:game.load.spritesheet("goku",game.pathImg+"png/goku_lt_idle.png",130*game.mratio,184*game.mratio);break;case 2:game.load.spritesheet("goku",game.pathImg+"png/Goku_2.png",130*game.mratio,184*game.mratio);break;case 3:game.load.spritesheet("goku",game.pathImg+"png/Goku_3.png",130*game.mratio,184*game.mratio);break;case 4:game.load.spritesheet("goku",game.pathImg+"png/Goku_4.png",130*game.mratio,184*game.mratio);break;case 5:game.load.spritesheet("goku",game.pathImg+"png/Goku_5.png",130*game.mratio,184*game.mratio);break}game.load.spritesheet("fireball",game.pathImg+"png/fireball.png",240*game.mratio,240*game.mratio);game.load.spritesheet("movin1",game.pathImg+"png/move_lines1.png",200*game.mratio,70*game.mratio);game.load.spritesheet("movin2",game.pathImg+"png/move_lines2.png",200*game.mratio,70*game.mratio);switch(this.levelFrz){case 1:game.load.spritesheet("freezerlt",game.pathImg+"png/freezer_1.png",113*game.mratio,150*game.mratio);game.load.audio("music",[game.pathSnd+"Music_1_Fight1.mp3",game.pathSnd+"Music_1_Fight1.m4a",game.pathSnd+"Music_1_Fight1.ogg"]);break;case 2:game.load.spritesheet("freezerlt",game.pathImg+"png/freezer_2.png",113*game.mratio,150*game.mratio);game.load.audio("music",[game.pathSnd+"Music_1_Fight2.mp3",game.pathSnd+"Music_1_Fight2.m4a",game.pathSnd+"Music_1_Fight2.ogg"]);break;case 3:game.load.spritesheet("freezerlt",game.pathImg+"png/freezer_3.png",113*game.mratio,150*game.mratio);game.load.audio("music",[game.pathSnd+"Music_1_Fight3.mp3",game.pathSnd+"Music_1_Fight3.m4a",game.pathSnd+"Music_1_Fight3.ogg"]);break}game.load.audio("firefreezer",[game.pathSnd+"Sound_1_Attack1.mp3",game.pathSnd+"Sound_1_Attack1.m4a",game.pathSnd+"Sound_1_Attack1.ogg"]);game.load.audio("showball",[game.pathSnd+"Sound_1_DBAppear.mp3",game.pathSnd+"Sound_1_DBAppear.m4a",game.pathSnd+"Sound_1_DBAppear.ogg"]);game.load.audio("catchball",[game.pathSnd+"Sound_1_DBCollect.mp3",game.pathSnd+"Sound_1_DBCollect.m4a",game.pathSnd+"Sound_1_DBCollect.ogg"]);game.load.audio("hit",[game.pathSnd+"Sound_1_Hit.mp3",game.pathSnd+"Sound_1_Hit.m4a",game.pathSnd+"Sound_1_Hit.ogg"]);game.load.audio("move",[game.pathSnd+"Sound_1_Move.mp3",game.pathSnd+"Sound_1_Move.m4a",game.pathSnd+"Sound_1_Move.ogg"]);game.load.audio("evol",[game.pathSnd+"Sound_1_EvolutionEvent.mp3",game.pathSnd+"Sound_1_EvolutionEvent.m4a",game.pathSnd+"Sound_1_EvolutionEvent.ogg"]);game.load.image("tracking06",game.pathTrack+"pixel.gif?r=play"+this.levelID+"&f="+this.levelFrz+"&diff="+this.difficulty)},create:function(){this.music=game.add.audio("music");this.firefreezer=game.add.audio("firefreezer");this.firefreezer.allowMultiple=true;this.sndhit=game.add.audio("hit");this.sndhit.allowMultiple=true;this.sndball=game.add.audio("showball");this.sndball.allowMultiple=true;this.sndcatch=game.add.audio("catchball");this.sndcatch.allowMultiple=true;this.sndmove=game.add.audio("move");this.sndmove.allowMultiple=true;this.sndevol=game.add.audio("evol");this.played=false;this.speedgoku=100;this.maxtime=100;this.pointerx=game.world.centerX;this.speedfiremin=80*this.difficulty;this.speedfiremax=140*this.difficulty;this.maxfire=3;this.midgoku=0;this.maxrangefrzr=6;this.minrangefrzr=1;this.mindfrzr=Math.round(6/this.difficulty);this.maxdfrzr=Math.round(16/this.difficulty);this.rgfrzr=-1;this.curfball=0;this.curdball=this.score;this.maxdball=7;this.catchdball=false;this.points=new Array();this.damage=game.freezerforce;this.gokuanchorx=0.5;this.skylayer=game.add.group();var a=this.skylayer.create(0,0,"sky");var o=this.skylayer.create(0,0,"sky");var j=game.add.sprite(0,0,"ground");game.set2Scale(a);game.set2Scale(o);o.x=a.width-1;if(game.testScroll){this.scrollsky()}game.set2Scale(j);this.goku=game.add.sprite(game.world.centerX,game.height,"goku");this.goku.smoothed=true;this.goku.anchor.setTo(0.5,1);this.freezerlt=game.add.sprite(game.world.centerX,game.get1Position(80),"freezerlt");this.freezerlt.smoothed=true;this.freezerlt.anchor.x=0.5;this.freezerlt.anchor.y=0.5;game.set2Scale(this.freezerlt);this.dragonball=game.add.sprite(-100,-100,"dballs");this.dragonball.anchor.x=0.5;this.dragonball.anchor.y=1;this.dragonball.smoothed=true;game.set2Scale(this.dragonball);this.dragonball.y=game.height;this.dragonball.animations.add("ball1",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],12,true);this.dragonball.animations.add("ball2",[24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47],12,true);this.dragonball.animations.add("ball3",[48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71],12,true);this.dragonball.animations.add("ball4",[72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],12,true);this.dragonball.animations.add("ball5",[96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119],12,true);this.dragonball.animations.add("ball6",[120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143],12,true);this.dragonball.animations.add("ball7",[144,145,146,,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167],12,true);this.physics.enable(this.dragonball,Phaser.Physics.ARCADE);this.dragonball.body.collideWorldBounds=true;this.dragonball.body.bounce.y=0.5;this.dragonball.body.gravity.y=600;this.dragonball.body.velocity.y=400;this.dragonball.kill();this.goku.animations.add("idle",[0,1,2,3,4,5,6,7,8,9,10,11,10,9,8,7,6,5,4,3,2,1],12,true);this.goku.animations.add("die",[12,13,14,15,16,17,18],12,false);this.goku.animations.add("evol",[19,20,21,22,23,23,23,23,23],12,false);this.goku.animations.add("catch",[19,20,21,22,23,22,21,20,19],18,false);this.goku.animations.play("idle");this.freezerlt.animations.add("idle",[0,1,2,3,4,5,6,7,8,9,10,11,12,11,10,9,8,7,6,5,4,3,2,1],12,true);this.freezerlt.animations.add("evol",[12,13,14,15,16,17,18,,19,20,21,22,23,23,23,23,23,23],12,false);this.freezerlt.animations.play("idle");this.movelined=this.goku.addChild(game.make.sprite(0,-30,"movin1"));this.movelined.anchor.set(1,1);game.set2Scale(this.movelined);this.movelined.animations.add("lines",[0,0,1,3,5,7,9,11,13,15],18,false);this.movelineg=this.goku.addChild(game.make.sprite(0,-30,"movin2"));this.movelineg.anchor.set(0,1);game.set2Scale(this.movelineg);this.movelineg.animations.add("lines",[0,0,15,13,11,9,7,5,3,1],18,false);this.fireball;this.fireballs=game.add.group();this.fireballs.enableBody=true;this.fireballs.physicsBodyType=Phaser.Physics.ARCADE;this.fireballs.createMultiple(this.maxfire,"fireball");this.fireballs.setAll("anchor.x",0.5);this.fireballs.setAll("anchor.y",0.5);this.fireballs.setAll("outOfBoundsKill",true);this.fireballs.setAll("checkWorldBounds",true);this.fireballs.callAll("animations.add","animations","nothing",[0],1,true,true);this.fireballs.callAll("animations.add","animations","fire",[1,2,3],6,true,true);var b=game.add.sprite(0,0,"level");game.set2Scale(b);game.set2Position(0,10,b);var m=game.add.sprite(0,0,"lifepoint");game.set2Scale(m);game.set2Position(0,70,m);var c=game.add.sprite(0,0,"dragonballs");game.set2Scale(c);game.set2Position(0,140,c);var d=game.get1Position(23);for(var e=0;e<this.maxdball;e++){this.points.push(game.add.image(c.x,c.y+c.height,"points"));game.set2Scale(this.points[e]);this.points[e].anchor.x=0.5;this.points[e].anchor.y=1;this.points[e].x=e*this.points[e].width+d+this.points[e].width/2;this.points[e].alpha=0}game.camera.flash(0,600,false);game.set2Scale(this.goku);this.physics.enable(this.goku,Phaser.Physics.ARCADE);var l=Math.round(this.goku.width/1.5);var h=Math.round(this.goku.height/1.5);var g=(this.goku.width-l)/2;var f=(this.goku.height-h)/2;this.goku.body.setSize(l,h,this.goku.width/game.mratio*0.5-l*0.5,this.goku.height/game.mratio*0.5-h*0.5);this.goku.y=game.height;this.midgoku=game.ismobile?Math.round((this.goku.width/2/game.pratio)):0;this.goku.anchor.x=this.gokuanchorx;this.goku.anchor.y=1;this.goku.body.collideWorldBounds=true;this.goku.events.onOutOfBounds.add(this.playerOutOfbounds,this);game.input.doubleTapRate=200;game.input.mouse.enabled=true;game.input.maxPointers=1;game.input.touch.enabled=true;game.input.touch.start();game.input.onDown.add(this.touchDown,this);game.input.onUp.add(this.touchUp,this);game.input.addMoveCallback(this.callbackmove,this);game.input.touch.callbackContext=this;game.input.touch.touchStartCallback=this.onTouchStart;game.input.touch.touchEndCallback=this.onTouchEnd;game.displayLifes(this.actuallife,this.ptslife);if(this.score>0){for(var n=0;n<this.curdball;n++){this.points[n].alpha=1}}var k=this;setTimeout(function(){k.reMoveFreezer()},1000);this.music.play("",0,0.3,true,true);game.addMusicButton();game.addPauseButton();game.time.advancedTiming=true},filecomplete:function(a,d,e,b,c){game.processLoader(a)},loadcomplete:function(){game.destroyLoader()},update:function(){if(game.testScroll){if(game.time.fps<40&&game.time.fps>0){this.killScrollSky()}}game.physics.arcade.overlap(this.goku,this.fireballs,this.collidefireballCallback,null,this);game.physics.arcade.overlap(this.goku,this.dragonball,this.collidedragonballCallback,null,this);var a=game.physics.arcade.distanceToXY(this.goku,this.pointerx,this.goku.y);if(a<0.5){this.goku.body.stopMovement(true);this.goku.x=this.pointerx;this.movelineg.animations.stop(null,true);this.movelined.animations.stop(null,true)}else{game.physics.arcade.moveToXY(this.goku,this.pointerx,game.height,this.speedgoku,this.maxtime);if(this.played){if(this.goku.body.velocity.x>1){this.movelineg.animations.stop(null,true);this.movelined.animations.play("lines")}if(this.goku.body.velocity.x<-1){this.movelined.animations.stop(null,true);this.movelineg.animations.play("lines")}if(this.goku.body.velocity.x>-1&&this.goku.body.velocity.x<1){this.movelined.animations.stop(null,true);this.movelineg.animations.stop(null,true)}}}},collidefireballCallback:function(b,a){a.kill();this.sndhit.play("",0,0.3,false,true);this.actuallife-=this.damage;if(this.actuallife<0){this.music.destroy();game.displayLifes(1,this.ptslife);this.freezerlt.animations.play("evol");this.sndevol.play("",0,0.3,false,true);this.freezerlt.events.onAnimationComplete.addOnce(function(f,d){f.kill();this.fireballs.destroy();this.music.destroy();game.camera.fade(16777215,500);var c=this;setTimeout(function(){game.state.start("loose",true,false,{levelFrz:c.levelFrz})},500)},this)}else{b.animations.play("die");if(this.actuallife>0){game.displayLifes(this.actuallife,this.ptslife)}b.events.onAnimationComplete.addOnce(function(){b.animations.play("idle")},this)}},collidedragonballCallback:function(b,a){a.kill();if(this.curdball<this.maxdball){this.sndcatch.play("",0,0.3,false,true);this.catchdball=false;b.animations.play("catch");b.events.onAnimationComplete.addOnce(function(){b.animations.play("idle")},this);this.points[this.curdball-1].alpha=1;game.add.tween(this.points[this.curdball-1].scale).from({x:3,y:3},800,Phaser.Easing.Elastic.Out,true);game.add.tween(this.points[this.curdball-1]).to({alpha:1},800,Phaser.Easing.Elastic.Out,true)}else{this.points[this.curdball-1].alpha=1;game.add.tween(this.points[this.curdball-1].scale).from({x:3,y:3},800,Phaser.Easing.Elastic.Out,true);game.add.tween(this.points[this.curdball-1]).to({alpha:1},800,Phaser.Easing.Elastic.Out,true);this.levelID++;this.music.destroy();b.animations.play("evol");this.sndevol.play("",0,0.3,false,true);this.freezerlt.alive=false;this.fireballs.destroy();b.events.onAnimationComplete.addOnce(function(){if(this.levelID==6){game.camera.fade(16777215,500);setTimeout(function(){game.state.start("win",true,false)},600)}if(this.levelID<6){game.camera.fade(16777215,500);var c=this;setTimeout(function(){game.state.start("levels",true,false,{levelID:c.levelID,levelFrz:c.levelFrz,score:c.curdball,curpts:c.actuallife,difficulty:c.difficulty})},600)}},this)}},processFireballCallback:function(){return true},render:function(){},scrollsky:function(){this.skylayer.x=0;this.tweensky=game.add.tween(this.skylayer);this.tweensky.to({x:-this.skylayer.width/2},30000,Phaser.Easing.Linear.None,true,0,0,false);this.tweensky.onComplete.add(this.scrollsky,this)},killScrollSky:function(){this.tweensky.stop();game.testScroll=false},touchDown:function(b,a){if(b.interactiveCandidates.length>0&&(b.interactiveCandidates[0].sprite.id=="btpause"||b.interactiveCandidates[0].sprite.id=="btmusic")){return}this.played=true;this.sndmove.play("",0,0.3,false,true);this.pointerx=b.x},touchUp:function(){this.played=false},onTouchStart:function(){},onTouchEnd:function(){},playerOutOfbounds:function(){},fireFireballs:function(){this.curfball++;if(this.curfball>=this.maxfire){this.showBall()}var a=Math.floor(Math.random()*(this.speedfiremax-this.speedfiremin))+this.speedfiremin;this.fireball=this.fireballs.getFirstExists(false);if(this.fireball&&this.freezerlt.alive){this.fireball.reset(this.freezerlt.x,this.freezerlt.y);var b=game.physics.arcade.angleBetween(this.fireball,this.goku);this.fireball.rotation=b;this.fireball.body.setCircle(30*game.mratio,90*game.mratio,90*game.mratio);this.fireball.rotation=b;this.fireball.animations.play("nothing",6,true);this.fireball.scale.setTo(0.1,0.1);var c=5000/(this.difficulty*this.levelFrz);game.physics.arcade.moveToObject(this.fireball,this.goku,a,c);game.add.tween(this.fireball.scale).to({x:game.pratio,y:game.pratio},c,Phaser.Easing.Cubic.Linear,true);var d=this;setTimeout(function(){d.firefreezer.play("",0,0.3,false,true);if(d.fireball){d.fireball.animations.play("fire",6,true)}},100)}},moveFreezer:function(d,b,c){b=b>0?-b:Math.abs(b);var a=game.add.tween(this.freezerlt);a.to({x:game.world.centerX+b},c,Phaser.Easing.Cubic.InOut,true,d,0,false);a.onComplete.add(this.reMoveFreezer,this)},reMoveFreezer:function(){var c=Math.floor(Math.random()*(this.maxdfrzr-this.mindfrzr))+this.mindfrzr;c=(c*300)/(this.levelFrz*6);var b=Math.floor(Math.random()*(this.maxrangefrzr-this.minrangefrzr))+this.minrangefrzr;b=b*20*game.mratio;b=this.rgfrzr>0?-b:b;this.rgfrzr=b;var a=Math.floor(Math.random()*3)+0.3;a=a*1000;this.moveFreezer(c,b,a);this.fireFireballs()},callbackmove:function(){if(this.played==true){this.pointerx=game.input.worldX}},showBall:function(){this.curfball=0;if(!this.catchdball){if(this.curdball<this.maxdball){if(this.levelID>1&&this.curdball==this.nbballfrz&&this.nbballfrz!=0){this.levelFrz++;this.freezerlt.animations.play("evol");this.fireballs.destroy();this.freezerlt.alive=false;this.sndevol.play("",0,0.3,false,true);this.freezerlt.events.onAnimationComplete.addOnce(this.endEvolFreezer,this)}else{this.dragonball.revive();var a=game.get1Position(30);var b=game.world.centerY;this.curdball++;this.dragonball.x=Math.floor(Math.random()*(game.width-a))+a;this.dragonball.y=b;this.dragonball.animations.play("ball"+this.curdball);this.catchdball=true}}}},endEvolFreezer:function(){this.music.destroy();game.camera.fade(16777215,500);var a=this;setTimeout(function(){game.state.start("evolfrz",true,false,{levelID:a.levelID,levelFrz:a.levelFrz,score:a.curdball,curpts:a.actuallife,difficulty:a.difficulty})},600)}};